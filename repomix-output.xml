This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  ISSUE_TEMPLATE/
    content-update.md
  workflows/
    ci.yml
  PULL_REQUEST_TEMPLATE.md
cold-dawn-85a2/
  .vscode/
    settings.json
  public/
    index.html
  src/
    index.ts
  test/
    index.spec.ts
    tsconfig.json
  .editorconfig
  .gitignore
  .prettierrc
  package.json
  tsconfig.json
  vitest.config.mts
  wrangler.jsonc
docs/
  assets/
    footer.png
    home-hero.png
    lighthouse-latest.png
    plan-visit.png
  decisions/
    ADR-TEMPLATE.md
  phase-0/
    content-inventory.md
    gaps-register.md
    mvp-definition.md
    README.md
    risk-register.md
    sitemap.md
    source-of-truth.yml
    working-agreement.md
  connect-card.md
  deploy.md
  ui-handoff.md
  ui-reliability.md
web/
  .github/
    workflows/
      ci.yml
  .vscode/
    extensions.json
    launch.json
  public/
    bulletins/
      2025-12-13.pdf
      2025-12-20.pdf
      2026-01-03.pdf
    _headers
    .assetsignore
  scripts/
    vendor/
      yargs-parser/
        build/
          lib/
            string-utils.js
            yargs-parser-types.js
            yargs-parser.js
    generate-pagefind-index.mjs
    patch-yargs-parser.js
  src/
    assets/
      photos/
        bridge-dusk.jpg
        church-logo-primary.jpg
        club-adventurers-logo.png
        club-pathfinders-logo.png
        first-springfield-exterior.png
        ministries-adventist-community-services-logo.png
        ministries-childrens-ministry-banner.png
        ministries-womens-ministry-logo.png
        ministries-youth-young-adults-ay-logo.png
    components/
      content/
        ContentCard.astro
      global/
        Footer.astro
        Header.astro
        SiteAlert.astro
      media/
        YouTubeEmbed.astro
      sections/
        CardGrid.astro
        EventList.astro
        Hero.astro
        HeroBanner.astro
        PrayerMeetingCallout.astro
        RecurringActivities.astro
        SermonHighlight.astro
        WeeklyHighlights.astro
      ui/
        Banner.astro
        BudgetProgress.astro
        Button.astro
        ButtonLink.astro
        Card.astro
        CardGrid.astro
        Hero.astro
        HighlightsScroller.astro
        MapEmbed.astro
        NoticeBanner.astro
        Schedule.astro
        SectionHeading.astro
        YouTubeEmbed.astro
      Footer.astro
      Header.astro
      PlaceholderPage.astro
      PlanVisitContent.astro
      Welcome.astro
    content/
      announcements/
        2026-01-29-forecast-warning.md
        2026-02-03-food-drive-call.md
        2026-02-05-worship-adjustments.md
        2026-02-07-pathfinder-induction.md
        2026-02-10-board-meeting.md
        2026-02-12-annex-safety-notice.md
        2026-02-12-greeters-needed.md
        2026-02-12-nar-anon-update.md
        2026-02-13-anchored-together-retreat.md
        2026-02-14-table-talk.md
        2026-02-14-youth-sabbath.md
        2026-02-28-matthew-5-bible-study.md
        2026-03-21-guest-speaker.md
        2026-03-28-trivia-night.md
        2026-04-04-he-has-risen.md
        2026-06-19-camp-meeting-closure.md
        2026-07-28-vacation-bible-school.md
        2026-12-19-christmas-program.md
      bulletins/
        2025-12-13.md
        2025-12-20.md
        2026-01-03.md
      devotionals/
        2026/
          02/
            10/
              quiet-strength.md
            11/
              anchored-in-mercy.md
            12/
              steady-faith.md
            13/
              restored-songs.md
      events/
        sabbath-service.md
      ministries/
        adult-sabbath-school.md
        adventist-community-services.md
        bible-study.md
        board-meeting.md
        children.md
        community-meal-spaghetti.md
        media-audio-visual.md
        mens-ministry.md
        music-ministry.md
        pathfinders.md
        sabbath-school.md
        secretary-communications.md
        social-ministry.md
        womens-ministry.md
        youth-young-adults.md
      resources/
        2025/
          12/
            16/
              welcome-packet.md
      updates/
        _building-annex-closed.md
        _email-update-template.md
        _schedule-change.md
        _sms-opt-in-template.md
        _social-voicemail-template.md
        _weather-cancellation.md
        annex-access-paused-for-safety.md
      verses/
        2026/
          02/
            11/
              light-of-hope.md
            12/
              steady-peace.md
    data/
      activities.ts
      announcement-tags.ts
      annual-calendar.json
      budget.json
      site-alert.json
      site-links.json
      site.ts
      videos.json
      weekly-highlights.ts
    layouts/
      BaseLayout.astro
      Layout.astro
    lib/
      announcements.ts
      links.ts
      updates.ts
    pages/
      accessibility/
        index.astro
      api/
        connect-card.ts
      calendar/
        index.astro
      connect/
        about/
          index.astro
        connect-card/
          index.astro
          thank-you.astro
        contact/
          index.astro
        facilities/
          index.astro
        plan-a-visit/
          index.astro
        prayer/
          index.astro
        team/
          index.astro
        worship-with-us/
          index.astro
        index.astro
      events/
        [id].astro
        index.astro
      give/
        index.astro
      join/
        index.astro
      media/
        live/
          index.astro
        videos/
          index.astro
        index.astro
      ministries/
        [id].astro
        index.astro
      privacy/
        index.astro
      resources/
        announcements/
          archive/
            [yyyy]/
              [mm].astro
          tags/
            [tag].astro
          [...page].astro
          [id].astro
          index.astro
          rss.xml.ts
        bulletins/
          index.astro
        daily-bible-verse/
          index.astro
        daily-devotional/
          index.astro
        forms/
          index.astro
        [...id].astro
        index.astro
      search/
        index.astro
      serve/
        index.astro
      updates/
        index.astro
      visit/
        index.astro
      404.astro
      components.astro
      index.astro
      robots.txt.ts
    styles/
      partials/
        calendar-event-page.css
      a11y.css
      global.css
      tokens.css
    content.config.ts
  test-results/
    .last-run.json
  tests/
    e2e/
      content-collections.spec.ts
      mobile.smoke.spec.ts
      phase-5-media-portals.spec.ts
      phase-6-search-and-analytics.spec.ts
      phase-7-a11y.spec.ts
      phase-7-seo.spec.ts
      phase-7-sitefiles.spec.ts
      smoke.spec.ts
  .env.example
  .gitignore
  astro.config 2.mjs
  astro.config.mjs
  hast-util-to-html-8.0.4.tgz
  hast-util-to-html-9.0.5.tgz
  lighthouserc.cjs
  linkinator.config.json
  package.json
  playwright.config.ts
  README.md
  tsconfig.json
  wrangler.jsonc
.editorconfig
.gitignore
.npmrc
.nvmrc
.repomixignore
CODE_OF_CONDUCT.md
CONTRIBUTING.md
LICENSE
lighthouserc-ci.cjs
package.json
README.md
SECURITY.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".github/ISSUE_TEMPLATE/content-update.md">
---
name: Content update
about: Update copy, dates, service times, or links
---

## What needs updating?

## Where on the site?

## Source of truth
(Who confirmed this information?)

## Deadline
</file>

<file path=".github/PULL_REQUEST_TEMPLATE.md">
## What changed?

- 

## Why?

- 

## How to verify

- [ ] I verified links work
- [ ] I checked for obvious copy/typos
- [ ] I confirmed dates/times are correct

## Screenshots (if applicable)
</file>

<file path="cold-dawn-85a2/.vscode/settings.json">
{
	"files.associations": {
		"wrangler.json": "jsonc"
	}
}
</file>

<file path="cold-dawn-85a2/public/index.html">
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Hello, World!</title>
	</head>
	<body>
		<h1 id="heading"></h1>
		<p>This page comes from a static asset stored at `public/index.html` as configured in `wrangler.jsonc`.</p>
		<button id="button" type="button">Fetch a random UUID</button>
		<output id="random" for="button"></output>
		<script>
			fetch('/message')
				.then((resp) => resp.text())
				.then((text) => {
					const h1 = document.getElementById('heading');
					h1.textContent = text;
				});

			const button = document.getElementById("button");
			button.addEventListener("click", () => {
				fetch('/random')
					.then((resp) => resp.text())
					.then((text) => {
						const random = document.getElementById('random');
						random.textContent = text;
					});
			});
		</script>
	</body>
</html>
</file>

<file path="cold-dawn-85a2/src/index.ts">
/**
 * Welcome to Cloudflare Workers! This is your first worker.
 *
 * - Run `npm run dev` in your terminal to start a development server
 * - Open a browser tab at http://localhost:8787/ to see your worker in action
 * - Run `npm run deploy` to publish your worker
 *
 * Bind resources to your worker in `wrangler.jsonc`. After adding bindings, a type definition for the
 * `Env` object can be regenerated with `npm run cf-typegen`.
 *
 * Learn more at https://developers.cloudflare.com/workers/
 */

export default {
	async fetch(request, env, ctx): Promise<Response> {
		const url = new URL(request.url);
		switch (url.pathname) {
			case '/message':
				return new Response('Hello, World!');
			case '/random':
				return new Response(crypto.randomUUID());
			default:
				return new Response('Not Found', { status: 404 });
		}
	},
} satisfies ExportedHandler<Env>;
</file>

<file path="cold-dawn-85a2/test/index.spec.ts">
import { env, createExecutionContext, waitOnExecutionContext, SELF } from 'cloudflare:test';
import { describe, it, expect } from 'vitest';
import worker from '../src';

describe('Hello World user worker', () => {
	describe('request for /message', () => {
		it('/ responds with "Hello, World!" (unit style)', async () => {
			const request = new Request<unknown, IncomingRequestCfProperties>('http://example.com/message');
			// Create an empty context to pass to `worker.fetch()`.
			const ctx = createExecutionContext();
			const response = await worker.fetch(request, env, ctx);
			// Wait for all `Promise`s passed to `ctx.waitUntil()` to settle before running test assertions
			await waitOnExecutionContext(ctx);
			expect(await response.text()).toMatchInlineSnapshot(`"Hello, World!"`);
		});

		it('responds with "Hello, World!" (integration style)', async () => {
			const request = new Request('http://example.com/message');
			const response = await SELF.fetch(request);
			expect(await response.text()).toMatchInlineSnapshot(`"Hello, World!"`);
		});
	});

	describe('request for /random', () => {
		it('/ responds with a random UUID (unit style)', async () => {
			const request = new Request<unknown, IncomingRequestCfProperties>('http://example.com/random');
			// Create an empty context to pass to `worker.fetch()`.
			const ctx = createExecutionContext();
			const response = await worker.fetch(request, env, ctx);
			// Wait for all `Promise`s passed to `ctx.waitUntil()` to settle before running test assertions
			await waitOnExecutionContext(ctx);
			expect(await response.text()).toMatch(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/);
		});

		it('responds with a random UUID (integration style)', async () => {
			const request = new Request('http://example.com/random');
			const response = await SELF.fetch(request);
			expect(await response.text()).toMatch(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/);
		});
	});
});
</file>

<file path="cold-dawn-85a2/test/tsconfig.json">
{
	"extends": "../tsconfig.json",
	"compilerOptions": {
		"types": ["@cloudflare/vitest-pool-workers"]
	},
	"include": ["./**/*.ts", "../worker-configuration.d.ts"],
	"exclude": []
}
</file>

<file path="cold-dawn-85a2/.editorconfig">
# http://editorconfig.org
root = true

[*]
indent_style = tab
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.yml]
indent_style = space
</file>

<file path="cold-dawn-85a2/.gitignore">
# Logs

logs
_.log
npm-debug.log_
yarn-debug.log*
yarn-error.log*
lerna-debug.log*
.pnpm-debug.log*

# Diagnostic reports (https://nodejs.org/api/report.html)

report.[0-9]_.[0-9]_.[0-9]_.[0-9]_.json

# Runtime data

pids
_.pid
_.seed
\*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover

lib-cov

# Coverage directory used by tools like istanbul

coverage
\*.lcov

# nyc test coverage

.nyc_output

# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)

.grunt

# Bower dependency directory (https://bower.io/)

bower_components

# node-waf configuration

.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)

build/Release

# Dependency directories

node_modules/
jspm_packages/

# Snowpack dependency directory (https://snowpack.dev/)

web_modules/

# TypeScript cache

\*.tsbuildinfo

# Optional npm cache directory

.npm

# Optional eslint cache

.eslintcache

# Optional stylelint cache

.stylelintcache

# Microbundle cache

.rpt2_cache/
.rts2_cache_cjs/
.rts2_cache_es/
.rts2_cache_umd/

# Optional REPL history

.node_repl_history

# Output of 'npm pack'

\*.tgz

# Yarn Integrity file

.yarn-integrity

# parcel-bundler cache (https://parceljs.org/)

.cache
.parcel-cache

# Next.js build output

.next
out

# Nuxt.js build / generate output

.nuxt
dist

# Gatsby files

.cache/

# Comment in the public line in if your project uses Gatsby and not Next.js

# https://nextjs.org/blog/next-9-1#public-directory-support

# public

# vuepress build output

.vuepress/dist

# vuepress v2.x temp and cache directory

.temp
.cache

# Docusaurus cache and generated files

.docusaurus

# Serverless directories

.serverless/

# FuseBox cache

.fusebox/

# DynamoDB Local files

.dynamodb/

# TernJS port file

.tern-port

# Stores VSCode versions used for testing VSCode extensions

.vscode-test

# yarn v2

.yarn/cache
.yarn/unplugged
.yarn/build-state.yml
.yarn/install-state.gz
.pnp.\*

# wrangler project

.dev.vars*
!.dev.vars.example
.env*
!.env.example
.wrangler/
</file>

<file path="cold-dawn-85a2/.prettierrc">
{
	"printWidth": 140,
	"singleQuote": true,
	"semi": true,
	"useTabs": true
}
</file>

<file path="cold-dawn-85a2/package.json">
{
	"name": "cold-dawn-85a2",
	"version": "0.0.0",
	"private": true,
	"scripts": {
		"deploy": "wrangler deploy",
		"dev": "wrangler dev",
		"start": "wrangler dev",
		"test": "vitest",
		"cf-typegen": "wrangler types"
	},
	"devDependencies": {
		"@cloudflare/vitest-pool-workers": "^0.8.19",
		"typescript": "^5.5.2",
		"vitest": "~3.2.0",
		"wrangler": "4.55.0"
	}
}
</file>

<file path="cold-dawn-85a2/tsconfig.json">
{
	"compilerOptions": {
		/* Visit https://aka.ms/tsconfig.json to read more about this file */

    /* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */
		"target": "es2024",
    /* Specify a set of bundled library declaration files that describe the target runtime environment. */
		"lib": ["es2024"],
    /* Specify what JSX code is generated. */
		"jsx": "react-jsx",

    /* Specify what module code is generated. */
		"module": "es2022",
    /* Specify how TypeScript looks up a file from a given module specifier. */
		"moduleResolution": "Bundler",
    /* Enable importing .json files */
		"resolveJsonModule": true,

    /* Allow JavaScript files to be a part of your program. Use the `checkJS` option to get errors from these files. */
		"allowJs": true,
    /* Enable error reporting in type-checked JavaScript files. */
		"checkJs": false,

    /* Disable emitting files from a compilation. */
		"noEmit": true,

    /* Ensure that each file can be safely transpiled without relying on other imports. */
		"isolatedModules": true,
    /* Allow 'import x from y' when a module doesn't have a default export. */
		"allowSyntheticDefaultImports": true,
    /* Ensure that casing is correct in imports. */
		"forceConsistentCasingInFileNames": true,

    /* Enable all strict type-checking options. */
		"strict": true,

    /* Skip type checking all .d.ts files. */
		"skipLibCheck": true,
		"types": [
			"./worker-configuration.d.ts"
		]
	},
	"exclude": ["test"],
	"include": ["worker-configuration.d.ts", "src/**/*.ts"]
}
</file>

<file path="cold-dawn-85a2/vitest.config.mts">
import { defineWorkersConfig } from '@cloudflare/vitest-pool-workers/config';

export default defineWorkersConfig({
	test: {
		poolOptions: {
			workers: {
				wrangler: { configPath: './wrangler.jsonc' },
			},
		},
	},
});
</file>

<file path="cold-dawn-85a2/wrangler.jsonc">
/**
 * For more details on how to configure Wrangler, refer to:
 * https://developers.cloudflare.com/workers/wrangler/configuration/
 */
{
	"$schema": "node_modules/wrangler/config-schema.json",
	"name": "cold-dawn-85a2",
	"main": "src/index.ts",
	"compatibility_date": "2025-12-16",
	"compatibility_flags": [
		"global_fetch_strictly_public"
	],
	"assets": {
		// The path to the directory containing the `index.html` file to be served at `/`
		"directory": "./public"
	},
	"observability": {
		"enabled": true
	}
	/**
	 * Smart Placement
	 * https://developers.cloudflare.com/workers/configuration/smart-placement/#smart-placement
	 */
	// "placement": {  "mode": "smart" }
	/**
	 * Bindings
	 * Bindings allow your Worker to interact with resources on the Cloudflare Developer Platform, including
	 * databases, object storage, AI inference, real-time communication and more.
	 * https://developers.cloudflare.com/workers/runtime-apis/bindings/
	 */
	/**
	 * Environment Variables
	 * https://developers.cloudflare.com/workers/wrangler/configuration/#environment-variables
	 * Note: Use secrets to store sensitive data.
	 * https://developers.cloudflare.com/workers/configuration/secrets/
	 */
	// "vars": {  "MY_VARIABLE": "production_value" }
	/**
	 * Service Bindings (communicate between multiple Workers)
	 * https://developers.cloudflare.com/workers/wrangler/configuration/#service-bindings
	 */
	// "services": [  {   "binding": "MY_SERVICE",   "service": "my-service"  } ]
}
</file>

<file path="docs/decisions/ADR-TEMPLATE.md">
# ADR: <Title>

## Status
Proposed | Accepted | Superseded

## Context
What problem are we solving?

## Decision
What did we decide?

## Consequences
What tradeoffs does this create?

## Date
YYYY-MM-DD
</file>

<file path="docs/phase-0/content-inventory.md">
# Content + Asset Inventory

## Brand assets
- [ ] Logo (full color)
- [ ] Logo (white)
- [ ] Logo (black)
- [ ] Favicon / square mark

## Photography
Minimum goal: 10–20 photos
- [ ] Exterior building shot
- [ ] Sanctuary/worship
- [ ] Small group / fellowship
- [ ] Pastoral/leadership portrait (if published)
- [ ] Ministry activity photos

## Bulletins
- [ ] Current bulletin PDF
- [ ] Archive PDFs (start date: TBD)

### Bulletin naming rule (proposal)
- `YYYY-MM-DD-bulletin.pdf`

## Ministries
Starter set (TBD):
- [ ] Youth
- [ ] Women
- [ ] Men
- [ ] Kids
- [ ] Music

## Events
- [ ] List next 5–10 events with title, date/time, short description, location

## Publishing permissions
- [ ] Confirm whether we can publish photos with children/faces
- [ ] Confirm if we need written consent for close-ups
</file>

<file path="docs/phase-0/gaps-register.md">
# Gaps Register

| Gap | Why it matters | Owner | Due date | Status | Where it will be stored |
|---|---|---:|---:|---|---|
| Public contact email | Contact + footer consistency | TBD | TBD | Open | source-of-truth.yml |
| Leadership list | Team page + ministry contacts | TBD | TBD | Open | source-of-truth.yml / content files |
| Bulletin archive start date | Archive page + naming rules | TBD | TBD | Open | content-inventory.md |
| Official social links | Header/footer + trust | TBD | TBD | Open | site-links.json |
| Language policy | Site IA + content workflow | TBD | TBD | Open | working-agreement.md |
| Photo permissions policy | Privacy + trust | TBD | TBD | Open | content-inventory.md |
| Analytics choice | Reporting + privacy posture | TBD | TBD | Open | ADR |
</file>

<file path="docs/phase-0/mvp-definition.md">
# MVP Definition

## Primary visitor goals
1. Find service times in under 10 seconds.
2. Get directions and contact the church.
3. Watch live or access the latest videos.
4. See upcoming events.
5. Find the giving link.
6. Submit a prayer request or contact form (external portal acceptable).

## MVP pages
- Home
- Plan a Visit
- Worship With Us
- About
- Contact
- Live
- Videos
- Events (hub + detail)
- Ministries (hub + detail)
- Bulletins (current + archive)

## MVP portals (external)
- Giving
- Prayer request form
- Contact form (if separate)

## MVP acceptance criteria (high-level)
- Home page shows service times + address + Watch Live + Give.
- Contact page includes at least one working method (email or phone) and directions.
- Live page includes embedded YouTube (when available) and a fallback link to the channel.
- Every portal link is tested on mobile.

## Out of scope for MVP
- Member login
- Payment processing on-site
- Custom database/admin panel
- Custom admin UI
</file>

<file path="docs/phase-0/README.md">
# Phase 0 (Initiation)

This folder contains the documents that unblock Phase 1.

**Exit criteria:**
- MVP scope + sitemap approved
- gaps assigned with owners + due dates
- source-of-truth file created
- domain approach decided
- content inventory plan created
- working agreement captured
</file>

<file path="docs/phase-0/risk-register.md">
# Risk Register

| Risk | Likelihood | Impact | Mitigation | Owner |
|---|---|---|---|---|
| Missing critical content (email, photos, bulletins) | Med | High | Assign owners + due dates in Gaps Register | TBD |
| Live embed fails on mobile networks | Med | High | Always include fallback link + “If stream doesn’t load” copy | TBD |
| Form spam | Med | Med | Start with Google Forms; consider Turnstile later for custom endpoint | TBD |
| Volunteer bandwidth drops | High | Med | Keep MVP small; defer nice-to-haves to backlog | TBD |
| Portal URLs change | Med | Med | Centralize links in a single config and re-check monthly | TBD |
| Wrong service times posted | Low | High | Source-of-truth file + explicit approver for schedule changes | TBD |
| Copyright/media issues | Low | High | Use only approved photos/music thumbnails; document source/permission | TBD |
</file>

<file path="docs/phase-0/sitemap.md">
# Sitemap (Draft)

## Primary navigation
- Home (/)
- Connect
  - Plan a Visit (/connect/plan-a-visit)
  - Worship With Us (/connect/worship-with-us)
  - About (/connect/about)
  - Events (/connect/events)
  - Team (/connect/team)
  - Contact (/connect/contact)
- Join
  - Membership (/join/membership)
  - Baptism (/join/baptism)
- Ministries
  - Directory (/ministries)
  - Detail pages (/ministries/<slug>)
- Resources
  - Forms (/resources/forms)
  - Prayer (/resources/prayer)
  - Study (/resources/study)
  - Bulletins (/resources/bulletin)
- Serve
  - Volunteer (/serve)
- Media
  - Live (/media/live)
  - Videos (/media/videos)

## Quick actions (header)
- Give (external)
- Request Prayer (external or /resources/prayer)
- Bulletin (/resources/bulletin)
- Forms (/resources/forms)
- Watch Live (/media/live)

## Notes
- Keep labels short and familiar.
- Avoid making visitors guess. Use “Plan a Visit” not “New Here?” if that fits your audience.
</file>

<file path="docs/phase-0/working-agreement.md">
# Working Agreement

## Decision-making
- Project owner: TBD
- Content approver: TBD
- Technical maintainer: TBD

## Change workflow
- Small edits (typos, broken links): maintainer can ship same day.
- Schedule changes: require content approver confirmation.
- New pages/sections: require project owner approval.

## Review cadence
- Weekly 15–30 min check-in during Phase 1.
- Emergency fixes as needed.

## Definition of Ready (for Phase 1 tasks)
A task is ready when:
- goal is clear
- acceptance criteria exist
- content (or placeholder) exists
- owner/approver is known
</file>

<file path="docs/deploy.md">
# Deploy notes

This repo builds with Astro + the Cloudflare Worker adapter, so the site ships as static files plus SSR routes that run inside Cloudflare Pages/Workers. The following steps keep deployments reproducible for preview and production when you need to demo or hand off to someone else.

## Environment variables

- `PUBLIC_SITE_URL` (set in CI + Pages) defines the canonical host for sitemap/robots/meta tags. CI exports it as `http://127.0.0.1:4321` to make `astro` render deterministic assets (robots, sitemap, canonical URLs). The same value should match the Pages preview/production domain so absolute URLs stay consistent.
- Cloudflare secrets (Cloudflare Pages project settings or `wrangler publish`) typically include `CF_ACCOUNT_ID`, `CF_PROJECT_NAME`, and a `CF_API_TOKEN` scoped to publish `pages` & `workers`. Keep them in GitHub secrets or the Pages dashboard and never hardcode them in `web/`.

## Preview workflow

1. From the repo root run `cd web && npm install`.
2. Build and preview with `npm run preview`; Astro uses the Cloudflare adapter and starts a local preview server—any absolute URLs honor `PUBLIC_SITE_URL` if you export it before running the command.
3. For emulator parity you can run `npx wrangler dev --local --ip 127.0.0.1 --port 4321` to exercise the Cloudflare Worker runtime; combine this with `npm run build` so the server uses the exact SSR bundle that Pages would deploy.

## Production deployments

1. Cloudflare Pages automatically picks up `web/` (build command `npm run build`) and uses `wrangler publish` under the hood when you connect the GitHub repo.
2. Ensure the Pages project’s production branch matches `main`/`master` and the `PUBLIC_SITE_URL` secret equals the published domain (e.g., `https://firstspringfieldma.adventistchurch.org`). This keeps canonical tags and sitemap URLs stable.
3. When you push, the existing CI job runs `npm run test:e2e:ci`, `npm run test:links:ci`, and `lhci` assertions before handing the built `web/dist` folder off to Pages.

## Verifying sitemap + robots + canonical output

1. After `npm run build`, inspect `web/dist/sitemap.xml` and `web/dist/robots.txt` to confirm URLs point to `PUBLIC_SITE_URL`.
2. The CI job already sets the same environment variable and runs `npm run build`, meaning the generated files in CI should match the deployed output. Re-run `npm run lighthouse` locally to surface canonical/robots warnings if they regress.
3. Build artifacts (`web/.lighthouseci` and `web/dist`) and the smoke suite ensure canonical links do not regress—check the CI artifacts or rerun `npm run qa` locally when you need to audit metadata behavior before shipping.
</file>

<file path="docs/ui-handoff.md">
# UI Handoff - First Springfield SDA Website

## 1) Design goals
- Calm, readable, welcoming tone with generous breathing room and restrained color.
- Mobile-first layout, fast loads, minimal JS (Astro SSR + partial hydration only where necessary).
- Accessible interactions: clear focus-visible rings, 44px+ tap targets, text that reads well across screen sizes.

## 2) Breakpoints (responsive rules)
Source of truth: `web/src/styles/global.css`.
- Base: mobile-first stack — `.stack`, hero, cards, and nav all stack vertically using tokens so there is no media query assumption.
- `@media (max-width: 860px)`: hides desktop `nav`/`cta` stacks, surfaces the mobile `details.menu`, and tightens `.main` padding to `var(--space-6)` while keeping all sections legible.
- `@media (max-width: 520px)` and `(max-width: 420px)`: collapse footer columns into single-column flow and hide the menu label to preserve tap area while keeping the icon visible.

## 3) Spacing scale (tokens)
Source of truth: `web/src/styles/tokens.css`.

| Token | Intended use | Examples |
|------|--------------|----------|
| `--space-1` | micro gaps or icon/text separation | `header .brand` gap, `.footer-contact` stack spacing |
| `--space-2` | petite padding between inline elements | button gutters, card subtitle margin, `.col-body` link spacing |
| `--space-3` | standard rhythm between sections | `.stack` spacing, hero actions gap, mobile nav spacing |
| `--space-4` | generous separation / nested stacks | hero-inner gap, `.hero` vs hero background, `grid` gap |
| `--space-6` | card padding or section padding inside containers | `.card` padding, `.inner` padding top/bottom, footer body padding |
| `--space-8` | container padding and major vertical gaps | `.main` padding, `Header` inner padding, `.stack--loose` |
| `--space-12` | extra-wide sections if/when needed | large hero spacing or future horizontal rules |

Implementation notes:
- Import tokens once (`@import "./tokens.css"`) and reference via `var(--space-*)` to keep vertical rhythm consistent.
- Use `.stack`, `.grid`, and `.cluster` utility classes from `global.css` so spacing scales with the same token set rather than hard-coded px values.

## 4) Typography scale (global rules)
Source of truth: `web/src/styles/global.css`.
- Base `body` font size is `var(--font-size-1)` (1rem) with a 1.6 line-height.
- Headings rely on `clamp()` for responsiveness:
  - `h1`: clamp(2.2rem, 1.6rem + 2.4vw, 3.2rem) for hero-level impact.
  - `h2`: clamp(1.6rem, 1.2rem + 1.6vw, 2.4rem) for section headers.
  - `h3`: clamp(1.25rem, 1.05rem + 1vw, 1.7rem) for subsections.
- Paragraphs and lists are capped at 70ch to hit the 60–80ch readability target.
- Hero component overrides `h1` (`clamp(2.4rem ... 3.5rem)`) and adds a `muted` subtitle with its own clamp.

## 5) Color + elevation
Source of truth: `web/src/styles/tokens.css`.
- Surfaces: `--color-bg`, `--color-surface`, `--color-surface-2`, and `--color-surface-muted` keep backgrounds and cards light.
- Text: `--color-text`, `--color-text-muted`, `--color-primary`, `--color-primary-hover`, and `--color-focus` drive links, CTAs, and focus outlines.
- Borders use `--color-border` / `--color-border-strong` with consistent `--radius-*` rounding (cards, buttons, menu, footer).
- Elevation: `--shadow-1` for cards, `--shadow-2` for hover states (cards, menu panel), no complex layering keeps performance predictable.

## 6) Components catalog (what exists + how to use)
### Button
File: `web/src/components/ui/Button.astro`
- Variants: `primary` (solid key actions), `secondary` (light background, dark border), `ghost` (transparent, outlines), plus implicit text/inline usage through `ButtonLink`.
- Sizes: `sm`, `md`, `lg` adjust font-size (vars `--font-size-0..2`) and padding (`--space-2..6`).
- States:
  - `hover`: darkens (`--color-primary-hover`) or swaps to gray hover fills.
  - `focus-visible`: global `outline: 3px solid var(--color-focus)` via `global.css` keeps keyboard nav visible.
  - `disabled`: not styled explicitly, so rely on native browser styling; add `disabled` prop before applying `Button` for future needs.
- Uses `var(--space-2)` for gaps and ensures `min-height: var(--target-min)` for 44px tap targets.

### Card
File: `web/src/components/ui/Card.astro`
- Reused for service cards, announcements, and hero wrapper (`<section class="hero card">`).
- Provides `card`/`card--link` classes defined globally (background, border, radius, shadows) and tailored title/description text.
- Outline: `card__title` uses `--font-size-2`, `card__desc` uses `muted` color, and CTAs reuse `.link` styling for hover/focus.

### Hero
File: `web/src/components/ui/Hero.astro`
- Wraps title/subtitle + CTA buttons in `.hero.card` to reuse card surface rules.
- `hero__inner` grid uses `--space-4`; `hero__title` and `hero__subtitle` each define their own `clamp()` scalings.
- CTA stack uses `--space-3` so buttons align vertically on mobile yet stay horizontal when space is available.

### Header / Nav
File: `web/src/components/global/Header.astro`
- Brand link + nav items are laid out in a 3-column grid inside `.inner` with container padding/token values.
- Desktop nav vs mobile menu (`details.menu` + `.menu__panel`), including quick actions derived from `site.quickActions`.
- Nav links highlight active route (`aria-current`) and use `var(--space-2)` gaps, so `--space-3` spacing between the nav cluster and CTA group.
- Mobile menu uses `var(--shadow-2)` and `--radius-3` to match overall surface language; event listener closes menu when selecting a link.

### Footer
File: `web/src/components/global/Footer.astro`
- Two-part layout: info column + nav grid, all inside `.inner` with `var(--space-6)` padding.
- Uses `.links` helper and `var(--space-2)` gap to keep links stacked, and `@media (max-width: 520px)` collapses columns to full width.
- Includes dynamic sections (primary/exploratory nav, quick actions, service times) sourced from `site.nav`, `site.quickActions`, and `site.schedule`.

## 7) Accessibility checklist (project expectations)
- Keyboard navigation: global `a:focus-visible`, `button:focus-visible`, and `summary:focus-visible` outlines defined in `global.css` for consistent focus states.
- Skip link (`.skip-link`) is available globally and reveals itself on focus so screen-reader/keyboard users can jump straight to `.main`.
- Tap targets: `--target-min` enforces 44px+ heights for buttons, nav pills, menu links.
- Semantic text: `heading` scalings, `muted` helpers, and list height constraints keep readability high, and `Hero` CTA order remains logical.
- Images (e.g., `Hero` and CTA icons) should always include `alt` text from the content source; decorative elements rely on empty `alt`.

## 8) “Design-to-code” notes
- Tokens live in `web/src/styles/tokens.css` and are the single source for spacing, color, radius, and typography values.
- Components (`Button`, `Card`, `Hero`, `Header`, `Footer`) rely on tokens instead of raw px to preserve rhythm as screen widths change.
- Responsive rules mirror tokens: `.stack`, `.grid`, `.container`, and media queries share numeric values from the tokens file for predictable scaling.
- Animations/transitions are minimal (`120–160ms ease`) and tied to hover/focus states in `global.css`; keep new interactions aligned with that timing.

## 9) Screenshots & callouts
- ![Home hero callout](assets/home-hero.png) Spacing uses `--space-3` between stacked sections, matching the `.stack` gap in `global.css`.
- ![Plan a Visit callout](assets/plan-visit.png) Typography: `h2` uses `clamp()` to scale with viewport width (`global.css`).
- ![Footer callout](assets/footer.png) Footer spacing leans on `--space-4`/`--space-6` to keep columns breathing and align with the header container.

## 10) Decision log
- Why Astro: content-first rendering with partial hydration keeps the site fast and lets us pull in Markdown/data without heavy bundling.
- Why tokens: centralized spacing/color/typescale means any new component can reuse variables instead of uncoordinated values.
- Why smoke tests: quick, cross-engine smoke tests give confidence that renders stay consistent without slowing down the full CI pipeline.
</file>

<file path="docs/ui-reliability.md">
# UI reliability notes

This page explains the known UI failure modes we monitor so we can triage common issues, keep the experience responsive, and communicate how the build/release pipeline proves behavior before every deploy.

## Failure: YouTube embed blocked / slow network

- **User impact:** The sermon/media player takes center stage on the media page, so a blocked iframe can freeze loading above-the-fold content and make the hero section feel inert.
- **How the UI behaves:** The media section renders a retry-friendly CTA (watch live / try again) and drops the iframe in favor of a descriptive fallback tile with the video title and transcript preview so the rest of the page remains interactive.
- **How we test it:** The Playwright smoke suite includes `/media` coverage (see `web/tests/e2e/smoke.spec.ts`) and the a11y sweep catches residual UI shifts; we manually simulate iframe route abortion when diagnosing regressions, and `npx playwright test --project=chromium --grep media` lets us run a blocked request locally. Lighthouse CI budgets highlight any layout shift that might come from repeated iframe retries.

## Failure: Missing content collection item

- **User impact:** The equal-width grids (cards, ministries, events) depend on CMS content collections; a missing item leaves a hole that feels like a broken card or outdated listing.
- **How the UI behaves:** We render placeholder cards with the `Card` component plus muted copy, and the grid gracefully collapses while `Linkinator`/Playwright watchers flag the missing link. Content editors get a descriptive notification in the admin so they can republish.
- **How we test it:** `astro check` validates generated types inside `web/src/content`, Playwright smoke checks the `CardGrid` (`/` page) for fallout, and `linkinator.config.json` ensures published links exist. During local debugging we stub the collection (commented fixture) so we can observe the placeholder state while keeping CI green.

## Failure: Search index not ready

- **User impact:** The Pagefind-powered search overlay is often the first thing visitors touch when they land on a new topic; if the index build is in progress the search input returns no results and may mislead the user.
- **How the UI behaves:** We render a skeleton input and button with “Retry search” copy, show inline microcopy explaining the cold start, and keep the search modal open so the user can retry without navigating away.
- **How we test it:** The `phase-7-a11y` Axe test (`web/tests/e2e/phase-7-a11y.spec.ts`) already spins up the search modal and verifies accessible labels; we extend that harness with the “Search index not ready” copy while manually blocking the `/pagefind-ui` endpoint during regression runs. Lighthouse budgets guard for the skeleton’s CLS/pause, and Playwright smoke tests executed during CI ensure the UI still renders with mock search results even when the service is offline.

## Reliability signals

- Automated tooling (Playwright smoke + axe, Linkinator, Lighthouse CI) runs on every push—see `web/test-results` and `web/playwright.config.ts` for CI entry points.
- For quick triage, rerun `npm run qa` inside `web/` to reproduce a failure locally while hitting the same test matrix we rely on in CI.
</file>

<file path="web/.vscode/extensions.json">
{
  "recommendations": ["astro-build.astro-vscode"],
  "unwantedRecommendations": []
}
</file>

<file path="web/.vscode/launch.json">
{
  "version": "0.2.0",
  "configurations": [
    {
      "command": "./node_modules/.bin/astro dev",
      "name": "Development server",
      "request": "launch",
      "type": "node-terminal"
    }
  ]
}
</file>

<file path="web/public/_headers">
/*
  X-Content-Type-Options: nosniff
  Referrer-Policy: strict-origin-when-cross-origin
  X-Frame-Options: DENY
  Permissions-Policy: geolocation=(), microphone=(), camera=()
</file>

<file path="web/public/.assetsignore">
_worker.js
_routes.json
</file>

<file path="web/scripts/vendor/yargs-parser/build/lib/string-utils.js">
/**
 * @license
 * Copyright (c) 2016, Contributors
 * SPDX-License-Identifier: ISC
 */
export function camelCase(str) {
    // Handle the case where an argument is provided as camel case, e.g., fooBar.
    // by ensuring that the string isn't already mixed case:
    const isCamelCase = str !== str.toLowerCase() && str !== str.toUpperCase();
    if (!isCamelCase) {
        str = str.toLowerCase();
    }
    if (str.indexOf('-') === -1 && str.indexOf('_') === -1) {
        return str;
    }
    else {
        let camelcase = '';
        let nextChrUpper = false;
        const leadingHyphens = str.match(/^-+/);
        for (let i = leadingHyphens ? leadingHyphens[0].length : 0; i < str.length; i++) {
            let chr = str.charAt(i);
            if (nextChrUpper) {
                nextChrUpper = false;
                chr = chr.toUpperCase();
            }
            if (i !== 0 && (chr === '-' || chr === '_')) {
                nextChrUpper = true;
            }
            else if (chr !== '-' && chr !== '_') {
                camelcase += chr;
            }
        }
        return camelcase;
    }
}
export function decamelize(str, joinString) {
    const lowercase = str.toLowerCase();
    joinString = joinString || '-';
    let notCamelcase = '';
    for (let i = 0; i < str.length; i++) {
        const chrLower = lowercase.charAt(i);
        const chrString = str.charAt(i);
        if (chrLower !== chrString && i > 0) {
            notCamelcase += `${joinString}${lowercase.charAt(i)}`;
        }
        else {
            notCamelcase += chrString;
        }
    }
    return notCamelcase;
}
export function looksLikeNumber(x) {
    if (x === null || x === undefined)
        return false;
    // if loaded from config, may already be a number.
    if (typeof x === 'number')
        return true;
    // hexadecimal.
    if (/^0x[0-9a-f]+$/i.test(x))
        return true;
    // don't treat 0123 as a number; as it drops the leading '0'.
    if (/^0[^.]/.test(x))
        return false;
    return /^[-]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(x);
}
</file>

<file path="web/scripts/vendor/yargs-parser/build/lib/yargs-parser-types.js">
/**
 * @license
 * Copyright (c) 2016, Contributors
 * SPDX-License-Identifier: ISC
 */
export var DefaultValuesForTypeKey;
(function (DefaultValuesForTypeKey) {
    DefaultValuesForTypeKey["BOOLEAN"] = "boolean";
    DefaultValuesForTypeKey["STRING"] = "string";
    DefaultValuesForTypeKey["NUMBER"] = "number";
    DefaultValuesForTypeKey["ARRAY"] = "array";
})(DefaultValuesForTypeKey || (DefaultValuesForTypeKey = {}));
</file>

<file path="web/scripts/vendor/yargs-parser/build/lib/yargs-parser.js">
/**
 * @license
 * Copyright (c) 2016, Contributors
 * SPDX-License-Identifier: ISC
 */
import { tokenizeArgString } from './tokenize-arg-string.js';
import { DefaultValuesForTypeKey } from './yargs-parser-types.js';
import { camelCase, decamelize, looksLikeNumber } from './string-utils.js';
let mixin;
export class YargsParser {
    constructor(_mixin) {
        mixin = _mixin;
    }
    parse(argsInput, options) {
        const opts = Object.assign({
            alias: undefined,
            array: undefined,
            boolean: undefined,
            config: undefined,
            configObjects: undefined,
            configuration: undefined,
            coerce: undefined,
            count: undefined,
            default: undefined,
            envPrefix: undefined,
            narg: undefined,
            normalize: undefined,
            string: undefined,
            number: undefined,
            __: undefined,
            key: undefined
        }, options);
        // allow a string argument to be passed in rather
        // than an argv array.
        const args = tokenizeArgString(argsInput);
        // tokenizeArgString adds extra quotes to args if argsInput is a string
        // only strip those extra quotes in processValue if argsInput is a string
        const inputIsString = typeof argsInput === 'string';
        // aliases might have transitive relationships, normalize this.
        const aliases = combineAliases(Object.assign(Object.create(null), opts.alias));
        const configuration = Object.assign({
            'boolean-negation': true,
            'camel-case-expansion': true,
            'combine-arrays': false,
            'dot-notation': true,
            'duplicate-arguments-array': true,
            'flatten-duplicate-arrays': true,
            'greedy-arrays': true,
            'halt-at-non-option': false,
            'nargs-eats-options': false,
            'negation-prefix': 'no-',
            'parse-numbers': true,
            'parse-positional-numbers': true,
            'populate--': false,
            'set-placeholder-key': false,
            'short-option-groups': true,
            'strip-aliased': false,
            'strip-dashed': false,
            'unknown-options-as-args': false
        }, opts.configuration);
        const defaults = Object.assign(Object.create(null), opts.default);
        const configObjects = opts.configObjects || [];
        const envPrefix = opts.envPrefix;
        const notFlagsOption = configuration['populate--'];
        const notFlagsArgv = notFlagsOption ? '--' : '_';
        const newAliases = Object.create(null);
        const defaulted = Object.create(null);
        // allow a i18n handler to be passed in, default to a fake one (util.format).
        const __ = opts.__ || mixin.format;
        const flags = {
            aliases: Object.create(null),
            arrays: Object.create(null),
            bools: Object.create(null),
            strings: Object.create(null),
            numbers: Object.create(null),
            counts: Object.create(null),
            normalize: Object.create(null),
            configs: Object.create(null),
            nargs: Object.create(null),
            coercions: Object.create(null),
            keys: []
        };
        const negative = /^-([0-9]+(\.[0-9]+)?|\.[0-9]+)$/;
        const negatedBoolean = new RegExp('^--' + configuration['negation-prefix'] + '(.+)');
        [].concat(opts.array || []).filter(Boolean).forEach(function (opt) {
            const key = typeof opt === 'object' ? opt.key : opt;
            // assign to flags[bools|strings|numbers]
            const assignment = Object.keys(opt).map(function (key) {
                const arrayFlagKeys = {
                    boolean: 'bools',
                    string: 'strings',
                    number: 'numbers'
                };
                return arrayFlagKeys[key];
            }).filter(Boolean).pop();
            // assign key to be coerced
            if (assignment) {
                flags[assignment][key] = true;
            }
            flags.arrays[key] = true;
            flags.keys.push(key);
        });
        [].concat(opts.boolean || []).filter(Boolean).forEach(function (key) {
            flags.bools[key] = true;
            flags.keys.push(key);
        });
        [].concat(opts.string || []).filter(Boolean).forEach(function (key) {
            flags.strings[key] = true;
            flags.keys.push(key);
        });
        [].concat(opts.number || []).filter(Boolean).forEach(function (key) {
            flags.numbers[key] = true;
            flags.keys.push(key);
        });
        [].concat(opts.count || []).filter(Boolean).forEach(function (key) {
            flags.counts[key] = true;
            flags.keys.push(key);
        });
        [].concat(opts.normalize || []).filter(Boolean).forEach(function (key) {
            flags.normalize[key] = true;
            flags.keys.push(key);
        });
        if (typeof opts.narg === 'object') {
            Object.entries(opts.narg).forEach(([key, value]) => {
                if (typeof value === 'number') {
                    flags.nargs[key] = value;
                    flags.keys.push(key);
                }
            });
        }
        if (typeof opts.coerce === 'object') {
            Object.entries(opts.coerce).forEach(([key, value]) => {
                if (typeof value === 'function') {
                    flags.coercions[key] = value;
                    flags.keys.push(key);
                }
            });
        }
        if (typeof opts.config !== 'undefined') {
            if (Array.isArray(opts.config) || typeof opts.config === 'string') {
                ;
                [].concat(opts.config).filter(Boolean).forEach(function (key) {
                    flags.configs[key] = true;
                });
            }
            else if (typeof opts.config === 'object') {
                Object.entries(opts.config).forEach(([key, value]) => {
                    if (typeof value === 'boolean' || typeof value === 'function') {
                        flags.configs[key] = value;
                    }
                });
            }
        }
        // create a lookup table that takes into account all
        // combinations of aliases: {f: ['foo'], foo: ['f']}
        extendAliases(opts.key, aliases, opts.default, flags.arrays);
        // apply default values to all aliases.
        Object.keys(defaults).forEach(function (key) {
            (flags.aliases[key] || []).forEach(function (alias) {
                defaults[alias] = defaults[key];
            });
        });
        let error = null;
        checkConfiguration();
        let notFlags = [];
        const argv = Object.assign(Object.create(null), { _: [] });
        // TODO(bcoe): for the first pass at removing object prototype  we didn't
        // remove all prototypes from objects returned by this API, we might want
        // to gradually move towards doing so.
        const argvReturn = {};
        for (let i = 0; i < args.length; i++) {
            const arg = args[i];
            const truncatedArg = arg.replace(/^-{3,}/, '---');
            let broken;
            let key;
            let letters;
            let m;
            let next;
            let value;
            // any unknown option (except for end-of-options, "--")
            if (arg !== '--' && /^-/.test(arg) && isUnknownOptionAsArg(arg)) {
                pushPositional(arg);
                // ---, ---=, ----, etc,
            }
            else if (truncatedArg.match(/^---+(=|$)/)) {
                // options without key name are invalid.
                pushPositional(arg);
                continue;
                // -- separated by =
            }
            else if (arg.match(/^--.+=/) || (!configuration['short-option-groups'] && arg.match(/^-.+=/))) {
                // Using [\s\S] instead of . because js doesn't support the
                // 'dotall' regex modifier. See:
                // http://stackoverflow.com/a/1068308/13216
                m = arg.match(/^--?([^=]+)=([\s\S]*)$/);
                // arrays format = '--f=a b c'
                if (m !== null && Array.isArray(m) && m.length >= 3) {
                    if (checkAllAliases(m[1], flags.arrays)) {
                        i = eatArray(i, m[1], args, m[2]);
                    }
                    else if (checkAllAliases(m[1], flags.nargs) !== false) {
                        // nargs format = '--f=monkey washing cat'
                        i = eatNargs(i, m[1], args, m[2]);
                    }
                    else {
                        setArg(m[1], m[2], true);
                    }
                }
            }
            else if (arg.match(negatedBoolean) && configuration['boolean-negation']) {
                m = arg.match(negatedBoolean);
                if (m !== null && Array.isArray(m) && m.length >= 2) {
                    key = m[1];
                    setArg(key, checkAllAliases(key, flags.arrays) ? [false] : false);
                }
                // -- separated by space.
            }
            else if (arg.match(/^--.+/) || (!configuration['short-option-groups'] && arg.match(/^-[^-]+/))) {
                m = arg.match(/^--?(.+)/);
                if (m !== null && Array.isArray(m) && m.length >= 2) {
                    key = m[1];
                    if (checkAllAliases(key, flags.arrays)) {
                        // array format = '--foo a b c'
                        i = eatArray(i, key, args);
                    }
                    else if (checkAllAliases(key, flags.nargs) !== false) {
                        // nargs format = '--foo a b c'
                        // should be truthy even if: flags.nargs[key] === 0
                        i = eatNargs(i, key, args);
                    }
                    else {
                        next = args[i + 1];
                        if (next !== undefined && (!next.match(/^-/) ||
                            next.match(negative)) &&
                            !checkAllAliases(key, flags.bools) &&
                            !checkAllAliases(key, flags.counts)) {
                            setArg(key, next);
                            i++;
                        }
                        else if (/^(true|false)$/.test(next)) {
                            setArg(key, next);
                            i++;
                        }
                        else {
                            setArg(key, defaultValue(key));
                        }
                    }
                }
                // dot-notation flag separated by '='.
            }
            else if (arg.match(/^-.\..+=/)) {
                m = arg.match(/^-([^=]+)=([\s\S]*)$/);
                if (m !== null && Array.isArray(m) && m.length >= 3) {
                    setArg(m[1], m[2]);
                }
                // dot-notation flag separated by space.
            }
            else if (arg.match(/^-.\..+/) && !arg.match(negative)) {
                next = args[i + 1];
                m = arg.match(/^-(.\..+)/);
                if (m !== null && Array.isArray(m) && m.length >= 2) {
                    key = m[1];
                    if (next !== undefined && !next.match(/^-/) &&
                        !checkAllAliases(key, flags.bools) &&
                        !checkAllAliases(key, flags.counts)) {
                        setArg(key, next);
                        i++;
                    }
                    else {
                        setArg(key, defaultValue(key));
                    }
                }
            }
            else if (arg.match(/^-[^-]+/) && !arg.match(negative)) {
                letters = arg.slice(1, -1).split('');
                broken = false;
                for (let j = 0; j < letters.length; j++) {
                    next = arg.slice(j + 2);
                    if (letters[j + 1] && letters[j + 1] === '=') {
                        value = arg.slice(j + 3);
                        key = letters[j];
                        if (checkAllAliases(key, flags.arrays)) {
                            // array format = '-f=a b c'
                            i = eatArray(i, key, args, value);
                        }
                        else if (checkAllAliases(key, flags.nargs) !== false) {
                            // nargs format = '-f=monkey washing cat'
                            i = eatNargs(i, key, args, value);
                        }
                        else {
                            setArg(key, value);
                        }
                        broken = true;
                        break;
                    }
                    if (next === '-') {
                        setArg(letters[j], next);
                        continue;
                    }
                    // current letter is an alphabetic character and next value is a number
                    if (/[A-Za-z]/.test(letters[j]) &&
                        /^-?\d+(\.\d*)?(e-?\d+)?$/.test(next) &&
                        checkAllAliases(next, flags.bools) === false) {
                        setArg(letters[j], next);
                        broken = true;
                        break;
                    }
                    if (letters[j + 1] && letters[j + 1].match(/\W/)) {
                        setArg(letters[j], next);
                        broken = true;
                        break;
                    }
                    else {
                        setArg(letters[j], defaultValue(letters[j]));
                    }
                }
                key = arg.slice(-1)[0];
                if (!broken && key !== '-') {
                    if (checkAllAliases(key, flags.arrays)) {
                        // array format = '-f a b c'
                        i = eatArray(i, key, args);
                    }
                    else if (checkAllAliases(key, flags.nargs) !== false) {
                        // nargs format = '-f a b c'
                        // should be truthy even if: flags.nargs[key] === 0
                        i = eatNargs(i, key, args);
                    }
                    else {
                        next = args[i + 1];
                        if (next !== undefined && (!/^(-|--)[^-]/.test(next) ||
                            next.match(negative)) &&
                            !checkAllAliases(key, flags.bools) &&
                            !checkAllAliases(key, flags.counts)) {
                            setArg(key, next);
                            i++;
                        }
                        else if (/^(true|false)$/.test(next)) {
                            setArg(key, next);
                            i++;
                        }
                        else {
                            setArg(key, defaultValue(key));
                        }
                    }
                }
            }
            else if (arg.match(/^-[0-9]$/) &&
                arg.match(negative) &&
                checkAllAliases(arg.slice(1), flags.bools)) {
                // single-digit boolean alias, e.g: xargs -0
                key = arg.slice(1);
                setArg(key, defaultValue(key));
            }
            else if (arg === '--') {
                notFlags = args.slice(i + 1);
                break;
            }
            else if (configuration['halt-at-non-option']) {
                notFlags = args.slice(i);
                break;
            }
            else {
                pushPositional(arg);
            }
        }
        // order of precedence:
        // 1. command line arg
        // 2. value from env var
        // 3. value from config file
        // 4. value from config objects
        // 5. configured default value
        applyEnvVars(argv, true); // special case: check env vars that point to config file
        applyEnvVars(argv, false);
        setConfig(argv);
        setConfigObjects();
        applyDefaultsAndAliases(argv, flags.aliases, defaults, true);
        applyCoercions(argv);
        if (configuration['set-placeholder-key'])
            setPlaceholderKeys(argv);
        // for any counts either not in args or without an explicit default, set to 0
        Object.keys(flags.counts).forEach(function (key) {
            if (!hasKey(argv, key.split('.')))
                setArg(key, 0);
        });
        // '--' defaults to undefined.
        if (notFlagsOption && notFlags.length)
            argv[notFlagsArgv] = [];
        notFlags.forEach(function (key) {
            argv[notFlagsArgv].push(key);
        });
        if (configuration['camel-case-expansion'] && configuration['strip-dashed']) {
            Object.keys(argv).filter(key => key !== '--' && key.includes('-')).forEach(key => {
                delete argv[key];
            });
        }
        if (configuration['strip-aliased']) {
            ;
            [].concat(...Object.keys(aliases).map(k => aliases[k])).forEach(alias => {
                if (configuration['camel-case-expansion'] && alias.includes('-')) {
                    delete argv[alias.split('.').map(prop => camelCase(prop)).join('.')];
                }
                delete argv[alias];
            });
        }
        // Push argument into positional array, applying numeric coercion:
        function pushPositional(arg) {
            const maybeCoercedNumber = maybeCoerceNumber('_', arg);
            if (typeof maybeCoercedNumber === 'string' || typeof maybeCoercedNumber === 'number') {
                argv._.push(maybeCoercedNumber);
            }
        }
        // how many arguments should we consume, based
        // on the nargs option?
        function eatNargs(i, key, args, argAfterEqualSign) {
            let ii;
            let toEat = checkAllAliases(key, flags.nargs);
            // NaN has a special meaning for the array type, indicating that one or
            // more values are expected.
            toEat = typeof toEat !== 'number' || isNaN(toEat) ? 1 : toEat;
            if (toEat === 0) {
                if (!isUndefined(argAfterEqualSign)) {
                    error = Error(__('Argument unexpected for: %s', key));
                }
                setArg(key, defaultValue(key));
                return i;
            }
            let available = isUndefined(argAfterEqualSign) ? 0 : 1;
            if (configuration['nargs-eats-options']) {
                // classic behavior, yargs eats positional and dash arguments.
                if (args.length - (i + 1) + available < toEat) {
                    error = Error(__('Not enough arguments following: %s', key));
                }
                available = toEat;
            }
            else {
                // nargs will not consume flag arguments, e.g., -abc, --foo,
                // and terminates when one is observed.
                for (ii = i + 1; ii < args.length; ii++) {
                    if (!args[ii].match(/^-[^0-9]/) || args[ii].match(negative) || isUnknownOptionAsArg(args[ii]))
                        available++;
                    else
                        break;
                }
                if (available < toEat)
                    error = Error(__('Not enough arguments following: %s', key));
            }
            let consumed = Math.min(available, toEat);
            if (!isUndefined(argAfterEqualSign) && consumed > 0) {
                setArg(key, argAfterEqualSign);
                consumed--;
            }
            for (ii = i + 1; ii < (consumed + i + 1); ii++) {
                setArg(key, args[ii]);
            }
            return (i + consumed);
        }
        // if an option is an array, eat all non-hyphenated arguments
        // following it... YUM!
        // e.g., --foo apple banana cat becomes ["apple", "banana", "cat"]
        function eatArray(i, key, args, argAfterEqualSign) {
            let argsToSet = [];
            let next = argAfterEqualSign || args[i + 1];
            // If both array and nargs are configured, enforce the nargs count:
            const nargsCount = checkAllAliases(key, flags.nargs);
            if (checkAllAliases(key, flags.bools) && !(/^(true|false)$/.test(next))) {
                argsToSet.push(true);
            }
            else if (isUndefined(next) ||
                (isUndefined(argAfterEqualSign) && /^-/.test(next) && !negative.test(next) && !isUnknownOptionAsArg(next))) {
                // for keys without value ==> argsToSet remains an empty []
                // set user default value, if available
                if (defaults[key] !== undefined) {
                    const defVal = defaults[key];
                    argsToSet = Array.isArray(defVal) ? defVal : [defVal];
                }
            }
            else {
                // value in --option=value is eaten as is
                if (!isUndefined(argAfterEqualSign)) {
                    argsToSet.push(processValue(key, argAfterEqualSign, true));
                }
                for (let ii = i + 1; ii < args.length; ii++) {
                    if ((!configuration['greedy-arrays'] && argsToSet.length > 0) ||
                        (nargsCount && typeof nargsCount === 'number' && argsToSet.length >= nargsCount))
                        break;
                    next = args[ii];
                    if (/^-/.test(next) && !negative.test(next) && !isUnknownOptionAsArg(next))
                        break;
                    i = ii;
                    argsToSet.push(processValue(key, next, inputIsString));
                }
            }
            // If both array and nargs are configured, create an error if less than
            // nargs positionals were found. NaN has special meaning, indicating
            // that at least one value is required (more are okay).
            if (typeof nargsCount === 'number' && ((nargsCount && argsToSet.length < nargsCount) ||
                (isNaN(nargsCount) && argsToSet.length === 0))) {
                error = Error(__('Not enough arguments following: %s', key));
            }
            setArg(key, argsToSet);
            return i;
        }
        function setArg(key, val, shouldStripQuotes = inputIsString) {
            if (/-/.test(key) && configuration['camel-case-expansion']) {
                const alias = key.split('.').map(function (prop) {
                    return camelCase(prop);
                }).join('.');
                addNewAlias(key, alias);
            }
            const value = processValue(key, val, shouldStripQuotes);
            const splitKey = key.split('.');
            setKey(argv, splitKey, value);
            // handle populating aliases of the full key
            if (flags.aliases[key]) {
                flags.aliases[key].forEach(function (x) {
                    const keyProperties = x.split('.');
                    setKey(argv, keyProperties, value);
                });
            }
            // handle populating aliases of the first element of the dot-notation key
            if (splitKey.length > 1 && configuration['dot-notation']) {
                ;
                (flags.aliases[splitKey[0]] || []).forEach(function (x) {
                    let keyProperties = x.split('.');
                    // expand alias with nested objects in key
                    const a = [].concat(splitKey);
                    a.shift(); // nuke the old key.
                    keyProperties = keyProperties.concat(a);
                    // populate alias only if is not already an alias of the full key
                    // (already populated above)
                    if (!(flags.aliases[key] || []).includes(keyProperties.join('.'))) {
                        setKey(argv, keyProperties, value);
                    }
                });
            }
            // Set normalize getter and setter when key is in 'normalize' but isn't an array
            if (checkAllAliases(key, flags.normalize) && !checkAllAliases(key, flags.arrays)) {
                const keys = [key].concat(flags.aliases[key] || []);
                keys.forEach(function (key) {
                    Object.defineProperty(argvReturn, key, {
                        enumerable: true,
                        get() {
                            return val;
                        },
                        set(value) {
                            val = typeof value === 'string' ? mixin.normalize(value) : value;
                        }
                    });
                });
            }
        }
        function addNewAlias(key, alias) {
            if (!(flags.aliases[key] && flags.aliases[key].length)) {
                flags.aliases[key] = [alias];
                newAliases[alias] = true;
            }
            if (!(flags.aliases[alias] && flags.aliases[alias].length)) {
                addNewAlias(alias, key);
            }
        }
        function processValue(key, val, shouldStripQuotes) {
            // strings may be quoted, clean this up as we assign values.
            if (shouldStripQuotes) {
                val = stripQuotes(val);
            }
            // handle parsing boolean arguments --foo=true --bar false.
            if (checkAllAliases(key, flags.bools) || checkAllAliases(key, flags.counts)) {
                if (typeof val === 'string')
                    val = val === 'true';
            }
            let value = Array.isArray(val)
                ? val.map(function (v) { return maybeCoerceNumber(key, v); })
                : maybeCoerceNumber(key, val);
            // increment a count given as arg (either no value or value parsed as boolean)
            if (checkAllAliases(key, flags.counts) && (isUndefined(value) || typeof value === 'boolean')) {
                value = increment();
            }
            // Set normalized value when key is in 'normalize' and in 'arrays'
            if (checkAllAliases(key, flags.normalize) && checkAllAliases(key, flags.arrays)) {
                if (Array.isArray(val))
                    value = val.map((val) => { return mixin.normalize(val); });
                else
                    value = mixin.normalize(val);
            }
            return value;
        }
        function maybeCoerceNumber(key, value) {
            if (!configuration['parse-positional-numbers'] && key === '_')
                return value;
            if (!checkAllAliases(key, flags.strings) && !checkAllAliases(key, flags.bools) && !Array.isArray(value)) {
                const shouldCoerceNumber = looksLikeNumber(value) && configuration['parse-numbers'] && (Number.isSafeInteger(Math.floor(parseFloat(`${value}`))));
                if (shouldCoerceNumber || (!isUndefined(value) && checkAllAliases(key, flags.numbers))) {
                    value = Number(value);
                }
            }
            return value;
        }
        // set args from config.json file, this should be
        // applied last so that defaults can be applied.
        function setConfig(argv) {
            const configLookup = Object.create(null);
            // expand defaults/aliases, in-case any happen to reference
            // the config.json file.
            applyDefaultsAndAliases(configLookup, flags.aliases, defaults);
            Object.keys(flags.configs).forEach(function (configKey) {
                const configPath = argv[configKey] || configLookup[configKey];
                if (configPath) {
                    try {
                        let config = null;
                        const resolvedConfigPath = mixin.resolve(mixin.cwd(), configPath);
                        const resolveConfig = flags.configs[configKey];
                        if (typeof resolveConfig === 'function') {
                            try {
                                config = resolveConfig(resolvedConfigPath);
                            }
                            catch (e) {
                                config = e;
                            }
                            if (config instanceof Error) {
                                error = config;
                                return;
                            }
                        }
                        else {
                            config = mixin.require(resolvedConfigPath);
                        }
                        setConfigObject(config);
                    }
                    catch (ex) {
                        // Deno will receive a PermissionDenied error if an attempt is
                        // made to load config without the --allow-read flag:
                        if (ex.name === 'PermissionDenied')
                            error = ex;
                        else if (argv[configKey])
                            error = Error(__('Invalid JSON config file: %s', configPath));
                    }
                }
            });
        }
        // set args from config object.
        // it recursively checks nested objects.
        function setConfigObject(config, prev) {
            Object.keys(config).forEach(function (key) {
                const value = config[key];
                const fullKey = prev ? prev + '.' + key : key;
                // if the value is an inner object and we have dot-notation
                // enabled, treat inner objects in config the same as
                // heavily nested dot notations (foo.bar.apple).
                if (typeof value === 'object' && value !== null && !Array.isArray(value) && configuration['dot-notation']) {
                    // if the value is an object but not an array, check nested object
                    setConfigObject(value, fullKey);
                }
                else {
                    // setting arguments via CLI takes precedence over
                    // values within the config file.
                    if (!hasKey(argv, fullKey.split('.')) || (checkAllAliases(fullKey, flags.arrays) && configuration['combine-arrays'])) {
                        setArg(fullKey, value);
                    }
                }
            });
        }
        // set all config objects passed in opts
        function setConfigObjects() {
            if (typeof configObjects !== 'undefined') {
                configObjects.forEach(function (configObject) {
                    setConfigObject(configObject);
                });
            }
        }
        function applyEnvVars(argv, configOnly) {
            if (typeof envPrefix === 'undefined')
                return;
            const prefix = typeof envPrefix === 'string' ? envPrefix : '';
            const env = mixin.env();
            Object.keys(env).forEach(function (envVar) {
                if (prefix === '' || envVar.lastIndexOf(prefix, 0) === 0) {
                    // get array of nested keys and convert them to camel case
                    const keys = envVar.split('__').map(function (key, i) {
                        if (i === 0) {
                            key = key.substring(prefix.length);
                        }
                        return camelCase(key);
                    });
                    if (((configOnly && flags.configs[keys.join('.')]) || !configOnly) && !hasKey(argv, keys)) {
                        setArg(keys.join('.'), env[envVar]);
                    }
                }
            });
        }
        function applyCoercions(argv) {
            let coerce;
            const applied = new Set();
            Object.keys(argv).forEach(function (key) {
                if (!applied.has(key)) { // If we haven't already coerced this option via one of its aliases
                    coerce = checkAllAliases(key, flags.coercions);
                    if (typeof coerce === 'function') {
                        try {
                            const value = maybeCoerceNumber(key, coerce(argv[key]));
                            ([].concat(flags.aliases[key] || [], key)).forEach(ali => {
                                applied.add(ali);
                                argv[ali] = value;
                            });
                        }
                        catch (err) {
                            error = err;
                        }
                    }
                }
            });
        }
        function setPlaceholderKeys(argv) {
            flags.keys.forEach((key) => {
                // don't set placeholder keys for dot notation options 'foo.bar'.
                if (~key.indexOf('.'))
                    return;
                if (typeof argv[key] === 'undefined')
                    argv[key] = undefined;
            });
            return argv;
        }
        function applyDefaultsAndAliases(obj, aliases, defaults, canLog = false) {
            Object.keys(defaults).forEach(function (key) {
                if (!hasKey(obj, key.split('.'))) {
                    setKey(obj, key.split('.'), defaults[key]);
                    if (canLog)
                        defaulted[key] = true;
                    (aliases[key] || []).forEach(function (x) {
                        if (hasKey(obj, x.split('.')))
                            return;
                        setKey(obj, x.split('.'), defaults[key]);
                    });
                }
            });
        }
        function hasKey(obj, keys) {
            let o = obj;
            if (!configuration['dot-notation'])
                keys = [keys.join('.')];
            keys.slice(0, -1).forEach(function (key) {
                o = (o[key] || {});
            });
            const key = keys[keys.length - 1];
            if (typeof o !== 'object')
                return false;
            else
                return key in o;
        }
        function setKey(obj, keys, value) {
            let o = obj;
            if (!configuration['dot-notation'])
                keys = [keys.join('.')];
            keys.slice(0, -1).forEach(function (key) {
                // TODO(bcoe): in the next major version of yargs, switch to
                // Object.create(null) for dot notation:
                key = sanitizeKey(key);
                if (typeof o === 'object' && o[key] === undefined) {
                    o[key] = {};
                }
                if (typeof o[key] !== 'object' || Array.isArray(o[key])) {
                    // ensure that o[key] is an array, and that the last item is an empty object.
                    if (Array.isArray(o[key])) {
                        o[key].push({});
                    }
                    else {
                        o[key] = [o[key], {}];
                    }
                    // we want to update the empty object at the end of the o[key] array, so set o to that object
                    o = o[key][o[key].length - 1];
                }
                else {
                    o = o[key];
                }
            });
            // TODO(bcoe): in the next major version of yargs, switch to
            // Object.create(null) for dot notation:
            const key = sanitizeKey(keys[keys.length - 1]);
            const isTypeArray = checkAllAliases(keys.join('.'), flags.arrays);
            const isValueArray = Array.isArray(value);
            let duplicate = configuration['duplicate-arguments-array'];
            // nargs has higher priority than duplicate
            if (!duplicate && checkAllAliases(key, flags.nargs)) {
                duplicate = true;
                if ((!isUndefined(o[key]) && flags.nargs[key] === 1) || (Array.isArray(o[key]) && o[key].length === flags.nargs[key])) {
                    o[key] = undefined;
                }
            }
            if (value === increment()) {
                o[key] = increment(o[key]);
            }
            else if (Array.isArray(o[key])) {
                if (duplicate && isTypeArray && isValueArray) {
                    o[key] = configuration['flatten-duplicate-arrays'] ? o[key].concat(value) : (Array.isArray(o[key][0]) ? o[key] : [o[key]]).concat([value]);
                }
                else if (!duplicate && Boolean(isTypeArray) === Boolean(isValueArray)) {
                    o[key] = value;
                }
                else {
                    o[key] = o[key].concat([value]);
                }
            }
            else if (o[key] === undefined && isTypeArray) {
                o[key] = isValueArray ? value : [value];
            }
            else if (duplicate && !(o[key] === undefined ||
                checkAllAliases(key, flags.counts) ||
                checkAllAliases(key, flags.bools))) {
                o[key] = [o[key], value];
            }
            else {
                o[key] = value;
            }
        }
        // extend the aliases list with inferred aliases.
        function extendAliases(...args) {
            args.forEach(function (obj) {
                Object.keys(obj || {}).forEach(function (key) {
                    // short-circuit if we've already added a key
                    // to the aliases array, for example it might
                    // exist in both 'opts.default' and 'opts.key'.
                    if (flags.aliases[key])
                        return;
                    flags.aliases[key] = [].concat(aliases[key] || []);
                    // For "--option-name", also set argv.optionName
                    flags.aliases[key].concat(key).forEach(function (x) {
                        if (/-/.test(x) && configuration['camel-case-expansion']) {
                            const c = camelCase(x);
                            if (c !== key && flags.aliases[key].indexOf(c) === -1) {
                                flags.aliases[key].push(c);
                                newAliases[c] = true;
                            }
                        }
                    });
                    // For "--optionName", also set argv['option-name']
                    flags.aliases[key].concat(key).forEach(function (x) {
                        if (x.length > 1 && /[A-Z]/.test(x) && configuration['camel-case-expansion']) {
                            const c = decamelize(x, '-');
                            if (c !== key && flags.aliases[key].indexOf(c) === -1) {
                                flags.aliases[key].push(c);
                                newAliases[c] = true;
                            }
                        }
                    });
                    flags.aliases[key].forEach(function (x) {
                        flags.aliases[x] = [key].concat(flags.aliases[key].filter(function (y) {
                            return x !== y;
                        }));
                    });
                });
            });
        }
        function checkAllAliases(key, flag) {
            const toCheck = [].concat(flags.aliases[key] || [], key);
            const keys = Object.keys(flag);
            const setAlias = toCheck.find(key => keys.includes(key));
            return setAlias ? flag[setAlias] : false;
        }
        function hasAnyFlag(key) {
            const flagsKeys = Object.keys(flags);
            const toCheck = [].concat(flagsKeys.map(k => flags[k]));
            return toCheck.some(function (flag) {
                return Array.isArray(flag) ? flag.includes(key) : flag[key];
            });
        }
        function hasFlagsMatching(arg, ...patterns) {
            const toCheck = [].concat(...patterns);
            return toCheck.some(function (pattern) {
                const match = arg.match(pattern);
                return match && hasAnyFlag(match[1]);
            });
        }
        // based on a simplified version of the short flag group parsing logic
        function hasAllShortFlags(arg) {
            // if this is a negative number, or doesn't start with a single hyphen, it's not a short flag group
            if (arg.match(negative) || !arg.match(/^-[^-]+/)) {
                return false;
            }
            let hasAllFlags = true;
            let next;
            const letters = arg.slice(1).split('');
            for (let j = 0; j < letters.length; j++) {
                next = arg.slice(j + 2);
                if (!hasAnyFlag(letters[j])) {
                    hasAllFlags = false;
                    break;
                }
                if ((letters[j + 1] && letters[j + 1] === '=') ||
                    next === '-' ||
                    (/[A-Za-z]/.test(letters[j]) && /^-?\d+(\.\d*)?(e-?\d+)?$/.test(next)) ||
                    (letters[j + 1] && letters[j + 1].match(/\W/))) {
                    break;
                }
            }
            return hasAllFlags;
        }
        function isUnknownOptionAsArg(arg) {
            return configuration['unknown-options-as-args'] && isUnknownOption(arg);
        }
        function isUnknownOption(arg) {
            arg = arg.replace(/^-{3,}/, '--');
            // ignore negative numbers
            if (arg.match(negative)) {
                return false;
            }
            // if this is a short option group and all of them are configured, it isn't unknown
            if (hasAllShortFlags(arg)) {
                return false;
            }
            // e.g. '--count=2'
            const flagWithEquals = /^-+([^=]+?)=[\s\S]*$/;
            // e.g. '-a' or '--arg'
            const normalFlag = /^-+([^=]+?)$/;
            // e.g. '-a-'
            const flagEndingInHyphen = /^-+([^=]+?)-$/;
            // e.g. '-abc123'
            const flagEndingInDigits = /^-+([^=]+?\d+)$/;
            // e.g. '-a/usr/local'
            const flagEndingInNonWordCharacters = /^-+([^=]+?)\W+.*$/;
            // check the different types of flag styles, including negatedBoolean, a pattern defined near the start of the parse method
            return !hasFlagsMatching(arg, flagWithEquals, negatedBoolean, normalFlag, flagEndingInHyphen, flagEndingInDigits, flagEndingInNonWordCharacters);
        }
        // make a best effort to pick a default value
        // for an option based on name and type.
        function defaultValue(key) {
            if (!checkAllAliases(key, flags.bools) &&
                !checkAllAliases(key, flags.counts) &&
                `${key}` in defaults) {
                return defaults[key];
            }
            else {
                return defaultForType(guessType(key));
            }
        }
        // return a default value, given the type of a flag.,
        function defaultForType(type) {
            const def = {
                [DefaultValuesForTypeKey.BOOLEAN]: true,
                [DefaultValuesForTypeKey.STRING]: '',
                [DefaultValuesForTypeKey.NUMBER]: undefined,
                [DefaultValuesForTypeKey.ARRAY]: []
            };
            return def[type];
        }
        // given a flag, enforce a default type.
        function guessType(key) {
            let type = DefaultValuesForTypeKey.BOOLEAN;
            if (checkAllAliases(key, flags.strings))
                type = DefaultValuesForTypeKey.STRING;
            else if (checkAllAliases(key, flags.numbers))
                type = DefaultValuesForTypeKey.NUMBER;
            else if (checkAllAliases(key, flags.bools))
                type = DefaultValuesForTypeKey.BOOLEAN;
            else if (checkAllAliases(key, flags.arrays))
                type = DefaultValuesForTypeKey.ARRAY;
            return type;
        }
        function isUndefined(num) {
            return num === undefined;
        }
        // check user configuration settings for inconsistencies
        function checkConfiguration() {
            // count keys should not be set as array/narg
            Object.keys(flags.counts).find(key => {
                if (checkAllAliases(key, flags.arrays)) {
                    error = Error(__('Invalid configuration: %s, opts.count excludes opts.array.', key));
                    return true;
                }
                else if (checkAllAliases(key, flags.nargs)) {
                    error = Error(__('Invalid configuration: %s, opts.count excludes opts.narg.', key));
                    return true;
                }
                return false;
            });
        }
        return {
            aliases: Object.assign({}, flags.aliases),
            argv: Object.assign(argvReturn, argv),
            configuration: configuration,
            defaulted: Object.assign({}, defaulted),
            error: error,
            newAliases: Object.assign({}, newAliases)
        };
    }
}
// if any aliases reference each other, we should
// merge them together.
function combineAliases(aliases) {
    const aliasArrays = [];
    const combined = Object.create(null);
    let change = true;
    // turn alias lookup hash {key: ['alias1', 'alias2']} into
    // a simple array ['key', 'alias1', 'alias2']
    Object.keys(aliases).forEach(function (key) {
        aliasArrays.push([].concat(aliases[key], key));
    });
    // combine arrays until zero changes are
    // made in an iteration.
    while (change) {
        change = false;
        for (let i = 0; i < aliasArrays.length; i++) {
            for (let ii = i + 1; ii < aliasArrays.length; ii++) {
                const intersect = aliasArrays[i].filter(function (v) {
                    return aliasArrays[ii].indexOf(v) !== -1;
                });
                if (intersect.length) {
                    aliasArrays[i] = aliasArrays[i].concat(aliasArrays[ii]);
                    aliasArrays.splice(ii, 1);
                    change = true;
                    break;
                }
            }
        }
    }
    // map arrays back to the hash-lookup (de-dupe while
    // we're at it).
    aliasArrays.forEach(function (aliasArray) {
        aliasArray = aliasArray.filter(function (v, i, self) {
            return self.indexOf(v) === i;
        });
        const lastAlias = aliasArray.pop();
        if (lastAlias !== undefined && typeof lastAlias === 'string') {
            combined[lastAlias] = aliasArray;
        }
    });
    return combined;
}
// this function should only be called when a count is given as an arg
// it is NOT called to set a default value
// thus we can start the count at 1 instead of 0
function increment(orig) {
    return orig !== undefined ? orig + 1 : 1;
}
// TODO(bcoe): in the next major version of yargs, switch to
// Object.create(null) for dot notation:
function sanitizeKey(key) {
    if (key === '__proto__')
        return '___proto___';
    return key;
}
function stripQuotes(val) {
    return (typeof val === 'string' &&
        (val[0] === "'" || val[0] === '"') &&
        val[val.length - 1] === val[0])
        ? val.substring(1, val.length - 1)
        : val;
}
</file>

<file path="web/scripts/generate-pagefind-index.mjs">
import path from "node:path";
import { promises as fs } from "node:fs";
import { close, createIndex } from "pagefind";

const distDir = path.resolve("dist");
const outputDir = path.join(distDir, "pagefind");

async function ensureDistDirectory() {
  const stats = await fs.stat(distDir).catch(() => null);
  if (!stats || !stats.isDirectory()) {
    throw new Error(
      "`dist/` is missing. Run `npm run astro -- build` before generating the Pagefind index."
    );
  }
}

async function main() {
  await ensureDistDirectory();

  console.log(`Generating Pagefind index from ${distDir}`);

  const { index } = await createIndex();
  if (!index) {
    throw new Error("Pagefind did not return an index instance.");
  }

  try {
    const { page_count: pageCount, errors: indexingErrors } = await index.addDirectory({
      path: distDir,
    });
    if (indexingErrors.length) {
      throw new Error(
        `Pagefind failed to index directory: ${indexingErrors.join("; ")}`
      );
    }

    await fs.rm(outputDir, { recursive: true, force: true });

    const { outputPath, errors: writeErrors } = await index.writeFiles({
      outputPath: outputDir,
    });
    if (writeErrors.length) {
      throw new Error(`Pagefind failed to write files: ${writeErrors.join("; ")}`);
    }

    console.log(
      `Pagefind indexed ${pageCount ?? 0} page(s) and wrote files to ${outputPath}`
    );
  } finally {
    await close();
  }
}

await main();
</file>

<file path="web/scripts/patch-yargs-parser.js">
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const vendorDir = path.join(__dirname, 'vendor', 'yargs-parser', 'build', 'lib');
const nodeModulesDir = path.join(process.cwd(), 'node_modules');
const files = ['string-utils.js', 'yargs-parser-types.js', 'yargs-parser.js'];
const logInfo = (message) => console.info(`[yargs patch] ${message}`);

logInfo(`Starting yargs-parser patch (vendorDir=${vendorDir}).`);

if (!fs.existsSync(vendorDir)) {
  console.error('Missing vendor files; cannot patch yargs-parser.');
  process.exit(1);
}

if (!fs.existsSync(nodeModulesDir)) {
  console.warn('Skipping yargs-parser patch: project node_modules directory not found.');
  process.exit(0);
}

const targetDirs = findYargsParserLibDirs(nodeModulesDir);
if (!targetDirs.length) {
  console.warn('Skipping yargs-parser patch: no yargs-parser directories detected in node_modules.');
  process.exit(0);
}

logInfo(`Found ${targetDirs.length} target location(s) to patch.`);

for (const targetDir of targetDirs) {
  for (const file of files) {
    const src = path.join(vendorDir, file);
    const dest = path.join(targetDir, file);
    try {
      fs.unlinkSync(dest);
    } catch (error) {
      if (error.code !== 'ENOENT') {
        throw error;
      }
    }
    fs.copyFileSync(src, dest);
  }
}

console.info(`Applied yargs-parser vendor patch to ${targetDirs.length} location(s).`);

function findYargsParserLibDirs(startDir) {
  const lockPath = path.join(process.cwd(), 'package-lock.json');
  if (fs.existsSync(lockPath)) {
    const lockDirs = findYargsParserLibDirsFromLock(lockPath);
    if (lockDirs.length) {
      logInfo(`Found ${lockDirs.length} yargs-parser/lib directories via package-lock.json.`);
      return lockDirs;
    }
    logInfo('package-lock.json scan found no yargs-parser entries; falling back to filesystem traversal.');
  } else {
    logInfo('package-lock.json not found; falling back to filesystem traversal.');
  }

  return scanNodeModulesForYargs(startDir);
}

function scanNodeModulesForYargs(startDir) {
  logInfo(`Scanning ${startDir} for yargs-parser/lib directories.`);
  const scanStart = Date.now();
  const targets = new Set();
  const queue = [startDir];
  const visited = new Set();
  const stats = { directoriesVisited: 0, nestedDirsEnqueued: 0 };

  while (queue.length) {
    const currentDir = queue.shift();
    let resolved;
    try {
      resolved = fs.realpathSync(currentDir);
    } catch {
      continue;
    }
    if (visited.has(resolved)) {
      continue;
    }
    visited.add(resolved);

    stats.directoriesVisited += 1;

    let entries;
    try {
      entries = fs.readdirSync(currentDir, { withFileTypes: true });
    } catch {
      continue;
    }

    for (const entry of entries) {
      if (!entry.isDirectory()) {
        continue;
      }

      const entryPath = path.join(currentDir, entry.name);

      if (entry.name === 'yargs-parser') {
        const libDir = path.join(entryPath, 'build', 'lib');
        if (fs.existsSync(libDir)) {
          targets.add(path.resolve(libDir));
        }
        continue;
      }

      if (entry.name.startsWith('@')) {
        queue.push(entryPath);
        stats.nestedDirsEnqueued += 1;
        continue;
      }

      if (entry.name.startsWith('node_modules')) {
        queue.push(entryPath);
        stats.nestedDirsEnqueued += 1;
        continue;
      }

      const nestedNodeModules = findNestedNodeModules(entryPath);
      stats.nestedDirsEnqueued += nestedNodeModules.length;
      for (const nestedDir of nestedNodeModules) {
        queue.push(nestedDir);
      }
    }
  }

  const durationMs = Date.now() - scanStart;
  logInfo(
    `Scan finished in ${durationMs}ms; visited ${stats.directoriesVisited} directories and enqueued ${stats.nestedDirsEnqueued} nested node_modules variants.`
  );

  return Array.from(targets);
}

function findYargsParserLibDirsFromLock(lockPath) {
  let lockJson;
  try {
    lockJson = JSON.parse(fs.readFileSync(lockPath, 'utf8'));
  } catch (error) {
    logInfo(`Could not read package-lock.json (${error.message}); falling back to traversal.`);
    return [];
  }

  const packages = lockJson.packages;
  if (!packages || typeof packages !== 'object') {
    logInfo('package-lock.json missing packages map; falling back to traversal.');
    return [];
  }

  const matches = [];
  for (const pkgPath of Object.keys(packages)) {
    const segments = pkgPath.split(/[\\/]+/).filter(Boolean);
    if (!segments.length || segments[segments.length - 1] !== 'yargs-parser') {
      continue;
    }
    const libDir = path.join(process.cwd(), ...segments, 'build', 'lib');
    if (fs.existsSync(libDir)) {
      matches.push(path.resolve(libDir));
    }
  }

  return Array.from(new Set(matches));
}

function findNestedNodeModules(dir) {
  const variants = [
    'node_modules',
    'node_modules2',
    'node_modules3',
    'node_modules4',
    'node_modules5',
    'node_modules 2',
    'node_modules 3',
    'node_modules 4',
    'node_modules 5',
    'node_modules-2',
    'node_modules-3',
    'node_modules-4',
    'node_modules-5',
  ];

  const nested = [];
  for (const variant of variants) {
    const candidate = path.join(dir, variant);
    try {
      if (fs.existsSync(candidate) && fs.statSync(candidate).isDirectory()) {
        nested.push(candidate);
      }
    } catch {
      // ignore permissions or race conditions
    }
  }
  return nested;
}
</file>

<file path="web/src/components/sections/PrayerMeetingCallout.astro">
---
import Button from "../ui/Button.astro";
import type { PrayerMeetingDetails } from "../../data/activities";

type Props = {
  meeting: PrayerMeetingDetails;
};

const { meeting } = Astro.props as Props;
const timeLabel = `${meeting.day} · ${meeting.time}`;
---

<section class="prayer-callout" aria-label="Prayer meeting callout">
  <div class="prayer-callout__content">
    <p class="eyebrow">{meeting.title}</p>
    <h2>{timeLabel}</h2>
    <p class="muted">In person: {meeting.location}</p>
  </div>

  <div class="prayer-callout__cta">
    <Button href={meeting.zoomUrl} external size="md">
      Join via Zoom
    </Button>
  </div>

  <details class="prayer-callout__details">
    <summary>Dial-in &amp; meeting info</summary>
    <dl>
      <div>
        <dt>Dial-in</dt>
        <dd>{meeting.dialIn}</dd>
      </div>
      <div>
        <dt>Meeting ID</dt>
        <dd>{meeting.meetingId}</dd>
      </div>
      <div>
        <dt>Passcode</dt>
        <dd>{meeting.passcode}</dd>
      </div>
    </dl>
  </details>
</section>

<style>
  .prayer-callout {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    background: var(--color-surface);
    padding: var(--space-4);
    box-shadow: var(--shadow-2);
    display: grid;
    gap: var(--space-3);
  }

  .prayer-callout__content h2 {
    margin: 0;
    font-size: 1.5rem;
    letter-spacing: -0.02em;
  }

  .prayer-callout__cta {
    display: flex;
  }

  .prayer-callout__cta .btn {
    width: 100%;
    justify-content: center;
  }

  .prayer-callout__details {
    border-top: 1px solid var(--color-border);
    padding-top: var(--space-2);
  }

  .prayer-callout__details summary {
    font-weight: 600;
    cursor: pointer;
    list-style: none;
  }

  .prayer-callout__details summary::-webkit-details-marker {
    display: none;
  }

  .prayer-callout__details dl {
    margin: var(--space-2) 0 0;
    display: grid;
    gap: var(--space-1);
  }

  .prayer-callout__details dt {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--color-text-muted);
  }

  .prayer-callout__details dd {
    margin: 0;
    font-size: 1rem;
  }

  @media (min-width: 720px) {
    .prayer-callout {
      grid-template-columns: 1fr auto;
      align-items: center;
    }

    .prayer-callout__details {
      grid-column: 1 / -1;
    }

    .prayer-callout__cta {
      justify-content: flex-end;
    }
  }
</style>
</file>

<file path="web/src/components/ui/BudgetProgress.astro">
---
import budget from "../../data/budget.json";

const { goal = 0, received = 0, updatedAt } = budget;
const normalizedGoal = Math.max(0, goal);
const normalizedReceived = Math.max(0, received);
const percentRaised = normalizedGoal
  ? Math.min(100, Math.round((normalizedReceived / normalizedGoal) * 100))
  : 0;

const currencyFormatter = new Intl.NumberFormat("en-US", {
  style: "currency",
  currency: "USD",
  maximumFractionDigits: 0,
});

const dateFormatter = new Intl.DateTimeFormat("en-US", {
  month: "long",
  day: "numeric",
  year: "numeric",
});

const formattedGoal = currencyFormatter.format(normalizedGoal);
const formattedReceived = currencyFormatter.format(normalizedReceived);
const formattedUpdatedAt = updatedAt
  ? dateFormatter.format(new Date(updatedAt))
  : null;
---

<section class="budget-progress card" aria-label="Budget progress widget">
  <div class="budget-progress__heading">
    <p class="muted">Annual operating budget</p>
    <h2>Budget progress</h2>
  </div>

  <div class="budget-progress__totals">
    <div>
      <p class="muted">Goal</p>
      <p class="budget-progress__amount">{formattedGoal}</p>
    </div>
    <div>
      <p class="muted">Received</p>
      <p class="budget-progress__amount">{formattedReceived}</p>
    </div>
  </div>

  <div
    class="budget-progress__bar"
    role="progressbar"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-valuenow={percentRaised}
    aria-label={`${percentRaised}% of goal met`}
  >
    <span class="budget-progress__bar-fill" style={`width: ${percentRaised}%`}></span>
  </div>

  <p class="budget-progress__percent">{percentRaised}% of the goal met</p>
  {formattedUpdatedAt && (
    <p class="budget-progress__updated small muted">Updated {formattedUpdatedAt}</p>
  )}
</section>

<style>
  .budget-progress {
    gap: var(--space-4);
    display: flex;
    flex-direction: column;
  }

  .budget-progress__heading h2 {
    margin: 0;
    font-size: var(--font-size-3);
  }

  .budget-progress__totals {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: var(--space-4);
  }

  .budget-progress__amount {
    margin: 0;
    font-size: var(--font-size-3);
    font-weight: 700;
  }

  .budget-progress__bar {
    position: relative;
    height: 12px;
    background: var(--color-surface-muted);
    border-radius: var(--radius-4);
    overflow: hidden;
  }

  .budget-progress__bar-fill {
    display: block;
    height: 100%;
    background: linear-gradient(90deg, var(--color-primary), #8c222b);
    border-radius: var(--radius-4);
    transition: width 220ms ease;
  }

  .budget-progress__percent {
    margin: 0;
    font-weight: 600;
  }

  .budget-progress__updated {
    margin: 0;
  }
</style>
</file>

<file path="web/src/components/ui/ButtonLink.astro">
---
import Button from "./Button.astro";

type Props = {
  href: string;
  external?: boolean;
  variant?: "primary" | "secondary";
  size?: "sm" | "md" | "lg";
};

const { href, external, variant = "primary", size = "md" } = Astro.props;
---

<Button href={href} external={external} variant={variant} size={size}>
  <slot />
</Button>
</file>

<file path="web/src/components/ui/MapEmbed.astro">
---
export interface Props {
  src: string;
  title?: string;
}
const { src, title = "Map" } = Astro.props;
---

<div class="map-embed">
  <iframe
    src={src}
    title={title}
    loading="lazy"
    referrerpolicy="no-referrer-when-downgrade"
    allowfullscreen
  ></iframe>
</div>

<style>
  .map-embed {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    overflow: hidden;
    aspect-ratio: 16 / 9;
    background: var(--color-surface);
  }

  .map-embed iframe {
    width: 100%;
    height: 100%;
    border: 0;
    display: block;
  }
</style>
</file>

<file path="web/src/components/ui/SectionHeading.astro">
---
type Props = {
  title?: string;
  subtitle?: string;
};

const { title, subtitle } = Astro.props as Props;
const hasTitle = Boolean(title?.trim());
const hasSubtitle = Boolean(subtitle?.trim());
const hasActionSlot = Boolean(Astro.slots?.action);
const shouldRender = hasTitle || hasSubtitle || hasActionSlot;
const classes = ["section-heading", hasActionSlot ? "section-heading--horizontal" : ""].filter(Boolean).join(" ");
---

{shouldRender && (
  <header class={classes}>
    <div class="section-heading__copy">
      {hasTitle && <h2 class="section-heading__title">{title}</h2>}
      {hasSubtitle && <p class="section-heading__subtitle">{subtitle}</p>}
    </div>
    {hasActionSlot && (
      <div class="section-heading__action">
        <slot name="action" />
      </div>
    )}
  </header>
)}
</file>

<file path="web/src/components/ui/YouTubeEmbed.astro">
---
import YouTubeEmbedMedia from "../media/YouTubeEmbed.astro";

export type Props = {
  title: string;
  /** Full YouTube embed URL, e.g. https://www.youtube.com/embed/VIDEO_ID */
  embedUrl: string;
};

const props = Astro.props as Props;
---

<YouTubeEmbedMedia {...props} />
</file>

<file path="web/src/components/PlanVisitContent.astro">
---
import Schedule from "./ui/Schedule.astro";
import { site } from "../data/site";
---

<div class="stack">
  <h1>Plan a Visit</h1>

  <Schedule title="Service Times" items={site.schedule} />

  <section class="card stack">
    <h2>Directions</h2>
    <p class="muted">
      Address:
      <a href={site.contact.mapsUrl} target="_blank" rel="noopener noreferrer">
        {site.contact.address}
      </a>
    </p>

    <ul class="muted">
      {site.visit.directions.map((direction) => (
        <li>{direction}</li>
      ))}
    </ul>
  </section>

  <section class="card stack">
    <h2>What to expect</h2>
    <p class="muted">{site.visit.languageNote}</p>
    <p class="muted">{site.visit.parkingNote}</p>
    <p class="muted">{site.visit.accessibilityNote}</p>
  </section>
</div>
</file>

<file path="web/src/components/Welcome.astro">
---
import astroLogo from '../assets/astro.svg';
import background from '../assets/background.svg';
---

<div id="container">
	<img id="background" src={background.src} alt="" fetchpriority="high" />
	<main>
		<section id="hero">
			<a href="https://astro.build"
				><img src={astroLogo.src} width="115" height="48" alt="Astro Homepage" /></a
			>
			<h1>
				To get started, open the <code><pre>src/pages</pre></code> directory in your project.
			</h1>
			<section id="links">
				<a class="button" href="https://docs.astro.build">Read our docs</a>
				<a href="https://astro.build/chat"
					>Join our Discord <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36"
						><path
							fill="currentColor"
							d="M107.7 8.07A105.15 105.15 0 0 0 81.47 0a72.06 72.06 0 0 0-3.36 6.83 97.68 97.68 0 0 0-29.11 0A72.37 72.37 0 0 0 45.64 0a105.89 105.89 0 0 0-26.25 8.09C2.79 32.65-1.71 56.6.54 80.21a105.73 105.73 0 0 0 32.17 16.15 77.7 77.7 0 0 0 6.89-11.11 68.42 68.42 0 0 1-10.85-5.18c.91-.66 1.8-1.34 2.66-2a75.57 75.57 0 0 0 64.32 0c.87.71 1.76 1.39 2.66 2a68.68 68.68 0 0 1-10.87 5.19 77 77 0 0 0 6.89 11.1 105.25 105.25 0 0 0 32.19-16.14c2.64-27.38-4.51-51.11-18.9-72.15ZM42.45 65.69C36.18 65.69 31 60 31 53s5-12.74 11.43-12.74S54 46 53.89 53s-5.05 12.69-11.44 12.69Zm42.24 0C78.41 65.69 73.25 60 73.25 53s5-12.74 11.44-12.74S96.23 46 96.12 53s-5.04 12.69-11.43 12.69Z"
						></path></svg
					>
				</a>
			</section>
		</section>
	</main>

	<a href="https://astro.build/blog/astro-5/" id="news" class="box">
		<svg width="32" height="32" fill="none" xmlns="http://www.w3.org/2000/svg"
			><path
				d="M24.667 12c1.333 1.414 2 3.192 2 5.334 0 4.62-4.934 5.7-7.334 12C18.444 28.567 18 27.456 18 26c0-4.642 6.667-7.053 6.667-14Zm-5.334-5.333c1.6 1.65 2.4 3.43 2.4 5.333 0 6.602-8.06 7.59-6.4 17.334C13.111 27.787 12 25.564 12 22.666c0-4.434 7.333-8 7.333-16Zm-6-5.333C15.111 3.555 16 5.556 16 7.333c0 8.333-11.333 10.962-5.333 22-3.488-.774-6-4-6-8 0-8.667 8.666-10 8.666-20Z"
				fill="#111827"></path></svg
		>
		<h2>What's New in Astro 5.0?</h2>
		<p>
			From content layers to server islands, click to learn more about the new features and
			improvements in Astro 5.0
		</p>
	</a>
</div>

<style>
	#background {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: -1;
		filter: blur(100px);
	}

	#container {
		font-family: Inter, Roboto, 'Helvetica Neue', 'Arial Nova', 'Nimbus Sans', Arial, sans-serif;
		height: 100%;
	}

	main {
		height: 100%;
		display: flex;
		justify-content: center;
	}

	#hero {
		display: flex;
		align-items: start;
		flex-direction: column;
		justify-content: center;
		padding: 16px;
	}

	h1 {
		font-size: 22px;
		margin-top: 0.25em;
	}

	#links {
		display: flex;
		gap: 16px;
	}

	#links a {
		display: flex;
		align-items: center;
		padding: 10px 12px;
		color: #111827;
		text-decoration: none;
		transition: color 0.2s;
	}

	#links a:hover {
		color: rgb(78, 80, 86);
	}

	#links a svg {
		height: 1em;
		margin-left: 8px;
	}

	#links a.button {
		color: white;
		background: linear-gradient(83.21deg, #3245ff 0%, #bc52ee 100%);
		box-shadow:
			inset 0 0 0 1px rgba(255, 255, 255, 0.12),
			inset 0 -2px 0 rgba(0, 0, 0, 0.24);
		border-radius: 10px;
	}

	#links a.button:hover {
		color: rgb(230, 230, 230);
		box-shadow: none;
	}

	pre {
		font-family:
			ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono',
			monospace;
		font-weight: normal;
		background: linear-gradient(14deg, #d83333 0%, #f041ff 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
		margin: 0;
	}

	h2 {
		margin: 0 0 1em;
		font-weight: normal;
		color: #111827;
		font-size: 20px;
	}

	p {
		color: #4b5563;
		font-size: 16px;
		line-height: 24px;
		letter-spacing: -0.006em;
		margin: 0;
	}

	code {
		display: inline-block;
		background:
			linear-gradient(66.77deg, #f3cddd 0%, #f5cee7 100%) padding-box,
			linear-gradient(155deg, #d83333 0%, #f041ff 18%, #f5cee7 45%) border-box;
		border-radius: 8px;
		border: 1px solid transparent;
		padding: 6px 8px;
	}

	.box {
		padding: 16px;
		background: rgba(255, 255, 255, 1);
		border-radius: 16px;
		border: 1px solid white;
	}

	#news {
		position: absolute;
		bottom: 16px;
		right: 16px;
		max-width: 300px;
		text-decoration: none;
		transition: background 0.2s;
		backdrop-filter: blur(50px);
	}

	#news:hover {
		background: rgba(255, 255, 255, 0.55);
	}

	@media screen and (max-height: 368px) {
		#news {
			display: none;
		}
	}

	@media screen and (max-width: 768px) {
		#container {
			display: flex;
			flex-direction: column;
		}

		#hero {
			display: block;
			padding-top: 10%;
		}

		#links {
			flex-wrap: wrap;
		}

		#links a.button {
			padding: 14px 18px;
		}

		#news {
			right: 16px;
			left: 16px;
			bottom: 2.5rem;
			max-width: 100%;
		}

		h1 {
			line-height: 1.5;
		}
	}
</style>
</file>

<file path="web/src/content/announcements/2026-01-29-forecast-warning.md">
---
title: "Weather-related cancellations"
date: 2026-01-29
tags:
  - cancellations
summary: "Monday night Bible study is postponed if the winter storm arrives."
expires: 2026-01-31
---
Check the weather feed before heading out for evening programs. If the snow arrives as forecast (chance of 6–8 inches), we will postpone Monday night Bible study and notify volunteers by email.
</file>

<file path="web/src/content/announcements/2026-02-03-food-drive-call.md">
---
title: "Community food drive volunteers"
date: 2026-02-03
tags:
  - events
  - volunteers
summary: "Help pack and deliver meals for neighbors in need on February 12."
---
Register online or call the church office if you can lend a hand with sorting, packing, or delivering meals for our community food drive. Bring gloves and a warm coat; hot beverages will be served.
</file>

<file path="web/src/content/announcements/2026-02-05-worship-adjustments.md">
---
title: "Sabbath worship time update"
date: 2026-02-05
tags:
  - this-week
  - ministries
summary: "Worship time will shift for Sabbath mornings while our sanctuary host team finishes upgrades."
featured: true
---
Our sanctuary host team is finishing a short series of upgrades, so Sabbath worship will begin at 10:45 AM on February 5 instead of 10:30 AM. Please arrive a few minutes early if you would like to help with setup or welcome guests.

The youth choir will still lead the first hymn, and the sermon will follow the welcome at 11:00 AM.
</file>

<file path="web/src/content/announcements/2026-02-12-annex-safety-notice.md">
---
title: "Annex safety notice"
date: 2026-02-12
tags:
  - cancellations
summary: "The annex is paused while we confirm the space is safe."
---
We are keeping the annex closed while our safety team confirms the building is secure following a recent incident. There is no indication of ongoing danger, but we are pausing access until inspectors finish their report and any repairs are completed.

We will publish a full update as soon as the safety review is complete so families and ministry leaders can plan ahead. Until then, please avoid scheduling meetings or dropping items in the annex.

Questions may be directed to <firstspringfieldsda@gmail.com>, and the welcome team will help route those requests once we have a confirmed reopening date.
</file>

<file path="web/src/content/announcements/2026-02-12-greeters-needed.md">
---
title: "Greeters needed for worship welcome"
date: 2026-02-12
tags:
  - volunteers
summary: "Volunteers are needed to welcome worshipers on upcoming Sabbaths."
---
We are assembling a welcome team for the next few Sabbaths and need greeters who can arrive by 9:30 AM to open doors, hand out bulletins, and help guests find seating and children's programs.

Our official greeter coordinator is still being confirmed, so for now just reply to <firstspringfieldsda@gmail.com> with "Greeter volunteer" in the subject and list the Sabbaths you are available. We will host a short orientation before your first shift so you feel confident in the role.

This is a perfect opportunity for people who smile easily, love meeting new neighbors, and want to share the warmth of First Springfield every week.
</file>

<file path="web/src/content/announcements/2026-02-12-nar-anon-update.md">
---
title: "Nar-Anon meets Monday nights"
date: 2026-02-12
tags:
  - events
summary: "Nar-Anon now gathers Mondays at 7:00 PM in the fellowship hall."
---
Nar-Anon now meets Monday evenings at 7:00 PM in the fellowship hall. The gathering lasts about 90 minutes and offers a safe space for families and friends affected by addiction.

The meeting format mixes short readings, reflection, and open sharing, and all are welcome to join whether you are new to Nar-Anon or returning. There is no cost, and confidentiality is respected by the hosts.

For more information, email <firstspringfieldsda@gmail.com> with "Nar-Anon" in the subject and the volunteer hosts will connect you with the right resources.
</file>

<file path="web/src/content/announcements/2026-02-13-anchored-together-retreat.md">
---
title: "Anchored Together couples retreat"
date: 2026-02-13
tags:
  - events
summary: "Anchored Together couples retreat runs Feb 13-14 to refresh marriages."
---
"Anchored Together" is a couples retreat that runs Friday evening through Saturday afternoon, February 13-14, at a nearby retreat center. It blends worship, guided conversation, and restful space so married and engaged couples can reconnect with each other and with Christ.

Friday night begins with supper, a devotion, and small-group conversation. Saturday includes breakfast check-in, worship, practical breakout sessions on communication and mission partnership, and time for prayer before returning home for Sabbath rest.

Space is limited to twelve couples, so register by Tuesday, February 4, by emailing <firstspringfieldsda@gmail.com> with your names and any dietary needs. A modest love offering will help cover meals and materials.
</file>

<file path="web/src/content/announcements/2026-02-14-table-talk.md">
---
title: "Table Talk - February 14"
date: 2026-02-14
tags:
  - events
summary: "Table Talk returns after the Divine Service on Feb 14 for youth and young adults."
---
Table Talk is back on Saturday, February 14, immediately after the Divine Service in the fellowship hall. This monthly conversation gives youth, young adults, and their friends a safe place to ask questions about faith, mission, relationships, and everyday choices.

A short devotion kicks off the evening, followed by small-group conversations while we enjoy light refreshments shared by the youth team. Bring a question, a listening ear, or a friend who is exploring faith.

Questions or topic suggestions can be sent to <firstspringfieldsda@gmail.com> with "Table Talk" in the subject.
</file>

<file path="web/src/content/announcements/2026-02-14-youth-sabbath.md">
---
title: "Youth Sabbath celebration"
date: 2026-02-14
tags:
  - events
summary: "Youth and young adults lead worship during Youth Sabbath on Feb 14."
---
Join us for Youth Sabbath on Saturday, February 14, when the Youth & Young Adults Ministry team leads the Divine Service. Youth musicians, testimony teams, and a message from our young leaders will highlight how they are living out their faith in school, work, and community.

We will also pause for a short moment of gratitude, and the youth hospitality crew will host a simple fellowship lunch after worship so everyone can continue the conversation.

Want to support the youth team or share a prayer? Email <firstspringfieldsda@gmail.com> and the youth ministry leaders will connect with you.
</file>

<file path="web/src/content/announcements/2026-02-28-matthew-5-bible-study.md">
---
title: "Matthew 5 Bible study"
date: 2026-02-28
tags:
  - events
summary: "Study Jesus' Sermon on the Mount right after the Divine Service on Feb 28."
---
Stick around after the Divine Service on Saturday, February 28, for a Matthew 5 Bible study in the fellowship hall. We'll read the Beatitudes together, ask what Jesus' message means for our neighborhoods, and pray for the courage to live the Sermon on the Mount.

The discussion will include guided questions, a short historical note, and space for prayer requests. Bring a Bible, a notebook, and your curiosity.

Questions or ideas for future passages? Reply to <firstspringfieldsda@gmail.com> and the discipleship team will follow up.
</file>

<file path="web/src/content/announcements/2026-03-21-guest-speaker.md">
---
title: "Guest Speaker Sabbath"
date: 2026-03-21
tags:
  - events
summary: "Guest Speaker Sabbath on March 21 welcomes a visiting speaker and devotional conversation."
---
Join us for Guest Speaker Sabbath on Saturday, March 21, at 11:15 AM in the sanctuary. We will welcome a visiting speaker from our conference who will encourage us in discipleship, community engagement, and faithful witness in Springfield.

After the message, the guest will stay for a short conversation time where you can ask questions and hear how God is leading our wider union. We'll also invite the congregation to share prayer requests for the speaker's ministry.

If you have questions you'd like to pass along in advance, reply to <firstspringfieldsda@gmail.com> with "Guest Speaker" in the subject.
</file>

<file path="web/src/content/announcements/2026-03-28-trivia-night.md">
---
title: "Trivia Night"
date: 2026-03-28
tags:
  - events
summary: "Trivia Night on March 28 is a fellowship-driven evening of teams, snacks, and missions."
---
Trivia Night is Saturday, March 28, at 6:30 PM in the fellowship hall. Teams of four to six will face off on Bible stories, Adventist history, pop culture, and lighthearted surprises while we take short breaks for prayer and a surprise devotion.

Bring a snack to share, and we will host a potluck-style table with beverages between rounds. Entry is free, but a small donation will support Youth & Young Adults Ministry outreach and missions.

Reserve your table by emailing <firstspringfieldsda@gmail.com> with "Trivia Night" in the subject and the names on your team.
</file>

<file path="web/src/content/announcements/2026-04-04-he-has-risen.md">
---
title: "He Has Risen worship celebration"
date: 2026-04-04
tags:
  - events
summary: "He Has Risen special worship on Easter Sabbath, April 4."
---
Celebrate "He Has Risen" on Sabbath, April 4, at 11:15 AM in the sanctuary. The worship service will feature the choir, youth drama, and an Easter message that explores the hope of the resurrection for every season.

The music and drama teams will lead fresh arrangements of beloved hymns, and we will close with a candlelight benediction and the congregation singing together. Fellowship refreshments will follow in the foyer so visitors can stay and connect.

Plan to invite friends and neighbors, and if you have a musical gift to share, email <firstspringfieldsda@gmail.com> with "He Has Risen" in the subject.
</file>

<file path="web/src/content/announcements/2026-06-19-camp-meeting-closure.md">
---
title: "Camp Meeting and campus closure"
date: 2026-06-19
tags:
  - events
summary: "Campus closed on Sabbaths June 20 and 27 while the church family attends Atlantic Union Camp Meeting."
---
Our church family plans to attend the Atlantic Union Camp Meeting June 19-27, 2026, so campus activities will pause while we gather there. The campus will be closed on Sabbath, June 20, and Sabbath, June 27, while staff, volunteers, and ministry leaders worship and connect at camp.

Members who can't travel are invited to watch the online services (link to be shared closer to the date) or join the small fellowship group that will host a prayer gathering on the campus bridge during those Sabbaths.

We expect to reopen the campus on Sunday, June 28. Questions about the closure or prayer requests can be sent to <firstspringfieldsda@gmail.com>.
</file>

<file path="web/src/content/announcements/2026-07-28-vacation-bible-school.md">
---
title: "Vacation Bible School 2026"
date: 2026-07-28
tags:
  - events
summary: "VBS July 28-30 welcomes kids ages 4-12 for stories, crafts, and worship."
---
Vacation Bible School (VBS) returns Tuesday-Thursday, July 28-30, from 6:00 to 7:15 PM each evening. Children ages 4-12 are invited to dive into Bible stories, crafts, worship songs, and service projects that celebrate Jesus' love.

Registration is open now; families can sign up by replying to <firstspringfieldsda@gmail.com> with "VBS registration" in the subject and listing child names, ages, and any allergies.

We also need adult and teen volunteers to shepherd groups, lead stations, and bless kids with snacks. If you can help, reply to the same email and share your availability.
</file>

<file path="web/src/content/announcements/2026-12-19-christmas-program.md">
---
title: "Christmas program 2026"
date: 2026-12-19
tags:
  - events
summary: "Christmas program with music, drama, and candlelight on Dec 19."
---
Save the date for our Christmas program on Saturday, December 19, at 5:00 PM in the sanctuary. We will present music, drama, and candlelight reflections that tell the story of Jesus' birth.

Choirs, youth ensembles, and drama teams will share seasonal favorites, and we will conclude with a community candlelighting and the final chorus of "O Holy Night." Guests are welcome, so bring neighbors and family.

After the program, the foyer will host a cookie reception; if you can bring a tray or help greet visitors, email <firstspringfieldsda@gmail.com> with "Christmas program" in the subject.
</file>

<file path="web/src/content/bulletins/2025-12-13.md">
---
title: "Sabbath Bulletin"
date: "2025-12-13"
summary: "Archive sample bulletin."
pdfUrl: "/bulletins/2025-12-13.pdf"
---
</file>

<file path="web/src/content/bulletins/2026-01-03.md">
---
title: "Sabbath Bulletin"
date: "2026-01-03"
summary: "Order of service, announcements, and weekly schedule."
pdfUrl: "/bulletins/2026-01-03.pdf"
---
</file>

<file path="web/src/content/devotionals/2026/02/10/quiet-strength.md">
---
title: "Quiet Strength"
summary: |
  Our strength grows when we stop striving and stand under God's promise to renew weary souls. This reflection leans on Isaiah 40 and invites gentle waiting, not hurried fixes.
date: "2026-02-10"
---

## Reflection
God's strength is not a quick fix but a deepening confidence. When we let go of the illusion that we must fix everything ourselves, we feel the Holy Spirit breathe new patience into our day.

## Prayer
Heavenly Father, remind me that strength is born in stillness with you.
</file>

<file path="web/src/content/devotionals/2026/02/11/anchored-in-mercy.md">
---
title: "Anchored in Mercy"
summary: |
  When the week swells with noise, God's mercy invites a quieter rhythm. Today's reflection reminds us to release control, name our fears, and rest in the Shepherd who never slumbers.
date: "2026-02-11"
link: "https://www.upperroom.org/resources/daily-devotional"
---

## Reflection
Mercy looks like breath that comes deep from the Father, steadying our hearts even when the path ahead feels unclear. Instead of forcing answers, we pause, pray, and let the Spirit remind us that love is already sufficient.

## Prayer
Lord, soften my busy mind and draw me near to the calm of your mercy.
</file>

<file path="web/src/content/devotionals/2026/02/12/steady-faith.md">
---
title: "Steady Faith in the Wait"
summary: |
  Waiting seasons stretch our trust, so today’s reflection leans into the promise that God keeps every word and gently holds our story in His hands.
date: "2026-02-12"
link: "https://www.upperroom.org/resources/daily-devotional"
---

## Reflection

Patient faith is not idle; it is steady obedience. When we feel stuck between the promise and the provision, God invites us to keep praying, keep loving, and keep showing up for the next right thing. In that surrendered rhythm, His peace quietly surfaces.

## Prayer

Jesus, help me keep my gaze on you while I wait, knowing you are already working behind the scenes to bring your good plans to light.
</file>

<file path="web/src/content/devotionals/2026/02/13/restored-songs.md">
---
title: "Restored Songs"
summary: |
  God rewrites our history with mercy, so even the broken verses can become melody again when we respond with gratitude.
date: "2026-02-13"
link: "https://www.upperroom.org/resources/daily-devotional"
---

## Reflection

When we carry guilt or regret, it’s tempting to stay quiet—but the Spirit invites us to remember how He has already forgiven and now redeems every sorrow into praise. Let your next step be gratitude and a small act of generosity.

## Prayer

Lord, lift the weight from my shoulders and help me sing the songs you have restored in my heart.
</file>

<file path="web/src/content/ministries/adult-sabbath-school.md">
---
title: "Adult Sabbath School"
summary: "A Christ-centered Sabbath School focused on prayer, member care, service, and Bible study."
leaderName: "Sabbath School Superintendent"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Sabbaths at 10:00 AM"
category: "Bible Study"
tags: ["adult", "sabbath school", "bible study", "prayer", "service"]
---

## Mission Statement

The Mission of the Adult Sabbath School Department of the First Springfield Seventh-day Adventist Church is to provide structured opportunities for its members and visitors to experience a living relationship with Jesus Christ through an emphasis on prayer, member care, service, and Bible study.

## Goals and Objectives

<div class="grid--cards">
  <div class="card stack--tight">
    <h3>Prayer</h3>
    <p>
      We recognize that prayer is a primary foundation of Spiritual life. Therefore, each class will
      spend time in group prayer. Ample opportunity will be made to receive prayer requests, and prayer
      will be made not only by class leaders, but individual members will pray for class needs, church
      needs, and the overall importance of each person being filled with the Holy Spirit.
    </p>
  </div>
  <div class="card stack--tight">
    <h3>Member Care</h3>
    <p>
      We recognize that each individual is a part of the larger body, and that Scripture calls us to
      care for one another. Therefore, each class will spend time in discerning the needs of its
      members, and planning ways to reach out and meet those needs. Obeying the Scriptural injunction
      to "Bear one another's burdens," we will seek to lift the spiritual, social, emotional, and
      financial needs of our brothers and sisters within the family of God as we have opportunity.
      Each class will seek to reach out to its inactive or missing members in a regular and consistent
      manner.
    </p>
  </div>
  <div class="card stack--tight">
    <h3>Service</h3>
    <p>
      We recognize that God has directed that service be the criteria by which greatness is measured.
      Following our Lord's example, each class will plan and execute a service program in some area of
      need. Such programs will range from practical help given to needy persons to evangelistic or
      missionary work in the Pioneer Valley area, or even in the larger world field as God leads.
      Opportunities will be provided to receive training that will facilitate the outreach of the
      Sabbath School program.
    </p>
  </div>
  <div class="card stack--tight">
    <h3>Bible Study</h3>
    <p>
      We recognize that the study of Scripture is the primary way that we may come to know our Lord
      Jesus Christ and the power of His gospel. Seeking to increase our understanding of Scripture,
      each class will spend time in appropriate and relevant Bible study, using either the Adult
      Sabbath School Quarterly, or other materials approved by the Sabbath School Council. New classes
      will be encouraged to form that center around shared interests and needs as it pertains to
      applying Scripture to all aspects of our lives.
    </p>
  </div>
</div>
</file>

<file path="web/src/content/ministries/board-meeting.md">
---
title: "Board Meeting"
summary: "Monthly planning and oversight for church leadership."
leaderName: "Church Board"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "2nd Tuesday"
category: "Leadership"
draft: true
tags: ["leadership", "members"]
---

## Overview

Board meetings are for members and invited guests to plan and shepherd church life.

## How to get involved

If you are a board member, watch for the monthly agenda and meeting link.
</file>

<file path="web/src/content/ministries/community-meal-spaghetti.md">
---
title: "Community Meal - Spaghetti"
summary: "A free community meal to share food, fellowship, and care."
leaderName: "Community Meal Team"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "4th Wednesday"
category: "Outreach"
tags: ["outreach", "community", "hospitality"]
---

## Overview

Neighbors are welcome to a warm meal and friendly conversation.

## How to get involved

Volunteer or invite a friend to join us.
</file>

<file path="web/src/content/ministries/music-ministry.md">
---
title: "Music Ministry"
summary: "Leading worship through choir, praise teams, and congregational music that reflects our multicultural story."
leaderName: "Berline Guirand"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Choir rehearsals Thursdays at 7:00 PM, with weekly preparation for Sabbath worship."
category: "Other"
tags: ["music", "worship", "choir", "praise"]
---

## Music Ministry

Our Music Ministry invites voices, instruments, and hearts of every age to lift Jesus in worship. We celebrate a variety of musical traditions that reflect Springfield’s diverse congregational family—from gospel choirs and praise teams to orchestral and acoustic specials.

### Choirs & Ensembles

• Adults, youth, and children rehearse together and separately during the week so each Sabbath service includes a thoughtful blend of voices, instrumental praise, and moments for congregational singing.
• Special music is coordinated for holidays, communion weekends, evangelism events, and community outreach services.

### Participation & Contact

Everyone is welcome to join, whether you read music or simply love to sing. Reach out to Music Director Berline Guirand at [firstspringfieldsda@gmail.com](mailto:firstspringfieldsda@gmail.com) to learn which ensemble is a good fit, discover rehearsal schedules, or request a piece for an upcoming worship service.
</file>

<file path="web/src/content/ministries/social-ministry.md">
---
title: "Social Ministry"
summary: "Hospitality, fellowship, and celebration events that help our people and neighbors feel known."
leaderName: "Teddy Williamson · David McKenzie"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Social events align with the church calendar and are announced in the weekly bulletin."
category: "Outreach"
tags: ["community", "fellowship", "hospitality", "events"]
---

## Social Ministry

Our Social Ministry brings intentional hospitality to First Springfield—creating meals, fellowship nights, celebrations, and shared meals that welcome members and neighbors alike.

### Events & Fellowship

• Community-friendly potlucks, seasonal celebrations, and dessert socials help us stay connected after worship and during special seasons.
• Hospitality is also woven into milestone events such as graduations, anniversaries, and fellowship after memorials or outreach programs.
• The Social Committee partners with other ministries (like Adventist Community Services and Vacation Bible School) to make sure every gathering feels warm and well-planned.

### Join the Committee

To suggest a gathering, bring a recipe, or help serve, email the Social Committee (Teddy Williamson · David McKenzie) at [firstspringfieldsda@gmail.com](mailto:firstspringfieldsda@gmail.com). Volunteers are welcome for setup, clean-up, decorating, and hospitality teams.
</file>

<file path="web/src/content/updates/_building-annex-closed.md">
---
title: "Building/annex closed template"
date: 2026-01-01
summary: "Where people can’t enter because of repairs, and when it might reopen."
category: "building"
draft: true
---
Replace this copy with the reason for the closure (maintenance, staff meeting, etc.), which doors or annex spaces are affected, and what alternate rooms or services are still available if applicable.
</file>

<file path="web/src/content/updates/_email-update-template.md">
---
title: "Email update template"
date: 2026-02-12
summary: "Reuse this layout to announce cancellations, schedule shifts, or closures via email."
category: "communications"
draft: true
---
**Subject line:** lead with the action (cancellation, time change, closure) plus the program and date so it scrolls into inboxes quickly.

**Preview text:** add the brightest detail (new time, safety reminder, follow-up plan) so people who skim the message know why it matters.

**Body:** open with a single sentence that names the impacted gathering or service, states the new state of play, and points people to the updates page for full context. Follow with a short “Quick details” list:
1. What: decision (e.g., “KidZone is postponed” or “Worship service moves online”).
2. When/where: new time, virtual link, or closed doorway.
3. What you need: confirm RSVP, bring a mask, park in Lot B, etc.
4. How we’ll keep you posted: updates page link, text alerts, voicemail line.

**Closing:** remind readers who to email/text if they still have questions, mention the banner/updates page, and add the multi-channel kit note (“This note goes out with the SMS + social/voicemail copy below so everyone sees the change.”).
</file>

<file path="web/src/content/updates/_schedule-change.md">
---
title: "Schedule change template"
date: 2026-01-01
summary: "What service, rehearsal, or gathering is shifting and when the new time is."
category: "schedule"
draft: true
---
Describe which lineup (worship, rehearsal, children’s programming) moved, list the new date/time, and note whether volunteers or attendees should arrive earlier or bring anything specific.
</file>

<file path="web/src/content/updates/_sms-opt-in-template.md">
---
title: "SMS opt-in template"
date: 2026-02-12
summary: "Short, opt-in-friendly text alerts that echo the email + updates page messaging."
category: "communications"
draft: true
---
Keep the message under 160 characters, mention the quick change, and include the updates page URL (or short-code) so everyone can read the full details.

Example structure:
- Line 1: “UPDATED: [service or space] [action] [new time or status].”
- Line 2: “Details & opt-out: [short link to updates page].”

Because this is opt-in only, add “Reply STOP to cancel” or similar at the end of line 2, along with the time you expect to send the next update if the situation evolves.

Pair this text with the email message above and the social/voicemail draft below so the same language runs across every channel.
</file>

<file path="web/src/content/updates/_social-voicemail-template.md">
---
title: "Social post / voicemail template"
date: 2026-02-12
summary: "Copy you can tweak for social media and outgoing voicemail so every channel mirrors the update."
category: "communications"
draft: true
---
## Social posts
- Start with the most important fact (“Sunday service switches to 10:00 AM,” “Youth rehearsal is postponed,” etc.).
- Mention how people can stay in the loop (“See the updates page,” “Click the link in bio,” or “Mute notifications? we’ll text you too”).
- Add a note on why the change happened (weather, maintenance, volunteer shortage) plus any quick instructions (bring an umbrella, plan for parking).
- Finish with a CTA (“Tap for the latest update,” “Share with your small group,” “Hashtag #FirstSpringfieldUpdates”).

Keep each caption/tagline short enough for the platform (Instagram/Facebook caption vs. X/Twitter) and use the same link you included in the email/SMS so readers land on the updates page.

## Voicemail script
1. “Hi, you’ve reached First Springfield [customize role], we wanted to let you know that [service/event] is [new status].”
2. “The full note is on the updates page, we’ll also text/email you the details, and you can call [office/volunteer line] if you need anything right away.”
3. “Thanks for staying connected—we hope to see you on [next service or plan].”

Use the voicemail script for outgoing desk calls or auto-attendants so visitors hear the same tone as the email/SMS/social post. The shared updates page link keeps everyone pointed to one source of truth.
</file>

<file path="web/src/content/updates/_weather-cancellation.md">
---
title: "Weather cancellation template"
date: 2026-01-01
summary: "What is canceled if the forecast continues and how to stay updated."
category: "weather"
draft: true
---
Update the summary above with the specific program or service to postpone. Replace the date with the day the change starts, and then describe the conditions (storm, temperature, flooding, etc.) along with a reminder to double-check the forecast before heading out.
</file>

<file path="web/src/content/updates/annex-access-paused-for-safety.md">
---
title: "Annex access paused for safety review"
date: "2026-02-11"
summary: "We’ve paused annex use while the team completes an inspection and makes necessary repairs."
category: "building"
---

Work crews discovered a structural concern in the annex hallway that needs tuned-up before we can safely welcome people back through that door. The side entrance, choir suite, and educator offices remain closed to visitors until the engineer signs off on the repairs.

If you had a meeting or rehearsal scheduled in the annex, the schedulers will reach out with an alternate room (usually the sanctuary or fellowship hall). Please direct new space requests to the Church Clerk via the contact form so we can keep every calendar update aligned with the repair timeline.

We’ll also post another update as soon as the inspection passes so the Sunday school classrooms and youth suite can reopen.
</file>

<file path="web/src/content/verses/2026/02/11/light-of-hope.md">
---
date: "2026-02-11"
reference: "Psalm 27:1-2"
verseText: |
  The Lord is my light and my salvation—whom shall I fear?
  The Lord is the stronghold of my life—of whom shall I be afraid?
translation: "ESV"
---

The psalmist reminds us that God’s presence is the antidote to fear, so we can keep moving forward even when shadows gather.
</file>

<file path="web/src/content/verses/2026/02/12/steady-peace.md">
---
date: "2026-02-12"
reference: "Isaiah 41:10"
verseText: |
  Fear not, for I am with you; be not dismayed, for I am your God.
  I will strengthen you, I will help you, I will uphold you with my righteous right hand.
translation: "NRSV"
---

God promises to carry us when unease creeps in, so we can rest knowing His faithful grip never lets go.
</file>

<file path="web/src/data/annual-calendar.json">
{
  "updatedAt": "2026-02-11T12:00:00Z",
  "subjectToChange": "Dates are subject to change; check back before making plans.",
  "events": [
    {
      "title": "Spring prayer walk",
      "start": "2026-03-14",
      "summary": "A neighborhood prayer walk and potluck to bless nearby homes and welcome neighbors.",
      "location": "Campus grounds + local streets",
      "category": "community"
    },
    {
      "title": "Easter worship celebration",
      "start": "2026-04-05",
      "end": "2026-04-05",
      "summary": "One service at 10 AM with children’s choir, followed by a brunch in the fellowship hall.",
      "location": "Main sanctuary",
      "category": "worship"
    },
    {
      "title": "Camp Meeting: Atlantic Union",
      "start": "2026-06-19",
      "end": "2026-06-27",
      "summary": "Annual camp meeting with youth gatherings, evening worship, and ministry workshops at the Atlantic Union Conference grounds.",
      "location": "Atlantic Union Conference grounds",
      "category": "camp",
      "highlight": true,
      "closureNote": "Church campus closed on the Sabbaths (June 20 & 27) while staff and volunteers attend Camp Meeting.",
      "notes": "Traveling groups depart Friday, June 19, and return Monday, June 29."
    },
    {
      "title": "Back-to-school blessing",
      "start": "2026-08-30",
      "summary": "Blessing for students and educators before the fall semester begins, with resources for parents.",
      "location": "Sanctuary",
      "category": "community"
    }
  ]
}
</file>

<file path="web/src/data/budget.json">
{
  "goal": 320000,
  "received": 198450,
  "updatedAt": "2026-02-05"
}
</file>

<file path="web/src/layouts/Layout.astro">
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro Basics</title>
	</head>
	<body>
		<slot />
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
</file>

<file path="web/src/pages/accessibility/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Hero from "../../components/ui/Hero.astro";
import { mailto, tel } from "../../lib/links";
import { site } from "../../data/site";

const reviewDate = "February 12, 2026";
const contactPage = "/connect/contact";
const contactEmailHref = mailto(site.contact.email);
const contactPhoneHref = tel(site.contact.phone);
---

<BaseLayout
  title="Accessibility"
  description="Accessibility statement for the First Springfield SDA Church website."
>
  <div class="stack">
    <Hero
      title="Accessibility"
      subtitle="We are committed to keeping this website welcoming for every guest."
    />

    <section class="card stack">
      <h2>Our commitment</h2>
      <p class="muted">
        First Springfield Seventh-day Adventist Church strives to provide an accessible online experience for everyone,
        including people with visual, hearing, mobility, or cognitive differences. We follow W3C WAI guidance when
        designing new pages and maintaining existing content so you can find worship times, ministry updates, and
        ways to connect without barriers.
      </p>

      <h2>Conformance target</h2>
      <p class="muted">
        The site is built with the goal of conforming to WCAG 2.2 Level AA success criteria. We rely on semantic HTML,
        meaningful heading structure, descriptive alt text, high contrast palettes, focus-visible outlines, and
        keyboard-friendly components to support broad accessibility. Every major update goes through accessibility
        review before it goes live.
      </p>

      <h2>Known limitations</h2>
      <p class="muted">
        While we work toward full conformance, there are a few areas that remain in progress:
      </p>
      <ul class="muted">
        <li>
          Third-party giving, prayer, and volunteer tools are hosted on external platforms, and we cannot guarantee that their
          entire workflow meets WCAG 2.2 AA.
        </li>
        <li>
          Live streams and archived media rely on YouTube for playback and captions, so availability depends on the channel host.
        </li>
        <li>
          Some downloadable PDFs and older documents shared on the site have not yet been remediated for assistive technologies.
        </li>
      </ul>

      <h2>Feedback</h2>
      <p class="muted">
        If you encounter an accessibility barrier, please let us know. Email us at
        <a href={contactEmailHref}>{site.contact.email}</a>, call
        <a href={contactPhoneHref}>{site.contact.phone}</a>, or use our
        <a href={contactPage}>contact form</a>. We aim to respond within two business days and will describe alternative
        ways to access the information or service you need.
      </p>

      <h2>Assessment</h2>
      <p class="muted">
        We combine manual keyboard and screen reader testing with automated checks (for example: Lighthouse, axe, and contrast
        analyzers) whenever we publish new content. After major feature releases we re-run these audits and invite volunteer
        feedback so we can keep improving.
      </p>

      <p class="small muted">Statement last reviewed on {reviewDate}.</p>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/api/connect-card.ts">
import type { APIRoute } from "astro";
import { site } from "../../data/site";

const THANK_YOU_PATH = "/connect/connect-card/thank-you";
const TURNSTILE_VERIFY_URL = "https://challenges.cloudflare.com/turnstile/v0/siteverify";
const SENDGRID_ENDPOINT = "https://api.sendgrid.com/v3/mail/send";

const verifyTurnstile = async (token: string, secret: string) => {
  try {
    const response = await fetch(TURNSTILE_VERIFY_URL, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ secret, response: token }),
    });
    const payload = await response.json();
    return payload.success === true;
  } catch (error) {
    console.error("Turnstile verification error", error);
    return false;
  }
};

const buildSummary = (entries: [string, FormDataEntryValue][]) => {
  const summary: Record<string, string> = {};

  for (const [key, value] of entries) {
    if (key === "cf-turnstile-response" || value instanceof File) {
      continue;
    }

    const normalizedKey = key.replace(/\[\]$/, "");
    const textValue = String(value).trim();
    if (!textValue) {
      continue;
    }

    summary[normalizedKey] = summary[normalizedKey]
      ? `${summary[normalizedKey]}, ${textValue}`
      : textValue;
  }

  return summary;
};

const formatSummaryText = (summary: Record<string, string>) =>
  Object.entries(summary)
    .map(([key, value]) => `${key}: ${value}`)
    .join("\n");

const sendNotificationEmail = async (
  recipients: string[],
  fromEmail: string,
  apiKey: string,
  summaryText: string
) => {
  if (!recipients.length) return;

  const payload = {
    personalizations: [
      {
        to: recipients.map((email) => ({ email })),
        subject: `Connect Card · ${site.shortName}`,
      },
    ],
    from: { email: fromEmail },
    content: [{ type: "text/plain", value: summaryText }],
  };

  const response = await fetch(SENDGRID_ENDPOINT, {
    method: "POST",
    headers: {
      Authorization: `Bearer ${apiKey}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify(payload),
  });

  if (!response.ok) {
    const errorText = await response.text();
    throw new Error(`SendGrid error ${response.status}: ${errorText}`);
  }
};

export const prerender = false;

export const post: APIRoute = async ({ request }) => {
  const turnstileSecret = process.env.PRIVATE_TURNSTILE_SECRET_KEY;
  if (!turnstileSecret) {
    return new Response("Turnstile secret is not configured.", { status: 503 });
  }

  const formData = await request.formData();
  const tokenValue = formData.get("cf-turnstile-response");
  if (!tokenValue) {
    return new Response("Turnstile token missing.", { status: 400 });
  }

  const token = String(tokenValue);
  const authenticated = await verifyTurnstile(token, turnstileSecret);
  if (!authenticated) {
    return new Response("Turnstile verification failed.", { status: 400 });
  }

  const forwardUrl = process.env.PRIVATE_CONNECT_CARD_FORWARD_URL;
  if (!forwardUrl) {
    return new Response("Connect Card destination is not configured.", { status: 503 });
  }

  const entries = Array.from(formData.entries());
  const payload = new URLSearchParams();

  for (const [key, value] of entries) {
    if (value instanceof File || key === "cf-turnstile-response") {
      continue;
    }
    payload.append(key, String(value));
  }

  const forwardResponse = await fetch(forwardUrl, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: payload,
  });

  if (!forwardResponse.ok) {
    const errorText = await forwardResponse.text();
    console.error("Connect Card forward failed", errorText);
    return new Response("Unable to deliver the Connect Card submission.", { status: 502 });
  }

  const summary = buildSummary(entries);
  summary["Submitted At"] = new Date().toISOString();

  const notifyEmails = (process.env.CONNECT_CARD_NOTIFY_EMAILS ?? "")
    .split(",")
    .map((email) => email.trim())
    .filter(Boolean);
  const sendgridKey = process.env.CONNECT_CARD_SENDGRID_API_KEY;
  const summaryText = formatSummaryText(summary);

  if (sendgridKey && notifyEmails.length) {
    const fromEmail = process.env.CONNECT_CARD_NOTIFY_FROM?.trim() || site.contact.email;
    try {
      await sendNotificationEmail(notifyEmails, fromEmail, sendgridKey, summaryText);
    } catch (error) {
      console.error("Connect Card notification failed", error);
    }
  }

  const redirectValue = formData.get("redirectUrl");
  const redirectUrl = typeof redirectValue === "string" && redirectValue.trim()
    ? redirectValue
    : THANK_YOU_PATH;

  return Response.redirect(redirectUrl, 303);
};
</file>

<file path="web/src/pages/calendar/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { site } from "../../data/site";
import annualCalendar from "../../data/annual-calendar.json";

type AnnualEvent = {
  title: string;
  start: string;
  end?: string;
  summary: string;
  location: string;
  category?: string;
  highlight?: boolean;
  closureNote?: string;
  notes?: string;
};

type AnnualCalendar = {
  updatedAt?: string;
  subjectToChange?: string;
  events?: AnnualEvent[];
};

const locale = site.locale ?? "en-US";
const timeZone = site.timeZone ?? "UTC";

const calendarData = annualCalendar as AnnualCalendar;
const events = calendarData.events ?? [];
const updatedDate =
  calendarData.updatedAt && !Number.isNaN(new Date(calendarData.updatedAt).valueOf())
    ? new Date(calendarData.updatedAt)
    : null;

const monthFormatter = new Intl.DateTimeFormat(locale, { month: "long", timeZone });
const monthDayFormatter = new Intl.DateTimeFormat(locale, {
  month: "long",
  day: "numeric",
  timeZone,
});
const yearFormatter = new Intl.DateTimeFormat(locale, { year: "numeric", timeZone });
const updatedFormatter = new Intl.DateTimeFormat(locale, {
  dateStyle: "medium",
  timeZone,
});

const enrichedEvents = events
  .map((event) => {
    const startDate = new Date(event.start);
    const endDate = event.end ? new Date(event.end) : startDate;
    return {
      ...event,
      startDate,
      endDate,
    };
  })
  .filter((event) => !Number.isNaN(event.startDate.valueOf()))
  .sort((a, b) => a.startDate.valueOf() - b.startDate.valueOf());

const highlightEvent = enrichedEvents.find((entry) => entry.highlight);
const calendarEvents = enrichedEvents.filter((entry) => entry !== highlightEvent);

const formatDateRange = (start: Date, end?: Date) => {
  if (!start || Number.isNaN(start.valueOf())) {
    return "";
  }

  const actualEnd = end && !Number.isNaN(end.valueOf()) ? end : start;
  const startYear = yearFormatter.format(start);
  const endYear = yearFormatter.format(actualEnd);

  if (start.valueOf() === actualEnd.valueOf()) {
    return `${monthDayFormatter.format(start)}, ${startYear}`;
  }

  if (startYear === endYear) {
    if (start.getMonth() === actualEnd.getMonth()) {
      const monthName = monthFormatter.format(start);
      return `${monthName} ${start.getDate()}–${actualEnd.getDate()}, ${startYear}`;
    }
    return `${monthDayFormatter.format(start)} – ${monthDayFormatter.format(actualEnd)}, ${startYear}`;
  }

  return `${monthDayFormatter.format(start)}, ${startYear} – ${monthDayFormatter.format(actualEnd)}, ${endYear}`;
};

const categoryLabels: Record<string, string> = {
  worship: "Worship + praise",
  camp: "Camp meeting",
  community: "Community",
};

const subjectToChange = calendarData.subjectToChange ?? "Dates are subject to change.";
---

<BaseLayout title="Annual calendar" description="Seasonal events, highlights, and the Camp Meeting schedule for the year.">
  <div class="stack">
    <section class="stack">
      <h1>Annual calendar</h1>
      <p class="muted">
        A quick glance at milestone dates, planning notes, and times the campus shifts gears across the season.
      </p>
      <p class="muted small">
        {updatedDate ? `Last updated ${updatedFormatter.format(updatedDate)}` : "Last updated date coming soon."}
        {" · "}
        {subjectToChange}
      </p>
    </section>

    {highlightEvent ? (
      <section class="card stack--tight calendar-highlight">
        <div class="cluster--between">
          <div>
            <p class="muted small">{categoryLabels[highlightEvent.category ?? "camp"] ?? "Camp meeting"}</p>
            <h2>{highlightEvent.title}</h2>
          </div>
          <p class="muted small">{formatDateRange(highlightEvent.startDate, highlightEvent.endDate)}</p>
        </div>
        <p class="muted small">Location: {highlightEvent.location}</p>
        <p>{highlightEvent.summary}</p>
        {highlightEvent.closureNote ? (
          <p class="calendar-closure">{highlightEvent.closureNote}</p>
        ) : null}
        {highlightEvent.notes ? (
          <p class="muted small">{highlightEvent.notes}</p>
        ) : null}
      </section>
    ) : null}

    <section class="stack">
      <div class="cluster--between">
        <div>
          <h2>Featured dates</h2>
          <p class="muted">These dates help the community plan ahead for worship, service, and outreach.</p>
        </div>
      </div>

      {calendarEvents.length === 0 ? (
        <p class="muted">No additional dates are published yet.</p>
      ) : (
        <div class="stack">
          {calendarEvents.map((entry) => (
            <article class="card calendar-event">
              <div class="cluster--between calendar-event__header">
                <p class="muted small">
                  {categoryLabels[entry.category ?? "community"] ?? "Event"}
                </p>
                <p class="muted small">{formatDateRange(entry.startDate, entry.endDate)}</p>
              </div>
              <h3>{entry.title}</h3>
              <p class="muted">{entry.summary}</p>
              <p class="muted small">Location: {entry.location}</p>
              {entry.notes ? <p class="muted small">{entry.notes}</p> : null}
            </article>
          ))}
        </div>
      )}
    </section>
  </div>
</BaseLayout>

<style>
  .calendar-highlight {
    border-color: var(--color-primary);
    background: var(--color-surface-2);
  }

  .calendar-closure {
    margin: 0;
    font-weight: 600;
    color: var(--color-text);
  }

  .calendar-event__header {
    gap: var(--space-2);
  }

  .calendar-event {
    display: grid;
    gap: var(--space-3);
  }
</style>
</file>

<file path="web/src/pages/resources/announcements/rss.xml.ts">
import rss from "@astrojs/rss";
import { site } from "../../../data/site";
import { getSortedAnnouncements } from "../../../lib/announcements";

const siteUrl = process.env.PUBLIC_SITE_URL ?? "http://localhost:4321";

export async function get() {
  const announcements = await getSortedAnnouncements();

  return rss({
    title: `${site.name} announcements`,
    description: "Weekly updates, volunteer calls, cancellations, and ministry news.",
    site: siteUrl,
    items: announcements.map((entry) => ({
      title: entry.data.title,
      description: entry.data.summary,
      pubDate: entry.data.date,
      link: `/resources/announcements/${entry.id}`,
      categories: entry.data.tags,
    })),
  });
}
</file>

<file path="web/src/pages/resources/daily-bible-verse/index.astro">
---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Hero from '../../../components/ui/Hero.astro';
import { getCollection, render } from 'astro:content';
import { site } from '../../../data/site';

const verses = await getCollection('verses', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const sortedVerses = [...verses].sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const todayVerse = sortedVerses[0];
let TodayVerseContent = null;
if (todayVerse) {
  const rendered = await render(todayVerse);
  TodayVerseContent = rendered.Content;
}

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'full',
  timeZone: site.timeZone,
});

const trustedLinks = [
  {
    label: 'Bible Gateway Verse of the Day',
    href: 'https://www.biblegateway.com/featured/verse-of-the-day/',
    description: 'Verse and short devotional notes in dozens of translations.',
  },
  {
    label: 'YouVersion Verse of the Day',
    href: 'https://www.bible.com/verse-of-the-day',
    description: 'Short verse with the ability to read it in your preferred translation or listen to audio.',
  },
  {
    label: 'Bible Hub Verse of the Day',
    href: 'https://biblehub.com/verse-of-the-day/',
    description: 'Compiles the same verse in multiple translations plus background notes.',
  },
  {
    label: 'DailyVerses.net',
    href: 'https://dailyverses.net/',
    description: 'Simple verse-of-the-day cards for quiet meditation or sharing with friends.',
  },
];

const recentVerses = sortedVerses.slice(1, 4);
const verseLines = todayVerse
  ? todayVerse.data.verseText
      .split('\n')
      .map((line) => line.trim())
      .filter(Boolean)
  : [];
---

<BaseLayout
  title="Daily Bible Verse"
  description="A curated verse with reflection plus curated portals for the day."
>
  <Hero
    title="Daily Bible Verse"
    subtitle="A short passage to focus on today’s trust in Scripture."
  />

  <section class="stack--loose">
    <article class="card stack--tight">
      <h2>Curated scripture, ready when you need it</h2>
      <p>
        Each verse you see here is selected manually, then paired with a brief reflection so you can hold on
        to a single truth and let it shape your day.
      </p>
    </article>

    {todayVerse ? (
      <article class="card stack" aria-labelledby="today-verse-title">
        <div class="stack--tight">
          <p class="muted small">
            <strong>Today · </strong>
            {fmt.format(todayVerse.data.date)}
          </p>
          <h2 id="today-verse-title">{todayVerse.data.reference}</h2>
          <p class="muted small">{todayVerse.data.translation}</p>
        </div>

        <blockquote class="verse-quote">
          {verseLines.map((line) => (
            <p>{line}</p>
          ))}
          <cite>
            {todayVerse.data.reference} ({todayVerse.data.translation})
          </cite>
        </blockquote>

        {TodayVerseContent && (
          <div class="prose">
            <TodayVerseContent />
          </div>
        )}
      </article>
    ) : (
      <article class="card">
        <p class="muted">No verse has been published yet. Check back again soon.</p>
      </article>
    )}

    {recentVerses.length > 0 && (
      <article class="card stack--tight">
        <h3>Recent verses</h3>
        <ul class="stack--tight">
          {recentVerses.map((entry) => (
            <li>
              <p class="muted small">{fmt.format(entry.data.date)}</p>
              <p>
                <strong>{entry.data.reference}</strong> · {entry.data.translation}
              </p>
            </li>
          ))}
        </ul>
      </article>
    )}

    <article class="card stack--tight">
      <h3>Trusted verse resources</h3>
      <ul class="stack--tight">
        {trustedLinks.map((link) => (
          <li>
            <a class="link" href={link.href} target="_blank" rel="noopener noreferrer">
              {link.label}
            </a>
            <p class="muted small">{link.description}</p>
          </li>
        ))}
      </ul>
    </article>
  </section>

  <style>
    .verse-quote {
      margin: var(--space-4) 0 0;
      padding-left: var(--space-4);
      border-left: 4px solid var(--color-border);
    }

    .verse-quote p {
      margin: 0 0 var(--space-2);
      font-size: var(--font-size-1);
    }

    .verse-quote cite {
      display: block;
      margin-top: var(--space-3);
      font-style: normal;
      color: var(--color-muted);
      font-size: var(--font-size-0);
    }
  </style>
</BaseLayout>
</file>

<file path="web/src/pages/resources/daily-devotional/index.astro">
---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Hero from '../../../components/ui/Hero.astro';
import { getCollection, render } from 'astro:content';
import { site } from '../../../data/site';

const devotionals = await getCollection('devotionals', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const sortedDevotionals = [...devotionals].sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const todayDevotional = sortedDevotionals[0];
let TodayDevotionalContent = null;
if (todayDevotional) {
  const rendered = await render(todayDevotional);
  TodayDevotionalContent = rendered.Content;
}

const moreReflections = sortedDevotionals.slice(1, 4);
const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'full',
  timeZone: site.timeZone,
});

const trustedLinks = [
  {
    label: 'Upper Room Daily Devotional',
    href: 'https://www.upperroom.org/resources/daily-devotional',
    description: 'A Spirit-led reflection with scripture, prayer, and a gentle nudge for the day ahead.',
  },
  {
    label: 'Our Daily Bread',
    href: 'https://odb.org/daily-devotional',
    description: 'Classic devotionals that balance a Scripture, story, and application for everyday life.',
  },
  {
    label: 'YouVersion Daily Devotional',
    href: 'https://www.bible.com/reading-plans/1541',
    description: 'Choose a plan, tap today&apos;s entry, and read it in your preferred translation or audio.',
  },
  {
    label: 'BibleProject Daily Devotional',
    href: 'https://bibleproject.com/daily-devotional/',
    description: 'Short videos and reflections that bring biblical themes to life with beautiful storytelling.',
  },
];
---

<BaseLayout
  title="Daily Devotional"
  description="Curated reflections and prayer material for each day."
>
  <Hero
    title="Daily Devotional"
    subtitle="Curated reflections to center your heart on God every morning."
  />

  <section class="stack--loose">
    <article class="card stack--tight">
      <h2>Carefully curated, not auto-pulled</h2>
      <p>
        Instead of relying on automatic feeds, we gather trusted reflections, add local perspective, and
        publish the freshest entry right here so the daily message is dependable and easy to share.
      </p>
    </article>

    {todayDevotional ? (
      <article class="card stack" aria-labelledby="today-devotional-title">
        <div class="stack--tight">
          <p class="muted small">
            <strong>Today · </strong>
            {fmt.format(todayDevotional.data.date)}
          </p>
          <h2 id="today-devotional-title">{todayDevotional.data.title}</h2>
          <p>{todayDevotional.data.summary}</p>
        </div>

        {TodayDevotionalContent && (
          <div class="prose">
            <TodayDevotionalContent />
          </div>
        )}

        {todayDevotional.data.link && (
          <p>
            <a
              class="link"
              href={todayDevotional.data.link}
              target="_blank"
              rel="noopener noreferrer"
            >
              Continue reading the source devotional
            </a>
          </p>
        )}
      </article>
    ) : (
      <article class="card">
        <p class="muted">We haven’t published a devotional yet. Check back soon.</p>
      </article>
    )}

    {moreReflections.length > 0 && (
      <article class="card stack--tight">
        <h3>Recent reflections (newest first)</h3>
        <div class="grid--cards">
          {moreReflections.map((entry) => (
            <section class="card stack--tight">
              <p class="muted small">{fmt.format(entry.data.date)}</p>
              <h4>{entry.data.title}</h4>
              <p class="muted">{entry.data.summary}</p>
              {entry.data.link && (
                <a
                  class="link"
                  href={entry.data.link}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Read the full reflection
                </a>
              )}
            </section>
          ))}
        </div>
      </article>
    )}

    <article class="card stack--tight">
      <h3>Trusted links</h3>
      <ul class="stack--tight">
        {trustedLinks.map((link) => (
          <li>
            <a class="link" href={link.href} target="_blank" rel="noopener noreferrer">
              {link.label}
            </a>
            <p class="muted small">{link.description}</p>
          </li>
        ))}
      </ul>
    </article>
  </section>
</BaseLayout>
</file>

<file path="web/src/pages/visit/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PlanVisitContent from "../../components/PlanVisitContent.astro";
import { site } from "../../data/site";
---

<BaseLayout
  title="Plan a Visit"
  description={`Service times, directions, parking, and what to expect when visiting ${site.name}.`}
>
  <PlanVisitContent />
</BaseLayout>
</file>

<file path="web/src/pages/404.astro">
---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Page not found">
  <h1>Page not found</h1>
  <p class="muted">We couldn’t find that page. Try one of these options:</p>

  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/media">Media</a></li>
    <li><a href="/give">Give</a></li>
    <li><a href="/connect">Connect</a></li>
  </ul>
</BaseLayout>
</file>

<file path="web/src/pages/robots.txt.ts">
import type { APIRoute } from "astro";

// Force this endpoint to be emitted as a static file in dist/robots.txt
export const prerender = true;

export const GET: APIRoute = ({ site: astroSite, url }) => {
  // Prefer Astro config `site` when present, otherwise use the request origin
  // (important for local LHCI ports like http://localhost:51310)
  const origin = (astroSite?.toString() ?? url.origin).replace(/\/$/, "");

  const sitemapUrl = new URL("/sitemap-index.xml", origin).toString();

  const body = [
    "User-agent: *",
    "Allow: /",
    "",
    `Sitemap: ${sitemapUrl}`,
    "",
  ].join("\n");

  return new Response(body, {
    headers: {
      "Content-Type": "text/plain; charset=utf-8",
      "Cache-Control": "public, max-age=3600",
    },
  });
};
</file>

<file path="web/src/styles/partials/calendar-event-page.css">
.calendar-event-page .breadcrumb {
  font-size: var(--font-size-0);
  margin-bottom: var(--space-4);
  color: var(--color-text-muted);
}

.calendar-event-page .breadcrumb ol {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
  padding: 0;
  margin: 0;
  list-style: none;
  align-items: center;
}

.calendar-event-page .breadcrumb li {
  display: inline-flex;
}

.calendar-event-page .breadcrumb li + li::before {
  content: "/";
  margin-right: var(--space-2);
  color: var(--color-border-strong);
}

.calendar-event-page .event-hero {
  background: var(--color-surface-2);
  border-color: var(--color-border-strong);
  box-shadow: var(--shadow-1);
  padding: clamp(1.5rem, 1.25rem + 0.5vw, 2rem);
  margin-bottom: var(--space-6);
}

.calendar-event-page .event-details {
  gap: var(--space-6);
}

.calendar-event-page .event-meta {
  gap: var(--space-3);
}

.calendar-event-page .event-meta strong {
  font-weight: 700;
}

.calendar-event-page .event-date {
  display: inline-flex;
  flex-wrap: wrap;
  gap: var(--space-1);
  margin-left: var(--space-2);
}

.calendar-event-page .event-date time {
  font-weight: 600;
  color: var(--color-text);
}

.calendar-event-page .event-date-separator {
  color: var(--color-text-muted);
}

.calendar-event-page .event-details .card {
  padding: var(--space-6);
}

@media (max-width: 720px) {
  .calendar-event-page .event-hero {
    padding: var(--space-5);
  }
}
</file>

<file path="web/.gitignore">
# build output
dist/

# generated types
.astro/

# dependencies
node_modules/

# logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# environment variables
.env
.env.production

# macOS-specific files
.DS_Store

# jetbrains setting folder
.idea/
</file>

<file path="web/astro.config 2.mjs">
import cloudflare from "@astrojs/cloudflare";
import mdx from "@astrojs/mdx";
import sitemap from "@astrojs/sitemap";
import compress from "astro-compress";
import icon from "astro-icon";
import pagefind from "astro-pagefind";
import { defineConfig } from "astro/config";

const site = process.env.PUBLIC_SITE_URL;

export default defineConfig({
  // Used for canonical URLs + sitemap/robots generation.
  // In Cloudflare Pages: set PUBLIC_SITE_URL to your production domain (e.g. https://example.org)
  site: site ?? "http://localhost:4321",
  trailingSlash: "never",

  integrations: [
    mdx(),
    icon(),
    compress(),
    pagefind(),
    sitemap({
      // Internal site search is not a page you want indexed.
      filter: (page) => !page.endsWith("/search"),
    }),
  ],

  output: "static",
  adapter: cloudflare(),
  vite: {
    ssr: {
      noExternal: ["@fontsource-variable/inter"],
    },
  },
});
</file>

<file path="web/README.md">
# Astro Starter Kit: Basics

```sh
npm create astro@latest -- --template basics
```

> 🧑‍🚀 **Seasoned astronaut?** Delete this file. Have fun!

## 🚀 Project Structure

Inside of your Astro project, you'll see the following folders and files:

```text
/
├── public/
│   └── favicon.svg
├── src
│   ├── assets
│   │   └── astro.svg
│   ├── components
│   │   └── Welcome.astro
│   ├── layouts
│   │   └── Layout.astro
│   └── pages
│       └── index.astro
└── package.json
```

To learn more about the folder structure of an Astro project, refer to [our guide on project structure](https://docs.astro.build/en/basics/project-structure/).

## 🧞 Commands

All commands are run from the root of the project, from a terminal:

| Command                   | Action                                           |
| :------------------------ | :----------------------------------------------- |
| `npm install`             | Installs dependencies                            |
| `npm run dev`             | Starts local dev server at `localhost:4321`      |
| `npm run build`           | Build your production site to `./dist/`          |
| `npm run preview`         | Preview your build locally, before deploying     |
| `npm run astro ...`       | Run CLI commands like `astro add`, `astro check` |
| `npm run astro -- --help` | Get help using the Astro CLI                     |

## 👀 Want to learn more?

Feel free to check [our documentation](https://docs.astro.build) or jump into our [Discord server](https://astro.build/chat).
</file>

<file path=".editorconfig">
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false
</file>

<file path=".npmrc">
# Use the Python installation that still exposes distutils for node-gyp builds.
python=/opt/homebrew/bin/python3.11
</file>

<file path=".nvmrc">
20
</file>

<file path="CODE_OF_CONDUCT.md">
# Contributor Covenant Code of Conduct

## Our Pledge

We as members, contributors, and leaders pledge to make participation in this project and our community a harassment-free experience for everyone.

## Our Standards

Examples of behavior that contributes to a positive environment include:
- Using welcoming and inclusive language.
- Being respectful of differing viewpoints and experiences.
- Gracefully accepting constructive criticism.
- Focusing on what is best for the community.
- Showing empathy toward other community members.

Examples of unacceptable behavior include harassment, trolling, insulting/derogatory comments, or other conduct which might reasonably be considered inappropriate.

## Enforcement

Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting conduct@firstspringfieldma.adventistchurch.org. All complaints will be reviewed and investigated promptly and fairly.

## Attribution

This Code of Conduct is adapted from the [Contributor Covenant](https://www.contributor-covenant.org/), version 2.1, available at https://www.contributor-covenant.org/version/2/1/code_of_conduct/.
</file>

<file path="CONTRIBUTING.md">
# Contributing

Thanks for improving First Springfield Church Website! Follow the guidelines below so changes stay reliable and reviewers can move quickly.

## Getting started

1. `git checkout -b feature/description` (use prefixes like `feature/`, `fix/`, `docs/`, `chore/`, etc.).
2. Always run the QA suite before opening a PR so CI has the same baseline:
   ```sh
   cd web
   npm install
   npm run qa
   ```
3. Keep commits focused and descriptive; squash/fixup as needed before merging.

## Branch naming & PR expectations

- Prefer active names like `feature/service-livestream` or `fix/banner-spacing`.
- Title PRs with the change (e.g., “Improve Banner focus states”) and cite the main README section or issue if one exists.
- Describe what was done, list any manual verifications (Lighthouse, Playwright, Linkinator), and attach screenshots when the UI changes.
- Mention any missing coverage or follow-up work in the PR description so reviewers know what to expect.
- Link to `CONTRIBUTING.md`, `SECURITY.md`, or `docs/ui-reliability.md` when relevant.

## Tests & formatting

- `npm run format` touches Astro/Svelte files; run it locally if you change markup or styles.
- `npm run test:e2e:ci` (Playwright) plus `npm run test:links:ci` ensure cross-browser and link coverage.
- `npm run lighthouse:ci` enforces performance + accessibility budgets before landing a change that touches layout.

## Questions?

Reach out on the repo or cross-post to the church tech/staff email before sending large updates. Thank you!
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2024 First Springfield Church Website contributors

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="lighthouserc-ci.cjs">
const baseConfig = require("./web/lighthouserc.cjs");

const config = structuredClone(baseConfig);
config.ci.collect.staticDistDir = "./web/dist";
config.ci.upload = {
  ...config.ci.upload,
  outputDir: "./web/.lighthouseci",
};

module.exports = config;
</file>

<file path="package.json">
{
  "dependencies": {
    "@astrojs/sitemap": "3.6.0"
  }
}
</file>

<file path="SECURITY.md">
# Security Policy

## Reporting a Vulnerability

If you discover a security issue, please notify us at `security@firstspringfieldma.adventistchurch.org` with:

- A short description of the issue.
- The affected component (e.g., frontend embed, deployment).
- Steps to reproduce or a proof of concept.
- Any mitigations you’ve already tried.

We aim to respond within 48 hours, keep the report confidential, and coordinate a fix before public disclosure.

## Supported Versions

This repo runs on the latest dependencies pinned in `web/package-lock.json`. Security updates are applied through CI before merging.

## Guidance for Contributors

- Keep dependencies up to date (`npm update` inside `web/` and rerun `npm run qa`).
- Avoid committing secrets or tokens; use the GitHub secrets store for private configuration.
- Document security implications of large changes in both the PR body and `docs/ui-reliability.md` when relevant.
</file>

<file path="web/src/components/media/YouTubeEmbed.astro">
---
type Props = {
  title: string;
  /** Full YouTube embed URL, e.g. https://www.youtube.com/embed/VIDEO_ID */
  embedUrl: string;
};

const { title, embedUrl } = Astro.props;
---

<div class="yt" aria-label={title}>
  <iframe
    class="yt__frame"
    src={embedUrl}
    title={title}
    loading="lazy"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen
  ></iframe>
</div>

<style>
  .yt {
    position: relative;
    width: 100%;
    border-radius: var(--radius-3);
    overflow: hidden;
    border: 1px solid var(--color-border);
    background: var(--color-surface-2);
  }

  /* 16:9 */
  .yt::before {
    content: "";
    display: block;
    padding-top: 56.25%;
  }

  .yt__frame {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }
</style>
</file>

<file path="web/src/components/sections/Hero.astro">
---
import HeroUI from "../ui/Hero.astro";

export type Props = {
  title: string;
  subtitle?: string;
  primaryCtaLabel?: string;
  primaryCtaHref?: string;
  secondaryCtaLabel?: string;
  secondaryCtaHref?: string;
  className?: string;
};

const props = Astro.props as Props;
---

<HeroUI {...props} />
</file>

<file path="web/src/components/ui/CardGrid.astro">
---
type Props = {
  /** Fixed number of columns (e.g. 3). */
  columns?: number;
  /** Responsive min column width in px (auto-fit). */
  columnsMin?: number;
};

const { columns, columnsMin = 240 } = Astro.props;

const template =
  typeof columns === "number"
    ? `repeat(${columns}, minmax(0, 1fr))`
    : `repeat(auto-fit, minmax(${columnsMin}px, 1fr))`;
---

<div class="grid" style={`grid-template-columns: ${template};`}>
  <slot />
</div>

<style>
  .grid {
    display: grid;
    gap: var(--space-4);
  }
</style>
</file>

<file path="web/src/components/ui/HighlightsScroller.astro">
---
import weeklyHighlights from "../../data/weekly-highlights";

const highlights = weeklyHighlights.filter((item) => item.text.trim().length > 0);
const tickerDuration = highlights.length ? Math.max(highlights.length * 4, 24) : 24;
const marqueeItems = highlights.length ? [...highlights, ...highlights] : [];
const isExternal = (href?: string) => typeof href === "string" && /^https?:\/\//.test(href);
---

{highlights.length > 0 ? (
  <section class="highlights-scroller" aria-label="Weekly highlights ticker">
    <div class="highlights-scroller__window">
      <div
        class="highlights-scroller__track"
        role="list"
        style={`--ticker-duration: ${tickerDuration}s`}
      >
        {marqueeItems.map((item) => (
          <div class="highlights-scroller__item" role="listitem">
            {item.badge ? <span class="highlights-scroller__badge">{item.badge}</span> : null}
            {item.href ? (
              <a
                class="highlights-scroller__link"
                href={item.href}
                target={isExternal(item.href) ? "_blank" : undefined}
                rel={isExternal(item.href) ? "noreferrer" : undefined}
              >
                {item.text}
              </a>
            ) : (
              <span class="highlights-scroller__link">{item.text}</span>
            )}
          </div>
        ))}
      </div>
    </div>
  </section>
) : null}

<style>
  .highlights-scroller {
    margin: var(--space-8) 0;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    background: var(--color-surface);
    box-shadow: var(--shadow-1);
    overflow: hidden;
  }

  .highlights-scroller__window {
    overflow: hidden;
  }

  .highlights-scroller__track {
    display: flex;
    align-items: center;
    gap: var(--space-5);
    padding: var(--space-3) var(--space-4);
    min-width: 200%;
    animation: highlights-scroll var(--ticker-duration, 32s) linear infinite;
    will-change: transform;
  }

  .highlights-scroller__item {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    border-right: 1px solid var(--color-border);
    padding-right: var(--space-4);
    font-size: 1rem;
    font-weight: 600;
    flex: 0 0 auto;
    white-space: nowrap;
  }

  .highlights-scroller__link {
    color: inherit;
    text-decoration: none;
  }

  .highlights-scroller__link:hover {
    text-decoration: underline;
  }

  .highlights-scroller__badge {
    background: var(--color-gray-100);
    color: var(--color-text-muted);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    border-radius: var(--radius-2);
    padding: 0 var(--space-2);
    height: 1.4rem;
    display: inline-flex;
    align-items: center;
  }

  .highlights-scroller__window:hover .highlights-scroller__track,
  .highlights-scroller__window:focus-within .highlights-scroller__track {
    animation-play-state: paused;
  }

  @keyframes highlights-scroll {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .highlights-scroller__track {
      animation: none;
    }
  }

  @media (max-width: 720px) {
    .highlights-scroller__track {
      gap: var(--space-4);
    }

    .highlights-scroller__item {
      font-size: 0.95rem;
      padding-right: var(--space-3);
    }
  }
</style>
</file>

<file path="web/src/components/ui/NoticeBanner.astro">
---
export type Variant = "info" | "warning" | "urgent";

type Props = {
  variant?: Variant;
};

const { variant = "info" } = Astro.props as Props;
const className = `notice notice--${variant}`;
---

<section class={className} role="status">
  <div class="notice__content">
    <slot />
  </div>
</section>

<style>
  .notice {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
    padding: var(--space-4);
    border-radius: var(--radius-3);
    border: 1px solid transparent;
    background: var(--color-surface-2);
    color: var(--color-text);
    box-shadow: var(--shadow-1);
  }

  .notice__content {
    width: 100%;
  }

  .notice--info {
    border-color: var(--color-info-border);
    background: var(--color-info-bg);
  }

  .notice--warning {
    border-color: var(--color-warn-border);
    background: var(--color-warn-bg);
  }

  .notice--urgent {
    border-color: var(--color-danger-border);
    background: var(--color-danger-bg);
  }
</style>
</file>

<file path="web/src/components/ui/Schedule.astro">
---
import type { ScheduleItem } from "../../data/site";

type Props = {
  title?: string;
  items: ScheduleItem[];
};

const { title = "This Week", items } = Astro.props;
---

<section class="card stack--tight">
  <h2>{title}</h2>
  <ul class="schedule">
    {items.map((item) => (
      <li class="schedule__item">
        <div class="schedule__label">{item.label}</div>
        <div class="schedule__meta muted">{item.day} - {item.time}</div>
      </li>
    ))}
  </ul>
</section>

<style>
  .schedule {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: var(--space-3);
  }

  .schedule__item {
    padding: var(--space-3);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    background: var(--color-surface-muted);
  }

  .schedule__label {
    font-weight: 800;
  }

  .schedule__meta {
    font-size: var(--font-size-0);
    margin-top: var(--space-1);
  }
</style>
</file>

<file path="web/src/components/PlaceholderPage.astro">
---
type Props = {
  title: string;
  message?: string;
};

const { title, message } = Astro.props;
---

<section class="card stack--tight">
  <h1>{title}</h1>
  <p class="muted">
    {message ?? "We’re preparing this page. More information will be here soon."}
  </p>
</section>
</file>

<file path="web/src/content/announcements/2026-02-07-pathfinder-induction.md">
---
title: "Pathfinder induction and spring kickoff"
date: 2026-02-07
tags:
  - events
  - volunteers
summary: "Pathfinder induction happens during the Divine Service on Sabbath, Feb 7, as we welcome 2026 Pathfinders."
featured: true
---
Join the Pathfinders & Adventurers Club for its 2026 induction ceremony during the Divine Service on Sabbath, February 7. We will pause the main worship midway through the service to officially welcome new Pathfinders, celebrate the leaders, and bless the year of camping, community service, and spiritual growth ahead.

Volunteers are especially welcome to help with hospitality, coordinating the ceremony, and keeping the children's corner calm so families can stay focused on fellowship. Reply to <firstspringfieldsda@gmail.com> by Wednesday, February 5, with the roles you can cover, and we will follow up about greeter assignments and refreshments for the reception that follows.
</file>

<file path="web/src/content/announcements/2026-02-10-board-meeting.md">
---
title: "Church board meeting"
date: 2026-02-10
tags:
  - events
  - ministries
summary: "Board meets Tuesday, Feb 10 at 7:00 PM; agenda items due Feb 8."
featured: true
---
The Church Board meets Tuesday, February 10, at 7:00 PM in the church office conference room. We will finalize the quarterly budget, review the spring outreach calendar, and identify volunteer needs for upcoming ministries.

Board members and ministry leaders should confirm their attendance by replying to <firstspringfieldsda@gmail.com>. Please submit agenda items by Saturday, February 8, so the clerk can distribute a balanced schedule, and observers with a ministry update may request time by letting the clerk know ahead of the meeting. A livestream link will be shared with anyone who cannot join in person.
</file>

<file path="web/src/content/bulletins/2025-12-20.md">
---
title: "Sabbath Bulletin"
date: "2025-12-20"
summary: "Order of service, announcements, and weekly schedule."
pdfUrl: "/bulletins/2025-12-20.pdf"
---
</file>

<file path="web/src/content/ministries/adventist-community-services.md">
---
title: "Adventist Community Services (ACS)"
summary: "Holistic ministry serving the Pioneer Valley and Springfield through compassion and practical care."
leaderName: "Adventist Community Services Team"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Monthly programs (see details below)."
category: "Outreach"
tags: ["community", "outreach", "service", "holistic ministry"]
---

## Adventist Community Services (ACS)

## Team

Our Adventist Community Services ministry is led by a dedicated team of volunteers from First Springfield.

- Brenda St George
- Belinda Behnava
- Donald Moore
- Gabriele Moore
- Carolyn Mutcherson
- Ray Mutcherson
- Pastor Abankwa Amoakohene

Pastor Abankwa Amoakohene provides pastoral support and advocacy as the team serves the community.

“At First Springfield Seventh-day Adventist Church, our mission is to humbly and lovingly serve the residents of the Pioneer Valley, the City of Springfield, and surrounding cities and towns. We seek to share the message of Jesus in tangible and meaningful ways by serving the whole person, a Christ-centered approach known as holistic ministry.”

“Throughout Jesus’ earthly ministry, He consistently modeled a holistic approach to caring for humanity, especially those who were marginalized, disadvantaged, and disenfranchised. He met people where they were, addressed their physical, emotional, and spiritual needs, and offered hope, dignity, and restoration.”

“As Ellen G. White beautifully wrote: “Christ’s method alone will give true success in reaching the people. The Savior mingled with men as one who desired their good. He showed His sympathy for them, ministered to their needs, and won their confidence. Then He bade them, ‘Follow Me.’””

“Through our Community Services ministry, we strive to follow Christ’s example, serving with humility, compassion, and love, and reflecting God’s grace to all.”

“Monthly Activities: Our community service programs are open to the public, and volunteers are always welcome to join us in serving others.”

“• Adventist Community Services (ACS) Meeting – Held on the second Wednesday of each month from 5:30–6:45 PM. All are welcome to participate and learn how to serve the community.”

“• Homeless Outreach Lunch – Prepared and delivered on the first Tuesday of each month in coordination with South Congregational Church in Springfield, MA.”

“• Taylor Street Men’s Shelter Dinner – Prepared and delivered on the second Tuesday of each month, providing warm meals and fellowship to those in need.”

“• Community Spaghetti Dinner – Held on the last Wednesday of each month from 5:00–6:00 PM, offering a free, welcoming meal to our neighbors.”
</file>

<file path="web/src/content/ministries/bible-study.md">
---
title: "Bible Study"
summary: "Interactive study and discussion of Scripture."
leaderName: "Bible Study Facilitator"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "4th Sabbath"
category: "Bible Study"
tags: ["bible", "study", "growth"]
---

## Overview

We read the Bible together and talk about how to live it out.

## How to get involved

Bring your Bible and join the discussion.

## Daily encouragement

Our Bible Study ministry also curates short-form resources you can open from home. The
[Daily Devotional](/resources/daily-devotional) highlights a thoughtful reflection each day, and the
[Daily Bible Verse](/resources/daily-bible-verse) pairs a single Scripture passage with a brief meditation.
Both are updated regularly to keep your personal Bible study fresh even when you cannot join a group session.
</file>

<file path="web/src/content/ministries/media-audio-visual.md">
---
title: "Media & Audio Visual"
summary: "Supports worship and campus events with livestream, sound, and visual storytelling."
category: "Other"
tags: ["media", "audio", "visual", "communications"]
---

## Media & Audio Visual

The Media & Audio Visual team keeps the gospel in focus with live streaming, sermon capture, and event production support. We blend sound, lighting, and visual elements so every voice can be heard warmly both in the sanctuary and online.

### Online presence

- https://www.youtube.com/@1stspringfieldsdama74
- “Facebook: [First Springfield SDA Church](https://www.facebook.com/firstspringfieldsda/)”
</file>

<file path="web/src/content/ministries/sabbath-school.md">
---
title: "Sabbath School"
summary: "Sabbath School equips Seventh-day Adventists to know Christ and share Him through Bible study, fellowship, mission, and discipleship."
leaderName: "Elder Paul Moulema"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Sabbath 10 am"
category: "Bible Study"
tags: ["sabbath school", "fellowship", "discipleship", "mission"]
---

## Sabbath School

Superintendent: Elder Paul Moulema

Assistant Superintendent: Carol Elliott

“Time: Sabbath 10 am”

“For Seventh-day Adventists, the goal of Sabbath School is much more than studying a lesson, it’s about making disciples. At its core, Sabbath School exists to help people grow in a saving relationship with Jesus Christ through the study of the Bible, fellowship, mission, and outreach. It is designed to nurture spiritual growth, strengthen faith, and equip members to live out the gospel in practical ways.”

“The key goals of Sabbath School in the Seventh-day Adventist Church are to:”

“• Study the Word of God – Deepening understanding of the Bible and its application to daily life.”

“• Build Fellowship – Creating a caring, supportive community where members connect, encourage one another, and grow together.”

“• Promote Mission – Inspiring participants to share the gospel locally and globally through service, outreach, and giving.”

“• Nurture Discipleship – Helping members develop Christlike character and actively follow Jesus in their personal and public lives.”

“In essence, Sabbath School supports the church’s mission by preparing believers to know Christ, grow in Christ, and share Christ with others—beginning each Sabbath morning in worship, study, and community.”

### Resources

- https://michigansspm.org/talking_points/
- https://3abnsabbathschoolpanel.com/
</file>

<file path="web/src/content/ministries/womens-ministry.md">
---
title: "Women's Ministry"
summary: "Connection, encouragement, and discipleship for women of all ages."
leaderName: "Women's Ministry Team"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "First Tuesday of every month from 6:00–8:00 PM"
category: "Women"
tags: ["women", "discipleship", "community"]
---

## Women’s Ministry

Women’s Ministry Team: Yejide Bell, Ada Durand, Maxine Griffiths, Sharon Luszcz

Women’s Ministries exists to nurture, empower, and equip women to grow in their relationship with Jesus Christ and to use their God-given gifts in service to others. Our ministry provides a supportive and welcoming environment where women of all ages and backgrounds can connect, grow spiritually, and encourage one another.

Through Bible study, prayer, fellowship, outreach, and service, Women’s Ministries seeks to strengthen faith, build meaningful relationships, and support women in their homes, church, and community. We are committed to uplifting women, fostering spiritual growth, and inspiring lives of purpose, compassion, and leadership in Christ.

“Meeting Time: Women’s Ministries meets regularly on the first Tuesday of every month from 6:00–8:00 PM. Each month features a variety of programs, including Bible studies, health care education, and support-focused discussions, designed to meet the spiritual and practical needs of women.”

### Special Programs & Upcoming Events

• Women’s International Day – March 7: Join us as we celebrate Women’s International Day with a special program featuring Sister Sandra Hinds, hosted at our church.

• Tween & Teen Retreat – May 15–16, 2026: A faith-building retreat for tweens and teens at Camp Winnekeag, focused on spiritual growth, connection, and empowerment.

• enditnow® Emphasis Day – Fourth Sabbath of August. This annual emphasis day provides an opportunity for our church to address the issue of abuse, educate members and leadership, raise community awareness, and affirm to victims that the church is a place of care, support, and hope.

### Resources

- https://www.sneconline.org/copy-of-family-life-ministries
- https://www.enditnow.org/
- https://women.adventist.org/church-statements-against-violence
</file>

<file path="web/src/content/ministries/youth-young-adults.md">
---
title: "Youth & Young Adults Ministry"
summary: "Supporting young people with Christ-centered friendship, learning, and service."
leaderName: "Youth & Young Adults Ministry Team"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "See programs & events for the latest schedule."
category: "Children & Youth"
tags: ["youth", "young adults", "discipleship", "community"]
---

## Youth & Young adults ministry

“Our Youth and Young Adult Ministries are dedicated to helping young people grow in faith, purpose, and community as they navigate the important seasons of life. We strive to create a Christ-centered environment where youth and young adults can build meaningful relationships, deepen their walk with God, and discover their role in the church and the world.”

“Through worship, fellowship, service, and meaningful conversations, our Youth and Young Adult Ministries seek to support, empower, and inspire young people to live out their faith with confidence and purpose.”

AY Director: Anthia Elliott

AY Assistant Director: Yolann Guirand

### Programs & Events

- “Table Talk: youth-focused program taking place the second Sabbath of the month. Each month, a new presenter will share practical guidance on life skills, workplace expectations, career insights, and personal development to help equip our youth for success. All youth are encouraged to attend and bring a friend, take part in these meaningful discussions in a relaxed, supportive setting. Come ready to learn, ask questions, and grow together!”
- “GYC: December 30 to January 3, 2027- location and details will be shared soon.”

### Resources

- Instagram Page: @firstspringfieldday
- https://nadyouthyoungadults.org/young-adult-ministry/
- https://growingyoungadventists.com/
</file>

<file path="web/src/content/resources/2025/12/16/welcome-packet.md">
---
title: "Welcome Packet"
summary: "A quick overview of our church, what we believe, and how to get connected."
published: "2025-12-16"
category: "New Here"
attachmentUrl: "/resources/forms" # replace with a real PDF path if/when you add one
---

## Inside

- Service times
- What to expect
- Ways to connect
</file>

<file path="web/src/data/announcement-tags.ts">
export const announcementTags = [
  {
    value: "this-week",
    label: "This week",
    description: "Weekly headlines, reminders, and praise reports for the coming Sabbath.",
  },
  {
    value: "cancellations",
    label: "Cancellations",
    description: "Weather alerts and service or room cancellations the church needs to know about.",
  },
  {
    value: "events",
    label: "Events",
    description: "Special programs, community outreach, and hospitality events.",
  },
  {
    value: "volunteers",
    label: "Volunteers",
    description: "Volunteer needs, sign-ups, and ministry staffing alerts.",
  },
  {
    value: "ministries",
    label: "Ministries",
    description: "Department and ministry team updates or leadership notes.",
  },
] as const;

export type AnnouncementTagInfo = (typeof announcementTags)[number];
export type AnnouncementTagValue = AnnouncementTagInfo["value"];

export const announcementTagValues = announcementTags.map((tag) => tag.value) as readonly AnnouncementTagValue[];
export const announcementTagEnumValues = announcementTagValues as [AnnouncementTagValue, ...AnnouncementTagValue[]];

export const announcementTagLabels = announcementTags.reduce(
  (map, tag) => {
    map[tag.value] = tag.label;
    return map;
  },
  {} as Record<AnnouncementTagValue, string>
);

export const announcementTagDescriptions = announcementTags.reduce(
  (map, tag) => {
    map[tag.value] = tag.description;
    return map;
  },
  {} as Record<AnnouncementTagValue, string>
);

export function getAnnouncementTag(value?: string) {
  return announcementTags.find((tag) => tag.value === value);
}
</file>

<file path="web/src/data/site-alert.json">
{
  "enabled": true,
  "title": "Annex access paused for safety review",
  "message": "The annex is temporarily closed while engineers finish a safety inspection and repairs; check the update for details.",
  "href": "/updates/annex-access-paused-for-safety",
  "variant": "warn",
  "updatedAt": "2026-02-12T15:00:00Z"
}
</file>

<file path="web/src/data/videos.json">
[
  {
    "title": "Sabbath Worship Service",
    "date": "2025-12-13",
    "youtubeId": "TBD",
    "summary": "Weekly worship service."
  },
  {
    "title": "Bible Study / Message",
    "date": "2025-12-06",
    "youtubeId": "TBD",
    "summary": "Sermon and reflection."
  },
  {
    "title": "Special Program",
    "date": "2025-11-29",
    "youtubeId": "TBD",
    "summary": "Guest speaker or special event."
  }
]
</file>

<file path="web/src/lib/announcements.ts">
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { site } from "../data/site";

export const announcementsPerPage = 6;

export type AnnouncementEntry = CollectionEntry<"announcements">;

const showDrafts = !import.meta.env.PROD;

const monthFormatter = new Intl.DateTimeFormat(site.locale, {
  month: "long",
  year: "numeric",
  timeZone: site.timeZone,
});

export type AnnouncementOptions = {
  includeExpired?: boolean;
};

export async function getSortedAnnouncements(options?: AnnouncementOptions) {
  const all = await getCollection("announcements");
  const now = Date.now();
  return all
    .filter((entry) => (showDrafts ? true : entry.data.draft !== true))
    .filter((entry) =>
      options?.includeExpired ? true : !entry.data.expires || entry.data.expires.valueOf() >= now
    )
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
}

export function paginateAnnouncements(entries: AnnouncementEntry[], page: number) {
  const perPage = announcementsPerPage;
  const start = (page - 1) * perPage;
  return {
    results: entries.slice(start, start + perPage),
    total: entries.length,
    totalPages: Math.max(1, Math.ceil(entries.length / perPage)),
    page,
  };
}

export function getArchiveMonths(entries: AnnouncementEntry[]) {
  const seen = new Set<string>();
  const months: { year: number; month: number; label: string }[] = [];

  entries.forEach((entry) => {
    const date = entry.data.date;
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const key = `${year}-${String(month).padStart(2, "0")}`;
    if (!seen.has(key)) {
      seen.add(key);
      months.push({
        year,
        month,
        label: monthFormatter.format(date),
      });
    }
  });

  return months;
}
</file>

<file path="web/src/lib/links.ts">
export function mailto(email: string, subject?: string) {
  const e = (email ?? "").trim();
  if (!e) return "";
  const params = subject ? `?subject=${encodeURIComponent(subject)}` : "";
  return `mailto:${e}${params}`;
}

export function tel(phone: string) {
  const p = (phone ?? "").trim();
  if (!p) return "";
  const digits = p.replace(/[^0-9+]/g, "");
  return digits ? `tel:${digits}` : "";
}
</file>

<file path="web/src/lib/updates.ts">
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

export type UpdateEntry = CollectionEntry<"updates">;

export async function getSortedUpdates(options?: { includeDrafts?: boolean }) {
  const all = await getCollection("updates");
  return all
    .filter((entry) => (options?.includeDrafts ? true : entry.data.draft !== true))
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
}

export function getRecentUpdates(entries: UpdateEntry[], limit = 4) {
  return entries.slice(0, limit);
}
</file>

<file path="web/src/pages/connect/connect-card/thank-you.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import { site } from "../../../data/site";
---

<BaseLayout title="Thank you" description="Thank you for submitting a Connect Card. First Springfield SDA will reach out soon.">
  <div class="stack thank-you">
    <h1>Thank you for connecting</h1>
    <p class="muted">
      We received your Connect Card and a member of our team will follow up within a business day (or sooner if you asked).
    </p>
    <p class="muted">
      If you need help right now, call us at <a href={`tel:${site.contact.phone.replace(/[^0-9+]/g, "")}`}>{site.contact.phone}</a>
      or email <a href={`mailto:${site.contact.email}`}>{site.contact.email}</a>.
    </p>
    <div class="button-row">
      <Button href="/" variant="tertiary">Return home</Button>
      <Button href="/connect/contact" variant="secondary">Contact page</Button>
    </div>
  </div>
</BaseLayout>

<style>
  .thank-you {
    max-width: 48rem;
  }

  .button-row {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }
</style>
</file>

<file path="web/src/pages/connect/facilities/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import NoticeBanner from "../../../components/ui/NoticeBanner.astro";
import { site } from "../../../data/site";
import { mailto, tel } from "../../../lib/links";

const emailHref = mailto(site.contact.email);
const phoneHref = tel(site.contact.phone);
---

<BaseLayout
  title="Facilities"
  description="Learn how to request and schedule space at First Springfield SDA."
>
  <div class="stack">
    <h1>Facilities use</h1>

    <NoticeBanner variant="urgent">
      <strong>Temporary suspension:</strong> Use of the Annex (fellowship hall, classrooms, and adjoining restrooms) is suspended until repairs finish. Please reach out to the church office before planning an event to confirm whether any spaces are currently available.
    </NoticeBanner>

    <section class="card stack" aria-labelledby="facilities-request-heading">
      <h2 id="facilities-request-heading">How to request use</h2>
      <p>
        Share the basics of your event: what rooms you need, how many people you expect, and any equipment (sound, tables, audiovisual) you will be using. Email the church office at
        <a href={emailHref}>{site.contact.email}</a> or call <a href={phoneHref}>{site.contact.phone}</a> and include "Facility request" in the subject line.
      </p>
      <div class="prose">
        <ol>
          <li>Confirm the preferred date(s) and time range, including setup and teardown windows.</li>
          <li>Mention whether you need support from our media/AV volunteers, custodial crew, or parking volunteers.</li>
          <li>Let us know if your group carries its own insurance or needs a certificate of insurance.</li>
        </ol>
      </div>
    </section>

    <section class="card stack" aria-labelledby="facilities-approval-heading">
      <h2 id="facilities-approval-heading">Who approves &amp; schedules</h2>
      <p>
        The Pastor, Head Elder, and church office team review every request to avoid calendar conflicts and make sure ministry priorities stay in step with our mission. Once everyone signs off, the office will confirm the room assignment and email you a reservation summary with any follow-up items.
      </p>
      <p>
        Belinda Behnava, who coordinates facility approvals on behalf of the Head Deaconess, is our named scheduler. Mention her name when you email or call the office for confirmation so the right ministry oversight is included in the approval.
      </p>
      <p class="muted">
        Please do not assume a space is reserved until you receive an approval email. Approval may include instructions for additional ministry oversight depending on the type of event.
      </p>
    </section>

    <section class="card stack" aria-labelledby="facilities-lead-time-heading">
      <h2 id="facilities-lead-time-heading">Expected lead time</h2>
      <p>
        Standard events require at least four weeks notice so we can review the calendar, verify staffing, and align insurance coverage. Large receptions, off-site retreats, or anything requiring extra custodial support should be submitted six weeks ahead. Smaller meetings may be considered with two weeks' notice but are subject to available space.
      </p>
      <p class="muted">
        When possible, confirm recurring meetings for the next quarter before the last Sunday of the current month so we can hold the rooms you rely on.
      </p>
    </section>

    <section class="card stack" aria-labelledby="facilities-rules-heading">
      <h2 id="facilities-rules-heading">Basic rules</h2>
      <div class="prose">
        <ul>
          <li>Leave every space as you found it—wipe down tables, sweep floors, return chairs and equipment to the storage closet, and remove all trash. Extra trash bags are available in the janitor closet; please bag and haul trash to the dumpster behind the building.</li>
          <li>Keys for classrooms, the main sanctuary, or the Annex must be picked up and returned at the church office during business hours. Report any missing keys immediately so we can re-key locks if needed.</li>
          <li>Protect carpets and wood floors by using spill guards, liners, or trays when serving food or beverages. No confetti, helium balloons, or permanent adhesives on walls.</li>
          <li>Keep exterior doors locked when you are not escorting guests, and make sure everyone exits before the building is secured. Immediately report any maintenance or safety issues to the office.</li>
          <li>If your group needs parking assistance, we can supply cones or volunteers. Please set up signage only with office approval so we do not block emergency routes.</li>
        </ul>
      </div>
      <p class="small muted">
        Failure to follow these guidelines may result in loss of future facility privileges. If your plans change, let us know as soon as possible so we can free up the space for another group.
      </p>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/events/[id].astro">
---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import { getCollection, render } from 'astro:content';
import { site } from '../../data/site';

export async function getStaticPaths() {
  const events = await getCollection('events', ({ data }) => {
    return import.meta.env.PROD ? data.draft !== true : true;
  });

  return events.map((event) => ({
    params: { id: event.id },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await render(event);

const fmtDate = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'full',
  timeStyle: 'short',
  timeZone: site.timeZone,
});

const locationName = event.data.locationName ?? "";
const address =
  event.data.address ?? (locationName === site.name ? site.contact.address : "");

const when = event.data.end
  ? `${fmtDate.format(event.data.start)} – ${fmtDate.format(event.data.end)}`
  : fmtDate.format(event.data.start);
---

<BaseLayout title={event.data.title} description={event.data.summary}>
  <Hero title={event.data.title} subtitle={event.data.summary} />

  <section class="stack">
    <div class="card stack--tight">
      <p class="muted"><strong>When:</strong> {when}</p>
      {locationName && (
        <p class="muted"><strong>Where:</strong> {locationName}</p>
      )}
      {address && (
        <p class="muted"><strong>Address:</strong> {address}</p>
      )}
      {event.data.registrationUrl && (
        <p>
          <a class="link" href={event.data.registrationUrl} rel="noopener noreferrer">Register / Learn more</a>
        </p>
      )}
    </div>

    <article class="card">
      <div class="prose">
        <Content />
      </div>
    </article>

    <p><a class="link" href="/events">← Back to Events</a></p>
  </section>
</BaseLayout>
</file>

<file path="web/src/pages/events/index.astro">
---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import ContentCard from '../../components/content/ContentCard.astro';
import RecurringActivities from '../../components/sections/RecurringActivities.astro';
import { getCollection } from 'astro:content';
import { site } from '../../data/site';

const events = await getCollection('events', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const now = new Date();
const upcoming = events
  .filter((e) => e.data.start >= now)
  .sort((a, b) => a.data.start.valueOf() - b.data.start.valueOf());

const past = events
  .filter((e) => e.data.start < now)
  .sort((a, b) => b.data.start.valueOf() - a.data.start.valueOf())
  .slice(0, 12);

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'medium',
  timeStyle: 'short',
  timeZone: site.timeZone,
});
---

<BaseLayout title="Events" description="What’s happening at church.">
  <Hero
    title="Events"
    subtitle="See what’s coming up and what we’ve recently hosted."
  />

  <section class="stack--loose">
    <RecurringActivities />

    <div class="stack">
      <h2>Upcoming</h2>

      {upcoming.length === 0 ? (
        <p class="muted">No upcoming events are published yet.</p>
      ) : (
        <div class="grid--cards">
          {upcoming.map((e) => (
            <ContentCard
              href={`/events/${e.id}`}
              title={e.data.title}
              summary={e.data.summary}
              meta={fmt.format(e.data.start)}
              tags={e.data.tags}
            />
          ))}
        </div>
      )}
    </div>

    <div class="stack">
      <h2>Recent</h2>
      {past.length === 0 ? (
        <p class="muted">No past events are published yet.</p>
      ) : (
        <div class="grid--cards">
          {past.map((e) => (
            <ContentCard
              href={`/events/${e.id}`}
              title={e.data.title}
              summary={e.data.summary}
              meta={fmt.format(e.data.start)}
              tags={e.data.tags}
            />
          ))}
        </div>
      )}
    </div>
  </section>
</BaseLayout>
</file>

<file path="web/src/pages/privacy/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Hero from "../../components/ui/Hero.astro";

const analyticsEnabled = import.meta.env.PROD && Boolean(import.meta.env.PUBLIC_CF_ANALYTICS_TOKEN);
---

<BaseLayout title="Privacy" description="Privacy and data use">
  <div class="stack">
    <Hero title="Privacy" subtitle="How this website handles data." />

    <section class="card stack">
      <h2>Analytics</h2>
      {analyticsEnabled ? (
        <>
          <p class="muted">
            This site uses Cloudflare Web Analytics to understand overall traffic (for example: page views and referrers).
            We use this information to improve content and navigation.
          </p>
          <ul class="muted">
            <li>We measure aggregated traffic, not individual user behavior.</li>
            <li>We do not sell personal information.</li>
            <li>We do not use this analytics setup for ad targeting.</li>
          </ul>
        </>
      ) : (
        <p class="muted">
          This site currently has analytics disabled. If enabled in the future, this page will be updated.
        </p>
      )}

      <h2>Search</h2>
      <p class="muted">
        Search is powered by a static index and runs in your browser. Search queries are not sent to a server.
      </p>

      <h2>External links</h2>
      <p class="muted">
        Some buttons and links may send you to external platforms (for example: online giving, YouTube, or forms).
        Those services have their own privacy policies.
      </p>

      <h2>Contact</h2>
      <p class="muted">
        If you have privacy questions, please contact the church.
      </p>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/resources/announcements/tags/[tag].astro">
---
import BaseLayout from "../../../../layouts/BaseLayout.astro";
import Button from "../../../../components/ui/Button.astro";
import ContentCard from "../../../../components/content/ContentCard.astro";
import { site } from "../../../../data/site";
import {
  announcementTagLabels,
  announcementTags,
  type AnnouncementTagValue,
} from "../../../../data/announcement-tags";
import {
  getArchiveMonths,
  getSortedAnnouncements,
} from "../../../../lib/announcements";

export async function getStaticPaths() {
  return announcementTags.map((tag) => ({ params: { tag: tag.value } }));
}

const tagParam = Astro.params.tag as AnnouncementTagValue;
const tagInfo = announcementTags.find((tag) => tag.value === tagParam);
if (!tagInfo) {
  throw new Error(`Unknown announcement tag: ${tagParam}`);
}

const announcements = await getSortedAnnouncements();
const filtered = announcements.filter((entry) => entry.data.tags?.includes(tagInfo.value));
const metaFormatter = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone,
});
const archiveMonths = getArchiveMonths(await getSortedAnnouncements({ includeExpired: true }));
const updatesUrl = "/updates";
const rssUrl = "/resources/announcements/rss.xml";
---

<BaseLayout title={`Announcements · ${tagInfo.label}`}>
  <div class="stack">
    <h1>{tagInfo.label} announcements</h1>
    <p class="muted">{tagInfo.description}</p>
    <div class="cluster">
      <Button href="/resources/announcements" variant="tertiary">All announcements</Button>
      <Button href={updatesUrl} variant="tertiary">Visit updates page</Button>
      <Button href={rssUrl} variant="tertiary" size="sm">Subscribe via RSS</Button>
    </div>

    {filtered.length === 0 ? (
      <p class="muted">No announcements use this tag yet.</p>
    ) : (
      <div class="grid--cards">
        {filtered.map((entry) => (
          <ContentCard
            href={`/resources/announcements/${entry.id}`}
            title={entry.data.title}
            summary={entry.data.summary}
            meta={metaFormatter.format(entry.data.date)}
            tags={entry.data.tags?.map((value) => announcementTagLabels[value] ?? value)}
          />
        ))}
      </div>
    )}

    <section class="card stack--tight">
      <h2>Archive by month</h2>
      {archiveMonths.length === 0 ? (
        <p class="muted">No archived months yet.</p>
      ) : (
        <ul class="archive-list">
          {archiveMonths.map(({ year, month, label }) => (
            <li>
              <a class="link" href={`/resources/announcements/archive/${year}/${String(month).padStart(2, "0")}`}>
                {label}
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>
  </div>
</BaseLayout>

<style>
  .archive-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .archive-list li {
    min-width: 180px;
  }
</style>
</file>

<file path="web/src/pages/resources/[...id].astro">
---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import { getCollection, render } from 'astro:content';
import { site } from '../../data/site';

export async function getStaticPaths() {
  const resources = await getCollection('resources', ({ data }) => {
    return import.meta.env.PROD ? data.draft !== true : true;
  });

  return resources.map((resource) => ({
    params: { id: resource.id },
    props: { resource },
  }));
}

const { resource } = Astro.props;
const { Content } = await render(resource);

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'full',
  timeZone: site.timeZone,
});
---

<BaseLayout title={resource.data.title} description={resource.data.summary}>
  <Hero title={resource.data.title} subtitle={resource.data.summary} />

  <section class="stack">
    <div class="card stack--tight">
      <p class="muted"><strong>Published:</strong> {fmt.format(resource.data.published)}</p>
      {resource.data.category && (
        <p class="muted"><strong>Category:</strong> {resource.data.category}</p>
      )}

      {resource.data.attachmentUrl && (
        <p>
          <a class="link" href={resource.data.attachmentUrl}>Download / Open attachment</a>
        </p>
      )}

      {resource.data.externalUrl && (
        <p>
          <a class="link" href={resource.data.externalUrl} rel="noopener noreferrer">Open external link</a>
        </p>
      )}
    </div>

    <article class="card">
      <div class="prose">
        <Content />
      </div>
    </article>

    <p><a class="link" href="/resources">← Back to Resources</a></p>
  </section>
</BaseLayout>
</file>

<file path="web/src/pages/updates/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Button from "../../components/ui/Button.astro";
import SiteAlert from "../../components/global/SiteAlert.astro";
import { render } from "astro:content";
import { site } from "../../data/site";
import siteAlert from "../../data/site-alert.json";
import { getSortedUpdates, getRecentUpdates, type UpdateEntry } from "../../lib/updates";

const updates = await getSortedUpdates();
const recent = getRecentUpdates(updates, 4);
const renderedUpdates = await Promise.all(
  recent.map(async (entry) => {
    const { Content } = await render(entry);
    return { entry, Content };
  })
);

const metaFormatter = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone,
});

const alertConfig = siteAlert as {
  enabled?: boolean;
  title?: string;
  message?: string;
  href?: string;
  variant?: "info" | "warn";
  updatedAt?: string;
};
const showAlert = Boolean(alertConfig.enabled && alertConfig.title && alertConfig.message);

const categoryLabels: Record<UpdateEntry["data"]["category"], string> = {
  weather: "Weather notice",
  building: "Building/annex",
  schedule: "Schedule change",
};

const announcementsUrl = "/resources/announcements";
const rssUrl = "/resources/announcements/rss.xml";
const contactHref = "/connect/contact";
const submitDeadline = "Wednesday 5 PM";
const clerkDestination = "Church Clerk (Church Office)";
const contactEmail = site.contact.email;
---

<BaseLayout
  title="Updates"
  description="Emergency alerts, weather notices, and last-minute schedule changes for our church community."
>
  <div class="stack">
    <section class="stack">
      <h1>Updates</h1>
      <p class="muted">
        When the emergency banner appears, it lands here first. Check this page for cancellations, weather notices, and any last-minute announcements before heading to worship.
      </p>
    </section>

    <section class="stack">
      <h2>Current alert</h2>
      {showAlert ? (
        <SiteAlert
          title={alertConfig.title ?? ""}
          message={alertConfig.message ?? ""}
          href={alertConfig.href}
          variant={alertConfig.variant}
          updatedAt={alertConfig.updatedAt}
          announce={false}
          hideCta
        />
      ) : (
        <p class="muted">No emergency alerts right now.</p>
      )}
    </section>

    <section class="stack">
      <div class="cluster--between">
        <div>
          <h2 id="recent-updates">Recent updates</h2>
          <p class="muted">
            {recent.length === 0
              ? "No updates have been published yet."
              : `Showing ${recent.length} of ${updates.length} recent update${updates.length === 1 ? "" : "s"}.`}
          </p>
        </div>
        <div class="cluster">
          <Button href={announcementsUrl} variant="tertiary">Browse announcements</Button>
          <Button href={rssUrl} variant="tertiary" size="sm">Subscribe via RSS</Button>
        </div>
      </div>

      {renderedUpdates.length === 0 ? (
        <p class="muted">We’ll publish updates here as soon as they’re needed.</p>
      ) : (
        <div class="stack">
          {renderedUpdates.map(({ entry, Content }) => (
            <article class="card stack--tight">
              <div class="cluster--between">
                <div>
                  <p class="muted small">{categoryLabels[entry.data.category] ?? "Update"}</p>
                  <h3>{entry.data.title}</h3>
                </div>
                <p class="muted small">{metaFormatter.format(entry.data.date)}</p>
              </div>
              <p class="muted">{entry.data.summary}</p>
              <div class="prose">
                <Content />
              </div>
              {entry.data.tags && entry.data.tags.length > 0 ? (
                <ul class="chip-list">
                  {entry.data.tags.map((tag) => (
                    <li>
                      <span class="chip chip--readonly">{tag}</span>
                    </li>
                  ))}
                </ul>
              ) : null}
            </article>
          ))}
        </div>
      )}
    </section>

    <section class="card stack--tight">
      <h2>Need to share something urgently?</h2>
      <p class="muted">
        Contact the {clerkDestination} by {submitDeadline} so we can publish updates before Saturday. Email {contactEmail} or use the Connect page below.
      </p>
      <div class="cluster">
        <Button href={contactHref} variant="secondary">Contact Church Clerk</Button>
        <Button href={announcementsUrl} variant="tertiary">Submit an announcement</Button>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
.chip-list {
  list-style: none;
  display: flex;
  gap: var(--space-2);
  padding: 0;
  margin: 0;
}

.chip-list li {
  display: inline;
}
</style>
</file>

<file path="web/tests/e2e/phase-7-sitefiles.spec.ts">
import { expect, test } from "@playwright/test";

test("robots.txt exists and references sitemap", async ({ page }) => {
  await page.goto("/robots.txt");
  const body = await page.textContent("body");
  expect(body).toContain("User-agent:");
  expect(body).toContain("Sitemap:");
});

test("sitemap index exists", async ({ page }) => {
  await page.goto("/sitemap-index.xml");
  const body = await page.textContent("body");
  expect(body).toContain("<sitemapindex");
});
</file>

<file path="web/lighthouserc.cjs">
module.exports = {
  ci: {
    collect: {
      staticDistDir: "./dist",
      numberOfRuns: 3,
    },
    assert: {
      assertions: {
        "categories:performance": ["error", { minScore: 0.9 }],
        "categories:accessibility": ["error", { minScore: 0.95 }],
        "categories:seo": ["error", { minScore: 0.95 }],
        "categories:best-practices": ["error", { minScore: 0.95 }],
      },
    },
    upload: {
      target: "filesystem",
      outputDir: "./.lighthouseci",
    },
  },
};
</file>

<file path="web/linkinator.config.json">
{
  "recurse": true,
  "cleanUrls": true,
  "checkFragments": true,
  "timeout": 30000,
  "concurrency": 50,
  "skip": ["^mailto:", "^tel:", "^https?://"]
}
</file>

<file path="web/wrangler.jsonc">
{
  "main": "dist/_worker.js/index.js",
  "name": "web",
  "compatibility_date": "2025-12-19",
  "compatibility_flags": ["nodejs_compat", "global_fetch_strictly_public"],
  "assets": {
    "binding": "ASSETS",
    "directory": "./dist",
  },
  "observability": {
    "enabled": true,
  },
}
</file>

<file path=".github/workflows/ci.yml">
name: CI

on:
  pull_request:
  push:
    branches: ["main", "master"]

jobs:
  web:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: web

    env:
      # Ensures canonical URLs + sitemap/robots generation are deterministic in CI
      PUBLIC_SITE_URL: http://127.0.0.1:4321

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
          cache-dependency-path: web/package-lock.json

      - name: Install dependencies
        run: npm ci

      - name: Typecheck
        run: npm run check

      - name: Build
        run: npm run build

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: E2E tests
        run: npm run test:e2e:ci

      - name: Internal link check
        run: npm run test:links:ci

      - name: Lighthouse CI
        id: lighthouse
        uses: treosh/lighthouse-ci-action@v12
        with:
          configPath: ./lighthouserc-ci.cjs
          temporaryPublicStorage: true
          uploadArtifacts: false

      - name: Build Lighthouse summary
        if: github.event_name == 'pull_request'
        id: lhci-summary
        uses: actions/github-script@v8
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const core = require("@actions/core");
            const manifest = JSON.parse(process.env.MANIFEST_JSON || "[]");
            const entry = manifest[0] || {};
            const summary = entry.summary || {};
            const metricLabels = {
              performance: "Performance",
              accessibility: "Accessibility",
              "best-practices": "Best Practices",
              seo: "SEO",
              pwa: "PWA",
            };
            const metrics = Object.keys(metricLabels)
              .filter((key) => summary[key] !== undefined)
              .map((key) => `| ${metricLabels[key]} | ${Math.round(summary[key] * 100)}% |`);
            const table =
              metrics.length > 0
                ? ["| Metric | Score |", "| --- | --- |", ...metrics].join("\n")
                : "No Lighthouse scores available.";
            const links = JSON.parse(process.env.LINKS_JSON || "{}");
            const reportLink = Object.values(links)[0];
            const body = [
              "## Lighthouse CI results",
              table,
              reportLink
                ? `Temporary public report: [view it here](${reportLink})`
                : "Temporary public report not available.",
              "Artifacts remain in the `lighthouseci` artifact bundle for this run.",
            ].join("\n\n");
            core.setOutput("body", body);
        env:
          MANIFEST_JSON: ${{ steps.lighthouse.outputs.manifest }}
          LINKS_JSON: ${{ steps.lighthouse.outputs.links }}

      - name: Comment Lighthouse results
        if: github.event_name == 'pull_request'
        uses: peter-evans/create-or-update-comment@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: ${{ steps.lhci-summary.outputs.body }}
          tag: lighthouse-ci

      - name: Upload Lighthouse artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: lighthouseci
          path: web/.lighthouseci

      - name: Upload Playwright report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: web/playwright-report
</file>

<file path="docs/phase-0/source-of-truth.yml">
church:
  public_name: "First Springfield Seventh-day Adventist Church"
  address:
    street: "1118 Sumner Ave"
    city: "Springfield"
    state: "MA"
    zip: "01118-2154"
  phone: "(413) 782-6260"
  pastor_cell: "(240) 850-9452"
  email_public: "firstspringfieldsda@gmail.com"
  languages:
    primary: "English"

schedule:
  sabbath_school:
    day: "Saturday"
    time: "10:00 AM"
  worship_service:
    day: "Saturday"
    time: "11:15 AM"
  prayer_meeting:
    day: "Wednesday"
    time: "7:00 PM"

portals:
  giving_url: "https://adventistgiving.org/"
  youtube_channel_url: "https://www.youtube.com/@1stspringfieldsdama74"
  facebook_url: "TBD"
  prayer_form_url: "TBD"
  contact_form_url: "TBD"
  volunteer_form_url: "TBD"
  official_site_url: "https://firstspringfieldma.adventistchurch.org/"

copy:
  homepage_tagline: "A Christian community in Springfield, MA"
  welcome_message: "We would love to have you join our church family."
</file>

<file path="docs/connect-card.md">
## Connect Card / Connect Card (Static)

### What’s live

- `web/src/pages/connect/connect-card/index.astro` renders the Connect Card, complete with the photo gallery, gallery captions, and the refreshed specification described below.
- `web/src/pages/connect/connect-card/thank-you.astro` is the post-submit landing page.
- Header navigation and the hero banner now highlight the new page.

### Connect Card spec

- **This is your church family** – a 3–6 image gallery near the top of the page shows worship, fellowship, service, and welcome moments so visitors see the mix of people and gatherings before they hit the form.
- **Required fields & flow** – the Connect Card is intentionally narrower than a generic contact form: email is optional, phone, a preferred visit date, the “Visited before?” radio, and a structured address block for street, line 2, city, state, ZIP, and country are all required so the hospitality team can respond with confidence.
- **Interest list** – the checkbox set now follows the outreach categories you requested: Prayer; Bible study; Visitation; Conversion; Baptism; Transfer; Facility use. At least one option must be selected, and the hidden `address` input (supported by the client-side address summary script) keeps the submission schema aligned with your destination sheet.
- **Deliverability / spam handling** – Cloudflare Turnstile stays on the form. The built-in `/api/connect-card` endpoint verifies each `cf-turnstile-response` with `PRIVATE_TURNSTILE_SECRET_KEY` before forwarding the submission to `PRIVATE_CONNECT_CARD_FORWARD_URL` (your Apps Script, SheetMonkey hook, etc.). You can also configure `CONNECT_CARD_NOTIFY_EMAILS`, `CONNECT_CARD_NOTIFY_FROM`, and `CONNECT_CARD_SENDGRID_API_KEY` to send inbox alerts via SendGrid. If you prefer to post directly to your script, set `PUBLIC_CONNECT_CARD_FORM_ACTION` to that URL instead.

### Field & data mapping

| Field | Input name | Notes |
| --- | --- | --- |
| Full Name | `fullName` | Required |
| Email | `email` | Optional |
| Phone | `phone` | Required so we can follow up when email bounces |
| Preferred visit date | `visitDate` | Required to plan hospitality |
| Visited before? | `visitedBefore` | Required radio (yes/no) |
| Street address | `addressStreet` | Required |
| Address line 2 | `addressLine2` | Optional (apt, suite, etc.) |
| City | `addressCity` | Required |
| State | `addressState` | Required |
| ZIP | `addressZip` | Required |
| Country | `addressCountry` | Optional unless you are visiting from outside the United States; helps the hospitality team prepare travel directions or mailings. |
| Address (formatted) | `address` | Hidden input populated by the client-side script |
| Reason for connecting | `connectionReason` | Required |
| Interests | `interests[]` | Required checkbox set (select at least one from the canonical list) |
| Preferred follow-up | `preferredContact` | Required |
| Notes | `notes` | Optional free text |
| Redirect URL | `redirectUrl` | Defaults to `/connect/connect-card/thank-you` |
| Source | `formSource` | `connect-card-web` (static form identifier) |

The front-end script also ensures at least one `interests[]` checkbox is checked before submission and keeps the hidden `address` field in sync with the structured address inputs.

### Option A: Google Sheet + Web App (static-friendly, recommended)

1. In Google Sheets, create a tab called **ConnectCards**. Add columns that match the form `name` attributes:

   | Column | Field name |
   | --- | --- |
   | `Full Name` | `fullName` |
   | `Email` | `email` |
   | `Phone` | `phone` |
   | `Preferred visit date` | `visitDate` |
   | `Visited before?` | `visitedBefore` |
   | `Street address` | `addressStreet` |
   | `Address line 2` | `addressLine2` |
   | `City` | `addressCity` |
   | `State` | `addressState` |
   | `ZIP` | `addressZip` |
   | `Address line (formatted)` | `address` |
   | `Reason` | `connectionReason` |
   | `Interests` | `interests` (comma-separated, from checkboxes) |
   | `Preferred Contact` | `preferredContact` |
   | `Notes` | `notes` |
   | `Source` | `formSource` |
   | `Submitted At` | you can add a timestamp column |

   The form script constructs the `address` column from the street/city/state/ZIP parts so you can use the formatted version in mailings while still keeping the discrete parts for logistics.

2. Open **Extensions > Apps Script**:

  ```javascript
  const SPREADSHEET_ID = "…"; // readable from the sheet URL
   const SHEET_NAME = "ConnectCards";
   const TURNSTILE_SECRET = PropertiesService.getScriptProperties().getProperty(
     "PRIVATE_TURNSTILE_SECRET_KEY"
   );

   function doPost(e) {
     const token = e.parameter["cf-turnstile-response"];
     if (!verifyTurnstile(token, TURNSTILE_SECRET)) {
       return ContentService.createTextOutput("Bot check failed").setMimeType(
         ContentService.MimeType.TEXT
       );
     }

     const row = [
       e.parameter.fullName,
       e.parameter.email,
       e.parameter.phone,
       e.parameter.visitDate,
       e.parameter.visitedBefore,
       e.parameter.addressStreet,
       e.parameter.addressLine2,
       e.parameter.addressCity,
       e.parameter.addressState,
       e.parameter.addressZip,
       e.parameter.address,
       e.parameter.connectionReason,
       (Array.isArray(e.parameter.interests) ? e.parameter.interests : [e.parameter.interests])
         .filter(Boolean)
         .join(", "),
       e.parameter.preferredContact,
       e.parameter.notes,
       e.parameter.formSource,
       new Date().toISOString(),
     ];

     SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(SHEET_NAME).appendRow(row);

     const redirectUrl = e.parameter.redirectUrl || "/connect/connect-card/thank-you";
     return ContentService.createTextOutput(
       `<script>location.replace("${redirectUrl}")</script>`
     ).setMimeType(ContentService.MimeType.TEXT);
   }

  function verifyTurnstile(token, secret) {
    if (!token || !secret) return false;
    const response = UrlFetchApp.fetch("https://challenges.cloudflare.com/turnstile/v0/siteverify", {
      method: "post",
      payload: {
        secret,
        response: token,
      },
    });
    return JSON.parse(response.getContentText()).success === true;
  }
  ```

   Use this script as the destination pointed to by `PRIVATE_CONNECT_CARD_FORWARD_URL` so the built-in `/api/connect-card` proxy can append rows on your behalf. You can also deploy the script alone and set `PUBLIC_CONNECT_CARD_FORM_ACTION` directly to its URL if you prefer.

   - Store `PRIVATE_TURNSTILE_SECRET_KEY` in **Script Properties**.
   - Deploy as **Web App**: execute as yourself, access “Anyone with the link.”

3. Copy the Web App URL into your `.env` / environment as:

   ```
   PUBLIC_CONNECT_CARD_FORM_ACTION=https://script.google.com/macros/s/…/exec
   PUBLIC_TURNSTILE_SITE_KEY=… (same site key shown by Cloudflare)
   PRIVATE_TURNSTILE_SECRET_KEY=… (only in Apps Script)
   ```

4. Turnstile requires server-side verification. The script above checks `cf-turnstile-response` before writing and redirects users to `redirectUrl` (defaults to `/connect/connect-card/thank-you`).

### Optional: provider-based backend (Option B) or SSR

- If you prefer Formspree/Basin/etc., point `PUBLIC_CONNECT_CARD_FORM_ACTION` to the provider’s URL instead. Keep the same field names for consistent columns (you can use hidden inputs to rename if needed).
- When you later enable SSR hosting, implement `web/src/pages/api/connect-card.ts` to accept the form via `request.formData()`, validate Turnstile with `fetch("https://challenges.cloudflare.com/turnstile/v0/siteverify", ...)`, append to your backend datastore, and respond with a redirect/JSON success.

### Deploy checklist

1. Confirm the form page renders the Turnstile widget (requires `PUBLIC_TURNSTILE_SITE_KEY`).
2. Fill the form in the staging site and verify a row is added to the sheet within seconds.
3. Confirm the browser lands on `/connect/connect-card/thank-you` after submit.
4. Keep `PRIVATE_TURNSTILE_SECRET_KEY` secret (Apps Script only).

### Environment & protections

- The built-in `/api/connect-card` route fails closed if any of the required secrets (`PRIVATE_TURNSTILE_SECRET_KEY`, `PRIVATE_CONNECT_CARD_FORWARD_URL`, `PUBLIC_TURNSTILE_SITE_KEY`) are missing, so make sure your hosting environment defines them before going live.
- Use `CONNECT_CARD_NOTIFY_EMAILS` (comma-separated list) and `CONNECT_CARD_NOTIFY_FROM` to route email alerts via SendGrid, or set `CONNECT_CARD_NOTIFY_EMAILS` empty if you prefer forwarding only to your script.
- Rate limiting is not enforced inside the handler itself; protect the endpoint with your host’s edge rules (Cloudflare rate limiting, a WAF, or platform throttling) to guard against automated abuse before submissions reach the Turnstile check.
</file>

<file path="web/src/components/sections/WeeklyHighlights.astro">
---
import Button from "../ui/Button.astro";
import weeklyHighlights from "../../data/weekly-highlights";
import type { WeeklyHighlight } from "../../data/weekly-highlights";
import { recurringActivities } from "../../data/activities";

type HighlightConfig = WeeklyHighlight;

type HighlightCard = {
  id: string;
  title: string;
  description: string;
  tag?: string;
  timeLabel?: string;
  href?: string;
  ctaLabel: string;
  ctaExternal: boolean;
};

const highlightItems = weeklyHighlights
  .map((highlight: HighlightConfig) => {
    const source = recurringActivities.find((activity) => activity.id === highlight.activityId);
    if (!source) return null;

    const timePieces = [source.day, source.time].filter(Boolean);
    const timeLabel = timePieces.length ? timePieces.join(" · ") : undefined;
    const href = highlight.ctaHref ?? highlight.href ?? source.link;
    const ctaLabel = highlight.ctaLabel ?? "Learn more";
    const ctaExternal = typeof highlight.external === "boolean"
      ? highlight.external
      : typeof href === "string"
      ? /^https?:\/\//.test(href)
      : false;

    const card: HighlightCard = {
      id: source.id,
      title: highlight.title ?? source.title ?? highlight.text,
      description: highlight.description ?? source.cadence,
      tag: highlight.tag ?? source.category ?? undefined,
      timeLabel,
      href,
      ctaLabel,
      ctaExternal,
    };

    return card;
  })
  .filter((item): item is HighlightCard => Boolean(item));
---

{highlightItems.length > 0 ? (
  <section class="weekly-highlights" aria-label="Weekly highlights">
    <div class="weekly-highlights__header">
      <div>
        <p class="eyebrow">Weekly rhythm</p>
        <h2>This week at First Springfield</h2>
      </div>
      <p class="muted small">Swipe or scroll to explore the rhythm of worship and service.</p>
    </div>

    <div class="weekly-highlights__list" role="list">
      {highlightItems.map((item) => (
        <article class="weekly-highlights__card" role="listitem">
          {item.tag ? <span class="weekly-highlights__tag">{item.tag}</span> : null}
          <h3>{item.title}</h3>
          <p class="muted">{item.description}</p>
          {item.timeLabel ? (
            <p class="weekly-highlights__time muted">{item.timeLabel}</p>
          ) : null}
          {item.href ? (
            <Button href={item.href} variant="tertiary" size="sm" external={item.ctaExternal}>
              {item.ctaLabel}
            </Button>
          ) : null}
        </article>
      ))}
    </div>
  </section>
) : null}

<style>
  .weekly-highlights > * {
    margin: 0;
  }

  .weekly-highlights__header {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .weekly-highlights__list {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: minmax(240px, 1fr);
    gap: var(--space-4);
    overflow-x: auto;
    padding-bottom: var(--space-2);
    scroll-snap-type: x proximity;
    -webkit-overflow-scrolling: touch;
  }

  .weekly-highlights__list::-webkit-scrollbar {
    height: 0.35rem;
  }

  .weekly-highlights__card {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    padding: var(--space-4);
    background: var(--color-surface);
    box-shadow: var(--shadow-1);
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    min-height: 220px;
    scroll-snap-align: start;
  }

  .weekly-highlights__tag {
    font-size: 0.8rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-weight: 700;
    color: var(--color-text-muted);
  }

  .weekly-highlights__time {
    font-size: 0.95rem;
  }

  @media (min-width: 960px) {
    .weekly-highlights__list {
      grid-auto-flow: unset;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      overflow-x: visible;
    }
  }
</style>
</file>

<file path="web/src/content/events/sabbath-service.md">
---
title: "Sabbath Worship Service"
summary: "Join us each Sabbath for worship, prayer, and a message. Visitors are always welcome."
start: "2026-01-10T11:15:00-05:00"
end: "2026-01-10T12:45:00-05:00"
locationName: "First Springfield Seventh-day Adventist Church"
tags: ["worship", "sabbath"]
---

## What to expect

- A warm welcome
- Congregational singing
- Scripture and message

## Who can come?

Everyone. Come as you are.
</file>

<file path="web/src/content/ministries/mens-ministry.md">
---
title: "Men's Ministry"
summary: "Brotherhood, prayer, and service to strengthen men of faith."
leaderName: "Men's Ministry Team"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Fridays at 7:00 PM"
category: "Men"
tags: ["men", "fellowship", "service"]
---

## Overview

We gather for encouragement, prayer, and practical ways to serve families and the church.

## How to get involved

Reach out to the leader or show up on a Friday night.
</file>

<file path="web/src/content/ministries/secretary-communications.md">
---
title: "Secretary/Communications"
summary: "Keeps the church informed through weekly publications, office records, and member communication."
leaderName: "Secretary/Communications Team"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Produce weekly bulletin and announcements"
category: "Leadership"
tags: ["communications", "administration", "office"]
---

## Secretary/Communications

Church Clerk: Myrna L Leiper

Assistant Bulletin Secretary: Loreli Gaetki

This team keeps office records straight, shepherds member communication, and stewards the weekly bulletin that links congregants to worship plans, volunteer needs, and outreach invites. We coordinate with pastors, ministry leads, and volunteers so every voice is represented in print and online.

### Weekly updates

- [Add weekly bulletin (link)](/resources/bulletins)
- [Add weekly announcements (link)](/resources/announcements)

Need to send an announcement, update attendance, or ask a question about the bulletin? Reach out at the church office email above and we will walk you through the submission window for the coming Sabbath.

### Secretary page upgrade (paid add-on)

- Goal: build a dedicated Secretary/Communications page that highlights the office team, provides quick links to weekly bulletins and announcements, and surfaces the forms or contact points people use when they need to submit news, request a room, or update attendance.
- Deliverables to capture once available:
  1. Hero headline + description that frames the communications ministry and the secretary’s role.
  2. Contact block with office hours, phone/email, and a “submit an announcement” CTA linked to the existing bulletin/announcements workflow.
  3. Download links or embeds for the weekly bulletin/announcement PDFs (pulled from `/bulletins`).
  4. Accessibility/access instructions plus any additional microcopy the vendor was asked to provide.
- Keep this section updated with finalized copy or design notes so the vendor can replace the temporary placeholder content as soon as the assets arrive.
</file>

<file path="web/src/data/weekly-highlights.ts">
export type WeeklyHighlight = {
  activityId?: string;
  text: string;
  href?: string;
  badge?: string;
  tag?: string;
  title?: string;
  description?: string;
  ctaHref?: string;
  ctaLabel?: string;
  external?: boolean;
};

const weeklyHighlights: WeeklyHighlight[] = [
  {
    activityId: "prayer-meeting",
    text: "Prayer Meeting · Wednesdays at 7:00 PM · Church annex + Zoom",
    href: "/connect/prayer",
    badge: "This week",
  },
  {
    activityId: "nar-anon",
    text: "Nar-Anon · Thursdays at 7:00 PM – 8:30 PM in the Mother’s room",
    badge: "Support",
  },
  {
    activityId: "table-talk",
    text: "Table Talk · Second Sabbath of every month · Youth conversations after worship",
    badge: "Table Talk",
    href: "/ministries/youth-young-adults",
  },
  {
    activityId: "pathfinders",
    text: "Pathfinders & Adventurers · 1st & 3rd Sabbaths · 3:00 PM – 5:00 PM",
    href: "/ministries/pathfinders",
  },
  {
    activityId: "mens-fellowship",
    text: "Men's Fellowship · Fridays at 7:00 PM in the church annex for Bible study, prayer, and brotherhood",
    badge: "Men's Fellowship",
  },
  {
    activityId: "bible-study",
    text: "Bible Study · Fourth Sabbath deeper dive for all ages",
    href: "/ministries/bible-study",
  },
];

export default weeklyHighlights;
</file>

<file path="web/src/pages/connect/about/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { site } from "../../../data/site";

const { mission } = site;
---

<BaseLayout title="About Us" description={`About ${site.name} in Springfield, Massachusetts.`}>
  <div class="stack">
    <h1>About Us</h1>

    <section class="card stack--tight">
      <p class="muted">
        Our church is a vibrant, multicultural community located in the heart of Springfield, the
        third-largest city in the Commonwealth of Massachusetts. As of 2024, Springfield has an
        estimated population of approximately 154,888 residents, with around 25% living below the
        federal poverty line. Our church serves as a welcoming and safe haven for immigrants, refugees,
        and all who seek spiritual support and community.
      </p>
    </section>

    <section class="card stack--tight">
      <h2>Our Mission</h2>
      <p class="muted">
        {mission.statement}
      </p>
    </section>

    <section class="card stack--tight">
      <h2>Our Method</h2>
      <p class="muted">{mission.method}</p>
    </section>

    <section class="card stack--tight">
      <h2>Our Vision</h2>
      <p class="muted">
        {mission.vision}
      </p>
    </section>

    <section class="card stack--tight">
      <h2>Who We Are</h2>
      <p class="muted">
        We are a Christian faith community that is part of the worldwide Seventh-day Adventist Church.
        Rooted in the Bible and centered on Jesus Christ, we seek to reflect God’s love through worship,
        service, and community outreach.
      </p>

      <p class="muted">
        As Seventh-day Adventists, we value spiritual growth, healthy living, strong families, and
        compassionate service. We believe the church is not just a building, but a people called to live
        out their faith daily, serving God and our community with humility, integrity, and purpose.
      </p>

      <p class="muted">
        We welcome individuals and families from all backgrounds to join us as we grow in faith, study
        God’s Word, and prepare for the return of Jesus Christ.
      </p>
    </section>

    <section class="card stack--tight">
      <h2>What We Believe</h2>
      <p class="muted">
        Seventh-day Adventists accept the Bible as the inspired Word of God and base our beliefs on its
        teachings. Our core beliefs include:
      </p>

      <ul class="muted">
        <li>
          God – One God: Father, Son, and Holy Spirit, a loving Creator who desires a personal
          relationship with every person.
        </li>
        <li>
          Jesus Christ – Fully God and fully human, whose life, death, and resurrection provide
          salvation and hope for all.
        </li>
        <li>The Bible – God’s authoritative revelation of His will and truth.</li>
        <li>Salvation – A gift of grace received through faith in Jesus Christ, not by works.</li>
        <li>
          The Sabbath – The seventh day of the week, Saturday, observed as a sacred day of rest, worship,
          and fellowship.
        </li>
        <li>
          The Church – A community of believers called to worship God, support one another, and share
          the gospel.
        </li>
        <li>
          Health and Wholeness – A holistic approach to life that honors God by caring for the body,
          mind, and spirit.
        </li>
        <li>
          The Second Coming – The personal, visible return of Jesus Christ, which is the blessed hope of
          the church.
        </li>
      </ul>

      <p class="muted">
        We seek to live out these beliefs with love, compassion, and faithfulness as we serve God and
        others.
      </p>

      <p class="muted">
        Learn more about Adventist beliefs at{" "}
        <a href="https://www.adventist.org/beliefs/" target="_blank" rel="noopener noreferrer">
          adventist.org
        </a>
        .
      </p>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/connect/team/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { site } from "../../../data/site";
import { mailto } from "../../../lib/links";

const isFilled = (value?: string) => Boolean(value && value.trim() && value !== "TBD");
const fallbackName = "Contact us";
const fallbackHref = "/connect/contact";
const fallbackLabel = "Contact us for current details.";
---

<BaseLayout title="Our Team" description={`Meet the leadership and ministry contacts at ${site.name}.`}>
  <div class="stack">
    <h1>Our Team</h1>

    <section class="card stack">
      <h2>Leadership</h2>
      <p class="muted">
        For most questions, starting with the Pastor or Head Elder is a great first step.
      </p>

      <div class="table">
        <div class="row head">
          <div>Role</div>
          <div>Name</div>
          <div>Contact</div>
        </div>

        {(site.leadershipTeam ?? []).map((m) => {
          const name = isFilled(m.name) ? m.name : fallbackName;
          const email = isFilled(m.email) ? m.email : "";

          return (
            <div class="row">
              <div>{m.role}</div>
              <div>{name}</div>
              <div>
                {email ? (
                  <a href={mailto(email, `${m.role} - ${site.shortName}`)}>{email}</a>
                ) : (
                  <a class="link" href={fallbackHref}>{fallbackLabel}</a>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </section>

    <section class="card stack">
      <h2>Ministry Leads</h2>
      <p class="muted">
        Reach out to the ministry lead closest to your question, or use the general email if you’re not sure.
      </p>

      <div class="table">
        <div class="row head">
          <div>Ministry</div>
          <div>Name</div>
          <div>Contact</div>
        </div>

        {(site.ministryLeads ?? []).map((m) => {
          const name = isFilled(m.name) ? m.name : fallbackName;
          const email = isFilled(m.email) ? m.email : "";

          return (
            <div class="row">
              <div>{m.role}</div>
              <div>{name}</div>
              <div>
                {email ? (
                  <a href={mailto(email, `${m.role} - ${site.shortName}`)}>{email}</a>
                ) : (
                  <a class="link" href={fallbackHref}>{fallbackLabel}</a>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </section>

    <section class="card stack">
      <h2>Who to contact for what</h2>
      <p class="muted">
        Not sure who to reach? Start with one of these.
      </p>

      <div class="table">
        <div class="row head">
          <div>Topic</div>
          <div>Contact</div>
          <div>How</div>
        </div>

        {(site.contactTopics ?? []).map((t) => {
          const topicHref = isFilled(t.href) ? t.href : "";
          const topicEmail = isFilled(t.email) ? t.email : "";

          return (
            <div class="row">
              <div>{t.topic}</div>
              <div>{t.contactRole}</div>
              <div class="stack--tight">
                {topicHref ? (
                  <a
                    href={topicHref}
                    target={t.external ? "_blank" : undefined}
                    rel={t.external ? "noopener noreferrer" : undefined}
                  >
                    {t.hrefLabel ?? "Open"}
                  </a>
                ) : topicEmail ? (
                  <a href={mailto(topicEmail, `${t.topic} - ${site.shortName}`)}>{topicEmail}</a>
                ) : (
                  <a class="link" href={fallbackHref}>{fallbackLabel}</a>
                )}
                {t.note ? <div class="small muted">{t.note}</div> : null}
              </div>
            </div>
          );
        })}
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .table {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-2);
    overflow: hidden;
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: var(--space-4);
    padding: var(--space-3) var(--space-4);
    border-top: 1px solid var(--color-border);
    background: var(--color-white);
  }

  .row.head {
    border-top: none;
    background: var(--color-bg);
    font-weight: 800;
  }

  .muted {
    color: var(--color-text-muted);
  }

  .small {
    font-size: 0.95rem;
  }

  @media (max-width: 720px) {
    .row {
      grid-template-columns: 1fr;
      gap: var(--space-2);
    }
  }
</style>
</file>

<file path="web/src/pages/join/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CardGrid from "../../components/sections/CardGrid.astro";
import { site } from "../../data/site";
---

<BaseLayout title="Join" description={`Plan your first visit, learn what to expect, and get connected at ${site.name}.`}>
  <div class="stack">
    <h1>Join</h1>

    <CardGrid
      title="Start here"
      cards={[
        {
          title: "Plan a Visit",
          description: "Service times, directions, and what to expect.",
          href: "/connect/plan-a-visit"
        },
        {
          title: "Worship With Us",
          description: "Learn what our weekly services are like.",
          href: "/connect/worship-with-us"
        },
        {
          title: "Contact",
          description: "Phone, email, and how to reach us.",
          href: "/connect/contact"
        }
      ]}
    />
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/ministries/index.astro">
---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import ContentCard from '../../components/content/ContentCard.astro';
import { getCollection } from 'astro:content';

const ministries = await getCollection('ministries', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const sorted = ministries.sort((a, b) => a.data.title.localeCompare(b.data.title));
const grouped = sorted.reduce(
  (acc, ministry) => {
    const category = ministry.data.category ?? "Other";
    if (!acc[category]) acc[category] = [];
    acc[category].push(ministry);
    return acc;
  },
  {} as Record<string, typeof sorted>
);
const categoryOrder = [
  "Children & Youth",
  "Men",
  "Women",
  "Outreach",
  "Bible Study",
  "Leadership",
  "Other",
];
const orderedCategories = [
  ...categoryOrder.filter((category) => grouped[category]?.length),
  ...Object.keys(grouped)
    .filter((category) => !categoryOrder.includes(category))
    .sort((a, b) => a.localeCompare(b)),
];
---

<BaseLayout title="Ministries" description="Ways to serve and grow together.">
  <Hero title="Ministries" subtitle="Find a place to belong and serve." />

  <section class="stack">
    {sorted.length === 0 ? (
      <p class="muted">No ministries are published yet.</p>
    ) : (
      orderedCategories.map((category) => (
        <section class="stack--tight">
          <h2>{category}</h2>
          <div class="grid--cards">
            {grouped[category].map((m) => (
              <ContentCard
                href={`/ministries/${m.id}`}
                title={m.data.title}
                summary={m.data.summary}
                tags={m.data.tags}
              />
            ))}
          </div>
        </section>
      ))
    )}
  </section>
</BaseLayout>
</file>

<file path="web/src/pages/resources/announcements/archive/[yyyy]/[mm].astro">
---
import BaseLayout from "../../../../../layouts/BaseLayout.astro";
import Button from "../../../../../components/ui/Button.astro";
import ContentCard from "../../../../../components/content/ContentCard.astro";
import { site } from "../../../../../data/site";
import { announcementTagLabels } from "../../../../../data/announcement-tags";
import {
  getArchiveMonths,
  getSortedAnnouncements,
} from "../../../../../lib/announcements";

export async function getStaticPaths() {
  const announcements = await getSortedAnnouncements({ includeExpired: true });
  const months = getArchiveMonths(announcements);
  return months.map(({ year, month }) => ({
    params: {
      yyyy: String(year),
      mm: String(month).padStart(2, "0"),
    },
  }));
}

const { yyyy, mm } = Astro.params;
const year = Number(yyyy);
const month = Number(mm);
if (Number.isNaN(year) || Number.isNaN(month)) {
  throw new Error(`Invalid archive path: ${yyyy}/${mm}`);
}

const announcements = await getSortedAnnouncements({ includeExpired: true });
const filtered = announcements.filter(
  (entry) =>
    entry.data.date.getFullYear() === year && entry.data.date.getMonth() + 1 === month
);
const metaFormatter = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone,
});
const monthLabel = new Intl.DateTimeFormat(site.locale, {
  month: "long",
  year: "numeric",
  timeZone: site.timeZone,
}).format(new Date(year, month - 1, 1));
const archiveMonths = getArchiveMonths(announcements);
const updatesUrl = "/updates";
const rssUrl = "/resources/announcements/rss.xml";
---

<BaseLayout title={`Announcements · ${monthLabel}`}>
  <div class="stack">
    <h1>Announcements archive · {monthLabel}</h1>
    <p class="muted">
      {filtered.length === 0
        ? "No announcements published during this month."
        : `${filtered.length} announcement${filtered.length === 1 ? "" : "s"} in ${monthLabel}.`}
    </p>
    <div class="cluster">
      <Button href="/resources/announcements" variant="tertiary">Back to announcements</Button>
      <Button href={updatesUrl} variant="tertiary">Visit updates page</Button>
      <Button href={rssUrl} variant="tertiary" size="sm">Subscribe via RSS</Button>
    </div>

    {filtered.length === 0 ? null : (
      <div class="grid--cards">
        {filtered.map((entry) => (
          <ContentCard
            href={`/resources/announcements/${entry.id}`}
            title={entry.data.title}
            summary={entry.data.summary}
            meta={metaFormatter.format(entry.data.date)}
            tags={entry.data.tags?.map((value) => announcementTagLabels[value] ?? value)}
          />
        ))}
      </div>
    )}

    <section class="card stack--tight">
      <h2>Archive by month</h2>
      {archiveMonths.length === 0 ? (
        <p class="muted">No archived months yet.</p>
      ) : (
        <ul class="archive-list">
          {archiveMonths.map(({ year: archiveYear, month: archiveMonth, label }) => (
            <li>
              <a
                class="link"
                href={`/resources/announcements/archive/${archiveYear}/${String(archiveMonth).padStart(2, "0")}`}
              >
                {label}
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>
  </div>
</BaseLayout>

<style>
  .archive-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .archive-list li {
    min-width: 180px;
  }
</style>
</file>

<file path="web/src/pages/resources/announcements/[id].astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import { getEntry, render } from "astro:content";
import { site } from "../../../data/site";
import { announcementTagLabels } from "../../../data/announcement-tags";
import { getArchiveMonths, getSortedAnnouncements } from "../../../lib/announcements";

export async function getStaticPaths() {
  const announcements = await getSortedAnnouncements();
  return announcements.map((entry) => ({ params: { id: entry.id } }));
}

const { id } = Astro.params;
const announcement = await getEntry("announcements", id);
if (!announcement) {
  throw new Error(`Announcement not found: ${id}`);
}

const { Content } = await render(announcement);
const dateFormatter = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "full",
  timeZone: site.timeZone,
});
const monthPath = `/resources/announcements/archive/${announcement.data.date.getFullYear()}/${String(
  announcement.data.date.getMonth() + 1
).padStart(2, "0")}`;
const archiveMonths = getArchiveMonths(await getSortedAnnouncements({ includeExpired: true }));
const updatesUrl = "/updates";
const rssUrl = "/resources/announcements/rss.xml";
const tags = announcement.data.tags?.map((value) => announcementTagLabels[value] ?? value) ?? [];
---

<BaseLayout title={announcement.data.title} description={announcement.data.summary}>
  <div class="stack">
    <h1>{announcement.data.title}</h1>
    <p class="muted">{announcement.data.summary}</p>
    <p class="muted">
      {dateFormatter.format(announcement.data.date)} ·{" "}
      <a class="link" href={monthPath}>View this month</a>
    </p>
    {tags.length > 0 && (
      <ul class="chip-list">
        {tags.map((tag) => (
          <li>
            <span class="chip chip--readonly">{tag}</span>
          </li>
        ))}
      </ul>
    )}

    <section class="card">
      <div class="prose">
        <Content />
      </div>
    </section>

    <div class="cluster">
      <Button href="/resources/announcements" variant="tertiary">Back to announcements</Button>
      <Button href={updatesUrl} variant="tertiary">Visit updates page</Button>
      <Button href={rssUrl} variant="tertiary" size="sm">Subscribe via RSS</Button>
    </div>

    <section class="card stack--tight">
      <h2>Archive by month</h2>
      {archiveMonths.length === 0 ? (
        <p class="muted">No archived months yet.</p>
      ) : (
        <ul class="archive-list">
          {archiveMonths.map(({ year, month, label }) => (
            <li>
              <a class="link" href={`/resources/announcements/archive/${year}/${String(month).padStart(2, "0")}`}>
                {label}
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>
  </div>
</BaseLayout>

<style>
  .chip-list {
    list-style: none;
    display: flex;
    gap: var(--space-2);
    padding: 0;
    margin: 0;
  }

  .chip--readonly {
    border-color: transparent;
    background: color-mix(in oklab, var(--color-surface) 85%, black 15%);
  }

  .archive-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .archive-list li {
    min-width: 180px;
  }
</style>
</file>

<file path="web/src/pages/resources/bulletins/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import Card from "../../../components/ui/Card.astro";
import CardGrid from "../../../components/ui/CardGrid.astro";
import { site } from "../../../data/site";
import { getCollection } from "astro:content";

const bulletins = await getCollection("bulletins", ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const sorted = bulletins.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const current = sorted[0];
const archive = sorted.slice(1);

const fmt = new Intl.DateTimeFormat(site.locale, { dateStyle: "full", timeZone: site.timeZone });
---

<BaseLayout title="Bulletins" description="Weekly bulletins and archives.">
  <div class="stack">
    <h1>Bulletins</h1>
    <p class="muted">Weekly PDFs and an archive.</p>

    {sorted.length === 0 ? (
      <section class="card stack--tight">
        <p class="muted">No bulletins have been posted yet.</p>
      </section>
    ) : (
      <>
        <section class="card stack" aria-labelledby="bulletins-current">
          <h2 id="bulletins-current">Current bulletin</h2>
          <p class="muted">
            {current.data.title} • {fmt.format(current.data.date)}
          </p>
          {current.data.summary && (
            <p class="muted">{current.data.summary}</p>
          )}

          <div class="cluster">
            <Button href={current.data.pdfUrl} variant="secondary">Open PDF</Button>
          </div>
        </section>

        <section class="stack--tight" aria-labelledby="bulletins-archive">
          <h2 id="bulletins-archive">Archive</h2>

          {archive.length === 0 ? (
            <p class="muted">No archived bulletins yet.</p>
          ) : (
            <CardGrid columnsMin={260}>
              {archive.map((b) => (
                <Card
                  title={b.data.title}
                  description={fmt.format(b.data.date)}
                  href={b.data.pdfUrl}
                />
              ))}
            </CardGrid>
          )}
        </section>
      </>
    )}

    <p class="small muted">
      For church members: if you need a bulletin from a past week that isn’t listed, please contact the church.
    </p>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/resources/forms/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import CardGrid from "../../../components/ui/CardGrid.astro";
import Card from "../../../components/ui/Card.astro";
import { site } from "../../../data/site";

const phoneHref = `tel:${site.contact.phone.replace(/[^0-9+]/g, "")}`;

const hasPrayerForm = site.portals.prayerFormUrl && site.portals.prayerFormUrl !== "TBD";
const hasContactForm = site.portals.contactFormUrl && site.portals.contactFormUrl !== "TBD";
const hasVolunteerForm = site.portals.volunteerFormUrl && site.portals.volunteerFormUrl !== "TBD";
---

<BaseLayout title="Forms" description="Official request and signup forms.">
  <div class="stack">
    <h1>Forms</h1>
    <p class="muted">
      Official request and signup forms. If a form is not available, you can always contact the church.
    </p>

    <section class="card stack" aria-labelledby="forms-help">
      <h2 id="forms-help">Need help right now?</h2>
      <p class="muted">
        Call us at <a href={phoneHref}>{site.contact.phone}</a> or visit the <a href="/connect/contact">Contact</a> page.
      </p>
    </section>

    <section class="stack" aria-labelledby="forms-list">
      <h2 id="forms-list">Available forms</h2>

      <CardGrid columnsMin={260}>
        {hasPrayerForm && (
          <Card
            title="Prayer Request"
            description="Share a prayer request. Optionally ask for follow-up."
            href={site.portals.prayerFormUrl}
          />
        )}

        {hasContactForm && (
          <Card
            title="Contact / Questions"
            description="Send a message to the church."
            href={site.portals.contactFormUrl}
          />
        )}

        {hasVolunteerForm && (
          <Card
            title="Volunteer interest"
            description="Let us know how you’d like to serve."
            href={site.portals.volunteerFormUrl}
          />
        )}

        {(!hasPrayerForm || !hasContactForm || !hasVolunteerForm) && (
          <Card
            title="Other requests"
            description="If you don’t see a form you need, contact us and we’ll help."
            href="/connect/contact"
          />
        )}
      </CardGrid>

      <div class="cluster">
        {hasPrayerForm && (
          <Button href={site.portals.prayerFormUrl} external variant="secondary">Open prayer form</Button>
        )}
        {hasVolunteerForm && (
          <Button href={site.portals.volunteerFormUrl} external variant="secondary">Open volunteer form</Button>
        )}
      </div>

      <p class="small muted">
        Privacy note: only share information you’re comfortable sharing with a church prayer/team inbox.
      </p>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/search/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Hero from "../../components/ui/Hero.astro";
import Search from "astro-pagefind/components/Search";
---

<BaseLayout
  title="Search"
  description="Search pages, resources, and bulletins."
  noIndex={true}
>
  <div class="stack">
    <Hero title="Search" subtitle="Search resources, bulletins, and site pages." />

    <section aria-label="Site search" class="card stack">
      <label id="site-search-label" for="site-search-input" class="form-label">
        Search the site
      </label>

      <div>
        {/* astro-pagefind expects an id so it can mount Pagefind UI into this element */}
        <Search
          id="site-search"
          className="pagefind-ui"
          uiOptions={{
            showImages: false,
            showSubResults: true,
            excerptLength: 20,
            resetStyles: false,
            placeholder: "Search the site…",
          }}
        />
      </div>

      <script is:inline>
        {String.raw`(() => {
          const ROOT_ID = "site-search";
          const LABEL_ID = "site-search-label";
          const INPUT_ID = "site-search-input";

          const root = document.getElementById(ROOT_ID);
          if (!root) return;

          const ensureLabel = () => {
            const input = root.querySelector("input.pagefind-ui__search-input");
            if (!input) return false;

            // Tie visible <label> to the generated input
            input.id = INPUT_ID;
            input.setAttribute("aria-labelledby", LABEL_ID);

            // Also give it a direct accessible name (so it's never title-only)
            input.setAttribute("aria-label", "Search the site");

            // Title can exist, but we remove it to avoid "title-only" naming paths
            input.removeAttribute("title");

            return true;
          };

          // Try immediately
          if (ensureLabel()) return;

          // Keep watching until Pagefind mounts (no tiny timeout)
          const obs = new MutationObserver(() => {
            if (ensureLabel()) obs.disconnect();
          });

          obs.observe(root, { childList: true, subtree: true });

          // Safety valve: stop watching after 60s (prevents runaway observers)
          setTimeout(() => obs.disconnect(), 60_000);
        })();`}
      </script>


      <details class="small muted stack--tight">
        <summary>How search works</summary>
        <p>
          Search runs in your browser using a static index generated at build time.
          Your search terms are not sent to the site server.
        </p>
      </details>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/serve/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CardGrid from "../../components/sections/CardGrid.astro";
import { site } from "../../data/site";
---

<BaseLayout title="Serve" description={`Find a place to belong, serve, and grow with ${site.name}.`}>
  <div class="stack">
    <h1>Serve</h1>

    <CardGrid
      title="Get involved"
      cards={[
        {
          title: "Volunteer",
          description: "Find a place to serve based on your interests.",
          href: "/resources/forms"
        },
        {
          title: "Prayer Request",
          description: "Join our prayer ministry or submit a request.",
          href: "/connect/prayer"
        },
        {
          title: "Contact",
          description: "Reach out and we’ll help you get connected.",
          href: "/connect/contact"
        }
      ]}
    />
  </div>
</BaseLayout>
</file>

<file path="web/src/styles/a11y.css">
/* Accessibility helpers layered on top of global.css */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
</file>

<file path="web/test-results/.last-run.json">
{
  "status": "passed",
  "failedTests": []
}
</file>

<file path="web/tests/e2e/mobile.smoke.spec.ts">
import { test, expect } from "@playwright/test";

test.describe("Smoke - mobile device", () => {
  test("mobile header nav and primary CTA stay accessible on home", async ({
    page,
  }) => {
    await page.goto("/");
    await expect(
      page.locator("header.site-header nav.nav--desktop"),
    ).toBeVisible();
    await expect(
      page.getByRole("link", { name: "Give", exact: true }),
    ).toBeVisible();
    await expect(
      page.getByRole("link", { name: "Watch Live", exact: true }),
    ).toBeVisible();
  });

  test("visit page loads key content and CTA", async ({ page }) => {
    await page.goto("/visit");
    await expect(page.getByRole("heading", { level: 1 })).toBeVisible();
    await expect(page.locator("main")).toContainText(
      /parking|directions|address/i,
    );
    await expect(page.getByRole("link", { name: /give/i })).toBeVisible();
  });
});
</file>

<file path="web/tests/e2e/phase-5-media-portals.spec.ts">
import { expect, test } from "@playwright/test";

test("Media hub loads", async ({ page }) => {
  await page.goto("/media");
  await expect(
    page.getByRole("heading", { name: "Media", exact: true }),
  ).toBeVisible();

  const quickLinks = page.getByRole("region", { name: "Quick links" });
  await expect(
    quickLinks.getByRole("link", { name: "Watch Live", exact: true }),
  ).toBeVisible();
  await expect(
    quickLinks.getByRole("link", { name: "Videos", exact: true }),
  ).toBeVisible();
});

test("Live page loads", async ({ page }) => {
  await page.goto("/media/live");
  await expect(
    page.getByRole("heading", { name: "Watch Live", exact: true }),
  ).toBeVisible();
  await expect(
    page.getByRole("link", { name: "Open YouTube channel", exact: true }),
  ).toBeVisible();
});

test("Videos page loads", async ({ page }) => {
  await page.goto("/media/videos");
  await expect(
    page.getByRole("heading", { name: "Videos", exact: true }),
  ).toBeVisible();
  await expect(
    page.getByRole("link", { name: "Browse on YouTube", exact: true }),
  ).toBeVisible();
});

test("Bulletins page loads", async ({ page }) => {
  await page.goto("/resources/bulletins");
  await expect(
    page.getByRole("heading", { name: "Bulletins", exact: true }),
  ).toBeVisible();
});

test("Forms directory loads", async ({ page }) => {
  await page.goto("/resources/forms");
  await expect(
    page.getByRole("heading", { name: "Forms", exact: true }),
  ).toBeVisible();
});
</file>

<file path="web/tests/e2e/phase-6-search-and-analytics.spec.ts">
import { expect, test } from "playwright/test";

test("Search page loads", async ({ page }) => {
  await page.goto("/search");
  await expect(
    page.getByRole("heading", { name: "Search", exact: true }),
  ).toBeVisible();

  // Astro Pagefind <Search id="site-search" ... /> should render an input inside this container.
  const input = page.locator("#site-search input");
  await expect(input).toBeVisible({ timeout: 10_000 });
});

test("Search returns results for a common term", async ({ page }) => {
  // This test is intentionally loose to reduce flakiness.
  // It just verifies that results can render.
  await page.goto("/search");

  const input = page.locator("#site-search input");
  await expect(input).toBeVisible({ timeout: 10_000 });

  await input.fill("resources");

  // Pagefind UI renders results asynchronously.
  // Wait for at least one result link to appear inside the Pagefind root.
  const firstResultLink = page.locator("#site-search a[href]").first();
  await expect(firstResultLink).toBeVisible({ timeout: 10_000 });
});
</file>

<file path="web/tests/e2e/phase-7-seo.spec.ts">
import { expect, test } from "@playwright/test";

const PAGES: Array<{ path: string; robots: string }> = [
  { path: "/", robots: "index,follow" },
  { path: "/connect/plan-a-visit", robots: "index,follow" },
  { path: "/connect/team", robots: "index,follow" },
  { path: "/events", robots: "index,follow" },
  { path: "/resources", robots: "index,follow" },
  { path: "/media", robots: "index,follow" },
  { path: "/search", robots: "noindex,follow" },
];

for (const { path, robots } of PAGES) {
  test(`seo meta - ${path}`, async ({ page }) => {
    await page.goto(path);

    await expect(page).toHaveTitle(/.+/);

    await expect(page.locator('meta[name="description"]')).toHaveAttribute(
      "content",
      /.+/,
    );

    const canonical = page.locator('link[rel="canonical"]');
    const canonicalHref = await canonical.getAttribute("href");
    expect(canonicalHref).toBeTruthy();
    expect(canonicalHref!).toContain(path);

    await expect(page.locator('meta[property="og:title"]')).toHaveAttribute(
      "content",
      /.+/,
    );

    await expect(page.locator('meta[name="robots"]')).toHaveAttribute(
      "content",
      robots,
    );
  });
}
</file>

<file path="web/tests/e2e/smoke.spec.ts">
import { test, expect } from "@playwright/test";

test.describe("Smoke - cross browser", () => {
  test("home renders primary navigation and CTA", async ({ page }) => {
    await page.goto("/");
    await expect(page.locator("header.site-header")).toBeVisible();
    await expect(
      page.getByRole("link", { name: "Watch Live", exact: true }),
    ).toBeVisible();
    await expect(
      page.getByRole("link", { name: "Give", exact: true }),
    ).toBeVisible();
  });

  test("plan a visit page loads key content", async ({ page }) => {
    await page.goto("/visit");
    await expect(page.getByRole("heading", { level: 1 })).toBeVisible();
    await expect(page.locator("main")).toContainText(
      /parking|directions|address/i,
    );
  });
});
</file>

<file path="web/.env.example">
# Connect Card configuration
# These values must be populated before using the built-in connect card backend.
PUBLIC_CONNECT_CARD_FORM_ACTION=
PUBLIC_TURNSTILE_SITE_KEY=
PRIVATE_TURNSTILE_SECRET_KEY=
PRIVATE_CONNECT_CARD_FORWARD_URL=
CONNECT_CARD_NOTIFY_EMAILS=
CONNECT_CARD_NOTIFY_FROM=firstspringfieldsda@gmail.com
CONNECT_CARD_SENDGRID_API_KEY=
PUBLIC_PRAYER_MEETING_ZOOM_URL=

# Future use (Phase 5+)
# PUBLIC_SITE_URL=https://example.com
PUBLIC_CF_ANALYTICS_TOKEN=
</file>

<file path=".gitignore">
# Node
node_modules/
web/node_modules.bak/

# Astro
web/dist/
web/.astro/
web/.wrangler/tmp/

# OS
.DS_Store
</file>

<file path=".repomixignore">
*.d.ts
*.svg
web/.lighthouseci
web/.wrangler
package/
</file>

<file path="web/.github/workflows/ci.yml">
name: CI

on:
  pull_request:
  push:
    branches: ["main", "master"]

jobs:
  web:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: web

    env:
      # Ensures canonical URLs + sitemap/robots generation are deterministic in CI
      PUBLIC_SITE_URL: http://127.0.0.1:4321

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
          cache-dependency-path: web/package-lock.json

      - name: Install dependencies
        run: npm ci

      - name: Typecheck
        run: npm run check

      - name: Build
        run: npm run build

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: E2E tests
        run: npm run test:e2e:ci

      - name: Internal link check
        run: npm run test:links:ci

      - name: Lighthouse CI
        run: npm run lighthouse:ci

      - name: Upload Lighthouse artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: lighthouseci
          path: web/.lighthouseci

      - name: Upload Playwright report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: web/playwright-report
</file>

<file path="web/src/components/global/SiteAlert.astro">
---
import Button from "../ui/Button.astro";
import { site } from "../../data/site";

type SiteAlertVariant = "info" | "warn";

type Props = {
  title: string;
  message: string;
  href?: string;
  variant?: SiteAlertVariant;
  updatedAt?: string;
  announce?: boolean;
  ctaLabel?: string;
  ctaExternal?: boolean;
  hideCta?: boolean;
};

const {
  title,
  message,
  href,
  variant = "info",
  updatedAt,
  announce = true,
  ctaLabel,
  ctaExternal = false,
  hideCta = false,
} = Astro.props as Props;

const alertHref = href ?? "/updates";

const locale = site.locale ?? "en-US";
const timeZone = site.timeZone ?? "UTC";

const parsedDate = updatedAt ? new Date(updatedAt) : null;
const formattedDate = parsedDate && !Number.isNaN(parsedDate.valueOf())
  ? new Intl.DateTimeFormat(locale, { dateStyle: "medium", timeZone }).format(parsedDate)
  : null;

const roleAttribute = announce ? "status" as const : undefined;
const ariaLiveAttribute = announce ? "polite" as const : undefined;
const ariaAtomicAttribute = announce ? "true" as const : undefined;

const iconMap: Record<SiteAlertVariant, string> = {
  info: "ℹ️",
  warn: "⚠️",
};

const iconSymbol = iconMap[variant];
const ctaText = ctaLabel ?? "See updates";
const showActions = Boolean(formattedDate || (alertHref && !hideCta));
const rootClass = `site-alert site-alert--${variant}`;
---

<section
  class={rootClass}
  role={roleAttribute}
  aria-live={ariaLiveAttribute}
  aria-atomic={ariaAtomicAttribute}
>
  <span class="site-alert__icon" aria-hidden="true">{iconSymbol}</span>
  <div class="site-alert__body">
    <p class="site-alert__heading">{title}</p>
    <p class="site-alert__message">{message}</p>
  </div>
  {showActions ? (
    <div class="site-alert__actions">
      {formattedDate ? (
        <p class="site-alert__meta">Updated {formattedDate}</p>
      ) : null}
      {alertHref && !hideCta ? (
        <Button href={alertHref} variant="secondary" size="sm" external={ctaExternal}>
          {ctaText}
        </Button>
      ) : null}
    </div>
  ) : null}
</section>

<style>
  .site-alert {
    width: min(100%, var(--container-max));
    margin: 0 auto var(--space-6);
    padding: var(--space-4) var(--container-pad);
    border-radius: var(--radius-3);
    border: 1px solid transparent;
    background: var(--color-info-bg);
    border-color: var(--color-info-border);
    color: var(--color-text);
    box-shadow: var(--shadow-1);
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    gap: var(--space-4);
    align-items: center;
  }

  .site-alert--warn {
    background: var(--color-warn-bg);
    border-color: var(--color-warn-border);
  }

  .site-alert__icon {
    width: 2.75rem;
    height: 2.75rem;
    border-radius: var(--radius-3);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    background: color-mix(in oklab, var(--color-info-border) 25%, var(--color-info-bg) 75%);
    color: var(--color-info-border);
  }

  .site-alert--warn .site-alert__icon {
    background: color-mix(in oklab, var(--color-warn-border) 25%, var(--color-warn-bg) 75%);
    color: var(--color-warn-border);
  }

  .site-alert__body {
    min-width: 0;
  }

  .site-alert__heading {
    margin: 0;
    font-size: var(--font-size-1);
    font-weight: 800;
  }

  .site-alert__message {
    margin: var(--space-1) 0 0;
    font-size: var(--font-size-1);
    line-height: 1.6;
    color: var(--color-text);
  }

  .site-alert__message a {
    color: var(--color-primary);
    font-weight: 600;
    text-decoration: underline;
    text-underline-offset: 0.18em;
    text-decoration-thickness: 0.12em;
  }

  .site-alert__actions {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-3);
    justify-content: flex-end;
  }

  .site-alert__meta {
    margin: 0;
    font-size: var(--font-size-0);
    color: var(--color-text-muted);
  }

  .site-alert__actions .btn {
    font-weight: 700;
    letter-spacing: 0.01em;
  }

  @media (max-width: 720px) {
    .site-alert {
      grid-template-columns: auto;
    }

    .site-alert__actions {
      width: 100%;
      justify-content: flex-start;
    }
  }
</style>
</file>

<file path="web/src/components/sections/EventList.astro">
---
import Button from "../ui/Button.astro";
import ContentCard from "../content/ContentCard.astro";
import SectionHeading from "../ui/SectionHeading.astro";
import { getCollection } from "astro:content";
import { site } from "../../data/site";

type Props = {
  title?: string;
  limit?: number;
  showViewAll?: boolean;
};

const { title = "Upcoming Events", limit = 3, showViewAll = true } = Astro.props;

const events = await getCollection("events", ({ data }) =>
  import.meta.env.PROD ? data.draft !== true : true
);

const now = new Date();
const upcoming = events
  .filter((e) => e.data.start >= now)
  .sort((a, b) => a.data.start.valueOf() - b.data.start.valueOf())
  .slice(0, limit);

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeStyle: "short",
  timeZone: site.timeZone
});
---

<section class="stack">
  <SectionHeading title={title}>
    {showViewAll && (
      <Button slot="action" variant="tertiary" href="/events">
        View all
      </Button>
    )}
  </SectionHeading>

  {upcoming.length === 0 ? (
    <div class="card card--muted event-empty-state stack--tight">
      <span class="event-empty-state__icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="presentation">
          <rect x="3" y="5" width="18" height="16" rx="3" ry="3" fill="none" stroke="var(--color-primary)" stroke-width="1.5" />
          <line x1="3" y1="9" x2="21" y2="9" stroke="var(--color-primary)" stroke-width="1.5" />
          <line x1="8" y1="2" x2="8" y2="6" stroke="var(--color-primary)" stroke-width="1.5" />
          <line x1="16" y1="2" x2="16" y2="6" stroke="var(--color-primary)" stroke-width="1.5" />
        </svg>
      </span>
      <div class="event-empty-state__content stack--tight">
        <h3 class="event-empty-state__title">Nothing on the calendar yet</h3>
        <p class="event-empty-state__text">No upcoming events are published yet. We&apos;re keeping the schedule updated, so check back soon.</p>
      </div>
      <div class="event-empty-state__actions cluster cluster--loose">
        <Button variant="secondary" href="/events">View calendar</Button>
        <Button variant="tertiary" href="/connect/contact">Contact us</Button>
      </div>
    </div>
  ) : (
    <div class="grid--cards">
      {upcoming.map((e) => (
        <ContentCard
          href={`/events/${e.id}`}
          title={e.data.title}
          summary={e.data.summary}
          meta={fmt.format(e.data.start)}
          tags={e.data.tags}
        />
      ))}
    </div>
  )}
</section>

<style>
  .event-empty-state {
    text-align: center;
    justify-items: center;
  }

  .event-empty-state__icon {
    width: 56px;
    height: 56px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .event-empty-state__icon svg {
    width: 100%;
    height: 100%;
  }

  .event-empty-state__content {
    text-align: center;
  }

  .event-empty-state__title {
    margin: 0;
    font-size: var(--type-scale-h3-size);
  }

  .event-empty-state__text {
    margin: 0;
    color: var(--color-text-muted);
  }

  .event-empty-state__actions {
    width: min(320px, 100%);
    justify-content: center;
    gap: var(--space-4);
  }

  .event-empty-state__actions a,
  .event-empty-state__actions button {
    flex: 1;
  }
</style>
</file>

<file path="web/src/components/sections/SermonHighlight.astro">
---
import Button from "../ui/Button.astro";
import SectionHeading from "../ui/SectionHeading.astro";
import YouTubeEmbed from "../media/YouTubeEmbed.astro";
import videos from "../../data/videos.json";
import { site } from "../../data/site";

type Video = {
  title: string;
  date: string;
  youtubeId?: string;
  summary?: string;
};

type Props = {
  title?: string;
};

const { title = "Latest Sermon" } = Astro.props;

const list = (videos as Video[]).slice().sort((a, b) => {
  return new Date(b.date).valueOf() - new Date(a.date).valueOf();
});

const latest = list[0];
const hasEmbed = latest && latest.youtubeId && latest.youtubeId !== "TBD";
const hasYouTube = Boolean(site.portals.youtubeChannelUrl && site.portals.youtubeChannelUrl !== "TBD");

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone
});
const meta = latest?.date ? fmt.format(new Date(latest.date)) : undefined;
const youtubeHref = hasYouTube ? site.portals.youtubeChannelUrl : "/media/videos";
---

<section class="stack">
  <SectionHeading title={title} />

  {!latest ? (
    <p class="muted">No videos are listed yet.</p>
  ) : (
    <div class="card stack">
      <div class="stack--tight">
        {meta && <p class="muted small">{meta}</p>}
        <h3>{latest.title}</h3>
        {latest.summary && <p class="text-body">{latest.summary}</p>}
      </div>

      {hasEmbed ? (
        <YouTubeEmbed
          title={latest.title}
          embedUrl={`https://www.youtube.com/embed/${latest.youtubeId}`}
        />
      ) : (
        <p class="small muted">
          New sermon video coming soon. Check back soon or browse the video archive.
        </p>
      )}

      <div class="cluster">
        {hasYouTube ? (
          <Button href={youtubeHref} variant="primary" external>Open YouTube</Button>
        ) : null}
        <Button href="/media/videos" variant="secondary">More videos</Button>
      </div>
    </div>
  )}
</section>
</file>

<file path="web/src/components/Header.astro">
---
import { site } from "../data/site";

const pathname = Astro.url.pathname;

function isActive(href: string) {
  if (href === "/") return pathname === "/";
  return pathname === href || pathname.startsWith(href + "/");
}

function linkAttrs(item: { href: string; external?: boolean }) {
  return item.external
    ? { target: "_blank", rel: "noopener noreferrer" }
    : {};
}
---

<header class="header">
  <div class="container header__inner">
    <div class="header__brand">
      <a href="/">{site.shortName}</a>
      <div class="small muted">Site under construction (MVP)</div>
    </div>

    <div class="header__desktop" aria-label="Header navigation">
      <nav class="nav" aria-label="Primary navigation">
        {site.nav.map((item) => (
          <a
            href={item.href}
            aria-current={isActive(item.href) ? "page" : undefined}
            {...linkAttrs(item)}
          >
            {item.label}
          </a>
        ))}
      </nav>

      <nav class="nav" aria-label="Quick actions">
        {site.quickActions.map((item) => (
          <a
            href={item.href}
            style="font-weight: 700;"
            aria-current={isActive(item.href) ? "page" : undefined}
            {...linkAttrs(item)}
          >
            {item.label}
          </a>
        ))}
      </nav>
    </div>

    <div class="header__mobile">
      <details class="menu">
        <summary aria-label="Open menu">Menu</summary>
        <div class="menu__panel" aria-label="Mobile menu">
          <div>
            <div class="menu__sectionTitle">Navigate</div>
            <nav class="nav" aria-label="Primary navigation (mobile)">
              {site.nav.map((item) => (
                <a
                  href={item.href}
                  aria-current={isActive(item.href) ? "page" : undefined}
                  {...linkAttrs(item)}
                >
                  {item.label}
                </a>
              ))}
            </nav>
          </div>

          <div>
            <div class="menu__sectionTitle">Quick actions</div>
            <nav class="nav" aria-label="Quick actions (mobile)">
              {site.quickActions.map((item) => (
                <a
                  href={item.href}
                  style="font-weight: 700;"
                  aria-current={isActive(item.href) ? "page" : undefined}
                  {...linkAttrs(item)}
                >
                  {item.label}
                </a>
              ))}
            </nav>
          </div>
        </div>
      </details>
    </div>
  </div>
</header>

<script>
  // Close the mobile menu when a link is clicked.
  document.addEventListener("click", (e) => {
    const target = e.target;
    if (!(target instanceof HTMLElement)) return;

    const link = target.closest("a");
    const details = target.closest("details.menu");
    if (link && details) details.removeAttribute("open");
  });
</script>
</file>

<file path="web/src/pages/connect/connect-card/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import churchExterior from "../../../assets/photos/first-springfield-exterior.png";
import bridgeDusk from "../../../assets/photos/bridge-dusk.jpg";
import adventistCommunityServicesLogo from "../../../assets/photos/ministries-adventist-community-services-logo.png";
import childrensMinistryBanner from "../../../assets/photos/ministries-childrens-ministry-banner.png";
import youthLogo from "../../../assets/photos/ministries-youth-young-adults-ay-logo.png";
import pathfindersLogo from "../../../assets/photos/club-pathfinders-logo.png";

const customFormAction = import.meta.env.PUBLIC_CONNECT_CARD_FORM_ACTION;
const defaultFormAction = "/api/connect-card";
const formAction = customFormAction || defaultFormAction;
const usesCustomFormAction = Boolean(customFormAction);
const turnstileSiteKey = import.meta.env.PUBLIC_TURNSTILE_SITE_KEY ?? "";
const pageOrigin = Astro.url?.origin;
const thankYouPath = "/connect/connect-card/thank-you";
const thankYouUrl = pageOrigin ? `${pageOrigin}${thankYouPath}` : thankYouPath;

const galleryPhotos = [
  {
    src: bridgeDusk.src,
    alt: "Evening light on the bridge that leads toward our campus.",
    caption: "Neighborhood welcomes before you even cross the bridge.",
    tag: "Community",
  },
  {
    src: churchExterior.src,
    alt: "First Springfield SDA Church building and welcome sign.",
    caption: "Our sanctuary is open for worship, fellowship, and hospitality.",
    tag: "Welcome",
  },
  {
    src: childrensMinistryBanner.src,
    alt: "A colorful banner announcing Children’s Ministry programming.",
    caption: "Children’s Ministry storytelling, music, and hugs make every visitor feel known.",
    tag: "Children",
  },
  {
    src: pathfindersLogo.src,
    alt: "Pathfinders & Adventurers club crest.",
    caption: "Pathfinders & Adventurers gather for service, camping, and faith-building adventures.",
    tag: "Pathfinders",
  },
  {
    src: adventistCommunityServicesLogo.src,
    alt: "Adventist Community Services logo.",
    caption: "ACS outreach brings meals, care, and compassion to Springfield neighbors.",
    tag: "Service",
  },
  {
    src: youthLogo.src,
    alt: "Youth & Young Adults ministry emblem.",
    caption: "AY conversations, prayer, and mentorship keep young people connected.",
    tag: "Youth",
  },
];

const interestOptions = [
  { value: "prayer", label: "Prayer" },
  { value: "bible-study", label: "Bible study" },
  { value: "visitation", label: "Visitation" },
  { value: "conversion", label: "Conversion" },
  { value: "baptism", label: "Baptism" },
  { value: "transfer", label: "Transfer" },
  { value: "facility-use", label: "Facility use" },
];

const connectionReasons = [
  { value: "first-time-visit", label: "I am planning my first visit" },
  { value: "moving-to-town", label: "We just moved to the area" },
  { value: "prayer", label: "I’d like prayer or encouragement" },
  { value: "questions", label: "I have a question about the church" },
  { value: "other", label: "Other" },
];

const preferredContactOptions = [
  { value: "email", label: "Email (fastest)" },
  { value: "phone", label: "Phone call or text" },
];

const interestsId = (value: string) => `interest-${value}`;
---

<BaseLayout
  title="Connect Card"
  description="Submit a Connect Card to let the team know how to pray for you, follow up, or support your next steps."
>
  <script slot="head" is:inline src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <div class="stack connect-card">
    <div class="connect-card__intro">
      <h1>Connect Card</h1>
      <p id="connect-card-summary" class="muted">
        Tell us about your visit window, how we can pray for you, and which ministries you’d like to explore.
        We’ll ask for your preferred follow-up method and keep your information private unless you say otherwise.
      </p>
      {!usesCustomFormAction ? (
        <div class="connect-card__warning" role="status">
          <strong>Built-in Connect Card backend is active.</strong> Before publishing, configure
          <code>PRIVATE_CONNECT_CARD_FORWARD_URL</code> and <code>PRIVATE_TURNSTILE_SECRET_KEY</code>
          (and optionally <code>CONNECT_CARD_NOTIFY_EMAILS</code>) so submissions forward and trigger alerts.
        </div>
      ) : null}
    </div>

    <section class="connect-card__gallery" aria-labelledby="connect-card-gallery-title">
      <div class="connect-card__gallery-head">
        <p class="muted small">This is your church family</p>
        <h2 id="connect-card-gallery-title">This is your church family</h2>
        <p class="muted">
          Worship, fellowship, and service all intersect in the people you’ll meet when you visit First Springfield.
        </p>
      </div>
      <div class="connect-card__gallery-grid">
        {galleryPhotos.map((photo) => (
          <figure class="connect-card__photo">
            <img src={photo.src} alt={photo.alt} loading="lazy" decoding="async" />
            <figcaption>
              <span class="connect-card__photo-tag">{photo.tag}</span>
              <p>{photo.caption}</p>
            </figcaption>
          </figure>
        ))}
      </div>
    </section>

    <form
      class="connect-card__form"
      action={formAction || "#"}
      method="POST"
      accept-charset="UTF-8"
      aria-describedby="connect-card-summary"
    >
      <div class="connect-card__grid">
        <div class="form-field">
          <label for="full-name">
            Full name <span class="required" aria-hidden="true">*</span>
          </label>
          <input id="full-name" name="fullName" type="text" required autocomplete="name" placeholder="Jamie Rivera" />
        </div>

        <div class="form-field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" autocomplete="email" placeholder="name@example.com" />
        </div>

        <div class="form-field">
          <label for="phone">
            Phone <span class="required" aria-hidden="true">*</span>
            <span class="form-helper">Calls/texts help us respond if email bounces.</span>
          </label>
          <input id="phone" name="phone" type="tel" required autocomplete="tel" placeholder="(123) 456‑7890" />
        </div>

        <div class="form-field">
          <label for="visit-date">
            Preferred visit date <span class="required" aria-hidden="true">*</span>
            <span class="form-helper">Let us know when you hope to visit so we can plan hospitality.</span>
          </label>
          <input id="visit-date" name="visitDate" type="date" required />
        </div>
      </div>

      <div class="form-section connect-card__visited">
        <fieldset>
          <legend>Have you visited First Springfield before?</legend>
          <p class="form-helper">Knowing your familiarity helps us tailor your welcome.</p>
          <div class="radio-group">
            <label class="radio" for="visited-before-yes">
              <input id="visited-before-yes" name="visitedBefore" type="radio" value="yes" required />
              <span>Yes</span>
            </label>
            <label class="radio" for="visited-before-no">
              <input id="visited-before-no" name="visitedBefore" type="radio" value="no" required />
              <span>No</span>
            </label>
          </div>
        </fieldset>
      </div>

      <div class="form-section connect-card__address">
        <div class="connect-card__section-heading">
          <p class="form-label">
            Address <span class="required" aria-hidden="true">*</span>
          </p>
          <span class="form-helper">Needed for arrival info, mailings, or hospitality follow-up.</span>
        </div>
        <div class="address-grid">
          <div class="form-field">
            <label for="address-street">Street address <span class="required" aria-hidden="true">*</span></label>
            <input
              id="address-street"
              data-address-part
              name="addressStreet"
              type="text"
              required
              placeholder="123 Main St"
              autocomplete="address-line1"
            />
          </div>
          <div class="form-field form-field--wide">
            <label for="address-line2">Line 2 (apt, suite, etc.)</label>
            <input
              id="address-line2"
              data-address-part
              name="addressLine2"
              type="text"
              placeholder="Suite 4"
              autocomplete="address-line2"
            />
          </div>
          <div class="form-field">
            <label for="address-city">City <span class="required" aria-hidden="true">*</span></label>
            <input
              id="address-city"
              data-address-part
              name="addressCity"
              type="text"
              required
              placeholder="Springfield"
              autocomplete="address-level2"
            />
          </div>
          <div class="form-field">
            <label for="address-state">State <span class="required" aria-hidden="true">*</span></label>
            <input
              id="address-state"
              data-address-part
              name="addressState"
              type="text"
              required
              placeholder="MA"
              autocomplete="address-level1"
            />
          </div>
          <div class="form-field">
            <label for="address-zip">ZIP code <span class="required" aria-hidden="true">*</span></label>
            <input
              id="address-zip"
              data-address-part
              name="addressZip"
              type="text"
              required
              placeholder="01118"
              autocomplete="postal-code"
            />
          </div>
          <div class="form-field">
            <label for="address-country">Country</label>
            <span class="form-helper">Optional unless you are visiting from outside the U.S.</span>
            <input
              id="address-country"
              data-address-part
              name="addressCountry"
              type="text"
              placeholder="United States"
              autocomplete="country"
            />
          </div>
        </div>
        <input type="hidden" id="address-summary" name="address" required />
      </div>

      <div class="form-section">
        <label for="connection-reason">What best describes your reason for connecting?</label>
        <select id="connection-reason" name="connectionReason" required>
          <option value="">Choose one</option>
          {connectionReasons.map((item) => (
            <option value={item.value}>{item.label}</option>
          ))}
        </select>
      </div>

      <div class="form-section connect-card__interests">
        <p id="interests-label" class="form-label">
          I’d like the team to follow up about:
          <span class="required" aria-hidden="true">*</span>
        </p>
        <p class="form-helper">Choose all that apply so we can match you with the right team.</p>
        <div
          class="checkbox-grid"
          role="group"
          aria-labelledby="interests-label"
          aria-describedby="interests-error"
        >
          {interestOptions.map((item) => (
            <label class="checkbox" for={interestsId(item.value)}>
              <input id={interestsId(item.value)} name="interests[]" value={item.value} type="checkbox" />
              <span>{item.label}</span>
            </label>
          ))}
        </div>
        <p id="interests-error" class="form-error" role="alert" aria-live="assertive" hidden></p>
      </div>

      <div class="form-section">
        <label for="preferred-contact">Preferred follow-up method <span class="required" aria-hidden="true">*</span></label>
        <select id="preferred-contact" name="preferredContact" required>
          <option value="">Select</option>
          {preferredContactOptions.map((item) => (
            <option value={item.value}>{item.label}</option>
          ))}
        </select>
      </div>

      <div class="form-section">
        <label for="notes">Anything else we should know?</label>
        <textarea
          id="notes"
          name="notes"
          rows="4"
          placeholder="Share a prayer request, questions about ministry, or a time to connect."
        ></textarea>
      </div>

      <input type="hidden" name="redirectUrl" value={thankYouUrl} />
      <input type="hidden" name="formSource" value="connect-card-web" />

      <div class="form-section turnstile">
        {turnstileSiteKey ? (
          <div class="cf-turnstile" data-sitekey={turnstileSiteKey}></div>
        ) : (
          <p class="muted small">
            For spam protection, set <code>PUBLIC_TURNSTILE_SITE_KEY</code> and <code>PRIVATE_TURNSTILE_SECRET_KEY</code> (used
            server-side) so we can verify the widget before writing to the sheet.
          </p>
        )}
      </div>

      <p class="privacy-note small muted">
        Privacy note: We ask for phone, visit details, and address so the pastor, hospitality, or children’s team can respond
        with arrival information, ministry invitations, or resources you request. We will not share personal data outside the house
        of worship without permission.
      </p>

      <div class="form-actions">
        <button type="submit" class="primary-action">
          Submit a Connect Card
        </button>
        <a class="ghost-action" href="/connect/contact">Need help now?</a>
      </div>
    </form>
  </div>
</BaseLayout>

<script is:inline>
(function () {
  const focusFirstInvalidField = (form) => {
    const firstInvalid = form.querySelector(":invalid");
    if (firstInvalid instanceof HTMLElement && document.activeElement !== firstInvalid) {
      firstInvalid.focus();
    }
  };

  const init = () => {
    const form = document.querySelector(".connect-card__form");
    if (!form) return;

    const addressInputs = Array.from(form.querySelectorAll("[data-address-part]"));
    const addressSummary = form.querySelector("#address-summary");

    const updateAddressSummary = () => {
      if (!addressSummary) return;
      const parts = addressInputs.map((input) => input.value.trim()).filter(Boolean);
      addressSummary.value = parts.join(", ");
    };

    addressInputs.forEach((input) => input.addEventListener("input", updateAddressSummary));
    updateAddressSummary();

    const interestInputs = Array.from(form.querySelectorAll('input[name="interests[]"]'));
    const interestErrorElement = form.querySelector("#interests-error");

    const showInterestError = (message) => {
      if (!interestErrorElement) return;
      interestErrorElement.textContent = message;
      interestErrorElement.hidden = false;
    };

    const hideInterestError = () => {
      if (!interestErrorElement) return;
      interestErrorElement.textContent = "";
      interestErrorElement.hidden = true;
    };

    if (interestInputs.length) {
      const interestErrorMessage = "Select at least one interest so we can best support you.";

      const resetInterestValidation = () => {
        interestInputs.forEach((input) => input.setCustomValidity(""));
        hideInterestError();
      };

      interestInputs.forEach((input) => {
        input.setAttribute("aria-describedby", "interests-error");
        input.addEventListener("change", resetInterestValidation);
      });

      form.addEventListener("submit", (event) => {
        const hasAny = interestInputs.some((input) => input.checked);
        if (!hasAny) {
          interestInputs[0].setCustomValidity(interestErrorMessage);
          showInterestError(interestErrorMessage);
          if (typeof form.reportValidity === "function") {
            form.reportValidity();
          }
          interestInputs[0].focus();
          event.preventDefault();
          return;
        }
      });
    }

    form.addEventListener("submit", () => {
      setTimeout(() => focusFirstInvalidField(form), 0);
    });
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>

<style>
  .connect-card {
    max-width: 52rem;
  }

  .connect-card__intro + .connect-card__gallery,
  .connect-card__gallery + .connect-card__form {
    margin-top: var(--space-6);
  }

  .connect-card__gallery {
    background: var(--color-surface-2);
    border-radius: var(--radius-3);
    padding: var(--space-4) var(--space-5);
    border: 1px solid var(--color-border);
  }

  .connect-card__gallery-head {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
  }

  .connect-card__gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: var(--space-3);
  }

  .connect-card__photo {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    margin: 0;
  }

  .connect-card__photo img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: var(--radius-2);
    display: block;
  }

  .connect-card__photo-tag {
    text-transform: uppercase;
    font-size: var(--font-size-0);
    color: var(--color-primary);
    letter-spacing: 0.08em;
  }

  .connect-card__photo figcaption p {
    margin: 0;
  }

  .connect-card__form {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }

  .connect-card__grid {
    display: grid;
    gap: var(--space-4);
  }

  .form-field {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .form-field--wide {
    grid-column: span 2;
  }

  .connect-card__form label {
    font-weight: 700;
  }

  .connect-card__form input,
  .connect-card__form select,
  .connect-card__form textarea {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-2);
    padding: var(--space-3);
    font: inherit;
    background: var(--color-white);
  }

  .connect-card__form textarea {
    resize: vertical;
    min-height: 3rem;
  }

  .required {
    margin-left: 0.25rem;
    color: var(--color-secondary);
  }

  .form-helper {
    display: block;
    font-size: var(--font-size-0);
    color: var(--color-text-muted);
    font-weight: 400;
  }

  .form-error {
    margin: 0;
    font-size: var(--font-size-0);
    color: #b00020;
  }

  .form-section {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .connect-card__visited fieldset {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-2);
    padding: var(--space-3);
    margin: 0;
  }

  .connect-card__visited legend {
    font-weight: 700;
  }

  .radio-group {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
  }

  .radio {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-weight: 600;
    cursor: pointer;
  }

  .radio input {
    margin: 0;
    accent-color: var(--color-primary);
  }

  .connect-card__address {
    border: 1px dashed var(--color-border);
    border-radius: var(--radius-3);
    padding: var(--space-4);
    background: var(--color-surface);
  }

  .connect-card__section-heading {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .address-grid {
    display: grid;
    gap: var(--space-3);
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  }

  .connect-card__interests .checkbox-grid {
    display: grid;
    gap: var(--space-2);
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }

  .checkbox {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-weight: 500;
    font-size: 0.95rem;
    cursor: pointer;
  }

  .checkbox input {
    margin: 0;
    accent-color: var(--color-primary);
  }

  .turnstile {
    padding: var(--space-3);
    border: 1px dashed var(--color-border);
    border-radius: var(--radius-2);
    background: var(--color-surface-2);
  }

  .form-actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
    align-items: center;
  }

  .primary-action {
    background: var(--color-primary);
    color: var(--color-white);
    border: none;
    border-radius: var(--radius-3);
    padding: var(--space-3) var(--space-5);
    font-weight: 700;
    cursor: pointer;
  }

  .ghost-action {
    color: var(--color-primary);
    font-weight: 600;
    text-decoration: underline;
  }

  .connect-card .privacy-note {
    margin: 0;
  }

  @media (min-width: 720px) {
    .connect-card__grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .form-field:nth-child(odd) {
      min-width: 0;
    }
  }
</style>
</file>

<file path="web/src/pages/connect/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CardGrid from "../../components/sections/CardGrid.astro";
import { site } from "../../data/site";
---

<BaseLayout
  title="Connect"
  description={`Plan a visit, learn about worship, request prayer, and get in touch with ${site.name}.`}
>
  <div class="stack">
    <h1>Connect</h1>

    <CardGrid
      title="Ways to connect"
      cards={[
        {
          title: "Plan a Visit",
          description: "Service times, directions, and what to expect.",
          href: "/connect/plan-a-visit"
        },
        {
          title: "Worship With Us",
          description: "Learn about Sabbath School and worship service.",
          href: "/connect/worship-with-us"
        },
        {
          title: "Prayer Request",
          description: "Share a prayer request with our prayer team.",
          href: "/connect/prayer"
        },
        {
          title: "Contact",
          description: "Phone, email, and how to reach us.",
          href: "/connect/contact"
        }
      ]}
    />
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/media/videos/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import { site } from "../../../data/site";

const hasYouTube = site.portals.youtubeChannelUrl && site.portals.youtubeChannelUrl !== "TBD";
---

<BaseLayout title="Videos" description={`Recent videos from ${site.name}.`}>
  <div class="stack">
    <h1>Videos</h1>

    <section class="card stack">
      <h2>Watch on YouTube</h2>
      <p class="muted">
        Browse recent messages and live streams on our YouTube channel.
      </p>

      {hasYouTube ? (
        <Button href={site.portals.youtubeChannelUrl} external variant="secondary">
          Browse on YouTube
        </Button>
      ) : (
        <p class="small muted">
          Our YouTube channel is coming soon. Check back or{" "}
          <a class="link" href="/connect/contact">contact us</a> for the latest links.
        </p>
      )}
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/media/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Card from "../../components/ui/Card.astro";
import Grid from "../../components/ui/CardGrid.astro";
import { site } from "../../data/site";
---

<BaseLayout title="Media" description={`Watch live and browse recent videos from ${site.name}.`}>
  <div class="stack">
    <h1>Media</h1>

    <section aria-label="Quick links" class="stack--tight">
      <h2>Quick links</h2>

      <Grid columnsMin={240}>
        <Card
          title="Watch Live"
          description="Join our live stream when available."
          href="/media/live"
        />
        <Card
          title="Videos"
          description="Browse recent sermons and messages."
          href="/media/videos"
        />
      </Grid>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/resources/announcements/[...page].astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import ContentCard from "../../../components/content/ContentCard.astro";
import { site } from "../../../data/site";
import { announcementTagLabels } from "../../../data/announcement-tags";
import {
  announcementsPerPage,
  getArchiveMonths,
  getSortedAnnouncements,
  paginateAnnouncements,
} from "../../../lib/announcements";

export async function getStaticPaths() {
  const announcements = await getSortedAnnouncements();
  const totalPages = Math.max(1, Math.ceil(announcements.length / announcementsPerPage));
  const paths = [];

  for (let pageNumber = 2; pageNumber <= totalPages; pageNumber++) {
    paths.push({
      params: {
        page: `page/${pageNumber}`,
      },
    });
  }

  return paths;
}

const announcements = await getSortedAnnouncements();
const rawSegments = Astro.params.page;
const segments =
  typeof rawSegments === "string"
    ? rawSegments.split("/").filter(Boolean)
    : Array.isArray(rawSegments)
    ? rawSegments
    : [];
const requestedPage = Number(segments[segments.length - 1] ?? 1);
const totalPages = Math.max(1, Math.ceil(announcements.length / announcementsPerPage));
const page = Math.min(Math.max(1, Number.isNaN(requestedPage) ? 1 : requestedPage), totalPages);
const pagination = paginateAnnouncements(announcements, page);
const metaFormatter = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone,
});
const archiveMonths = getArchiveMonths(await getSortedAnnouncements({ includeExpired: true }));
const showPrev = page > 1;
const showNext = page < totalPages;
const prevHref = page === 2 ? "/resources/announcements" : `/resources/announcements/page/${page - 1}`;
const nextHref = `/resources/announcements/page/${page + 1}`;
const hasAnnouncements = announcements.length > 0;
const rangeStart = hasAnnouncements ? (page - 1) * announcementsPerPage + 1 : 0;
const rangeEnd = hasAnnouncements ? Math.min(announcements.length, page * announcementsPerPage) : 0;
const updatesUrl = "/updates";
const rssUrl = "/resources/announcements/rss.xml";
---

<BaseLayout title={`Announcements · page ${page}`}>
  <div class="stack">
    <h1>Announcements · page {page}</h1>
    <p class="muted">
      {hasAnnouncements
        ? `Showing ${rangeStart}–${rangeEnd} of ${announcements.length} announcements.`
        : "No announcements have been published yet."}{" "}
      <a class="link" href={rssUrl}>Subscribe via RSS</a>.
    </p>

    {pagination.results.length === 0 ? (
      <p class="muted">No announcements published for this page.</p>
    ) : (
      <div class="grid--cards">
        {pagination.results.map((entry) => (
          <ContentCard
            href={`/resources/announcements/${entry.id}`}
            title={entry.data.title}
            summary={entry.data.summary}
            meta={metaFormatter.format(entry.data.date)}
            tags={entry.data.tags?.map((value) => announcementTagLabels[value] ?? value)}
          />
        ))}
      </div>
    )}

    <div class="cluster--between pagination">
      {showPrev ? <Button href={prevHref} variant="tertiary">Newer announcements</Button> : <span />}
      {showNext ? <Button href={nextHref} variant="tertiary">Older announcements</Button> : null}
    </div>

    <section class="card stack--tight">
      <h2>Archive by month</h2>
      {archiveMonths.length === 0 ? (
        <p class="muted">No archived months yet.</p>
      ) : (
        <ul class="archive-list">
          {archiveMonths.map(({ year, month, label }) => (
            <li>
              <a class="link" href={`/resources/announcements/archive/${year}/${String(month).padStart(2, "0")}`}>
                {label}
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>

    <div class="cluster">
      <Button href="/resources/announcements" variant="secondary">Back to current announcements</Button>
      <Button href={updatesUrl} variant="tertiary">Visit updates page</Button>
    </div>
  </div>
</BaseLayout>

<style>
  .archive-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .archive-list li {
    min-width: 180px;
  }

  .pagination {
    margin-top: var(--space-4);
  }
</style>
</file>

<file path="web/src/pages/resources/announcements/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import ContentCard from "../../../components/content/ContentCard.astro";
import { site } from "../../../data/site";
import { announcementTagLabels, announcementTags } from "../../../data/announcement-tags";
import {
  announcementsPerPage,
  getArchiveMonths,
  getSortedAnnouncements,
} from "../../../lib/announcements";
import type { AnnouncementEntry } from "../../../lib/announcements";

const announcements = await getSortedAnnouncements();
const rawTag = Astro.url.searchParams.get("tag");
const activeTag = announcementTags.find((tag) => tag.value === rawTag);
const filteredAnnouncements = activeTag
  ? announcements.filter((entry) => entry.data.tags?.includes(activeTag.value))
  : announcements;
const featured =
  filteredAnnouncements.find((entry) => entry.data.featured) ?? filteredAnnouncements[0];
const visibleAnnouncements = filteredAnnouncements.slice(0, announcementsPerPage);
const showMore = filteredAnnouncements.length > announcementsPerPage;
const metaFormatter = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone,
});
const highlightFormatter = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "full",
  timeZone: site.timeZone,
});
const archiveMonths = getArchiveMonths(await getSortedAnnouncements({ includeExpired: true }));
const rssUrl = "/resources/announcements/rss.xml";
const updatesUrl = "/updates";
const tagDescription = activeTag
  ? `Showing ${activeTag.label} updates.`
  : "Showing everything.";

const tagQuery = (tagValue?: string) =>
  tagValue ? `/resources/announcements?tag=${tagValue}` : "/resources/announcements";
const detailHref = (entry: AnnouncementEntry) => `/resources/announcements/${entry.id}`;
const tagLabel = activeTag ? activeTag.label : "All";
const submitDeadline = "Wednesday 5 PM";
const clerkDestination = "Church Clerk (Church Office)";
const contactHref = "/connect/contact";
const contactEmail = site.contact.email;
---

<BaseLayout
  title="Announcements"
  description="Church announcements, tagging, and archival history for Saturday worship and outreach."
>
  <div class="stack">
    <h1>Announcements</h1>
    <p class="muted">
      The communications team gathers weekly updates from every ministry so you can stay informed about worship plans,
      volunteer opportunities, and urgent alerts.
    </p>

    <section class="card stack--tight" aria-labelledby="announcements-filter">
      <div class="cluster--between">
        <div>
          <h2 id="announcements-filter">Browse announcements</h2>
          <p class="muted">{tagDescription}</p>
        </div>
        <div class="cluster">
          <Button href={updatesUrl} variant="tertiary">Visit updates page</Button>
          <Button href={rssUrl} variant="tertiary" size="sm">Subscribe via RSS</Button>
        </div>
      </div>

      <div class="chips" role="list">
        <a
          class={`chip ${!rawTag ? "chip--active" : ""}`}
          href={tagQuery()}
          aria-pressed={!rawTag}
          role="listitem"
        >
          All
        </a>
        {announcementTags.map((tag) => (
          <a
            class={`chip ${rawTag === tag.value ? "chip--active" : ""}`}
            href={tagQuery(tag.value)}
            aria-pressed={rawTag === tag.value}
            role="listitem"
          >
            {tag.label}
          </a>
        ))}
      </div>
    </section>

    {featured ? (
      <section class="card stack--tight featured-card">
        <div class="cluster--between">
          <div>
            <p class="muted">Featured announcement</p>
            <h2>{featured.data.title}</h2>
            <p class="muted">
              {highlightFormatter.format(featured.data.date)} {featured.data.summary ? `• ${featured.data.summary}` : ""}
            </p>
            {featured.data.tags && featured.data.tags.length > 0 && (
              <ul class="chip-list">
                {featured.data.tags.map((value) => (
                  <li>
                    <span class="chip chip--readonly">
                      {announcementTagLabels[value] ?? value}
                    </span>
                  </li>
                ))}
              </ul>
            )}
          </div>
          <Button href={detailHref(featured)} variant="secondary">Read details</Button>
        </div>
      </section>
    ) : null}

    <section class="stack--tight" aria-labelledby="announcements-list">
      <div class="cluster--between">
        <h2 id="announcements-list">Latest announcements</h2>
        <p class="muted">
          Showing {visibleAnnouncements.length} of {filteredAnnouncements.length} {tagLabel.toLowerCase()}{filteredAnnouncements.length === 1 ? " announcement" : " announcements"}.
        </p>
      </div>

      {visibleAnnouncements.length === 0 ? (
        <p class="muted">
          No announcements found for {tagLabel.toLowerCase()}. Try another tag or visit the updates page.
        </p>
      ) : (
        <div class="grid--cards">
          {visibleAnnouncements.map((entry) => (
            <ContentCard
              href={detailHref(entry)}
              title={entry.data.title}
              summary={entry.data.summary}
              meta={metaFormatter.format(entry.data.date)}
              tags={entry.data.tags?.map((value) => announcementTagLabels[value] ?? value)}
            />
          ))}
        </div>
      )}

      {showMore ? (
        <div class="cluster--between pagination">
          <p class="muted">{`Older announcements appear on the next page.`}</p>
          <Button href="/resources/announcements/page/2" variant="tertiary">Older announcements</Button>
        </div>
      ) : null}
    </section>

    <section class="card stack--tight" aria-labelledby="announcements-archive">
      <h2 id="announcements-archive">Archive by month</h2>
      {archiveMonths.length === 0 ? (
        <p class="muted">No archived months yet.</p>
      ) : (
        <ul class="archive-list">
          {archiveMonths.map(({ year, month, label }) => (
            <li>
              <a class="link" href={`/resources/announcements/archive/${year}/${String(month).padStart(2, "0")}`}>
                {label}
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>

    <section class="card stack" aria-labelledby="announcements-submit">
      <h2 id="announcements-submit">Submit an announcement</h2>
      <p class="muted">
        Deadline: {submitDeadline}. Destination: {clerkDestination}. Email {contactEmail} or use the Connect page below.
      </p>
      <div class="cluster">
        <Button href={contactHref} variant="secondary">Contact Church Clerk</Button>
        <Button href={updatesUrl} variant="tertiary">See updates page</Button>
      </div>
      <p class="small muted">
        Phase 6 will create the Connect Card; you can add a dedicated announcement submission form later if needed.
      </p>
    </section>
  </div>
</BaseLayout>

<style>
  .chips {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-top: var(--space-3);
  }

  .chip {
    border-radius: var(--radius-4);
    border: 1px solid var(--color-border);
    padding: 0.35rem 0.85rem;
    font-weight: 600;
    text-decoration: none;
    color: inherit;
    background: var(--color-surface);
  }

  .chip--active {
    background: var(--color-primary);
    color: var(--color-white);
    border-color: var(--color-primary);
  }

  .chip--readonly {
    border-color: transparent;
    background: color-mix(in oklab, var(--color-surface) 85%, black 15%);
    cursor: default;
  }

  .chip-list {
    list-style: none;
    display: flex;
    gap: var(--space-2);
    padding: 0;
    margin: var(--space-3) 0 0;
  }

  .featured-card h2 {
    margin: 0;
  }

  .archive-list {
    list-style: none;
    padding-left: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .archive-list li {
    min-width: 180px;
  }

  .pagination {
    margin-top: var(--space-4);
  }
</style>
</file>

<file path="web/src/pages/components.astro">
---
import BaseLayout from "../layouts/BaseLayout.astro";
import Button, { type Size, type Variant } from "../components/ui/Button.astro";
import Banner from "../components/ui/Banner.astro";
import Card from "../components/ui/Card.astro";

const buttonVariants: { label: string; variant: Variant }[] = [
  { label: "Primary", variant: "primary" },
  { label: "Secondary", variant: "secondary" },
  { label: "Ghost", variant: "ghost" },
];

const buttonSizes: { label: string; size: Size }[] = [
  { label: "Small", size: "sm" },
  { label: "Medium (default)", size: "md" },
  { label: "Large", size: "lg" },
];

const linkSamples = [
  { label: "Plan a visit", href: "/connect/plan-a-visit", helper: "Internal CTA", external: false },
  {
    label: "Design handoff notes",
    href: "/docs/ui-handoff.md",
    helper: "Documents align with design tokens",
    external: false,
  },
  {
    label: "Cross-device guide",
    href: "https://playwright.dev/docs/test-configuration",
    helper: "External resource (opens new tab)",
    external: true,
  },
];

const cards = [
  {
    title: "Service snapshot",
    description: "Button-driven CTAs magnify the worship preview and giving link.",
    href: "/connect/worship-with-us",
  },
  {
    title: "Ministry stories",
    description: "Cards frame the latest community updates without extra markup.",
  },
];

const badges = [
  { label: "New", className: "badge badge--primary" },
  { label: "Draft", className: "badge badge--muted" },
  { label: "Alert", className: "badge badge--warn" },
];

const tableRows = [
  { component: "Button", usage: "Primary, secondary, ghost shapes", pattern: "Hero/CTA pattern" },
  { component: "Banner", usage: "Info + warning alerts", pattern: "Announcements + policy changes" },
  { component: "Card", usage: "Service/ministry highlights", pattern: "Grid + stack layouts" },
];

const listItems = [
  "Spacing relies on `var(--space-*)` tokens that keep grids and stacks aligned.",
  "Color, border, and focus tokens (*primary, border, focus*) stay consistent site wide.",
  "Animations respect `stack` and `cluster` helpers so cards stay responsive.",
];
---

<BaseLayout title="Components" description="Living component library for First Springfield’s web toolkit.">
  <section class="component-hero">
    <p class="eyebrow">Component library</p>
    <h1>Components</h1>
    <p>
      A compact guide to the shared UI surface, so designers and engineers can see the token-powered elements
      that ship across First Springfield’s site.
    </p>
  </section>

  <section class="component-section">
    <header>
      <h2>Buttons</h2>
      <p>Variants + sizes use the shared tokens so CTAs feel consistent anywhere they appear.</p>
    </header>

    <div class="component-grid component-grid--variants">
      {buttonVariants.map(({ label, variant }) => (
        <article>
          <p class="component-label">{label}</p>
          <Button variant={variant} size="md">{label}</Button>
        </article>
      ))}
    </div>

    <div class="component-grid component-grid--sizes">
      {buttonSizes.map(({ label, size }) => (
        <article>
          <p class="component-label">{label}</p>
          <Button variant="primary" size={size}>{label}</Button>
        </article>
      ))}
    </div>

    <div class="component-grid component-grid--states">
      <article>
        <p class="component-label">Disabled</p>
        <Button variant="primary" size="md" disabled>Disabled</Button>
      </article>
      <article>
        <p class="component-label">Focus-visible</p>
        <Button variant="primary" size="md" autoFocus>Focus state</Button>
      </article>
    </div>
    <p class="component-hint">Use Tab (or the demo focus button) to see the outline from the site-wide focus token.</p>
  </section>

  <section class="component-section">
    <header>
      <h2>Links + external icon behavior</h2>
      <p>Shared link styles highlight internal links and signal external destinations.</p>
    </header>
    <div class="component-grid component-grid--links">
      {linkSamples.map(({ label, href, helper, external }) => (
        <a
          class="component-link"
          href={href}
          target={external ? "_blank" : undefined}
          rel={external ? "noreferrer noopener" : undefined}
        >
          <span>{label}</span>
          <span class="component-link__hint">{helper}</span>
          {external ? <span aria-hidden="true" class="component-link__icon">↗</span> : null}
        </a>
      ))}
    </div>
  </section>

  <section class="component-section">
    <header>
      <h2>Banner states</h2>
      <p>Alert banners sport info or warn tones to stay calm yet clear.</p>
    </header>
    <div class="component-grid component-grid--banners">
      <Banner message="Service updates land here before they reach the hero." tone="info" ctaLabel="Read service updates" ctaHref="/connect/about" />
      <Banner message="Safety and campus policies use the warning tone." tone="warn" ctaLabel="Welcoming summary" ctaHref="/connect/worship-with-us" />
    </div>
  </section>

  <section class="component-section">
    <header>
      <h2>Cards & badges</h2>
      <p>Cards stretch into grids; badges keep metadata compact.</p>
    </header>
    <div class="component-grid component-grid--cards">
      {cards.map((card) => (
        <Card title={card.title} description={card.description} href={card.href} />
      ))}
    </div>
    <div class="badge-row">
      {badges.map((badge) => (
        <span class={badge.className}>{badge.label}</span>
      ))}
    </div>
  </section>

  <section class="component-section">
    <header>
      <h2>Table & list styles</h2>
      <p>Responsive tables and stacks keep content legible on every viewport.</p>
    </header>
    <div class="component-table-wrapper">
      <table class="component-table">
        <thead>
          <tr>
            <th scope="col">Component</th>
            <th scope="col">Usage</th>
            <th scope="col">Pattern</th>
          </tr>
        </thead>
        <tbody>
          {tableRows.map((row) => (
            <tr>
              <td>{row.component}</td>
              <td>{row.usage}</td>
              <td>{row.pattern}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    <ul class="component-list">
      {listItems.map((item) => (
        <li>{item}</li>
      ))}
    </ul>
  </section>
</BaseLayout>

<style>
  .eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.2em;
    font-size: var(--font-size-0);
    margin-bottom: var(--space-2);
    color: var(--color-text-muted);
  }

  .component-hero {
    margin-bottom: var(--space-8);
  }

  .component-section {
    margin-bottom: var(--space-10);
  }

  .component-section header h2 {
    margin: 0 0 var(--space-2);
  }

  .component-section header p {
    margin: 0;
    color: var(--color-text-muted);
  }

  .component-grid {
    display: grid;
    gap: var(--space-4);
    margin-top: var(--space-4);
  }

  .component-grid--variants,
  .component-grid--sizes,
  .component-grid--states {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  .component-grid--links {
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  }

  .component-grid--cards {
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .component-grid--banners {
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .component-label {
    margin: 0;
    font-size: var(--font-size-0);
    color: var(--color-text-muted);
  }

  .component-hint {
    margin-top: var(--space-3);
    font-size: var(--font-size-0);
    color: var(--color-text-muted);
  }

  .component-link {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    padding: var(--space-3);
    text-decoration: none;
    color: inherit;
    background: var(--color-surface);
  }

  .component-link:hover,
  .component-link:focus-visible {
    border-color: var(--color-border-strong);
    box-shadow: var(--shadow-1);
  }

  .component-link__hint {
    font-size: var(--font-size-0);
    color: var(--color-text-muted);
  }

  .component-link__icon {
    font-size: 0.9rem;
    color: var(--color-primary);
  }

  .badge-row {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
    margin-top: var(--space-4);
  }

  .component-table-wrapper {
    overflow-x: auto;
    margin-top: var(--space-4);
  }

  .component-table {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid var(--color-border);
  }

  .component-table th,
  .component-table td {
    padding: var(--space-3);
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  .component-table th {
    font-size: var(--font-size-0);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--color-text-muted);
  }

  .component-list {
    margin-top: var(--space-4);
    padding-left: 1.2rem;
    color: var(--color-text);
  }

  .component-list li + li {
    margin-top: var(--space-2);
  }

  @media (max-width: 640px) {
    .component-grid--variants,
    .component-grid--sizes,
    .component-grid--states {
      grid-template-columns: 1fr;
    }
  }
</style>
</file>

<file path="web/tests/e2e/content-collections.spec.ts">
import { expect, test } from "@playwright/test";

test("Events hub loads", async ({ page }) => {
  await page.goto("/events");
  await expect(
    page.getByRole("heading", { name: "Events", exact: true }),
  ).toBeVisible();
});

test("Ministries hub loads", async ({ page }) => {
  await page.goto("/ministries");
  await expect(page.getByRole("heading", { name: "Ministries", exact: true })).toBeVisible();
});

test("Resources hub loads", async ({ page }) => {
  await page.goto("/resources");
  await expect(
    page.getByRole("heading", { name: "Resources", exact: true }),
  ).toBeVisible();
});
</file>

<file path="web/tests/e2e/phase-7-a11y.spec.ts">
import AxeBuilder from "@axe-core/playwright";
import { expect, test } from "@playwright/test";

const PAGES = [
  "/",
  "/components",
  "/connect/plan-a-visit",
  "/connect/team",
  "/events",
  "/resources",
  "/media",
  "/search",
];

for (const path of PAGES) {
  test(`a11y (axe) - ${path}`, async ({ page }) => {
    await page.goto(path);

    if (path === "/search") {
      await page
        .locator("#site-search input.pagefind-ui__search-input")
        .waitFor();

      // Ensure the Pagefind input has a real label (axe: label-title-only)
      await page.evaluate(() => {
        const root = document.getElementById("site-search");
        const input = root?.querySelector(
          "input.pagefind-ui__search-input",
        ) as HTMLInputElement | null;
        const label = document.getElementById(
          "site-search-label",
        ) as HTMLLabelElement | null;

        if (!input || !label) return;

        input.id = "site-search-input";
        input.setAttribute("aria-labelledby", "site-search-label");
        input.setAttribute("aria-label", "Search the site");
        input.removeAttribute("title");
      });
    }

    const results = await new AxeBuilder({ page }).analyze();

    const highImpact = results.violations.filter((v) =>
      ["serious", "critical"].includes(v.impact ?? ""),
    );

    expect(highImpact).toEqual([]);
  });
}
</file>

<file path="web/tsconfig.json">
{
  "extends": "astro/tsconfigs/strict",
  "compilerOptions": {
    "resolveJsonModule": true
  },
  "include": [".astro/types.d.ts", "**/*"],
  "exclude": ["dist", "node_modules", "node_modules.bak"]
}
</file>

<file path="web/src/components/content/ContentCard.astro">
---
export interface Props {
  href: string;
  title: string;
  summary: string;
  meta?: string;
  tags?: string[];
}

const { href, title, summary, meta, tags } = Astro.props;
const safeTags = tags ?? [];
---

<a class="card card--link stack--tight" href={href}>
  {meta && <p class="muted small">{meta}</p>}
  <h3>
    <span class="link">{title}</span>
  </h3>
  <p class="card-summary">{summary}</p>

  {safeTags.length > 0 && (
    <ul class="tags" aria-label="Tags">
      {safeTags.map((t) => (
        <li class="tag">{t}</li>
      ))}
    </ul>
  )}
</a>

<style>
  h3 {
    margin: 0;
    font-size: var(--type-scale-h3-size);
    line-height: var(--type-scale-h3-line-height);
    font-weight: var(--type-scale-h3-weight);
  }

  .card-summary {
    margin: 0;
    font-size: var(--type-scale-body-size);
    line-height: var(--type-scale-body-line-height);
    color: var(--color-text);
  }
</style>
</file>

<file path="web/src/components/sections/CardGrid.astro">
---
import Card from "../ui/Card.astro";
import Grid from "../ui/CardGrid.astro";
import SectionHeading from "../ui/SectionHeading.astro";

type CardItem = {
  title: string;
  description?: string;
  href?: string;
};

type Props = {
  title?: string;
  subtitle?: string;
  cards: CardItem[];
  columns?: number;
  columnsMin?: number;
  class?: string;
};

const {
  title,
  subtitle,
  cards,
  columns,
  columnsMin = 240,
  class: className = "",
} = Astro.props;
const sectionClasses = ["stack", className].filter(Boolean).join(" ");
---

<section class={sectionClasses}>
  {(title || subtitle) && (
    <SectionHeading title={title} subtitle={subtitle} />
  )}

  <Grid columns={columns} columnsMin={columnsMin}>
    {cards.map((c) => (
      <Card title={c.title} description={c.description} href={c.href} />
    ))}
  </Grid>
</section>
</file>

<file path="web/src/components/sections/RecurringActivities.astro">
---
import { oneOffEvents, recurringActivities } from "../../data/activities";
import type { ActivityCategory, RecurringActivity } from "../../data/activities";
import { site } from "../../data/site";
import SectionHeading from "../ui/SectionHeading.astro";

type Props = {
  title?: string;
  subtitle?: string;
  showNotes?: boolean;
};

const { title = "Activities", subtitle, showNotes = true } = Astro.props;

const now = new Date();
const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
const fmtDate = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone
});
const fmtDateTime = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeStyle: "short",
  timeZone: site.timeZone
});

const isFilled = (value?: string) => Boolean(value && value.trim() && value !== "TBD");
const cleanedRecurring = recurringActivities.filter((activity) => {
  const title = activity.title?.trim();
  if (!title || title.toLowerCase().startsWith("etc")) {
    return false;
  }
  return isFilled(activity.cadence) || isFilled(activity.time);
});

const oneOffUpcoming = oneOffEvents
  .map((event) => {
    const startAt = new Date(event.start);
    return {
      ...event,
      startAt,
      hasTime: event.start.includes("T")
    };
  })
  .filter((event) => {
    if (Number.isNaN(event.startAt.valueOf())) {
      return false;
    }
    return event.hasTime ? event.startAt >= now : event.startAt >= startOfToday;
  })
  .sort((a, b) => a.startAt.valueOf() - b.startAt.valueOf());

const buildScheduleLine = (activity: RecurringActivity) => {
  const parts: string[] = [];
  const day = activity.day?.trim();
  if (day) {
    parts.push(day);
  }
  const time = activity.time?.trim();
  if (time) {
    parts.push(time);
  }
  return parts.join(" · ");
};

const recurringGroupOrder: (ActivityCategory | "other")[] = [
  "service",
  "ministry",
  "community",
  "event",
  "other"
];

const activityGroupLabels: Record<ActivityCategory | "other", string> = {
  service: "Worship & service",
  ministry: "Study & discipleship",
  community: "Community & outreach",
  event: "Special events",
  other: "Other gatherings"
};

const groupedRecurring = cleanedRecurring.reduce<Record<ActivityCategory | "other", RecurringActivity[]>>(
  (groups, activity) => {
    const key = (activity.category ?? "other") as ActivityCategory | "other";
    if (!groups[key]) {
      groups[key] = [];
    }
    groups[key].push(activity);
    return groups;
  },
  {} as Record<ActivityCategory | "other", RecurringActivity[]>
);

const activeRecurringGroups = recurringGroupOrder.filter((groupKey) => groupedRecurring[groupKey]?.length);

const describeRecurringActivity = (activity: RecurringActivity) => {
  const scheduleLine = buildScheduleLine(activity);
  const cadence = activity.cadence?.trim();
  const schedule = scheduleLine || cadence || "Details coming soon";
  const metadata = scheduleLine && cadence && cadence !== scheduleLine ? cadence : undefined;
  return { schedule, metadata };
};
---

<section class="stack">
  <SectionHeading title={title} subtitle={subtitle} />

  {oneOffUpcoming.length > 0 && (
    <div class="activity-section stack--tight">
      <h3 class="activity-section__title">One-off events</h3>
      <div class="activity-list" role="list">
        {oneOffUpcoming.map((event) => (
          <article class="activity-card" role="listitem">
            <p class="activity-card__schedule">
              {event.hasTime ? fmtDateTime.format(event.startAt) : fmtDate.format(event.startAt)}
            </p>
            <div class="activity-card__heading">
              {event.link ? (
                <a class="activity-card__title" href={event.link}>
                  {event.title}
                </a>
              ) : (
                <span class="activity-card__title">{event.title}</span>
              )}
            </div>
            {showNotes && event.note && (
              <p class="activity-card__note">{event.note}</p>
            )}
          </article>
        ))}
      </div>
    </div>
  )}

  {activeRecurringGroups.length > 0 && (
    <div class="activity-section stack--tight">
      <h3 class="activity-section__title">Recurring activities</h3>
      {activeRecurringGroups.map((groupKey) => {
        const activities = groupedRecurring[groupKey] ?? [];
        return (
          <div class="activity-group">
            <h4 class="activity-group__heading">
              {activityGroupLabels[groupKey] ?? "Activities"}
            </h4>
            <div class="activity-list" role="list">
              {activities.map((activity) => {
                const { schedule, metadata } = describeRecurringActivity(activity);
                return (
                  <article class="activity-card" role="listitem">
                    <p class="activity-card__schedule">{schedule}</p>
                    <div class="activity-card__heading">
                      {activity.link ? (
                        <a class="activity-card__title" href={activity.link}>
                          {activity.title}
                        </a>
                      ) : (
                        <span class="activity-card__title">{activity.title}</span>
                      )}
                    </div>
                    {metadata && (
                      <p class="activity-card__meta">{metadata}</p>
                    )}
                    {showNotes && activity.note && (
                      <p class="activity-card__note">{activity.note}</p>
                    )}
                  </article>
                );
              })}
            </div>
          </div>
        );
      })}
    </div>
  )}
</section>

<style>
  .activity-section {
    display: grid;
    gap: var(--space-4);
  }

  .activity-section__title {
    margin: 0;
    font-size: var(--type-scale-h3-size);
  }

  .activity-group + .activity-group {
    margin-top: var(--space-4);
  }

  .activity-group__heading {
    margin: 0;
    font-size: var(--font-size-1);
    font-weight: 600;
    margin-bottom: var(--space-3);
  }

  .activity-list {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-4);
    background: var(--color-surface);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .activity-card {
    padding: var(--space-5) var(--space-6);
    display: grid;
    gap: var(--space-3);
    background: var(--color-surface);
  }

  .activity-card + .activity-card {
    border-top: 1px solid var(--color-border);
  }

  .activity-card__heading {
    display: flex;
    align-items: baseline;
  }

  .activity-card__title {
    font-size: var(--font-size-3);
    font-weight: 600;
    color: inherit;
    text-decoration: none;
  }

  .activity-card__title:hover {
    text-decoration: underline;
  }

  .activity-card__schedule {
    margin: 0;
    font-size: var(--type-scale-small-size);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--color-text-muted);
  }

  .activity-card__meta {
    margin: 0;
    font-size: var(--type-scale-body-size);
    color: var(--color-text-muted);
  }

  .activity-card__note {
    margin: 0;
    font-size: var(--type-scale-small-size);
    color: var(--color-text-muted);
  }
</style>
</file>

<file path="web/src/components/ui/Button.astro">
---
export type Variant = "primary" | "secondary" | "tertiary" | "ghost";
export type Size = "sm" | "md" | "lg";

type Props = {
  href?: string;
  external?: boolean;
  variant?: Variant;
  size?: Size;
  disabled?: boolean;
  autoFocus?: boolean;
};

const {
  href,
  external = false,
  variant = "primary",
  size = "md",
  disabled = false,
  autoFocus = false,
} = Astro.props as Props;

const className = `btn btn--${variant} btn--${size}`;
---

{href ? (
  <a
    class={className}
    href={href}
    target={external ? "_blank" : undefined}
    rel={external ? "noopener noreferrer" : undefined}
  >
    <slot />
  </a>
) : (
  <button class={className} type="button" disabled={disabled} autofocus={autoFocus}>
    <slot />
  </button>
)}

<style>
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    border-radius: var(--radius-2);
    text-decoration: none;
    font-weight: 700;
    border: 1px solid transparent;
    cursor: pointer;
    min-height: var(--target-min);
  }

  .btn--sm {
    font-size: var(--font-size-0);
    padding: var(--space-2) var(--space-3);
  }

  .btn--md {
    font-size: var(--font-size-1);
    padding: var(--space-2) var(--space-4);
  }

  .btn--lg {
    font-size: var(--font-size-2);
    padding: var(--space-3) var(--space-6);
  }

  .btn--primary {
    background: var(--color-primary);
    color: var(--color-white);
  }

  .btn--primary:hover {
    background: var(--color-primary-hover);
  }

  .btn--secondary {
    background: var(--color-gray-50);
    border-color: var(--color-border);
  }

  .btn--secondary:hover {
    background: var(--color-gray-100);
  }

  .btn--tertiary {
    background: transparent;
    border-color: transparent;
    color: var(--color-primary-link);
    text-decoration: underline;
    text-underline-offset: 0.18em;
    text-decoration-thickness: 0.18em;
  }

  .btn--tertiary:hover {
    color: var(--color-primary-hover);
    text-decoration-thickness: 0.21em;
  }

  .btn--ghost {
    background: transparent;
    border-color: var(--color-border);
    color: var(--color-primary);
  }

  .btn--ghost:hover {
    background: var(--color-gray-50);
  }

  .btn:disabled {
    opacity: 0.65;
    cursor: not-allowed;
  }
</style>
</file>

<file path="web/src/components/Footer.astro">
---
import { site } from "../data/site";

const year = new Date().getFullYear();
---

<footer class="footer">
  <div class="container footer__inner">
    <div class="footer__cols">
      <div>
        <div class="footer__title">{site.name}</div>
        <p class="muted" style="margin: 0;">
          <a href={site.contact.mapsUrl} target="_blank" rel="noopener noreferrer">
            {site.contact.address}
          </a>
        </p>
      </div>

      <div>
        <div class="footer__title">Contact</div>
        <ul class="footer__list">
          <li><a href={`tel:${site.contact.phone.replace(/[^0-9+]/g, "")}`}>{site.contact.phone}</a></li>
          <li><a href={`mailto:${site.contact.email}`}>{site.contact.email}</a></li>
          <li><a href="/connect/contact">Contact page</a></li>
        </ul>
      </div>

      <div>
        <div class="footer__title">Service times</div>
        <ul class="footer__list">
          {site.schedule.map((item) => (
            <li><strong>{item.label}:</strong> {item.day} - {item.time}</li>
          ))}
        </ul>
      </div>

      <div>
        <div class="footer__title">Links</div>
        <div class="nav" aria-label="Footer links">
          <a href="/give">Give</a>
          <a href="/media/live">Watch Live</a>
          <a href="/resources/bulletins">Bulletins</a>
          <a href="/resources/forms">Forms</a>
        </div>
        <div class="nav" aria-label="Social links" style="margin-top: var(--space-2);">
          {site.social.map((item) => (
            <a href={item.href} target="_blank" rel="noopener noreferrer">{item.label}</a>
          ))}
        </div>
      </div>
    </div>

    <div class="small muted">© {year} {site.name}</div>
  </div>
</footer>
</file>

<file path="web/src/data/site-links.json">
{
  "givingUrl": "https://adventistgiving.org/",
  "youtubeChannelUrl": "https://www.youtube.com/@1stspringfieldsdama74",
  "youtubeLiveEmbedUrl": "https://www.youtube.com/embed/live_stream?channel=UCkmryvqlHb3JIwVLc07FZwA",
  "facebookUrl": "https://www.facebook.com/firstspringfieldsda/",
  "prayerFormUrl": "",
  "contactFormUrl": "",
  "volunteerFormUrl": "",
  "bulletinsUrl": "/resources/bulletins",
  "announcementsUrl": "/resources/announcements",
  "oldWebsiteUrl": "https://firstspringfieldma.adventistchurch.org/"
}
</file>

<file path="web/src/pages/connect/plan-a-visit/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import PlanVisitContent from "../../../components/PlanVisitContent.astro";
import { site } from "../../../data/site";
---

<BaseLayout
  title="Plan a Visit"
  description={`Service times, directions, parking, and what to expect when visiting ${site.name}.`}
>
  <PlanVisitContent />
</BaseLayout>
</file>

<file path="web/src/pages/connect/prayer/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import { site } from "../../../data/site";

const prayerFormUrl = site.portals?.prayerFormUrl;
const hasPrayerForm = Boolean(prayerFormUrl && prayerFormUrl !== "TBD");
---

<BaseLayout title="Prayer Request" description={`Submit a prayer request to ${site.name}.`}>
  <div class="stack">
    <h1>Prayer Request</h1>

    <section class="card stack">
      <h2>How can we pray for you?</h2>
      <p class="muted">
        We believe prayer matters. Share a request and our prayer team will pray with you.
      </p>

      <div class="cluster">
        {hasPrayerForm ? (
          <Button href={prayerFormUrl} external variant="secondary">Submit Prayer Request</Button>
        ) : (
          <Button href={`mailto:${site.contact.email}?subject=Prayer%20Request`} variant="secondary">
            Email a Prayer Request
          </Button>
        )}
        <Button href="/connect/contact" variant="tertiary">Contact</Button>
      </div>

      <p class="small muted">
        Please avoid including sensitive information.
      </p>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/connect/worship-with-us/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Schedule from "../../../components/ui/Schedule.astro";
import { site } from "../../../data/site";
import { prayerMeetingDetails } from "../../../data/activities";
---

<BaseLayout
  title="Worship With Us"
  description={`Learn what Sabbath School, Worship Service, and midweek Prayer Meeting are like at ${site.name}.`}
>
  <div class="stack">
    <h1>Worship With Us</h1>

    <Schedule title="Weekly Schedule" items={site.schedule} />

    <section class="card stack--tight">
      <h2>Sabbath School</h2>
      <p class="muted">
        Sabbath School is a Bible study time for all ages, with classes for children and adults.
      </p>
    </section>

    <section class="card stack--tight">
      <h2>Worship Service</h2>
      <p class="muted">
        Our worship service includes singing, prayer, Scripture, and a message from the Bible.
      </p>
    </section>

    <section class="card stack--tight">
      <h2>Midweek Prayer Meeting</h2>
      <p class="muted">
        Join us midweek for prayer, encouragement, and Bible study.
      </p>
      <ul class="muted">
        <li><strong>When:</strong> {prayerMeetingDetails.day} · {prayerMeetingDetails.time}</li>
        <li><strong>In person:</strong> {prayerMeetingDetails.location}</li>
        <li><strong>Online:</strong>
          <a href={prayerMeetingDetails.zoomUrl} target="_blank" rel="noreferrer">Join via Zoom</a>
        </li>
        <li><strong>Dial-in:</strong> {prayerMeetingDetails.dialIn}</li>
        <li><strong>Meeting ID:</strong> {prayerMeetingDetails.meetingId}</li>
        <li><strong>Passcode:</strong> {prayerMeetingDetails.passcode}</li>
      </ul>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/media/live/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import YouTubeEmbed from "../../../components/ui/YouTubeEmbed.astro";
import Button from "../../../components/ui/Button.astro";
import { site } from "../../../data/site";

const hasEmbed = site.portals.youtubeLiveEmbedUrl && site.portals.youtubeLiveEmbedUrl !== "TBD";
const hasYouTube = site.portals.youtubeChannelUrl && site.portals.youtubeChannelUrl !== "TBD";
---

<BaseLayout title="Watch Live" description={`Watch ${site.shortName} live.`}>
  <div class="stack">
    <h1>Watch Live</h1>

    {hasEmbed ? (
      <YouTubeEmbed
        title={`${site.shortName} Live`}
        embedUrl={site.portals.youtubeLiveEmbedUrl}
      />
    ) : (
      <section class="card stack--tight">
        <h2>Live stream coming soon</h2>
        <p class="muted">
          We’re preparing a live stream. Check back soon or join us in person.
        </p>
        <div class="cluster">
          <Button href="/connect/plan-a-visit" variant="secondary">Plan a Visit</Button>
          <Button href="/media/videos" variant="tertiary">Watch Videos</Button>
        </div>
      </section>
    )}

    {hasYouTube ? (
      <Button href={site.portals.youtubeChannelUrl} external variant="secondary">
        Open YouTube channel
      </Button>
    ) : (
      <p class="small muted">
        YouTube channel coming soon.
      </p>
    )}
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/ministries/[id].astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import HeroSection from "../../components/sections/Hero.astro";
import { getCollection, getEntry, render } from "astro:content";
import { mailto } from "../../lib/links";

export async function getStaticPaths() {
  const ministries = await getCollection("ministries", ({ data }) =>
    import.meta.env.PROD ? data.draft !== true : true
  );
  return ministries.map((m) => ({ params: { id: m.id } }));
}

const { id } = Astro.params;

const ministry = await getEntry("ministries", id!);
if (!ministry) throw new Error(`Ministry not found: ${id}`);

const data: any = (ministry as any).data ?? {};
const isFilled = (value?: string) => Boolean(value && value.trim() && value !== "TBD");
const meetingTime = isFilled(data.meetingTime) ? data.meetingTime : "";
const leaderName = isFilled(data.leaderName) ? data.leaderName : "";
const leaderEmail = isFilled(data.leaderEmail)
  ? data.leaderEmail
  : isFilled(data.contactEmail)
    ? data.contactEmail
    : "";
const fallbackMessage = "Contact us for current meeting details.";

const { Content } = await render(ministry);

const title =
  data.title ??
  (typeof id === "string"
    ? id.replace(/[-_]/g, " ").replace(/\b\w/g, (c) => c.toUpperCase())
    : "Ministry");

const description =
  data.description ?? data.summary ?? `Learn more about ${title}.`;
const heroSubtitle = data.summary ?? description;
---

<BaseLayout title={title} description={description}>
  <div class="stack">
    <HeroSection title={title} subtitle={heroSubtitle}>
      {meetingTime ? (
        <article slot="meta" class="hero__meta-item">
          <p class="hero__meta-label">Meeting time</p>
          <p class="hero__meta-value">{meetingTime}</p>
        </article>
      ) : (
        <article slot="meta" class="hero__meta-item">
          <p class="hero__meta-label">Meeting time</p>
          <p class="hero__meta-value">
            <a class="hero__meta-link" href="/connect/contact">{fallbackMessage}</a>
          </p>
        </article>
      )}

      <article slot="meta" class="hero__meta-item">
        <p class="hero__meta-label">Contact</p>
        {leaderName && <p class="hero__meta-leader">{leaderName}</p>}
        {leaderEmail ? (
          <a
            class="hero__meta-link hero__meta-email"
            href={mailto(leaderEmail, `${title} ministry`)}
          >
            {leaderEmail}
          </a>
        ) : (
          <a class="hero__meta-link" href="/connect/contact">{fallbackMessage}</a>
        )}
      </article>
    </HeroSection>

    <section class="card">
      <div class="prose">
        <Content />
      </div>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/pages/resources/index.astro">
---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import ContentCard from '../../components/content/ContentCard.astro';
import { getCollection } from 'astro:content';
import { site } from '../../data/site';

const resources = await getCollection('resources', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const latest = resources
  .sort((a, b) => b.data.published.valueOf() - a.data.published.valueOf())
  .slice(0, 15);

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'medium',
  timeZone: site.timeZone
});
---

<BaseLayout title="Resources" description="Helpful links, forms, bulletins, and downloads.">
  <Hero title="Resources" subtitle="Downloads, forms, and helpful info." />

  <section class="stack--loose">
    <div class="grid--cards">
      <article class="card stack--tight">
        <h3>
          <a class="link" href="/search">Search</a>
        </h3>
        <p class="muted">Find resources, bulletins, and more.</p>
      </article>
      <article class="card stack--tight">
        <h3><a class="link" href="/resources/bulletins">Bulletins</a></h3>
        <p class="muted">Weekly PDFs and archives.</p>
      </article>
      <article class="card stack--tight">
        <h3><a class="link" href="/resources/announcements">Announcements</a></h3>
        <p class="muted">Quick weekly notices for church life and community updates.</p>
      </article>
      <article class="card stack--tight">
        <h3><a class="link" href="/resources/forms">Forms</a></h3>
        <p class="muted">Requests, sign-ups, and contact info.</p>
      </article>
    </div>

    <div class="stack">
      <h2>Latest resources</h2>

      {latest.length === 0 ? (
        <p class="muted">No resources are published yet.</p>
      ) : (
        <div class="grid--cards">
          {latest.map((r) => (
            <ContentCard
              href={`/resources/${r.id}`}
              title={r.data.title}
              summary={r.data.summary}
              meta={fmt.format(r.data.published)}
              tags={r.data.tags}
            />
          ))}
        </div>
      )}
    </div>
  </section>
</BaseLayout>
</file>

<file path="web/src/content.config.ts">
import { glob } from "astro/loaders";
import { z } from "astro/zod";
import { defineCollection } from "astro:content";
import { announcementTagEnumValues } from "./data/announcement-tags";

const shared = z.object({
  title: z.string(),
  summary: z.string(),
  tags: z.array(z.string()).optional(),
  draft: z.boolean().optional(),
  heroImage: z.string().optional(),
});

const events = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/events" }),
  schema: shared.extend({
    start: z.coerce.date(),
    end: z.coerce.date().optional(),
    locationName: z.string().optional(),
    address: z.string().optional(),
    registrationUrl: z.string().optional(), // allow relative or absolute
  }),
});

const ministries = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/ministries" }),
  schema: shared.extend({
    leaderName: z.string().optional(),
    leaderEmail: z.string().optional(),
    meetingTime: z.string().optional(),
    contactEmail: z.string().optional(),
    contactPhone: z.string().optional(),
    category: z.string().optional(),
    ctaLabel: z.string().optional(),
    ctaHref: z.string().optional(),
  }),
});

const resources = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/resources" }),
  schema: shared.extend({
    published: z.coerce.date(),
    category: z.string().optional(),
    attachmentUrl: z.string().optional(), // allow relative or absolute
    externalUrl: z.string().optional(),
  }),
});

const devotionals = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/devotionals" }),
  schema: shared.extend({
    date: z.coerce.date(),
    link: z.string().optional(),
  }),
});

const bulletins = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/bulletins" }),
  schema: z.object({
    title: z.string(),
    summary: z.string().optional(),
    date: z.coerce.date(),
    pdfUrl: z.string(), // your content uses /bulletins/... :contentReference[oaicite:4]{index=4}
    draft: z.boolean().optional(),
  }),
});

const announcements = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/announcements" }),
  schema: z.object({
    title: z.string(),
    date: z.coerce.date(),
    tags: z.array(z.enum(announcementTagEnumValues)).optional(),
    summary: z.string(),
    featured: z.boolean().optional(),
    expires: z.coerce.date().optional(),
    draft: z.boolean().optional(),
  }),
});

const updates = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/updates" }),
  schema: shared.extend({
    date: z.coerce.date(),
    category: z.enum(["weather", "building", "schedule"]),
  }),
});

const verses = defineCollection({
  loader: glob({ pattern: "**/[^_]*.md", base: "./src/content/verses" }),
  schema: z.object({
    date: z.coerce.date(),
    reference: z.string(),
    verseText: z.string(),
    translation: z.string(),
    draft: z.boolean().optional(),
  }),
});

export const collections = {
  events,
  ministries,
  resources,
  devotionals,
  bulletins,
  announcements,
  updates,
  verses,
};
</file>

<file path="web/astro.config.mjs">
import cloudflare from "@astrojs/cloudflare";
import mdx from "@astrojs/mdx";
import sitemap from "@astrojs/sitemap";
import compress from "astro-compress";
import icon from "astro-icon";
import { defineConfig } from "astro/config";

const site = process.env.PUBLIC_SITE_URL;

async function tryLoadPagefindIntegration() {
  try {
    const { default: pagefind } = await import("astro-pagefind");
    return pagefind();
  } catch (error) {
    if (error?.code === "ERR_UNSUPPORTED_NODE_MODULES_TYPE_STRIPPING") {
      console.warn(
        "[astro-pagefind] Skipping the search integration because Node cannot strip TypeScript in node_modules. " +
          "Run Node 24 or lower to keep search enabled."
      );
      return null;
    }
    throw error;
  }
}

const pagefindIntegration = await tryLoadPagefindIntegration();

export default defineConfig({
  // Used for canonical URLs + sitemap/robots generation.
  // In Cloudflare Pages: set PUBLIC_SITE_URL to your production domain (e.g. https://example.org)
  site: site ?? "http://localhost:4321",
  trailingSlash: "never",

  integrations: [
    mdx(),
    icon(),
    compress(),
    ...(pagefindIntegration ? [pagefindIntegration] : []),
    sitemap({
      // Internal site search is not a page you want indexed.
      filter: (page) => !page.endsWith("/search"),
    }),
  ],

  output: "static",
  adapter: cloudflare(),
  vite: {
    ssr: {
      noExternal: ["@fontsource-variable/inter"],
    },
  },
});
</file>

<file path="web/src/components/global/Header.astro">
---
import { Image } from "astro:assets";
import Button from "../ui/Button.astro";
import churchLogo from "../../assets/photos/church-logo-primary.jpg";
import { site } from "../../data/site";

const pathname = Astro.url?.pathname ?? "/";

function isActive(href: string) {
  if (href === "/") return pathname === "/";
  return pathname === href || pathname.startsWith(href + "/");
}

function linkAttrs(item: { href: string; external?: boolean }) {
  return item.external ? { target: "_blank", rel: "noopener noreferrer" } : {};
}

const utilityNavLabels = new Set(["Events", "Privacy"]);
const primaryNav = site.nav.filter((item) => !utilityNavLabels.has(item.label));
const utilityNav = site.nav.filter((item) => utilityNavLabels.has(item.label));

const watchLive = site.quickActions.find((i) => i.label === "Watch Live") ?? site.quickActions[0];
const give = site.quickActions.find((i) => i.label === "Give") ?? site.quickActions[1];
const otherQuick = site.quickActions.filter((i) => i.label !== watchLive?.label && i.label !== give?.label);
---

<header class="site-header">
  <div class="inner">
    <a class="brand" href="/" aria-label={site.name}>
      <Image
        src={churchLogo}
        alt={`${site.name} logo`}
        widths={[36, 44, 56]}
        sizes="48px"
        loading="eager"
        decoding="async"
        class="brand__logo"
      />
      <span class="brand__title">{site.shortName}</span>
    </a>

    <nav class="nav nav--desktop" aria-label="Primary navigation">
      {primaryNav.map((item) => (
        <a
          href={item.href}
          aria-current={isActive(item.href) ? "page" : undefined}
          {...linkAttrs(item)}
        >
          {item.label}
        </a>
      ))}
    </nav>

    <div class="right">
      <div class="cta cta--desktop" aria-label="Primary actions">
        {watchLive && (
          <Button href={watchLive.href} variant="secondary" size="sm" external={!!watchLive.external}>
            {watchLive.label}
          </Button>
        )}
        {give && (
          <Button href={give.href} variant="primary" size="sm" external={!!give.external}>
            {give.label}
          </Button>
        )}
      </div>

      <div class="cta cta--mobile" aria-label="Primary actions">
        {watchLive && (
          <Button href={watchLive.href} variant="secondary" size="sm" external={!!watchLive.external}>
            {watchLive.label}
          </Button>
        )}
        {give && (
          <Button href={give.href} variant="primary" size="sm" external={!!give.external}>
            {give.label}
          </Button>
        )}
      </div>

      <details class="menu" aria-label="Mobile menu">
        <summary class="menu__summary" aria-label="Open menu">
          <span class="menu__icon" aria-hidden="true">☰</span>
          <span class="menu__label">Menu</span>
        </summary>

        <div class="menu__panel">
          <div class="menu__section" aria-label="Primary navigation" role="navigation">
            {site.nav.map((item) => (
              <a
                class="menu__link"
                href={item.href}
                aria-current={isActive(item.href) ? "page" : undefined}
                {...linkAttrs(item)}
              >
                {item.label}
              </a>
            ))}
          </div>

          <div class="menu__divider" role="separator" aria-hidden="true"></div>

          <div class="menu__section" aria-label="Quick actions">
            <div class="menu__actions">
              {watchLive && (
                <Button href={watchLive.href} variant="secondary" size="sm" external={!!watchLive.external}>
                  {watchLive.label}
                </Button>
              )}
              {give && (
                <Button href={give.href} variant="primary" size="sm" external={!!give.external}>
                  {give.label}
                </Button>
              )}
            </div>

            {otherQuick.length > 0 && (
              <div class="menu__quicklinks" aria-label="More quick links">
                {otherQuick.map((item) => (
                  <a class="menu__sublink" href={item.href} {...linkAttrs(item)}>
                    {item.label}
                  </a>
                ))}
              </div>
            )}
          </div>
        </div>
      </details>
    </div>
  </div>

  {utilityNav.length > 0 && (
    <nav class="utility-bar" aria-label="Utility navigation">
      {utilityNav.map((item) => (
        <a href={item.href} {...linkAttrs(item)}>
          {item.label}
        </a>
      ))}
    </nav>
  )}
</header>

<script>
  // Close the mobile menu when a link is clicked.
  document.addEventListener("click", (e) => {
    const target = e.target;
    if (!(target instanceof HTMLElement)) return;

    const link = target.closest("a");
    const details = target.closest("details.menu");
    if (link && details) details.removeAttribute("open");
  });
</script>

<style>
  .site-header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: var(--color-white);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .inner {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: var(--space-3) var(--container-pad);
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: var(--space-4);
  }

  .utility-bar {
    width: 100%;
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 0 var(--container-pad) var(--space-1);
    display: flex;
    justify-content: flex-end;
    gap: var(--space-3);
    border-top: 1px solid var(--color-border);
    background: var(--color-gray-50);
    font-size: var(--font-size-0);
  }

  .utility-bar a {
    color: var(--color-text);
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: var(--target-min);
    padding: 0.45rem 0.85rem;
    border-radius: var(--radius-2);
  }

  .utility-bar a:hover,
  .utility-bar a:focus-visible {
    text-decoration: underline;
  }

  .brand {
    text-decoration: none;
    color: inherit;
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    min-width: max-content;
  }

  .brand__logo {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-3);
    object-fit: contain;
    flex-shrink: 0;
  }

  .brand__title {
    font-weight: 800;
    letter-spacing: -0.02em;
    font-size: var(--font-size-2);
  }

  .nav {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    justify-content: center;
    flex-wrap: wrap;
  }

  .nav a {
    display: inline-flex;
    align-items: center;
    min-height: var(--target-min);
    text-decoration: none;
    color: inherit;
    font-weight: 700;
    opacity: 0.9;
    padding: 0.65rem 0.9rem;
    min-width: var(--target-min);
    justify-content: center;
    border-radius: 999px;
  }

  .nav a:hover {
    background: var(--color-gray-50);
    opacity: 1;
  }

  .nav a[aria-current="page"] {
    background: var(--color-gray-100);
    opacity: 1;
  }

  .cta {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    justify-content: flex-end;
    min-width: max-content;
  }

  .right {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--space-2);
    min-width: max-content;
  }

  .cta--mobile {
    display: none;
  }

  /* Mobile menu */
  .menu {
    display: none;
    position: relative;
  }

  .menu__summary {
    list-style: none;
    cursor: pointer;
    user-select: none;
    padding: 0.65rem 0.9rem;
    border-radius: 999px;
    border: 1px solid var(--color-border);
    background: var(--color-white);
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-weight: 700;
    min-height: var(--target-min);
    min-width: var(--target-min);
  }

  .menu__summary::-webkit-details-marker {
    display: none;
  }

  .menu[open] .menu__summary {
    background: var(--color-gray-50);
  }

  .menu__panel {
    position: absolute;
    right: 0;
    top: calc(100% + 0.6rem);
    width: min(92vw, 22rem);
    background: var(--color-white);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    box-shadow: var(--shadow-2);
    padding: var(--space-3);
    z-index: 60;
  }

  .menu__section {
    display: grid;
    gap: 0.35rem;
  }

  .menu__link {
    display: flex;
    align-items: center;
    min-height: var(--target-min);
    text-decoration: none;
    color: inherit;
    font-weight: 700;
    padding: 0.6rem 0.7rem;
    border-radius: var(--radius-2);
  }

  .menu__link:hover {
    background: var(--color-gray-50);
  }

  .menu__link[aria-current="page"] {
    background: var(--color-gray-100);
  }

  .menu__divider {
    height: 1px;
    background: var(--color-border);
    margin: var(--space-3) 0;
  }

  .menu__actions {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
  }

  .menu__quicklinks {
    margin-top: var(--space-3);
    display: grid;
    gap: 0.25rem;
  }

  .menu__sublink {
    display: inline-flex;
    align-items: center;
    min-height: var(--target-min);
    text-decoration: none;
    color: inherit;
    opacity: 0.9;
    padding: 0.4rem 0.2rem;
    font-weight: 700;
  }

  .menu__sublink:hover {
    opacity: 1;
    text-decoration: underline;
  }

  @media (max-width: 860px) {
    .cta--desktop {
      display: none;
    }

    .cta--mobile {
      display: flex;
    }

    .inner {
      grid-template-columns: auto 1fr auto;
    }

    .menu {
      display: block;
    }
  }

  @media (max-width: 420px) {
    .menu__label {
      display: none;
    }

    .menu__summary {
      padding: 0.55rem 0.6rem;
    }
  }
</style>
</file>

<file path="web/src/components/ui/Banner.astro">
---
import Button from "./Button.astro";

type BannerTone = "info" | "warn";

type Props = {
  message: string;
  ctaLabel?: string;
  ctaHref?: string;
  tone?: BannerTone;
  ctaExternal?: boolean;
};

const {
  message,
  ctaLabel,
  ctaHref,
  tone = "info",
  ctaExternal = false
} = Astro.props as Props;

const toneClass = tone === "warn" ? "banner--warn" : "banner--info";
---

<section class={`banner ${toneClass}`} role="status">
  <div class="banner__inner">
    <div class="banner__msg">{message}</div>
    {ctaLabel && ctaHref ? (
      <Button href={ctaHref} variant="tertiary" size="sm" external={ctaExternal}>
        {ctaLabel}
      </Button>
    ) : null}
  </div>
</section>

<style>
  .banner {
    border: 1px solid transparent;
    border-radius: var(--radius-3);
    padding: var(--space-3) var(--space-4);
    background: var(--color-surface-2);
  }

  .banner--info {
    background: var(--color-info-bg);
    border-color: var(--color-info-border);
  }

  .banner--warn {
    background: var(--color-warn-bg);
    border-color: var(--color-warn-border);
  }

  .banner__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
    flex-wrap: wrap;
  }

  .banner__msg {
    font-weight: 800;
  }
</style>
</file>

<file path="web/src/components/ui/Card.astro">
---
type Props = {
  title: string;
  description?: string;
  href?: string;
  variant?: "standard" | "featured";
};

const { title, description, href, variant = "standard" } = Astro.props as Props;
const hasDescription = Boolean(description?.trim?.());
const classes = ["card", variant === "featured" ? "card--featured" : null, href ? "card--link" : ""].filter(Boolean).join(" ");
---

{href ? (
  <a class={classes} href={href} aria-label={title}>
    <div class="card__body">
      <div>
        <div class="card__title">{title}</div>
        {hasDescription && <p class="card__desc">{description}</p>}
      </div>
      <span class="card__cta link" aria-hidden="true">Learn more</span>
    </div>
  </a>
) : (
  <div class={classes}>
    <div class="card__body">
      <div>
        <div class="card__title">{title}</div>
        {hasDescription && <p class="card__desc">{description}</p>}
      </div>
    </div>
  </div>
)}

<style>
  .card__body {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    min-height: 160px;
    justify-content: space-between;
  }

  .card__title {
    font-weight: 800;
    font-size: var(--font-size-2);
    margin-bottom: var(--space-2);
  }

  .card__desc {
    margin: 0;
    font-size: var(--type-scale-body-size);
    line-height: var(--type-scale-body-line-height);
    color: var(--color-text);
  }

  .card__cta {
    font-weight: 700;
  }
</style>
</file>

<file path="web/src/components/ui/Hero.astro">
---
import Button from "./Button.astro";

type Props = {
  title: string;
  subtitle?: string;
  primaryCtaLabel?: string;
  primaryCtaHref?: string;
  secondaryCtaLabel?: string;
  secondaryCtaHref?: string;
  className?: string;
};

const {
  title,
  subtitle,
  primaryCtaLabel,
  primaryCtaHref,
  secondaryCtaLabel,
  secondaryCtaHref,
  className = ""
} = Astro.props as Props;
const hasMeta = Boolean(Astro.slots?.meta);
const rootClass = ["hero", "card", className].filter(Boolean).join(" ");
---

<section class={rootClass}>
  <div class="hero__inner">
    <div>
      <h1 class="hero__title">{title}</h1>
      {subtitle && <p class="hero__subtitle muted">{subtitle}</p>}
    </div>

    {hasMeta ? (
      <div class="hero__meta">
        <slot name="meta" />
      </div>
    ) : null}

    {(primaryCtaLabel && primaryCtaHref) || (secondaryCtaLabel && secondaryCtaHref) ? (
      <div class="hero__actions">
        {primaryCtaLabel && primaryCtaHref && (
          <Button href={primaryCtaHref} variant="primary">{primaryCtaLabel}</Button>
        )}
        {secondaryCtaLabel && secondaryCtaHref && (
          <Button href={secondaryCtaHref} variant="secondary">{secondaryCtaLabel}</Button>
        )}
      </div>
    ) : null}
  </div>
</section>

<style>
  .hero__inner {
    display: grid;
    gap: var(--space-4);
  }

  .hero__title {
    margin: 0;
    font-size: clamp(2.4rem, 1.8rem + 2.8vw, 3.5rem);
    line-height: 1.15;
  }

  .hero__subtitle {
    margin: var(--space-2) 0 0;
    font-size: clamp(1.05rem, 0.95rem + 0.7vw, 1.4rem);
  }

  .hero__actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .hero__meta {
    display: grid;
    gap: var(--space-4);
    margin-top: var(--space-4);
  }

  .hero__meta-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .hero__meta-label {
    margin: 0;
    font-size: 0.85rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--color-muted);
  }

  .hero__meta-value {
    margin: 0;
    font-size: 0.95rem;
  }

  .hero__meta-link {
    font-weight: 600;
  }

  .hero__meta-leader {
    font-weight: 500;
  }

  .hero__meta-email {
    font-size: 0.85rem;
    color: var(--color-muted);
  }

  @media (min-width: 720px) {
    .hero__meta {
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
  }

  .hero {
    max-width: min(560px, 100%);
    margin: 0;
    padding: clamp(1.25rem, 1rem + 0.5vw, 1.75rem);
    align-self: flex-start;
  }

  @media (max-width: 720px) {
    .hero {
      padding: var(--space-5);
    }
  }
</style>
</file>

<file path="web/src/content/ministries/pathfinders.md">
---
title: "Pathfinders & Adventurers"
summary: "The Seventh-day Adventist Church’s Adventurers and Pathfinders Clubs are Christ-centered programs designed to nurture children and youth in their spiritual, mental, physical, and social development."
leaderName: "Daunette Lemard-Reid"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "First and Third Sabbath of each month, from 3:00 PM – 5:00 PM."
category: "Children & Youth"
tags: ["children", "teens", "family", "discipleship", "adventure"]
---

## Overview

“The Seventh-day Adventist Church’s Adventurers and Pathfinders Clubs are Christ-centered programs designed to nurture children and youth in their spiritual, mental, physical, and social development.”

Pathfinders & Adventurers Club Director: Daunette Lemard-Reid

Meeting Time: First and Third Sabbath of each month, from 3:00 PM – 5:00 PM.

### Club logos

We proudly display both club insignias so families can recognize the young people’s ministry that speaks to them.

<figure>
  <img src="../../assets/photos/club-adventurers-logo.png" alt="Adventurers Club badge" width="220" loading="lazy" />
  <figcaption>Adventurers Club (ages 4–9)</figcaption>
</figure>

<figure>
  <img src="../../assets/photos/club-pathfinders-logo.png" alt="Pathfinders Club badge" width="220" loading="lazy" />
  <figcaption>Pathfinders Club (ages 10–15)</figcaption>
</figure>

## Adventurers

“The Adventurer Club is a fun, Christ-centered program for children ages 4–9 that helps them grow spiritually, socially, mentally, and physically. Through hands-on activities, Bible learning, games, and service projects, children build faith, character, confidence, friendships, and life skills in a supportive, family-focused environment while preparing for the Pathfinder journey ahead.”

## Pathfinders

“Pathfinders are a worldwide organization of young people sponsored by the Seventh-day Adventist Church, with nearly 2 million members around the globe. Young people of any religious persuasion, or none at all, are welcome and encouraged to join the organization.”

• Pathfinders (ages 10–15) provides opportunities for youth to grow in leadership, teamwork, and personal responsibility through outdoor activities, community service, spiritual growth, and practical life skills.

## Contact

To learn more about our Pathfinders and Adventurers Clubs or to get involved, email [firstspringfieldsda@gmail.com](mailto:firstspringfieldsda@gmail.com) or visit our [Contact page](/connect/contact).
</file>

<file path="web/src/data/activities.ts">
export type ActivityCategory = "service" | "ministry" | "event" | "community";

export type RecurringActivity = {
  id: string;
  title: string;
  cadence: string;
  time?: string;
  day?: string;
  link?: string;
  note?: string;
  category?: ActivityCategory;
};

export type OneOffEvent = {
  title: string;
  start: string;
  link?: string;
  note?: string;
};

export const recurringActivities: RecurringActivity[] = [
  {
    id: "sabbath-school",
    title: "Sabbath School",
    cadence: "Weekly study groups for every age",
    day: "Saturday",
    time: "10:00 AM",
    link: "/ministries/adult-sabbath-school",
    note: "Classes for children, youth, and adults in-person",
    category: "service",
  },
  {
    id: "worship-service",
    title: "Worship service",
    cadence: "Celebration via music and preaching",
    day: "Saturday",
    time: "11:15 AM",
    link: "/connect/worship-with-us",
    note: "Livestream + in-person fellowship",
    category: "service",
  },
  {
    id: "prayer-meeting",
    title: "Prayer meeting",
    cadence: "Midweek prayer, praise, and study",
    day: "Wednesday",
    time: "7:00 PM",
    link: "/connect/prayer",
    note: "Hybrid gathering with scripture focus",
    category: "service",
  },
  {
    id: "nar-anon",
    title: "Nar-Anon",
    cadence: "Thursdays · 7:00 PM – 8:30 PM in the Mother’s room",
    day: "Thursday",
    time: "7:00 PM – 8:30 PM",
    note: "Support for families and friends affected by addiction",
    category: "community",
  },
  {
    id: "pathfinders",
    title: "Pathfinders and Adventurers",
    cadence: "First and third Sabbath of each month",
    time: "3:00 PM – 5:00 PM",
    link: "/ministries/pathfinders",
    note: "Public",
    category: "ministry",
  },
  {
    id: "table-talk",
    title: "Table Talk",
    cadence: "Second Sabbath of every month",
    day: "Saturday",
    note: "Youth and young adult conversations around faith",
    link: "/ministries/youth-young-adults",
    category: "ministry",
  },
  {
    id: "board-meeting",
    title: "Board meeting",
    cadence: "Second Tuesday of every month",
    link: "/ministries/board-meeting",
    note: "Members only",
    category: "event",
  },
  {
    id: "mens-fellowship",
    title: "Men's fellowship",
    cadence: "Fridays · 7:00 PM",
    day: "Friday",
    time: "7:00 PM",
    note: "Bible study, prayer, and brotherhood",
    category: "service",
  },
  {
    id: "womens-ministry",
    title: "Women's ministry",
    cadence: "First Tuesday of every month",
    link: "/ministries/womens-ministry",
    note: "Public",
    category: "ministry",
  },
  {
    id: "community-meal",
    title: "Free spaghetti dinner",
    cadence: "Fourth Wednesday each month",
    link: "/ministries/community-meal-spaghetti",
    note: "Public outreach meal",
    category: "community",
  },
  {
    id: "bible-study",
    title: "Bible study",
    cadence: "Fourth Sabbath",
    link: "/ministries/bible-study",
    note: "Public",
    category: "ministry",
  },
];

export const oneOffEvents: OneOffEvent[] = [];

export type PrayerMeetingDetails = {
  title: string;
  day: string;
  time: string;
  location: string;
  zoomUrl: string;
  dialIn: string;
  meetingId: string;
  passcode: string;
};

const PRAYER_MEETING_ZOOM_URL =
  import.meta.env.PUBLIC_PRAYER_MEETING_ZOOM_URL ??
  "https://us02web.zoom.us/j/87430121210?pwd=QVNCRUlXcDdtU2dUSUdrbFdVdDlMUT09";

export const prayerMeetingDetails: PrayerMeetingDetails = {
  title: "Midweek Prayer Meeting",
  day: "Wednesday",
  time: "7:00 PM",
  location: "Church annex",
  zoomUrl: PRAYER_MEETING_ZOOM_URL,
  dialIn: "(646) 558-8656",
  meetingId: "874 3012 1210",
  passcode: "487844",
};
</file>

<file path="web/src/pages/give/index.astro">
---
import BaseLayout from "../../layouts/BaseLayout.astro";
import BudgetProgress from "../../components/ui/BudgetProgress.astro";
import Button from "../../components/ui/Button.astro";
import { site } from "../../data/site";
---

<BaseLayout title="Give" description={`Support ${site.name} through online giving.`}>
  <div class="stack">
    <h1>Give</h1>
    <BudgetProgress />

    <section class="card stack">
      <h2>Thank you for your generosity</h2>
      <p class="muted">
        Your giving supports ministry, outreach, and the mission of our church.
      </p>

      <div class="cluster">
        <Button href={site.portals.givingUrl} external variant="secondary">Give Online</Button>
        <Button href="/connect/contact" variant="tertiary">Questions?</Button>
      </div>

      <p class="small muted">
        If you prefer to give in person, you can also give during worship service.
      </p>
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/styles/tokens.css">
/* Design tokens: colors, typography, spacing, radius, shadows
   - Keep these as the single source of truth for styling.
   - All component/page CSS should reference variables from here.
*/

:root {
  /* Typography */
  --font-family-sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue",
    Arial, "Noto Sans", "Liberation Sans", sans-serif;

  /* Font sizes (step scale) */
  --font-size-0: 0.95rem;
  --font-size-1: 1rem;
  --font-size-2: 1.15rem;
  --font-size-3: 1.35rem;
  --font-size-4: 1.7rem;
  --font-size-5: 2.2rem;

  /* Type ramp tokens */
  --type-scale-h1-size: var(--font-size-5);
  --type-scale-h1-line-height: 1.2;
  --type-scale-h1-weight: 800;
  --type-scale-h1-letter-spacing: -0.02em;

  --type-scale-h2-size: var(--font-size-4);
  --type-scale-h2-line-height: 1.3;
  --type-scale-h2-weight: 700;
  --type-scale-h2-letter-spacing: -0.02em;

  --type-scale-h3-size: var(--font-size-3);
  --type-scale-h3-line-height: 1.4;
  --type-scale-h3-weight: 700;

  --type-scale-body-size: var(--font-size-2);
  --type-scale-body-line-height: 1.65;
  --type-scale-body-letter-spacing: 0;

  --type-scale-small-size: var(--font-size-0);
  --type-scale-small-line-height: 1.45;

  /* Spacing scale (fixes missing vars used across the repo) */
  --space-0: 0;
  --space-1: 0.25rem;  /* 4px */
  --space-2: 0.5rem;   /* 8px */
  --space-3: 0.75rem;  /* 12px */
  --space-4: 1rem;     /* 16px */
  --space-5: 1.25rem;  /* 20px  (was missing) */
  --space-6: 1.5rem;   /* 24px */
  --space-7: 1.75rem;  /* 28px  (was missing) */
  --space-8: 2rem;     /* 32px */
  --space-10: 2.5rem;  /* 40px  (was missing) */
  --space-12: 3rem;    /* 48px */
  --space-16: 4rem;    /* 64px */

  /* Radii */
  --radius-2: 0.5rem;
  --radius-3: 0.75rem;
  --radius-4: 1rem;

  /* Shadows */
  --shadow-1: 0 1px 2px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.06);
  --shadow-2: 0 2px 8px rgba(0,0,0,0.10), 0 16px 48px rgba(0,0,0,0.08);

  /* Layout */
  --container-max: 72rem;
  --container-pad: 1.75rem;
  --target-min: 44px;

  /* Brand */
  --color-primary: #6c1d25;
  --color-primary-hover: #4c1117;

  /* Optional deeper shade (used for gradients / emphasis) */
  --color-primary-700: #3b0d12;
  --color-primary-link: var(--color-primary-700);

  /* Neutrals */
  --color-black: #0b0f17;
  --color-text: #0b0f17;
  --color-white: #ffffff;

  --color-gray-50: #f9fafb;
  --color-gray-100: #f3f4f6;
  --color-gray-200: #e5e7eb;
  --color-gray-300: #d1d5db;
  --color-gray-600: #4b5563;

  /* Surfaces */
  --color-surface: #ffffff;
  --color-surface-2: #f3f4f6;
  --color-surface-muted: #f9fafb;

  --color-border: #e5e7eb;

  /* Text accents */
  --color-text-muted: #4b5563;

  /* Alias used in a few components */
  --color-muted: var(--color-text-muted);

  /* Semantic colors */
  --color-info-border: #d6b5b8; /* brand-tinted info */
  --color-info-bg: #fbf3f4;

  --color-warn-border: #f59e0b;
  --color-warn-bg: #fff7ed;

  --color-danger: #b00020;
  --color-danger-border: #b91c1c;
  --color-danger-bg: #fee2e2;

  --color-success-border: #34d399;
  --color-success-bg: #ecfdf5;

  /* Alias used by connect-card page */
  --color-secondary: var(--color-danger);

  /* Focus */
  --color-focus: #2563eb;
  --focus-ring: 3px solid var(--color-focus);
}
</file>

<file path="web/playwright.config.ts">
import { defineConfig, devices } from "@playwright/test";

const HOST = "127.0.0.1";
const PORT = 4321;
const BASE_URL = process.env.PLAYWRIGHT_BASE_URL ?? `http://${HOST}:${PORT}/`;

export default defineConfig({
  testDir: "./tests/e2e",
  fullyParallel: true,
  use: {
    baseURL: BASE_URL,
    trace: "retain-on-failure",
  },
  projects: [
    {
      name: "chromium",
      use: { ...devices["Desktop Chrome"] },
    },
    {
      name: "firefox-smoke",
      use: { ...devices["Desktop Firefox"] },
      testMatch: /.*smoke\.spec\.ts/,
    },
    {
      name: "webkit-smoke",
      use: { ...devices["Desktop Safari"] },
      testMatch: /.*smoke\.spec\.ts/,
    },
    {
      name: "mobile-smoke",
      use: { ...devices["iPhone 13"] },
      testMatch: /.*smoke\.spec\.ts/,
    },
  ],
  webServer: {
    command: `npm run build && npx wrangler dev --local --ip ${HOST} --port ${PORT} --log-level error`,
    url: BASE_URL,
    timeout: 120 * 1000,
    reuseExistingServer: !process.env.CI,
  },
});
</file>

<file path="README.md">
# First Springfield Church Website

![CI](https://github.com/josuejero/church-website/actions/workflows/ci.yml/badge.svg) ![Lighthouse CI budget enforced](https://img.shields.io/badge/Lighthouse%20CI-budget%20enforced-brightgreen) [![Live App](https://img.shields.io/badge/app-live-brightgreen.svg)](https://church-website.josuejero.workers.dev/)

This repo hosts the new First Springfield SDA site built with Astro and Cloudflare Workers. The focus is on a fast, accessible experience for worshipers, visitors, and church staff who need schedules, ministries, giving links, and helpful content in a heartbeat.

**Live demo:** https://church-website.josuejero.workers.dev/

## Why this project is a UI-intern-quality repo

- **UI from spec:** the designer handoff lives in [docs/ui-handoff.md](docs/ui-handoff.md), showing how colors, spacing, and layout principles translate into code.
- **Cross-browser smoke:** Playwright runs the Chromium full suite plus Firefox/WebKit smoke tests to prove it works everywhere.
- **Accessibility:** axe scans are part of the CI workflow so every push guards against regressions.
- **Performance:** Lighthouse CI budgets are enforced to keep the experience fast.
- **Cross-device:** Playwright `mobile-smoke` project plus device emulation validate the UI at representative mobile viewports.

## Getting started

1. `cd web`
2. `npm install`
3. `npm run dev`

The remaining scripts live inside `web/package.json`. `npm run build` produces a static output in `web/dist`, and `npm run preview` lets you inspect the production bundle locally before deployment.

## Local development

| Command | Purpose |
| --- | --- |
| `cd web && npm install` | Install dependencies and make the Astro scripts available. |
| `cd web && npm run dev` | Start the Astro dev server at `localhost:4321`. |
| `cd web && npm run qa` | Run `astro check`, Playwright E2E, Linkinator, and Lighthouse locally. |
| `cd web && npm run format` | Format Astro/Svelte files with Prettier + plugins. |

## Tech highlights

- Astro + Cloudflare Workers deliver content-first rendering with partial hydration where it makes the most sense.
- Tokens govern spacing, typography, color, and elevation so the component library stays cohesive.
- Accessibility-first surface rules (focus-visible, skip link, 44px tap targets, semantic headings) keep the site welcoming to everyone.
- Accessibility commitment: We follow WCAG 2.2 intent—44px tap targets, strong focus indicators, meaningful heading hierarchy, and keyboard navigation via the skip link so the UI feels reliable on every device (`web/src/styles/a11y.css`, `web/tests/e2e/phase-7-a11y.spec.ts`).
- A smoke suite (Playwright E2E, Linkinator links, Lighthouse CI) keeps regressions off the branch.
- Performance, accessibility, best practices, and SEO budgets run inside CI so builds never slip below the target thresholds.

## Engineering highlights

- Design tokens and the shared component library keep layout rhythm consistent as new stories land.
- The cross-engine smoke suite stitches together Playwright, link checking, and Lighthouse to prove the experience in multiple browsers.
- CI enforces the lightweight Lighthouse budget plus Playwright/linkinator updates on every push.

## Performance budget (Lighthouse CI)

![Latest Lighthouse CI run](docs/assets/lighthouse-latest.png)

We enforce a small Lighthouse CI budget in order to catch “death by a thousand cuts” (unoptimized images, heavy scripts, accidental layout shifts) before it reaches production:
- The CI workflow now runs `treosh/lighthouse-ci-action`, uploads `web/.lighthouseci` as the `lighthouseci` artifact, and posts a PR comment (`tag: lighthouse-ci`) that links to the temporary HTML report so reviewers see the latest scores without rerunning locally.
- Performance score must stay at or above 0.90.
- Accessibility score must stay at or above 0.95.
- Best Practices score must stay at or above 0.95.
- SEO score must stay at or above 0.95.

Lighthouse category assertions operate on a 0–1 scale in CI configs, so 0.90 corresponds to “90/100 style” expectations. Config: `web/lighthouserc.cjs`. Run locally from the `web/` folder via `npm run lighthouse`.

## Supporting docs

- [Design handoff](docs/ui-handoff.md)
- [Web developer README](web/README.md)
- [Component guide (living style guide)](/components)
- [Community health docs](CONTRIBUTING.md) _(includes CONTRIBUTING, CODE_OF_CONDUCT, SECURITY, LICENSE)_

## Troubleshooting

- If Playwright fails locally, run `npx playwright install --with-deps` and consult Playwright’s docs on CI workflows/setup patterns.
- If Lighthouse CI fails, inspect large images or heavyweight scripts, optimize them, and rerun `npm run lighthouse`; budgets guard performance, accessibility, best practices, and SEO.
</file>

<file path="web/src/components/global/Footer.astro">
---
import { Image } from "astro:assets";
import { site } from "../../data/site";
import { tel } from "../../lib/links";
import churchLogo from "../../assets/photos/church-logo-primary.jpg";

const year = new Date().getFullYear();
const churchPhoneHref = tel(site.contact.phone);
const pastorCellHref = tel(site.contact.pastorCell);
const pastorCellLabel = site.contact.pastorCellLabel ?? "Pastor (call/text)";
const hasPastorCell = Boolean(site.contact.pastorCell && site.contact.pastorCell.trim());
const hasMailing = Boolean(site.contact.mailingAddress && site.contact.mailingAddress.trim().length);
const hasFacebook = Boolean(site.portals.facebookUrl && site.portals.facebookUrl !== "TBD");
const hasYouTube = Boolean(site.portals.youtubeChannelUrl && site.portals.youtubeChannelUrl !== "TBD");

function linkAttrs(item: { href: string; external?: boolean }) {
  return item.external ? { target: "_blank", rel: "noopener noreferrer" } : {};
}

const primaryNavLabels = ["Visit", "Contact"];
const primaryActionLabels = ["Watch Live", "Give"];

const isDefined = <T,>(value: T | undefined | null): value is T => Boolean(value);

const findNav = (label: string) => site.nav.find((item) => item.label === label);
const primaryLinks = [
  findNav("Visit"),
  findNav("Contact")
].filter(isDefined);

const footerNav = site.nav.filter(
  (item) => !primaryNavLabels.includes(item.label) && item.label !== "Privacy"
);
const secondaryActions = site.quickActions.filter((item) => !primaryActionLabels.includes(item.label));
const privacyNavItem = site.nav.find((item) => item.label === "Privacy");
const privacyHref = privacyNavItem?.href ?? "/privacy";
const accessibilityHref = "/accessibility";
---

<footer class="site-footer">
  <div class="inner">
    <div class="left">
      <div class="footer-brand">
        <Image
          src={churchLogo}
          alt={`${site.name} logo`}
          widths={[48, 64, 80]}
          sizes="48px"
          loading="lazy"
          decoding="async"
          class="footer-brand__logo"
        />
        <div>
          <strong>{site.name}</strong>
          <div class="muted footer-brand__address">
            <a href={site.contact.mapsUrl} target="_blank" rel="noopener noreferrer">
              {site.contact.address}
            </a>
          </div>
        </div>
      </div>

      {hasMailing ? (
        <div class="muted small">
          Mail: {site.contact.mailingAddress}
        </div>
      ) : null}

      <div class="muted footer-contact">
        {hasPastorCell ? (
          <div>
            <span class="footer-contact-label">{pastorCellLabel}:</span>
            <a href={pastorCellHref}>{site.contact.pastorCell}</a>
          </div>
        ) : null}
        <div>
          <span class="footer-contact-label">Church:</span>
          <a href={churchPhoneHref}>{site.contact.phone}</a>
        </div>
        <div>
          <a href={`mailto:${site.contact.email}`}>{site.contact.email}</a>
        </div>
      </div>

      <div class="muted small">© {year}</div>
    </div>

    <nav class="right" aria-label="Footer links">
      <div class="col col--primary">
        <div class="col-title">Start here</div>
        <div class="col-body links">
          {primaryLinks.map((item) => (
            <a href={item.href} {...linkAttrs(item)}>
              {item.label}
            </a>
          ))}
        </div>
      </div>

      <div class="col">
        <div class="col-title">Explore</div>
        <div class="col-body links">
          {footerNav.map((item) => (
            <a href={item.href} {...linkAttrs(item)}>
              {item.label}
            </a>
          ))}
        </div>
        <div class="footer-policy-links">
          <a href={privacyHref}>Privacy</a>
          <a href={accessibilityHref}>Accessibility</a>
        </div>
      </div>

      <div class="col">
        <div class="col-title">Quick actions</div>
        <div class="col-body links">
          {secondaryActions.map((item) => (
            <a href={item.href} {...linkAttrs(item)}>
              {item.label}
            </a>
          ))}
          {hasYouTube ? (
            <a href={site.portals.youtubeChannelUrl} target="_blank" rel="noopener noreferrer">
              YouTube
            </a>
          ) : null}
          {hasFacebook ? (
            <a href={site.portals.facebookUrl} target="_blank" rel="noopener noreferrer">
              Facebook
            </a>
          ) : null}
        </div>
      </div>

      <div class="col">
        <div class="col-title">Service times</div>
        <div class="col-body muted small">
          {site.schedule.map((s) => (
            <div class="line">
              <span class="day">{s.day}</span>
              <span aria-hidden="true"> · </span>
              <span class="time">{s.time}</span>
              <span aria-hidden="true"> — </span>
              <span class="label">{s.label}</span>
            </div>
          ))}
        </div>
      </div>

    </nav>
  </div>
</footer>

<style>
  .site-footer {
    border-top: 1px solid var(--color-border);
    background: var(--color-white);
  }

  .footer-brand {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .footer-brand__logo {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-3);
    object-fit: contain;
  }

  .footer-brand__address {
    margin-top: var(--space-1);
  }

  .inner {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: var(--space-6) var(--container-pad);
    display: flex;
    gap: var(--space-6);
    justify-content: space-between;
    flex-wrap: wrap;
    align-items: flex-start;
  }

  .muted {
    color: var(--color-text-muted);
    margin-top: var(--space-2);
  }

  .footer-contact {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    margin-top: var(--space-2);
  }

  .footer-contact-label {
    font-weight: 600;
    margin-right: 0.35rem;
  }

  .small {
    font-size: 0.95rem;
  }

  .left a {
    color: inherit;
  }

  .right {
    display: flex;
    gap: var(--space-6);
    flex-wrap: wrap;
    align-items: flex-start;
  }

  .col {
    min-width: 190px;
    display: grid;
    gap: var(--space-2);
  }

  .col-title {
    font-weight: 800;
    letter-spacing: -0.01em;
  }

  .col--primary .col-title {
    color: var(--color-text);
  }

  .col-body {
    display: grid;
    gap: var(--space-2);
  }

  .line .day,
  .line .time,
  .line .label {
    white-space: nowrap;
  }

  .links a,
  .footer-policy-links a {
    display: inline-flex;
    align-items: center;
    min-height: var(--target-min);
    padding: 0.2rem 0;
    text-decoration: none;
    color: inherit;
    opacity: 0.9;
    font-weight: 600;
  }

  .links a:hover,
  .footer-policy-links a:hover {
    opacity: 1;
    text-decoration: underline;
  }

  .footer-policy-links {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
    margin-top: var(--space-1);
  }

  @media (max-width: 520px) {
    .col {
      min-width: 100%;
    }
  }
</style>
</file>

<file path="web/src/content/ministries/children.md">
---
title: "Children’s Ministry"
summary: "Nurturing every child to know Jesus through story, song, and a safe, joyful community."
leaderName: "Giselle Davey"
leaderEmail: "firstspringfieldsda@gmail.com"
meetingTime: "Sabbath mornings (see programs below)"
category: "Children & Youth"
ctaLabel: "Contact us"
ctaHref: "/connect/contact"
tags: ["kids", "families", "faith formation"]
---

## Children’s Ministry

Coordinator: Giselle Davey

The mission of the Children’s Ministries Department is to nurture children of every age into a loving, serving relationship with Jesus. We are committed to creating a safe, joyful, and faith-filled environment where every child can grow spiritually, emotionally, socially, and mentally while learning how deeply they are loved by God.

We seek to fulfill this mission by partnering closely with families to encourage Bible learning, worship, service, and fellowship through programs that welcome the whole child.

### Our Programs & Meeting Times

- • Sabbath School begins every Sabbath at 10:00 AM, offering engaging Bible-based lessons for children of all ages.
- • Children’s Choir Practice takes place every Sabbath from 10:55–11:10 AM, helping kids worship God through music and shared praise.
- • Children’s Church is held on the first and third Sabbath of each month, immediately following the Children’s Story, starting June 2026. Children’s Church is designed for children ages 3–9 and includes Bible stories, crafts, singing, a short sermonette, and snacks. For the safety of all children, parents are required to sign children in and out each Sabbath. All other Children’s Ministry programs are open to every child in Springfield and beyond.
- • Vacation Bible School (VBS): July 28 to July 30 from 6 pm to 7:15 pm.

Through these ministries, we aim to help children build faith, grow friendships, serve others, and develop a strong foundation that will guide them throughout their lives.

### Special Dates

- **Global Children’s Day — March 21, 2026:** We celebrate children worldwide with stories, songs, and acts of kindness, inviting each child to share in the joy of knowing Jesus.
- **Children’s Sabbath — July 25, 2026:** Our worship services highlight children through music, scripture, and stories as they help lead the congregation in gratitude.

### Resources

- https://www.youtube.com/c/adventistchildrensministries
- https://www.faithfinders.com/god-sent-his-son-to-be-my-friend-bible-study-guides
- https://www.gracelink.net/podcast
</file>

<file path="web/src/pages/connect/contact/index.astro">
---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import Schedule from "../../../components/ui/Schedule.astro";
import MapEmbed from "../../../components/ui/MapEmbed.astro";
import { site } from "../../../data/site";
import { tel } from "../../../lib/links";

const phoneHref = tel(site.contact.phone);
const pastorCellHref = tel(site.contact.pastorCell);
const pastorCellLabel = site.contact.pastorCellLabel ?? "Pastor (call/text)";
const pastorDisplayName = site.contact.pastorName ?? "the pastor";
const hasPastorCell = Boolean(site.contact.pastorCell && site.contact.pastorCell.trim());
const hasContactForm = site.portals.contactFormUrl && site.portals.contactFormUrl !== "TBD";
const hasFacebook = site.portals.facebookUrl && site.portals.facebookUrl !== "TBD";
const hasYouTube = site.portals.youtubeChannelUrl && site.portals.youtubeChannelUrl !== "TBD";
const hasMailing = Boolean(site.contact.mailingAddress && site.contact.mailingAddress.trim().length);
---

<BaseLayout
  title="Contact"
  description={`Contact ${site.name}: address, service times, phone, and email.`}
>
  <div class="stack">
    <h1>Contact</h1>

    <section class="card stack" aria-labelledby="contact-address">
      <h2 id="contact-address">Address</h2>
      <p class="muted">
        <a href={site.contact.mapsUrl} target="_blank" rel="noopener noreferrer">{site.contact.address}</a>
      </p>

      {hasMailing ? (
        <p class="small muted">
          Mail: {site.contact.mailingAddress}
        </p>
      ) : null}

      <div class="cluster">
        <Button href={site.contact.mapsUrl} external variant="secondary">Open in Maps</Button>
        <Button href="/connect/plan-a-visit" variant="tertiary">Plan a Visit</Button>
      </div>
      </section>

      <section class="card stack" aria-labelledby="contact-map">
        <h2 id="contact-map">Map</h2>
        <p class="muted">
          Prefer Google Maps? <a href={site.contact.mapsUrl} target="_blank" rel="noopener noreferrer">Open directions</a>.
        </p>
        <MapEmbed src={site.map.embedSrc} title={`${site.name} location map`} />
      </section>

    <Schedule title="Service Times" items={site.schedule} />

    {hasPastorCell ? (
      <section class="card stack" aria-labelledby="contact-pastor">
        <h2 id="contact-pastor">{pastorCellLabel}</h2>
        <p class="muted">
          The church phone may not be answered 24/7. For a faster response, call or text {pastorDisplayName}:
          <a href={pastorCellHref}>{site.contact.pastorCell}</a>
        </p>
      </section>
    ) : null}

    <section class="card stack" aria-labelledby="contact-phone">
      <h2 id="contact-phone">Phone</h2>
      <p class="muted">
        <a href={phoneHref}>{site.contact.phone}</a>
      </p>
      <p class="small muted">
        If nobody answers, please leave a message and include a callback number.
      </p>
    </section>

    <section class="card stack--tight" aria-labelledby="contact-email">
      <h2 id="contact-email">Email</h2>
      <p class="muted">
        <a href={`mailto:${site.contact.email}`}>{site.contact.email}</a>
      </p>
    </section>

    <section class="card stack" aria-labelledby="contact-watch-give">
      <h2 id="contact-watch-give">Watch &amp; Give</h2>
      <p class="muted">
        Watch live (when available) or give online.
      </p>

      <div class="cluster">
        <Button href="/media/live" variant="secondary">Watch Live</Button>
        <Button href="/give" variant="tertiary">Give</Button>
        {hasYouTube ? (
          <Button href={site.portals.youtubeChannelUrl} external variant="tertiary">YouTube</Button>
        ) : null}
        {hasFacebook ? (
          <Button href={site.portals.facebookUrl} external variant="tertiary">Facebook</Button>
        ) : null}
      </div>
    </section>

    <section class="card stack" aria-labelledby="contact-form">
      <h2 id="contact-form">Message us</h2>
      {hasContactForm ? (
        <>
          <p class="muted">
            Use our contact form and we’ll follow up as soon as possible.
          </p>
          <Button href={site.portals.contactFormUrl} external variant="secondary">Open contact form</Button>
          <p class="small muted">
            Please avoid including sensitive information.
          </p>
        </>
      ) : (
        <p class="muted">
          A contact form is coming soon. For now, please call or email us.
        </p>
      )}
    </section>
  </div>
</BaseLayout>
</file>

<file path="web/src/components/sections/HeroBanner.astro">
---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import HeroUI from "../ui/Hero.astro";

export type Props = {
  title: string;
  subtitle?: string;
  primaryCtaLabel?: string;
  primaryCtaHref?: string;
  secondaryCtaLabel?: string;
  secondaryCtaHref?: string;

  background: ImageMetadata;

  /**
   * Keep the bridge centered-ish.
   * Example: "50% 55%" (x y)
   */
  objectPosition?: string;
};

const {
  background,
  objectPosition = "50% 55%",
  ...heroProps
} = Astro.props as Props;
const hasMetaSlot = Boolean(Astro.slots?.meta);
---

<section class="heroBanner fullbleed" style={`--hero-object-position:${objectPosition};`}>
  <div class="heroBanner__media" aria-hidden="true">
    <Image
      src={background}
      alt=""
      widths={[640, 960, 1280, 1600, 1920]}
      sizes="100vw"
      loading="eager"
      decoding="async"
      fetchpriority="high"
      class="heroBanner__img"
    />
    <div class="heroBanner__scrim" aria-hidden="true"></div>
  </div>

  <div class="heroBanner__content">
    <HeroUI {...heroProps} className="hero-card">
      {hasMetaSlot ? <slot name="meta" slot="meta" /> : null}
    </HeroUI>
  </div>
</section>

<style>
  .heroBanner {
    position: relative;
    min-height: clamp(62vh, 70vh, 80vh);
    border-bottom: 1px solid var(--color-border);
    overflow: hidden;
    --hero-content-offset-x: clamp(var(--space-4), 3vw, var(--space-7));
    --hero-content-offset-y: clamp(var(--space-5), 5vw, var(--space-7));
  }

  .heroBanner__media {
    position: absolute;
    inset: 0;
  }

  .heroBanner__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: var(--hero-object-position);
    transform: scale(1.02);
  }

  .heroBanner__scrim {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      rgba(8, 11, 18, 0.75) 0%,
      rgba(11, 15, 23, 0.68) 45%,
      rgba(11, 15, 23, 0.85) 100%
    );
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
  }

  .heroBanner__content {
    position: relative;
    z-index: 1;
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    width: 100%;
    padding: var(--hero-content-offset-y) 0 0 var(--hero-content-offset-x);
  }

  /* Keep the existing “card” look, but make it sit nicely on the photo */
:global(.heroBanner .hero.card) {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-color: var(--color-border);
    border-radius: var(--radius-4);
    box-shadow: var(--shadow-1);
    max-width: min(440px, 100%);
    padding: var(--space-6);
  }

  @media (max-width: 720px) {
    .heroBanner {
      min-height: 55vh;
      --hero-content-offset-x: var(--space-4);
      --hero-content-offset-y: var(--space-4);
      --hero-object-position: 50% 50%;
    }
  }

  @media (prefers-reduced-data: reduce) {
    .heroBanner__media {
      display: none;
    }
    .heroBanner {
      background: var(--color-surface-2);
    }
  }
</style>
</file>

<file path="web/src/styles/global.css">
@import "./tokens.css";

/* Global baseline styles
   - Low-specificity defaults
   - Utility classes
   - Layout primitives
*/

:root {
  color-scheme: light;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  padding: 0;
  margin: 0;
}

body {
  font-family: var(--font-family-sans);
  color: var(--color-text);
  background: var(--color-surface);
  font-size: var(--type-scale-body-size);
  line-height: var(--type-scale-body-line-height);
}

img {
  max-width: 100%;
  height: auto;
}

a {
  color: var(--color-primary-link);
  font-weight: 600;
  text-decoration: underline;
  text-underline-offset: 0.18em;
  text-decoration-thickness: 0.16em;
}

a:hover {
  color: var(--color-primary-hover);
  text-decoration-thickness: 0.19em;
}

/* Focus styles (WCAG-friendly: visible, thick enough, offset from element) */
:where(a, button, summary, input, select, textarea, [role="button"], [tabindex]):focus-visible {
  outline: var(--focus-ring);
  outline-offset: 3px;
}

/* Prevent accidental focus rings when clicking */
:where(a, button, summary, input, select, textarea, [role="button"], [tabindex]):focus:not(:focus-visible) {
  outline: none;
}

.container {
  width: min(var(--container-max), calc(100% - var(--container-pad) * 2));
  margin: 0 auto;
}

.main {
  padding: var(--space-8) var(--container-pad);
}

h1,
h2,
h3,
h4 {
  margin: 0;
  font-weight: 700;
}

h1 {
  font-size: var(--type-scale-h1-size);
  line-height: var(--type-scale-h1-line-height);
  font-weight: var(--type-scale-h1-weight);
  letter-spacing: var(--type-scale-h1-letter-spacing);
}

h2 {
  font-size: var(--type-scale-h2-size);
  line-height: var(--type-scale-h2-line-height);
  font-weight: var(--type-scale-h2-weight);
  letter-spacing: var(--type-scale-h2-letter-spacing);
}

h3 {
  font-size: var(--type-scale-h3-size);
  line-height: var(--type-scale-h3-line-height);
  font-weight: var(--type-scale-h3-weight);
}

h4 {
  font-size: var(--font-size-2);
  line-height: 1.4;
}

p {
  margin: 0;
  font-size: var(--type-scale-body-size);
  line-height: var(--type-scale-body-line-height);
  color: var(--color-text);
}

.small {
  font-size: var(--type-scale-small-size);
  line-height: var(--type-scale-small-line-height);
}

.text-body {
  font-size: var(--type-scale-body-size);
  line-height: var(--type-scale-body-line-height);
  color: var(--color-text);
}

.section-heading {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  margin: 0;
}

.section-heading--horizontal {
  flex-direction: row;
  flex-wrap: wrap;
  align-items: baseline;
  justify-content: space-between;
  gap: var(--space-4);
}

.section-heading__copy {
  min-width: 0;
  flex: 1;
}

.section-heading__action {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  justify-content: flex-end;
}

.section-heading__action > * {
  flex-shrink: 0;
}

.section-heading__title {
  margin: 0;
}

.section-heading__subtitle {
  margin: 0;
  color: var(--color-text-muted);
  font-size: var(--type-scale-body-size);
  line-height: var(--type-scale-body-line-height);
}
.muted { color: var(--color-text-muted); }
.center { text-align: center; }

button { font: inherit; }

hr {
  border: 0;
  border-top: 1px solid var(--color-border);
  margin: var(--space-6) 0;
}

/* Card utility */
.card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-4);
  padding: var(--space-6);
  box-shadow: var(--shadow-1);
  transition: box-shadow 180ms ease, border-color 180ms ease, transform 180ms ease;
}

.card--muted { background: var(--color-surface-muted); }

.card--featured {
  box-shadow: var(--shadow-2);
  border-color: color-mix(in oklab, var(--color-border) 72%, var(--color-primary) 28%);
}

.card--link {
  display: block;
  color: inherit;
  text-decoration: none;
  transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
}

.card--link:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-2);
  border-color: color-mix(in oklab, var(--color-border) 70%, var(--color-primary) 30%);
}

.card--link:focus-visible {
  outline: var(--focus-ring);
  outline-offset: 3px;
}

.link {
  color: var(--color-primary-link);
  font-weight: 600;
  text-decoration: underline;
  text-underline-offset: 0.18em;
  text-decoration-thickness: 0.19em;
}

/* Badges + chips (used in /components and content pages) */
.badge,
.chip {
  display: inline-flex;
  align-items: center;
  min-height: 1.8rem;
  padding: 0.15rem 0.55rem;
  border-radius: 999px;
  border: 1px solid var(--color-border);
  background: color-mix(in oklab, var(--color-surface) 92%, black 8%);
  font-size: 0.85rem;
  font-weight: 700;
  letter-spacing: 0.02em;
  line-height: 1.2;
}

.badge--primary {
  border-color: color-mix(in oklab, var(--color-primary) 45%, var(--color-border) 55%);
  background: color-mix(in oklab, var(--color-primary) 8%, var(--color-surface) 92%);
  color: var(--color-primary);
}

.badge--warn {
  border-color: var(--color-warn-border);
  background: var(--color-warn-bg);
}

.badge--urgent {
  border-color: var(--color-danger-border);
  background: var(--color-danger-bg);
}

/* Tag list */
.tags {
  list-style: none;
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
  padding: 0;
  margin: 0;
}

.tag {
  font-size: 0.85rem;
  padding: 0.2rem 0.55rem;
  border-radius: 999px;
  border: 1px solid var(--color-border);
  background: color-mix(in oklab, var(--color-surface) 90%, black 10%);
}

/* Forms */
.form {
  display: grid;
  gap: var(--space-6);
}

.form-field {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
}

.form label { font-weight: 700; }

.form :where(input, select, textarea) {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-2);
  padding: var(--space-3);
  font: inherit;
  background: var(--color-white);
}

.form :where(input, select, textarea)::placeholder {
  color: color-mix(in oklab, var(--color-text-muted) 70%, transparent 30%);
}

.form :where(textarea) {
  resize: vertical;
  min-height: 6rem;
}

.required {
  margin-left: 0.25rem;
  color: var(--color-secondary);
}

.form-helper {
  display: block;
  font-size: var(--font-size-0);
  color: var(--color-text-muted);
  font-weight: 400;
}

.form-error {
  margin: 0;
  font-size: var(--font-size-0);
  color: var(--color-danger);
}

/* Prose / rich text */
.prose > * { margin: 0; }
.prose > * + * { margin-top: var(--space-4); }

.prose :where(h2, h3, h4) {
  margin-top: var(--space-6);
  margin-bottom: var(--space-2);
}

.prose :where(ul, ol) { padding-left: 1.4rem; }
.prose :where(li + li) { margin-top: var(--space-2); }

.prose :where(blockquote) {
  margin-left: 0;
  padding-left: var(--space-4);
  border-left: 3px solid var(--color-border);
  color: var(--color-text-muted);
}

.prose :where(code) {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.95em;
  padding: 0.1rem 0.3rem;
  border-radius: 0.4rem;
  background: color-mix(in oklab, var(--color-surface-2) 80%, black 20%);
}

.prose :where(pre) {
  overflow: auto;
  padding: var(--space-4);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-3);
  background: var(--color-surface-2);
}

.prose :where(pre code) {
  padding: 0;
  background: transparent;
  border-radius: 0;
}

.prose :where(table) {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid var(--color-border);
}

.prose :where(th, td) {
  border-top: 1px solid var(--color-border);
  padding: var(--space-2) var(--space-3);
  text-align: left;
  vertical-align: top;
}

.prose :where(th) {
  background: var(--color-surface-2);
  font-weight: 800;
}

.prose :where(img) {
  border-radius: var(--radius-3);
  border: 1px solid var(--color-border);
}

/* Layout utilities */
.stack,
.stack--tight,
.stack--loose { display: grid; }

.stack { gap: var(--space-6); }
.stack--tight { gap: var(--space-2); }
.stack--loose { gap: var(--space-8); }

.stack > *,
.stack--tight > *,
.stack--loose > * { margin: 0; }

.cluster {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-3);
}

.cluster--between { justify-content: space-between; }
.cluster--baseline { align-items: baseline; }
.cluster--loose { gap: var(--space-4); }

.grid { display: grid; gap: var(--space-4); }

.grid--cards {
  display: grid;
  gap: var(--space-4);
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.skip-link {
  position: absolute;
  top: var(--space-2);
  left: var(--space-2);
  padding: var(--space-2) var(--space-3);
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-2);
  text-decoration: none;
  transform: translateY(-200%);
  transition: transform 120ms ease;
  z-index: 999;
}

.skip-link:focus { transform: translateY(0); }

@media (max-width: 860px) {
  .main { padding: var(--space-6) 0; }
}
</file>

<file path="web/src/layouts/BaseLayout.astro">
---
import "../styles/global.css";
import "../styles/a11y.css";

import Header from "../components/global/Header.astro";
import Footer from "../components/global/Footer.astro";
import SiteAlert from "../components/global/SiteAlert.astro";
import { site } from "../data/site";
import siteAlert from "../data/site-alert.json";

export type Props = {
  title?: string;
  description?: string;
  noIndex?: boolean;
  ogImagePath?: string; // e.g. "/og/default.png"
  ogType?: "website" | "article";
};

const {
  title,
  description,
  noIndex = false,
  ogImagePath = "/og/default.png",
  ogType = "website",
} = Astro.props;

const pageTitle = title ? `${title} · ${site.shortName}` : site.name;
const pageDescription = description ?? site.description;

const baseUrl = Astro.site ?? new URL(Astro.url.origin);
const canonicalUrl = new URL(Astro.url.pathname, baseUrl).href;
const ogImageUrl = new URL(ogImagePath, baseUrl).href;
const locale = site.locale ?? "en-US";
const ogLocale = locale.replace("-", "_");
const cfAnalyticsToken = import.meta.env.PUBLIC_CF_ANALYTICS_TOKEN;
const analyticsEnabled = import.meta.env.PROD && Boolean(cfAnalyticsToken);
const alertConfig = siteAlert as {
  enabled?: boolean;
  title?: string;
  message?: string;
  href?: string;
  variant?: "info" | "warn";
  updatedAt?: string;
};
const showAlert = Boolean(alertConfig.enabled && alertConfig.title && alertConfig.message);
---

<!doctype html>
<html lang={locale.split("-")[0]}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="sitemap" href="/sitemap-index.xml" />

    <link rel="canonical" href={canonicalUrl} />
    <meta name="robots" content={noIndex ? "noindex,follow" : "index,follow"} />

    <meta property="og:site_name" content={site.name} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:type" content={ogType} />
    <meta property="og:locale" content={ogLocale} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={ogImageUrl} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />
    <meta name="twitter:image" content={ogImageUrl} />

    <slot name="head" />
  </head>
  <body>
    <a class="skip-link" href="#main">Skip to content</a>
    {showAlert ? (
      <SiteAlert
        title={alertConfig.title ?? ""}
        message={alertConfig.message ?? ""}
        href={alertConfig.href}
        variant={alertConfig.variant}
        updatedAt={alertConfig.updatedAt}
      />
    ) : null}
    <Header />
    <main id="main" class="main">
      <div class="container">
        <slot />
      </div>
    </main>
    <Footer />
    {analyticsEnabled ? (
      <script
        is:inline
        defer
        src="https://static.cloudflareinsights.com/beacon.min.js"
        data-cf-beacon={`{"token": "${cfAnalyticsToken}"}`}
      ></script>
    ) : null}
  </body>
</html>
</file>

<file path="web/package.json">
{
  "name": "web",
  "type": "module",
  "version": "0.0.1",
  "private": true,
  "scripts": {
    "patch:yargs-parser": "node scripts/patch-yargs-parser.js",
    "astro": "npm run patch:yargs-parser && NODE_OPTIONS=--max-old-space-size=8192 node ./node_modules/astro/astro.js",
    "dev": "npm run astro -- dev",
    "start": "npm run dev",
    "generate:pagefind-index": "node scripts/generate-pagefind-index.mjs",
    "build": "npm run astro -- build && npm run generate:pagefind-index",
    "preview": "npm run astro -- preview",
    "check": "npm run astro -- check",
    "test:e2e": "npm run build && playwright test",
    "test:e2e:ci": "playwright test",
    "test:links": "npm run build && linkinator ./dist --config ./linkinator.config.json",
    "test:links:ci": "linkinator ./dist --config=./linkinator.config.json",
    "lighthouse": "npm run build && lhci autorun --config=./lighthouserc.cjs",
    "lighthouse:ci": "lhci autorun --config=./lighthouserc.cjs",
    "qa": "npm run check && npm run test:e2e && npm run test:links && npm run lighthouse",
    "format": "prettier --write .",
    "postinstall": "node scripts/patch-yargs-parser.js"
  },
  "dependencies": {
    "@astrojs/check": "0.9.6",
    "@astrojs/cloudflare": "12.6.12",
    "@astrojs/mdx": "^4.3.1",
    "@astrojs/rss": "^4.0.12",
    "@astrojs/sitemap": "^3.5.1",
    "@astrojs/svelte": "^7.0.2",
    "@fontsource-variable/inter": "^5.2.5",
    "astro": "5.17.2",
    "astro-compress": "^2.3.3",
    "astro-icon": "^1.1.5",
    "astro-pagefind": "^1.7.0",
    "gray-matter": "^4.0.3",
    "html-escaper": "3.0.3",
    "node-addon-api": "^8.5.0",
    "sharp": "^0.34.2",
    "svelte": "^5.25.3",
    "zod": "^3.24.2"
  },
  "devDependencies": {
    "@axe-core/playwright": "^4.11.0",
    "@lhci/cli": "^0.15.1",
    "@playwright/test": "^1.51.1",
    "@types/node": "^22.13.9",
    "linkinator": "^7.5.0",
    "node-gyp": "^9.4.1",
    "prettier": "^3.5.3",
    "prettier-plugin-astro": "^0.14.1",
    "prettier-plugin-svelte": "^3.3.3",
    "typescript": "5.9.3"
  }
}
</file>

<file path="web/src/data/site.ts">
import siteLinks from "./site-links.json";
import { recurringActivities } from "./activities";

export type NavItem = {
  label: string;
  href: string;
  external?: boolean;
};

export type ScheduleItem = {
  label: string;
  day: string;
  time: string;
};

export type PortalLinks = {
  givingUrl: string;
  youtubeChannelUrl: string;
  youtubeLiveEmbedUrl: string;
  facebookUrl: string;
  prayerFormUrl: string;
  contactFormUrl: string;
  volunteerFormUrl: string;
  oldWebsiteUrl: string;
  bulletinsUrl?: string;
  announcementsUrl?: string;
};

export type TeamMember = {
  role: string;
  name: string;
  email?: string;
};

export type ContactTopic = {
  topic: string;
  contactRole: string;
  email?: string;
  href?: string;
  hrefLabel?: string;
  external?: boolean;
  note?: string;
};

// Official public contact details (NAD directory / eAdventist).
// If the church requests different public-facing details, update them here.
const PUBLIC_EMAIL = "firstspringfieldsda@gmail.com";
const PASTOR_NAME = "Pastor Abankwa Amoakohene";

const TIME_ZONE = "America/New_York";

const ADDRESS_LINE = "1118 Sumner Ave, Springfield, MA 01118-2154";
const MAPS_URL =
  "https://www.google.com/maps/dir/?api=1&destination=" +
  encodeURIComponent(ADDRESS_LINE);

const VISIT_NOTES = {
  directions: [
    "From I-91: take Exit 6 toward Springfield, then follow signs toward Sumner Ave.",
    "From I-90: take Exit 5, follow signs toward Springfield and take Exit 5, then follow local signs to Sumner Ave.",
  ],
  languageNote:
    "Services are primarily in English. If you need Spanish support, please contact us and we will help.",
  parkingNote:
    "Street parking is available near the church. Please arrive a few minutes early to find a spot.",
  accessibilityNote:
    "If you need accessibility accommodations, please contact us ahead of time so we can assist.",
};

const MISSION = {
  statement:
    "Make disciples of Jesus Christ who live as His loving witnesses and proclaim to all people the everlasting gospel of the Three Angels' Messages in preparation for His soon return (Matt 28:18-20, Acts 1:8, Rev 14:6-12).",
  method:
    "Guided by the Bible and the Holy Spirit, Seventh-day Adventists pursue the mission of making disciples through Christ-like living, healing, serving, proclaiming, teaching, and training.",
  vision:
    "In harmony with Bible revelation, Seventh-day Adventists see as the climax of God's plan the restoration of all His creation to full harmony with His perfect will and righteousness.",
};

// Official portal links live in `site-links.json` so teams have a single editable file.
const portals: PortalLinks = siteLinks as PortalLinks;

const serviceSchedule: ScheduleItem[] = recurringActivities
  .filter(
    (activity) =>
      activity.category === "service" &&
      (activity.day || activity.time || activity.cadence)
  )
  .map((activity) => ({
    label: activity.title,
    day: activity.day ?? "",
    time: activity.time ?? activity.cadence ?? "",
  }));

type TeamSection = "leadership" | "ministries";

type RosterMember = TeamMember & { section: TeamSection };

const teamRoster: RosterMember[] = [
  { role: "Pastor", name: PASTOR_NAME, email: PUBLIC_EMAIL, section: "leadership" },
  { role: "Head Elder", name: "Elder Paul Moulema", email: PUBLIC_EMAIL, section: "leadership" },
  { role: "Head Deacon", name: "Elder Trevor Crossfield", email: PUBLIC_EMAIL, section: "leadership" },
  { role: "Head Deaconess", name: "Belinda Behnava", email: PUBLIC_EMAIL, section: "leadership" },
  { role: "Church Clerk", name: "Myrna L Leiper", email: PUBLIC_EMAIL, section: "leadership" },
  { role: "Assistant Bulletin Secretary", name: "Loreli Gaetki", email: PUBLIC_EMAIL, section: "leadership" },
  {
    role: "Sabbath School Superintendent",
    name: "Elder Paul Moulema",
    email: PUBLIC_EMAIL,
    section: "leadership",
  },
  { role: "Stewardship", name: "Melinda Lajoie", email: PUBLIC_EMAIL, section: "leadership" },
  { role: "Treasurer", name: "Dan Hayes", email: PUBLIC_EMAIL, section: "leadership" },
  {
    role: "Children’s Ministry",
    name: "Giselle Davey",
    email: PUBLIC_EMAIL,
    section: "ministries",
  },
  {
    role: "Youth & Young Adults Ministry",
    name: "Anthia Elliott (AY Director) · Yolann Guirand (AY Assistant Director)",
    email: PUBLIC_EMAIL,
    section: "ministries",
  },
  {
    role: "Women’s Ministry",
    name: "Yejide Bell · Ada Durand · Maxine Griffiths · Sharon Luszcz",
    email: PUBLIC_EMAIL,
    section: "ministries",
  },
  {
    role: "Adventist Community Services (ACS)",
    name: "Brenda St George · Belinda Behnava · Donald Moore · Gabriele Moore · Carolyn Mutcherson · Pastor Abankwa Amoakohene",
    email: PUBLIC_EMAIL,
    section: "ministries",
  },
  { role: "Pathfinders & Adventurers", name: "Daunette Lemard-Reid", email: PUBLIC_EMAIL, section: "ministries" },
  {
    role: "Sabbath School",
    name: "Elder Paul Moulema · Carol Elliott",
    email: PUBLIC_EMAIL,
    section: "ministries",
  },
  {
    role: "Secretary / Communications",
    name: "Myrna L Leiper · Loreli Gaetki",
    email: PUBLIC_EMAIL,
    section: "ministries",
  },
  { role: "Audiovisual", name: "Josue Marrero", email: PUBLIC_EMAIL, section: "ministries" },
  { role: "Prayer Ministry", name: "Anthia Elliott", email: PUBLIC_EMAIL, section: "ministries" },
  {
    role: "Social Committee",
    name: "Belinda Behnava",
    email: PUBLIC_EMAIL,
    section: "ministries",
  },
  { role: "Health Ministry", name: "Gary Peiffer", email: PUBLIC_EMAIL, section: "ministries" },
  { role: "Communications", name: "Belinda Behnava", email: PUBLIC_EMAIL, section: "ministries" },
  { role: "Music Director", name: "Berline Guirand", email: PUBLIC_EMAIL, section: "ministries" },
];

const leadershipTeam = teamRoster.filter((member) => member.section === "leadership");
const ministryLeads = teamRoster.filter((member) => member.section === "ministries");

const hasVolunteerForm =
  portals.volunteerFormUrl && portals.volunteerFormUrl !== "TBD";
const hasPrayerForm = portals.prayerFormUrl && portals.prayerFormUrl !== "TBD";
const bulletinsLink =
  portals.bulletinsUrl && portals.bulletinsUrl !== "TBD"
    ? portals.bulletinsUrl
    : "/resources/bulletins";
const announcementsLink =
  portals.announcementsUrl && portals.announcementsUrl !== "TBD"
    ? portals.announcementsUrl
    : "/resources/announcements";
const prayerLink = hasPrayerForm ? portals.prayerFormUrl ?? "/connect/prayer" : "/connect/prayer";
const volunteerLink = hasVolunteerForm ? portals.volunteerFormUrl ?? "/serve" : "/serve";
const isExternalUrl = (href: string) => /^https?:\/\//.test(href);

const contactTopics: ContactTopic[] = [
  {
    topic: "First-time visit questions",
    contactRole: "Greeter / Hospitality",
    email: PUBLIC_EMAIL,
    note: "Happy to answer questions about parking, what to expect, and children’s programs.",
  },
  {
    topic: "Bible study",
    contactRole: "Pastor",
    email: PUBLIC_EMAIL,
    note: "We can connect you with a study group or set up a visit.",
  },
  {
    topic: "Prayer Request",
    contactRole: "Prayer Team",
    email: PUBLIC_EMAIL,
    href: hasPrayerForm ? portals.prayerFormUrl : "/connect/contact",
    hrefLabel: hasPrayerForm ? "Open prayer form" : "Contact us",
    external: hasPrayerForm ? true : false,
  },
  {
    topic: "Need help choosing a ministry",
    contactRole: "Pastor",
    email: PUBLIC_EMAIL,
    note: "If you are unsure who to contact, start here.",
  },
  {
    topic: "Volunteering",
    contactRole: "Ministry Leads",
    email: PUBLIC_EMAIL,
    href: hasVolunteerForm ? portals.volunteerFormUrl : "/connect/contact",
    hrefLabel: hasVolunteerForm ? "Open volunteer form" : "Contact us",
    external: hasVolunteerForm ? true : false,
  },
  {
    topic: "Giving questions",
    contactRole: "Treasurer",
    email: PUBLIC_EMAIL,
    href: "/give",
    hrefLabel: "Go to giving page",
  },
];

// Visitor-facing nav (matches real routes and keeps the header feeling “finished”)
const nav: NavItem[] = [
  { label: "Visit", href: "/connect/plan-a-visit" },
  { label: "Contact", href: "/connect/contact" },
  { label: "Connect Card", href: "/connect/connect-card" },
  { label: "About Us", href: "/connect/about" },
  { label: "Our Team", href: "/connect/team" },
  { label: "Ministries", href: "/ministries" },
  { label: "Events", href: "/events" },
  { label: "Privacy", href: "/privacy" },
];

// “Always available” actions (show as buttons in the header)
const quickActions: NavItem[] = [
  { label: "Watch Live", href: "/media/live" },
  { label: "Give", href: "/give" },
  {
    label: "Prayer Request",
    href: prayerLink,
    external: isExternalUrl(prayerLink),
  },
  { label: "Bulletins", href: bulletinsLink, external: isExternalUrl(bulletinsLink) },
  {
    label: "Announcements",
    href: announcementsLink,
    external: isExternalUrl(announcementsLink),
  },
  {
    label: "Volunteer",
    href: volunteerLink,
    external: isExternalUrl(volunteerLink),
  },
];

// Social links used in the legacy footer component
const social: NavItem[] = [];
if (portals.youtubeChannelUrl && portals.youtubeChannelUrl !== "TBD") {
  social.push({
    label: "YouTube",
    href: portals.youtubeChannelUrl,
    external: true,
  });
}
if (portals.facebookUrl && portals.facebookUrl !== "TBD") {
  social.push({ label: "Facebook", href: portals.facebookUrl, external: true });
}

export const site = {
  name: "First Springfield Seventh-day Adventist Church",
  shortName: "First Springfield SDA",
  locale: "en-US",
  timeZone: TIME_ZONE,
  description:
    "A Seventh-day Adventist church community in Springfield, MA. Join us for worship, Bible study, and service.",
  address: {
    street: "1118 Sumner Ave",
    city: "Springfield",
    state: "MA",
    zip: "01118-2154",
  },
  contact: {
    email: PUBLIC_EMAIL,
    phone: "413-782-6260",
    pastorCell: "240-850-9452",
    pastorCellLabel: "Pastor Abankwa Amoakohene (call/text)",
    pastorName: PASTOR_NAME,
    address: ADDRESS_LINE,
    mapsUrl: MAPS_URL,
    // Leave blank unless the church asks for a distinct mailing address.
    mailingAddress: "",
  },

  map: {
    embedSrc:
      "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2961.4635291201326!2d-72.5766111!3d42.1059871!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x3c9b7d2fd5f3b6f2!2sFirst%20Springfield%20Seventh-day%20Adventist%20Church!5e0!3m2!1sen!2sus!4v0000000000000",
    directions: VISIT_NOTES.directions,
  },

  visit: VISIT_NOTES,
  mission: MISSION,

  team: {
    leadership: [
      { name: PASTOR_NAME, role: "Pastor", email: PUBLIC_EMAIL },
      { name: "Head Elder", role: "Elder", email: PUBLIC_EMAIL },
      { name: "Church Clerk", role: "Clerk", email: PUBLIC_EMAIL },
    ],
  },

  schedule: serviceSchedule,
  portals,

  nav,
  quickActions,

  // Used by the legacy footer component
  social,

  // Team page sections
  leadershipTeam,
  ministryLeads,

  // Contact page topics
  contactTopics,
};
</file>

<file path="web/src/pages/index.astro">
---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeroBanner from "../components/sections/HeroBanner.astro";
import CardGrid from "../components/sections/CardGrid.astro";
import EventList from "../components/sections/EventList.astro";
import BudgetProgress from "../components/ui/BudgetProgress.astro";
import HighlightsScroller from "../components/ui/HighlightsScroller.astro";
import PrayerMeetingCallout from "../components/sections/PrayerMeetingCallout.astro";
import RecurringActivities from "../components/sections/RecurringActivities.astro";
import SermonHighlight from "../components/sections/SermonHighlight.astro";
import SectionHeading from "../components/ui/SectionHeading.astro";
import { Image } from "astro:assets";
import { site } from "../data/site";
import heroBg from "../assets/photos/first-springfield-exterior.png";
import bridgeDusk from "../assets/photos/bridge-dusk.jpg";
import churchLogo from "../assets/photos/church-logo-primary.jpg";
import { prayerMeetingDetails } from "../data/activities";
import Button from "../components/ui/Button.astro";
const ministryCards = [
  {
    title: "Children’s Ministry",
    description:
      "Storytelling, worship, choir, and family-focused programs that welcome every child and invite them to grow in Jesus.",
    href: "/ministries/children"
  },
  {
    title: "Pathfinders & Adventurers",
    description:
      "Two vibrant clubs filled with faith, service, and outdoor adventures for children and youth ready to discover purpose together.",
    href: "/ministries/pathfinders"
  },
  {
    title: "Adventist Community Services (ACS)",
    description:
      "Compassionate care, monthly meals, and community outreach that meet the whole person in Springfield and beyond.",
    href: "/ministries/adventist-community-services"
  },
  {
    title: "Women’s Ministry",
    description:
      "Prayer circles, retreats, and service projects that help women grow spiritually and encourage one another in Jesus.",
    href: "/ministries/womens-ministry"
  },
  {
    title: "Social Ministry",
    description:
      "Hospitality, fellowship meals, and celebration events that help members and neighbors build deeper relationships.",
    href: "/ministries/social-ministry"
  }
];
---

<BaseLayout title={site.name} description={site.description}>
  <section class="home-logo" aria-label="First Springfield Church logo">
    <Image
      src={churchLogo}
      alt="First Springfield Seventh-day Adventist Church logo"
      widths={[180, 280, 360]}
      sizes="(max-width: 720px) 60vw, 18vw"
      loading="eager"
      decoding="async"
      class="home-logo__img"
    />
  </section>

  <HeroBanner
    background={heroBg}
    objectPosition="50% 35%"
    title="Welcome"
    subtitle="A vibrant, multicultural Seventh-day Adventist church in the heart of Springfield, MA."
    primaryCtaLabel="Plan a Visit"
    primaryCtaHref="/connect/plan-a-visit"
    secondaryCtaLabel="Watch online"
    secondaryCtaHref="/media/live"
  >
    <div slot="meta" class="index-hero__meta">
      <p class="muted index-hero__meta-copy">
        Looking for a way to introduce yourself or let us know you’re interested in joining a ministry?
        Fill out a Connect Card and our team will follow up.
      </p>
      <Button href="/connect/connect-card" variant="secondary">Submit a Connect Card</Button>
    </div>
  </HeroBanner>

  <div class="home-grid">
    <div class="home-grid__section">
      <PrayerMeetingCallout meeting={prayerMeetingDetails} />
    </div>

    <div class="home-grid__section">
      <HighlightsScroller />
    </div>

    <CardGrid
      title="Ministries"
      subtitle="Find a place to serve, grow, and celebrate with your church family."
      cards={ministryCards}
      columnsMin={320}
      class="home-grid__section home-grid__cards home-grid__cards--ministries"
    />

    <section class="stack home-grid__section home-grid__giving card card--featured" aria-label="Giving">
      <SectionHeading
        title="Giving"
        subtitle="Support First Springfield’s ministries through faithful giving—every gift helps us worship, serve, and reach our neighbors."
      />

      <BudgetProgress />

      <p class="home-grid__giving-copy">
        Your generosity keeps the lights on, feeds neighbors, and helps young disciples grow in faith. Thank you for partnering with us.
      </p>

      <div class="home-grid__giving-cta">
        <Button href="/give">Give online</Button>
        <Button href="/connect/contact" variant="secondary">Connect with stewardship</Button>
      </div>
    </section>

    <section class="photo-montage stack home-grid__section home-grid__photo">
      <div class="photo-montage__intro">
        <p>
          We gather beneath the morning glow of the new entryway and cherish the calm of the familiar bridge-dusk view.
          Both scenes are part of First Springfield’s story; one bright and ready, the other still and reflective.
        </p>
      </div>

      <div class="photo-montage__grid">
        <article class="card photo-card">
          <Image
            src={heroBg}
            alt="First Springfield Church exterior bathed in daylight"
            widths={[440, 660, 880, 1100]}
            sizes="(min-width: 960px) 40vw, 80vw"
            loading="lazy"
            decoding="async"
            class="photo-card__img"
          />
          <div class="photo-card__caption">
            <h3>Sunlit welcome</h3>
            <p>The new front exterior invites you with bright, clear light every day.</p>
          </div>
        </article>

        <article class="card photo-card">
          <Image
            src={bridgeDusk}
            alt="The church and bridge illuminated at dusk"
            widths={[440, 660, 880, 1100]}
            sizes="(min-width: 960px) 40vw, 80vw"
            loading="lazy"
            decoding="async"
            class="photo-card__img"
          />
          <div class="photo-card__caption">
            <h3>Evening stillness</h3>
            <p>The bridge-dusk view keeps watch over Springfield as Sabbath approaches.</p>
          </div>
        </article>
      </div>
    </section>

    <CardGrid
      title="Get Connected"
      cards={[
        {
          title: "About Us",
          description: "Learn our mission and what we believe.",
          href: "/connect/about"
        },
        {
          title: "Adult Sabbath School",
          description: "Discover the mission, goals, and study focus of Adult Sabbath School.",
          href: "/ministries/adult-sabbath-school"
        },
        {
          title: "Worship With Us",
          description: "See when we meet and what to expect.",
          href: "/connect/worship-with-us"
        },
        {
          title: "Prayer Request",
          description: "Share a prayer request with our prayer team.",
          href: "/connect/prayer"
        }
      ]}
      columnsMin={280}
      class="home-grid__section home-grid__cards home-grid__cards--connected"
    />

    <div class="home-grid__section">
      <EventList title="Upcoming Events" />
    </div>

    <div class="home-grid__section">
      <RecurringActivities />
    </div>

    <div class="home-grid__section">
      <SermonHighlight title="Latest Sermon" />
    </div>
  </div>
</BaseLayout>

<style>
  .home-logo {
    margin: var(--space-8) auto 0;
    display: flex;
    justify-content: center;
  }

  .home-logo__img {
    width: min(220px, 80vw);
    height: auto;
    display: block;
  }

  .home-grid {
    width: 100%;
    margin: var(--space-10) 0 0;
    display: grid;
    grid-template-columns: repeat(12, minmax(0, 1fr));
    gap: var(--space-10);
  }

  .home-grid__section {
    grid-column: 1 / -1;
  }

  .home-grid__cards {
    grid-column: 1 / -1;
  }

  .home-grid__giving {
    gap: var(--space-4);
  }

  .home-grid__giving-copy {
    margin: 0;
    color: var(--color-text);
  }

  .home-grid__giving-cta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .photo-montage {
    gap: var(--space-4);
    margin: 0;
    width: 100%;
  }

  .photo-montage__intro p {
    margin: 0;
    max-width: 50rem;
    font-size: var(--type-scale-body-size);
    line-height: var(--type-scale-body-line-height);
    color: var(--color-text);
  }

  .photo-montage__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--space-4);
    width: 100%;
  }

  .photo-card {
    padding: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .photo-card__img {
    height: 225px;
    width: 100%;
    object-fit: cover;
    display: block;
  }

  .photo-card__caption {
    padding: var(--space-3);
  }

  .photo-card__caption h3 {
    margin: 0 0 0.35rem;
    font-size: var(--type-scale-h3-size);
    line-height: var(--type-scale-h3-line-height);
  }

  .photo-card__caption p {
    margin: 0;
    color: var(--color-text-muted);
  }

  @media (max-width: 960px) {
    .home-grid {
      grid-template-columns: repeat(8, minmax(0, 1fr));
    }
  }

  @media (max-width: 640px) {
    .home-grid {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }
  }

  @media (max-width: 720px) {
    .photo-card__img {
      height: 200px;
    }
  }

  .index-hero__meta {
    margin-top: var(--space-4);
    display: grid;
    gap: var(--space-3);
  }

  .index-hero__meta-copy {
    margin: 0;
  }
</style>
</file>

</files>
