---
import { site } from "../data/site";

const pathname = Astro.url.pathname;

function isActive(href: string) {
  if (href === "/") return pathname === "/";
  return pathname === href || pathname.startsWith(href + "/");
}

function linkAttrs(item: { href: string; external?: boolean }) {
  return item.external
    ? { target: "_blank", rel: "noopener noreferrer" }
    : {};
}
---

<header class="header">
  <div class="container header__inner">
    <div class="header__brand">
      <a href="/">{site.shortName}</a>
      <div class="small muted">Site under construction (MVP)</div>
    </div>

    <div class="header__desktop" aria-label="Header navigation">
      <nav class="nav" aria-label="Primary navigation">
        {site.nav.map((item) => (
          <a
            href={item.href}
            aria-current={isActive(item.href) ? "page" : undefined}
            {...linkAttrs(item)}
          >
            {item.label}
          </a>
        ))}
      </nav>

      <nav class="nav" aria-label="Quick actions">
        {site.quickActions.map((item) => (
          <a
            href={item.href}
            style="font-weight: 700;"
            aria-current={isActive(item.href) ? "page" : undefined}
            {...linkAttrs(item)}
          >
            {item.label}
          </a>
        ))}
      </nav>
    </div>

    <div class="header__mobile">
      <details class="menu">
        <summary aria-label="Open menu">Menu</summary>
        <div class="menu__panel" aria-label="Mobile menu">
          <div>
            <div class="menu__sectionTitle">Navigate</div>
            <nav class="nav" aria-label="Primary navigation (mobile)">
              {site.nav.map((item) => (
                <a
                  href={item.href}
                  aria-current={isActive(item.href) ? "page" : undefined}
                  {...linkAttrs(item)}
                >
                  {item.label}
                </a>
              ))}
            </nav>
          </div>

          <div>
            <div class="menu__sectionTitle">Quick actions</div>
            <nav class="nav" aria-label="Quick actions (mobile)">
              {site.quickActions.map((item) => (
                <a
                  href={item.href}
                  style="font-weight: 700;"
                  aria-current={isActive(item.href) ? "page" : undefined}
                  {...linkAttrs(item)}
                >
                  {item.label}
                </a>
              ))}
            </nav>
          </div>
        </div>
      </details>
    </div>
  </div>
</header>

<script>
  // Close the mobile menu when a link is clicked.
  document.addEventListener("click", (e) => {
    const target = e.target;
    if (!(target instanceof HTMLElement)) return;

    const link = target.closest("a");
    const details = target.closest("details.menu");
    if (link && details) details.removeAttribute("open");
  });
</script>