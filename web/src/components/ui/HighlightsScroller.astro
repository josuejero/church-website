---
import weeklyHighlights from "../../data/weekly-highlights.json";

type HighlightItem = {
  text: string;
  href?: string;
  badge?: string;
};

const highlights = weeklyHighlights.filter(
  (item): item is HighlightItem => typeof item?.text === "string" && item.text.trim().length > 0
);
const tickerDuration = highlights.length ? Math.max(highlights.length * 4, 24) : 24;
const marqueeItems = highlights.length ? [...highlights, ...highlights] : [];
const isExternal = (href?: string) => typeof href === "string" && /^https?:\/\//.test(href);
---

{highlights.length > 0 ? (
  <section class="highlights-scroller" aria-label="Weekly highlights ticker">
    <div class="highlights-scroller__window">
      <div
        class="highlights-scroller__track"
        role="list"
        style={`--ticker-duration: ${tickerDuration}s`}
      >
        {marqueeItems.map((item, index) => (
          <div class="highlights-scroller__item" role="listitem" key={`highlight-${index}`}>
            {item.badge ? <span class="highlights-scroller__badge">{item.badge}</span> : null}
            {item.href ? (
              <a
                class="highlights-scroller__link"
                href={item.href}
                target={isExternal(item.href) ? "_blank" : undefined}
                rel={isExternal(item.href) ? "noreferrer" : undefined}
              >
                {item.text}
              </a>
            ) : (
              <span class="highlights-scroller__link">{item.text}</span>
            )}
          </div>
        ))}
      </div>
    </div>
  </section>
) : null}

<style>
  .highlights-scroller {
    margin: var(--space-8) 0;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-3);
    background: var(--color-surface);
    box-shadow: var(--shadow-1);
    overflow: hidden;
  }

  .highlights-scroller__window {
    overflow: hidden;
  }

  .highlights-scroller__track {
    display: flex;
    align-items: center;
    gap: var(--space-5);
    padding: var(--space-3) var(--space-4);
    min-width: 200%;
    animation: highlights-scroll var(--ticker-duration, 32s) linear infinite;
    will-change: transform;
  }

  .highlights-scroller__item {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    border-right: 1px solid var(--color-border);
    padding-right: var(--space-4);
    font-size: 1rem;
    font-weight: 600;
    flex: 0 0 auto;
    white-space: nowrap;
  }

  .highlights-scroller__link {
    color: inherit;
    text-decoration: none;
  }

  .highlights-scroller__link:hover {
    text-decoration: underline;
  }

  .highlights-scroller__badge {
    background: var(--color-gray-100);
    color: var(--color-text-muted);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    border-radius: var(--radius-2);
    padding: 0 var(--space-2);
    height: 1.4rem;
    display: inline-flex;
    align-items: center;
  }

  .highlights-scroller__window:hover .highlights-scroller__track,
  .highlights-scroller__window:focus-within .highlights-scroller__track {
    animation-play-state: paused;
  }

  @keyframes highlights-scroll {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .highlights-scroller__track {
      animation: none;
    }
  }

  @media (max-width: 720px) {
    .highlights-scroller__track {
      gap: var(--space-4);
    }

    .highlights-scroller__item {
      font-size: 0.95rem;
      padding-right: var(--space-3);
    }
  }
</style>
