---
import Button from "../ui/Button.astro";
import YouTubeEmbed from "../media/YouTubeEmbed.astro";
import videos from "../../data/videos.json";
import { site } from "../../data/site";

type Video = {
  title: string;
  date: string;
  youtubeId?: string;
  summary?: string;
};

type Props = {
  title?: string;
};

const { title = "Latest Sermon" } = Astro.props;

const list = (videos as Video[]).slice().sort((a, b) => {
  return new Date(b.date).valueOf() - new Date(a.date).valueOf();
});

const latest = list[0];
const hasEmbed = latest && latest.youtubeId && latest.youtubeId !== "TBD";
const hasYouTube = Boolean(site.portals.youtubeChannelUrl && site.portals.youtubeChannelUrl !== "TBD");

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: "medium",
  timeZone: site.timeZone
});
const meta = latest?.date ? fmt.format(new Date(latest.date)) : undefined;
const youtubeHref = hasYouTube ? site.portals.youtubeChannelUrl : "/media/videos";
---

<section class="stack">
  <h2>{title}</h2>

  {!latest ? (
    <p class="muted">No videos are listed yet.</p>
  ) : (
    <div class="card stack">
      <div class="stack--tight">
        {meta && <p class="muted small">{meta}</p>}
        <h3>{latest.title}</h3>
        {latest.summary && <p class="muted">{latest.summary}</p>}
      </div>

      {hasEmbed ? (
        <YouTubeEmbed
          title={latest.title}
          embedUrl={`https://www.youtube.com/embed/${latest.youtubeId}`}
        />
      ) : (
        <p class="small muted">
          New sermon video coming soon. Check back soon or browse the video archive.
        </p>
      )}

      <div class="cluster">
        <Button href="/media/videos" variant="secondary">More videos</Button>
        {hasYouTube ? (
          <Button href={youtubeHref} external>Open YouTube</Button>
        ) : null}
      </div>
    </div>
  )}
</section>
