---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import HeroUI from "../ui/Hero.astro";

export type Props = {
  title: string;
  subtitle?: string;
  primaryCtaLabel?: string;
  primaryCtaHref?: string;
  secondaryCtaLabel?: string;
  secondaryCtaHref?: string;

  background: ImageMetadata;

  /**
   * Keep the bridge centered-ish.
   * Example: "50% 55%" (x y)
   */
  objectPosition?: string;
};

const {
  background,
  objectPosition = "50% 55%",
  ...heroProps
} = Astro.props as Props;
const hasMetaSlot = Boolean(Astro.slots?.meta);
---

<section class="heroBanner fullbleed" style={`--hero-object-position:${objectPosition};`}>
  <div class="heroBanner__media" aria-hidden="true">
    <Image
      src={background}
      alt=""
      widths={[640, 960, 1280, 1600, 1920]}
      sizes="100vw"
      loading="eager"
      decoding="async"
      fetchpriority="high"
      class="heroBanner__img"
    />
    <div class="heroBanner__scrim" aria-hidden="true"></div>
  </div>

  <div class="heroBanner__content">
    <HeroUI {...heroProps} className="hero-card">
      {hasMetaSlot ? <slot name="meta" slot="meta" /> : null}
    </HeroUI>
  </div>
</section>

<style>
  .heroBanner {
    position: relative;
    min-height: clamp(70vh, 78vh, 95vh);
    border-bottom: 1px solid var(--color-border);
    overflow: hidden;
    --hero-border-radius: var(--radius-4);
    border-radius: var(--hero-border-radius);
    --hero-content-offset-x: clamp(var(--space-4), 3vw, var(--space-7));
    --hero-content-offset-y: clamp(var(--space-5), 5vw, var(--space-7));
  }

  .heroBanner__media {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    overflow: hidden;
  }

  .heroBanner__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: var(--hero-object-position);
    transform: scale(1.02);
    border-radius: inherit;
  }

  .heroBanner__scrim {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      180deg,
      rgba(8, 11, 18, 0.75) 0%,
      rgba(11, 15, 23, 0.68) 45%,
      rgba(11, 15, 23, 0.85) 100%
    );
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
  }

  .heroBanner__content {
    position: relative;
    z-index: 1;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    width: 100%;
    min-height: 100%;
    padding: var(--hero-content-offset-y) var(--hero-content-offset-x);
  }

  /* Keep the existing “card” look, but make it sit nicely on the photo */
:global(.heroBanner .hero.card) {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-color: var(--color-border);
    border-radius: var(--radius-4);
    box-shadow: var(--shadow-1);
    max-width: min(440px, 100%);
    padding: var(--space-6);
  }

  @media (max-width: 720px) {
    .heroBanner {
      min-height: clamp(18rem, 42vh, 26rem);
      --hero-content-offset-x: var(--space-4);
      --hero-content-offset-y: var(--space-4);
      --hero-object-position: 50% 50%;
    }

    :global(.heroBanner .hero.card) {
      padding: var(--space-4);
    }
  }

  @media (prefers-reduced-data: reduce) {
    .heroBanner__media {
      display: none;
    }
    .heroBanner {
      background: var(--color-surface-2);
    }
  }
</style>
