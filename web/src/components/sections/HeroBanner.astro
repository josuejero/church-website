---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import HeroUI from "../ui/Hero.astro";

export type Props = {
  title: string;
  subtitle?: string;
  primaryCtaLabel?: string;
  primaryCtaHref?: string;
  secondaryCtaLabel?: string;
  secondaryCtaHref?: string;

  background: ImageMetadata;

  /**
   * Keep the bridge centered-ish.
   * Example: "50% 55%" (x y)
   */
  objectPosition?: string;
};

const {
  background,
  objectPosition = "50% 55%",
  ...heroProps
} = Astro.props as Props;
---

<section class="heroBanner fullbleed" style={`--hero-object-position:${objectPosition};`}>
  <div class="heroBanner__media" aria-hidden="true">
    <Image
      src={background}
      alt=""
      widths={[640, 960, 1280, 1600, 1920]}
      sizes="100vw"
      loading="eager"
      decoding="async"
      fetchpriority="high"
      class="heroBanner__img"
    />
    <div class="heroBanner__scrim" aria-hidden="true"></div>
  </div>

  <div class="heroBanner__content">
    <div class="heroBanner__container">
      <HeroUI {...heroProps} />
    </div>
  </div>
</section>

<style>
  .heroBanner {
    position: relative;
    padding: var(--space-12) 0;
    border-bottom: 1px solid var(--color-border);
    overflow: hidden;
  }

  .heroBanner__media {
    position: absolute;
    inset: 0;
  }

  .heroBanner__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: var(--hero-object-position);
    transform: scale(1.02);
  }

  .heroBanner__scrim {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      rgba(11, 15, 23, 0.45) 0%,
      rgba(11, 15, 23, 0.18) 45%,
      rgba(11, 15, 23, 0.55) 100%
    );
  }

  .heroBanner__content {
    position: relative;
    z-index: 1;
  }

  /* Match BaseLayout container sizing without nesting issues */
  .heroBanner__container {
    width: min(var(--container-max), calc(100% - var(--container-pad)));
    margin: 0 auto;
  }

  /* Keep the existing “card” look, but make it sit nicely on the photo */
  :global(.heroBanner .hero.card) {
    background: rgba(255, 255, 255, 0.90);
    backdrop-filter: blur(10px);
    border-color: rgba(255, 255, 255, 0.35);
  }

  @media (max-width: 720px) {
    .heroBanner {
      padding: var(--space-8) 0;
    }
    /* Slightly higher crop on mobile so the bridge line stays visible */
    .heroBanner {
      --hero-object-position: 50% 50%;
    }
  }

  @media (prefers-reduced-data: reduce) {
    .heroBanner__media {
      display: none;
    }
    .heroBanner {
      background: var(--color-surface-2);
    }
  }
</style>
