---
import "../styles/global.css";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import { site } from "../data/site";

const { title, description } = Astro.props;

const pageTitle = title ? `${title} | ${site.shortName}` : site.name;
const metaDescription = description ?? site.description;

// Phase 6: analytics is optional and should only run in production.
// PUBLIC_ vars are safe to expose client-side.
const analyticsToken = import.meta.env.PUBLIC_CF_ANALYTICS_TOKEN;
const enableAnalytics = import.meta.env.PROD && Boolean(analyticsToken);
---

<!doctype html>
<html lang={site.locale}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content={metaDescription} />
    <meta name="generator" content={Astro.generator} />
    <title>{pageTitle}</title>

    {/* Allow pages to inject extra <head> tags when needed */}
    <slot name="head" />

    {enableAnalytics && (
      <script
        is:inline
        defer
        src="https://static.cloudflareinsights.com/beacon.min.js"
        data-cf-beacon={JSON.stringify({ token: analyticsToken })}
      ></script>
    )}
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to content</a>

    <div data-pagefind-ignore>
      <Header />
    </div>

    <main id="main-content" class="container" data-pagefind-body>
      <slot />
    </main>

    <div data-pagefind-ignore>
      <Footer />
    </div>
  </body>
</html>