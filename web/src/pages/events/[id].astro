---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import { getCollection, render } from 'astro:content';
import { site } from '../../data/site';

export async function getStaticPaths() {
  const events = await getCollection('events', ({ data }) => {
    return import.meta.env.PROD ? data.draft !== true : true;
  });

  return events.map((event) => ({
    params: { id: event.id },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await render(event);

const fmtDate = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'full',
  timeStyle: 'short',
  timeZone: site.timeZone,
});

const locationName = event.data.locationName ?? "";
const address =
  event.data.address ?? (locationName === site.name ? site.contact.address : "");

const when = event.data.end
  ? `${fmtDate.format(event.data.start)} – ${fmtDate.format(event.data.end)}`
  : fmtDate.format(event.data.start);
---

<BaseLayout title={event.data.title} description={event.data.summary}>
  <Hero title={event.data.title} subtitle={event.data.summary} />

  <section class="stack">
    <div class="card stack--tight">
      <p class="muted"><strong>When:</strong> {when}</p>
      {locationName && (
        <p class="muted"><strong>Where:</strong> {locationName}</p>
      )}
      {address && (
        <p class="muted"><strong>Address:</strong> {address}</p>
      )}
      {event.data.registrationUrl && (
        <p>
          <a class="link" href={event.data.registrationUrl} rel="noopener noreferrer">Register / Learn more</a>
        </p>
      )}
    </div>

    <article class="card">
      <div class="prose">
        <Content />
      </div>
    </article>

    <p><a class="link" href="/events">← Back to Events</a></p>
  </section>
</BaseLayout>
