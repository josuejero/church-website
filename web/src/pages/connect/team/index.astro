---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { site } from "../../../data/site";
import { mailto } from "../../../lib/links";
export const prerender = false;

const isFilled = (value?: string) => Boolean(value && value.trim() && value !== "TBD");
const fallbackName = "Contact us";
const fallbackHref = "/connect/contact";
const fallbackLabel = "Contact us for current details.";
---

<BaseLayout title="Our Team" description={`Meet the leadership and ministry contacts at ${site.name}.`}>
  <div class="stack">
    <h1>Our Team</h1>

    <section class="card stack">
      <h2>Leadership</h2>
      <p class="muted">
        For most questions, starting with the Pastor or Head Elder is a great first step.
      </p>

      <div class="table">
        <div class="row head">
          <div>Role</div>
          <div>Name</div>
          <div>Contact</div>
        </div>

        {(site.leadershipTeam ?? []).map((m) => {
          const name = isFilled(m.name) ? m.name : fallbackName;
          const email = isFilled(m.email) ? m.email : "";

          return (
            <div class="row">
              <div>{m.role}</div>
              <div>{name}</div>
              <div>
                {email ? (
                  <a href={mailto(email, `${m.role} - ${site.shortName}`)}>{email}</a>
                ) : (
                  <a class="link" href={fallbackHref}>{fallbackLabel}</a>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </section>

    <section class="card stack">
      <h2>Ministry Leads</h2>
      <p class="muted">
        Reach out to the ministry lead closest to your question, or use the general email if youâ€™re not sure.
      </p>

      <div class="table">
        <div class="row head">
          <div>Ministry</div>
          <div>Name</div>
          <div>Contact</div>
        </div>

        {(site.ministryLeads ?? []).map((m) => {
          const name = isFilled(m.name) ? m.name : fallbackName;
          const email = isFilled(m.email) ? m.email : "";

          return (
            <div class="row">
              <div>{m.role}</div>
              <div>{name}</div>
              <div>
                {email ? (
                  <a href={mailto(email, `${m.role} - ${site.shortName}`)}>{email}</a>
                ) : (
                  <a class="link" href={fallbackHref}>{fallbackLabel}</a>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </section>

    <section class="card stack">
      <h2>Who to contact for what</h2>
      <p class="muted">
        Not sure who to reach? Start with one of these.
      </p>

      <div class="table">
        <div class="row head">
          <div>Topic</div>
          <div>Contact</div>
          <div>How</div>
        </div>

        {(site.contactTopics ?? []).map((t) => {
          const topicHref = isFilled(t.href) ? t.href : "";
          const topicEmail = isFilled(t.email) ? t.email : "";

          return (
            <div class="row">
              <div>{t.topic}</div>
              <div>{t.contactRole}</div>
              <div class="stack--tight">
                {topicHref ? (
                  <a
                    href={topicHref}
                    target={t.external ? "_blank" : undefined}
                    rel={t.external ? "noopener noreferrer" : undefined}
                  >
                    {t.hrefLabel ?? "Open"}
                  </a>
                ) : topicEmail ? (
                  <a href={mailto(topicEmail, `${t.topic} - ${site.shortName}`)}>{topicEmail}</a>
                ) : (
                  <a class="link" href={fallbackHref}>{fallbackLabel}</a>
                )}
                {t.note ? <div class="small muted">{t.note}</div> : null}
              </div>
            </div>
          );
        })}
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .table {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-2);
    overflow: hidden;
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: var(--space-4);
    padding: var(--space-3) var(--space-4);
    border-top: 1px solid var(--color-border);
    background: var(--color-white);
  }

  .row.head {
    border-top: none;
    background: var(--color-bg);
    font-weight: 800;
  }

  .muted {
    color: var(--color-text-muted);
  }

  .small {
    font-size: 0.95rem;
  }

  @media (max-width: 720px) {
    .row {
      grid-template-columns: 1fr;
      gap: var(--space-2);
    }
  }
</style>
