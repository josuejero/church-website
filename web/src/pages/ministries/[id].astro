---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const ministries = await getCollection("ministries", ({ data }) =>
    import.meta.env.PROD ? data.draft !== true : true
  );
  return ministries.map((m) => ({ params: { id: m.id } }));
}

const { id } = Astro.params;

const ministry = await getEntry("ministries", id!);
if (!ministry) throw new Error(`Ministry not found: ${id}`);

const data: any = (ministry as any).data ?? {};

let Content: any = null;
// Only Markdown/MDX entries have entry.render()
if (typeof (ministry as any).render === "function") {
  const rendered = await (ministry as any).render();
  Content = rendered?.Content ?? null;
}

const title =
  data.title ??
  (typeof id === "string"
    ? id.replace(/[-_]/g, " ").replace(/\b\w/g, (c) => c.toUpperCase())
    : "Ministry");

const description =
  data.description ?? data.summary ?? `Learn more about ${title}.`;
---

<BaseLayout title={title} description={description}>
  <div class="stack">
    <h1 style="margin: 0;">{title}</h1>

    {Content ? (
      <Content />
    ) : (
      <section class="card">
        <p class="muted" style="margin: 0;">{description}</p>
      </section>
    )}
  </div>
</BaseLayout>
