---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import { getCollection, render } from 'astro:content';
import { site } from '../../data/site';

export async function getStaticPaths() {
  const resources = await getCollection('resources', ({ data }) => {
    return import.meta.env.PROD ? data.draft !== true : true;
  });

  return resources.map((resource) => ({
    params: { id: resource.id },
    props: { resource },
  }));
}

const { resource } = Astro.props;
const { Content } = await render(resource);

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'full',
  timeZone: site.timeZone,
});
---

<BaseLayout title={resource.data.title} description={resource.data.summary}>
  <Hero title={resource.data.title} subtitle={resource.data.summary} />

  <section class="stack">
    <div class="card stack--tight">
      <p class="muted"><strong>Published:</strong> {fmt.format(resource.data.published)}</p>
      {resource.data.category && (
        <p class="muted"><strong>Category:</strong> {resource.data.category}</p>
      )}

      {resource.data.attachmentUrl && (
        <p>
          <a class="link" href={resource.data.attachmentUrl}>Download / Open attachment</a>
        </p>
      )}

      {resource.data.externalUrl && (
        <p>
          <a class="link" href={resource.data.externalUrl} rel="noopener noreferrer">Open external link</a>
        </p>
      )}
    </div>

    <article class="card">
      <div class="prose">
        <Content />
      </div>
    </article>

    <p><a class="link" href="/resources">‚Üê Back to Resources</a></p>
  </section>
</BaseLayout>
