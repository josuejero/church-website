---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import ContentCard from '../../components/content/ContentCard.astro';
import { getCollection } from 'astro:content';
import { site } from '../../data/site';

const resources = await getCollection('resources', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const latest = resources
  .sort((a, b) => b.data.published.valueOf() - a.data.published.valueOf())
  .slice(0, 15);

const fmt = new Intl.DateTimeFormat(site.locale, {
  dateStyle: 'medium',
  timeZone: site.timeZone
});
---

<BaseLayout title="Resources" description="Helpful links, forms, bulletins, and downloads.">
  <Hero title="Resources" subtitle="Downloads, forms, and helpful info." />

  <section class="stack--loose">
    <div class="grid--cards">
      <article class="card stack--tight">
        <h3>
          <a class="link" href="/search">Search</a>
        </h3>
        <p class="muted">Find resources, bulletins, and more.</p>
      </article>
      <article class="card stack--tight">
        <h3><a class="link" href="/resources/bulletins">Bulletins</a></h3>
        <p class="muted">Weekly PDFs and archives.</p>
      </article>
      <article class="card stack--tight">
        <h3><a class="link" href="/resources/announcements">Announcements</a></h3>
        <p class="muted">Quick weekly notices for church life and community updates.</p>
      </article>
      <article class="card stack--tight">
        <h3><a class="link" href="/resources/forms">Forms</a></h3>
        <p class="muted">Requests, sign-ups, and contact info.</p>
      </article>
    </div>

    <div class="stack">
      <h2>Latest resources</h2>

      {latest.length === 0 ? (
        <p class="muted">No resources are published yet.</p>
      ) : (
        <div class="grid--cards">
          {latest.map((r) => (
            <ContentCard
              href={`/resources/${r.id}`}
              title={r.data.title}
              summary={r.data.summary}
              meta={fmt.format(r.data.published)}
              tags={r.data.tags}
            />
          ))}
        </div>
      )}
    </div>
  </section>
</BaseLayout>
